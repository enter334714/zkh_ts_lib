var Laya=window.Laya=function(j,a){var k={__internals:[],__packages:{},__classmap:{Object:Object,Function:Function,Array:Array,String:String},__sysClass:{object:"Object",array:"Array",string:"String",dictionary:"Dictionary"},__propun:{writable:!0,enumerable:!1,configurable:!0},__presubstr:String.prototype.substr,__substr:function(a,b){return 1==arguments.length?k.__presubstr.call(this,a):k.__presubstr.call(this,a,0<b?b:this.length+b)},__init:function(a){a.forEach(function(a){a.__init$&&a.__init$()})},__isClass:function(a){return a&&(a.__isclass||a==Object||a==String||a==Array)},__newvec:function(a,b){var c=[];c.length=a;for(var d=0;d<a;d++)c[d]=b;return c},__extend:function(a,b){for(var c in b)if(b.hasOwnProperty(c)){var d=Object.getOwnPropertyDescriptor(b,c),e=d.get,f=d.set;e||f?e&&f?Object.defineProperty(a,c,d):(e&&Object.defineProperty(a,c,e),f&&Object.defineProperty(a,c,f)):a[c]=b[c]}function g(){k.un(this,"constructor",a)}g.prototype=b.prototype,a.prototype=new g,k.un(a.prototype,"__imps",k.__copy({},b.prototype.__imps))},__copy:function(a,b){if(!b)return null;for(var c in a=a||{},b)a[c]=b[c];return a},__package:function(a,b){if(!k.__packages[a]){k.__packages[a]=!0;var c=j,d=a.split(".");if(1<d.length)for(var e=0,f=d.length-1;e<f;e++){var g=c[d[e]];c=g||(c[d[e]]={})}c[d[d.length-1]]||(c[d[d.length-1]]=b||{})}},__hasOwnProperty:function(a,b){return b=b||this,Object.hasOwnProperty.call(b,a)||function a(b,c){if(Object.hasOwnProperty.call(c.prototype,b))return!0;var d=c.prototype.__super;return null==d?null:a(b,d)}(a,b.__class)},__typeof:function(a,b){if(!a||!b)return!1;if(b===String)return"string"==typeof a;if(b===Number)return"number"==typeof a;if(b.__interface__)b=b.__interface__;else if("string"!=typeof b)return a instanceof b;return a.__imps&&a.__imps[b]||a.__class==b},__as:function(a,b){return this.__typeof(a,b)?a:null},__int:function(a){return a?parseInt(a):0},interface:function(a,b){k.__package(a,{});var c=k.__internals,d=c[a]=c[a]||{self:a};if(b){var e=b.split(",");d.extend=[];for(var f=0;f<e.length;f++){var g=e[f];c[g]=c[g]||{self:g},d.extend.push(c[g])}}var h=j,i=a.split(".");for(f=0;f<i.length-1;f++)h=h[i[f]];h[i[i.length-1]]={__interface__:a}},class:function(a,b,c,d){if(c&&k.__extend(a,c),b)if(k.__package(b,a),k.__classmap[b]=a,0<b.indexOf(".")){if(0==b.indexOf("laya.")){var e=b.split(".");d=d||e[e.length-1],k[d]&&console.log("Warning!,this class["+d+"] already exist:",k[d]),k[d]=a}}else"Main"==b?j.Main=a:"MainWX"==b?j.MainWX=a:(k[b]&&console.log("Error!,this class["+b+"] already exist:",k[b]),k[b]=a);var f=k.un,g=a.prototype;f(g,"hasOwnProperty",k.__hasOwnProperty),f(g,"__class",a),f(g,"__super",c),f(g,"__className",b),f(a,"__super",c),f(a,"__className",b),f(a,"__isclass",!0),f(a,"super",function(a){this.__super.call(a)})},imps:function(a,b){if(!b)return null;var e=a.__imps||k.un(a,"__imps",{});function f(a){var b,c;if((b=k.__internals[a])&&(e[a]=!0,c=b.extend))for(var d=0;d<c.length;d++)f(c[d].self)}for(var c in b)f(c)},superSet:function(a,b,c,d){var e=a.prototype["_$set_"+c];e&&e.call(b,d)},superGet:function(a,b,c){var d=a.prototype["_$get_"+c];return d?d.call(b):null},getset:function(a,b,c,d,e){a?(d&&(b["_$GET_"+c]=d),e&&(b["_$SET_"+c]=e)):(d&&k.un(b,"_$get_"+c,d),e&&k.un(b,"_$set_"+c,e)),d&&e?Object.defineProperty(b,c,{get:d,set:e,enumerable:!1,configurable:!0}):(d&&Object.defineProperty(b,c,{get:d,enumerable:!1,configurable:!0}),e&&Object.defineProperty(b,c,{set:e,enumerable:!1,configurable:!0}))},static:function(c,d){for(var e=0,a=d.length;e<a;e+=2)if("length"==d[e])c.length=d[e+1].call(c);else{function b(){var b=d[e],a=d[e+1];Object.defineProperty(c,b,{get:function(){return delete this[b],this[b]=a.call(this)},set:function(a){delete this[b],this[b]=a},enumerable:!0,configurable:!0})}b()}},un:function(a,b,c){return c||(c=a[b]),k.__propun.value=c,Object.defineProperty(a,b,k.__propun),c},uns:function(b,a){a.forEach(function(a){k.un(b,a)})}};return j.console=j.console||{log:function(){}},j.trace=j.console.log,Error.prototype.throwError=function(){throw arguments},Object.defineProperty(Array.prototype,"fixed",{enumerable:!1}),k}(window,document);!function(a,b,c){c.un,c.uns,c.static,c.class,c.getset,c.__newvec}(window,document,Laya),function(g,b,x){x.un,x.uns;var i=x.static,p=x.class,k=x.getset;x.__newvec;x.interface("laya.runtime.IMarket"),x.interface("laya.filters.IFilter"),x.interface("laya.display.ILayout"),x.interface("laya.resource.IDispose"),x.interface("laya.runtime.IPlatform"),x.interface("laya.resource.IDestroy"),x.interface("laya.runtime.IConchNode"),x.interface("laya.filters.IFilterAction"),x.interface("laya.runtime.ICPlatformClass"),x.interface("laya.resource.ICreateResource"),x.interface("laya.runtime.IConchRenderObject"),x.interface("laya.runtime.IPlatformClass","laya.runtime.IPlatform");var D=function(){function f(){}return p(f,"laya.utils.RunDriver"),f.FILTER_ACTIONS=[],f.pixelRatio=-1,f._charSizeTestDiv=null,f.now=function(){return Date.now()},f.getWindow=function(){return g},f.getPixelRatio=function(){if(f.pixelRatio<0){var a=M.context,b=a.backingStorePixelRatio||a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1;(f.pixelRatio=(M.window.devicePixelRatio||1)/b)<1&&(f.pixelRatio=1)}return f.pixelRatio},f.getIncludeStr=function(a){return null},f.createShaderCondition=function(a){var b="(function() {return "+a+";})";return x._runScript(b)},f.fontMap=[],f.measureText=function(a,b){var c=f.hanzi.test(a);if(c&&f.fontMap[b])return f.fontMap[b];var d=M.context;d.font=b;var e=d.measureText(a);return c&&(f.fontMap[b]=e),e},f.getWebGLContext=function(a){},f.beginFlush=function(){},f.endFinish=function(){},f.addToAtlas=null,f.flashFlushImage=function(a){},f.drawToCanvas=function(a,b,c,d,e,f){var g=ta.create("2D"),h=new I(c,d,g);return J.renders[b]._fun(a,h,e,f),g},f.createParticleTemplate2D=null,f.createGLTextur=null,f.createWebGLContext2D=null,f.changeWebGLSize=function(a,b){},f.createRenderSprite=function(a,b){return new J(a,b)},f.createFilterAction=function(a){return new t},f.createGraphics=function(){return new m},f.clear=function(a){H._context.ctx.clear()},f.cancelLoadByUrl=function(a){},f.clearAtlas=function(a){},f.isAtlas=function(a){return!1},f.addTextureToAtlas=function(a){},f.getTexturePixels=function(a,b,c,d,e){return null},f.skinAniSprite=function(){return null},f.update3DLoop=function(){},i(f,["hanzi",function(){return this.hanzi=new RegExp("^[一-龥]$")}]),f}(),d=(k(1,x,"alertGlobalError",null,function(a){var f=0;M.window.onerror=a?function(a,b,c,d,e){f++<5&&e&&alert(e.stack||e)}:null}),x.init=function(a,b,c){for(var d=[],e=2,f=arguments.length;e<f;e++)d.push(arguments[e]);if(!x._isinit){ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=x._arrayBufferSlice),x._isinit=!0,M.__init__(),K.__init__(),m.__init__(),x.timer=new W,x.scaleTimer=new W,x.loader=new ia,$.__init__(),e=0;for(var g=d.length;e<g;e++)d[e].enable&&d[e].enable();return n.__init__(),h.__init__(),L.__init__(),O.beginCheck(),x._currentStage=x.stage=new ra,x.stage.conchModel&&x.stage.conchModel.setRootNode(),x._getUrlPath(),x.render=new H(0,0),x.stage.size(a,b),J.__init__(),l.__init__(),o.instance.__init__(x.stage,H.canvas),va.__init__(),C.autoStopMusic=!0,A.__init__(),H.canvas}},x._getUrlPath=function(){var a=M.window.location,b=a.pathname;b=b&&":"==b.charAt(2)?b.substring(1):b,G.rootPath=G.basePath=G.getPath("file:"==a.protocol?b:a.protocol+"//"+a.host+a.pathname)},x._arrayBufferSlice=function(a,b){var c=new Uint8Array(this,a,b-a),d=new Uint8Array(c.length);return d.set(c),d.buffer},x._runScript=function(a){return M.window[x._evcode](a)},x.stage=null,x.timer=null,x.scaleTimer=null,x.loader=null,x.version="1.8.6",x.render=null,x._currentStage=null,x._isinit=!1,x.isDebug=!1,x.MiniAdpter={init:function(){g.navigator&&g.navigator.userAgent&&-1<g.navigator.userAgent.indexOf("MiniGame")&&console.error("请先引用小游戏适配库laya.wxmini.js,详细教程：https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0")}},i(x,["conchMarket",function(){return this.conchMarket=g.conch?conchMarket:null},"PlatformClass",function(){return this.PlatformClass=g.PlatformClass},"_evcode",function(){return this._evcode="e"+String.fromCharCode(118)+"al"}]),function(){function a(){}return p(a,"Config"),a.WebGLTextCacheCount=500,a.atlasEnable=!1,a.showCanvasMark=!1,a.animationInterval=50,a.isAntialias=!1,a.isAlpha=!1,a.premultipliedAlpha=!0,a.isStencil=!0,a.preserveDrawingBuffer=!1,a}()),j=function(){function j(){this._events=null}p(j,"laya.events.EventDispatcher");var a=j.prototype;return a.hasListener=function(a){return!!(this._events&&this._events[a])},a.event=function(a,b){if(!this._events||!this._events[a])return!1;var c=this._events[a];if(c.lock)c.queue||(c.queue=[]),c.queue.push(b);else{var d;for(c.lock=!0,c.cursor=c.head;c.cursor;)d=c.cursor,c.cursor=d.next,d.once&&j.delNode(c,d),null!=b?d.args?d.method.apply(d.caller,d.args.concat(b)):b instanceof Array?d.method.apply(d.caller,b):d.method.call(d.caller,b):d.method.apply(d.caller,d.args),d.once&&j.recoverHandler(d);c.lock=!1,!c.head&&this._events&&this._events[a]==c&&delete this._events[a],c.queue&&c.queue.length&&this.event(a,c.queue.shift())}return!0},a.on=function(a,b,c,d){return this._createListener(a,b,c,d,!1)},a.once=function(a,b,c,d){return this._createListener(a,b,c,d,!0)},a._createListener=function(a,b,c,d,e,f){void 0===f&&(f=!0),f&&this.off(a,b,c,e);var g=j.createHandler(b||this,c,d,e);this._events||(this._events={});var h=this._events,i=h[a];return i?i.tail?(g.prev=i.tail,i.tail.next=g,i.tail=g):i.head=i.tail=g:h[a]={head:g,tail:g,cursor:null,lock:!1},this},a.off=function(a,b,c,d){if(void 0===d&&(d=!1),!this._events||!this._events[a])return this;for(var e=this._events[a],f=e.head;f;){if((!b||f.caller===b)&&f.method===c&&(!d||f.once)){j.delNode(e,f),e.cursor==f&&(e.cursor=f.next),j.recoverHandler(f);break}f=f.next}return this},a.offAll=function(a){var b=this._events;if(!b)return this;if(a)this._recoverHandlers(b[a]),delete b[a];else{for(var c in b)this._recoverHandlers(b[c]);this._events=null}return this},a._recoverHandlers=function(a){if(a){for(var b=a.head;b;){j.delNode(a,b);var c=b.next;j.recoverHandler(b),b=c}a.cursor=null}},a.isMouseEvent=function(a){return j.MOUSE_EVENTS[a]},j.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0},j.__init$=function(){Object.defineProperty(laya.events.EventDispatcher.prototype,"_events",{enumerable:!1,writable:!0})},j.delNode=function(a,b){b.prev?b.prev.next=b.next:a.head=b.next,b.next?b.next.prev=b.prev:a.tail=b.prev},j.createHandler=function(a,b,c,d){var e=j._freeHandler;return e?(j._freeCount--,j._freeHandler=e.next,e.caller=a,e.method=b,e.args=c,e.once=d):e={caller:a,method:b,args:c,once:d},e.prev=e.next=null,e},j.recoverHandler=function(a){a.caller=a.method=a.args=a.prev=null,a.next=j._freeHandler,j._freeHandler=a,j._freeCount++},j._freeHandler=null,j._freeCount=0,j}(),s=function(){function e(a,b,c,d){this.once=!1,void(this._id=0)===d&&(d=!1),this.setTo(a,b,c,d)}p(e,"laya.utils.Handler");var a=e.prototype;return a.setTo=function(a,b,c,d){return this._id=e._gid++,this.caller=a,this.method=b,this.args=c,this.once=d,this},a.run=function(){if(null==this.method)return null;var a=this._id,b=this.method.apply(this.caller,this.args);return this._id===a&&this.once&&this.recover(),b},a.runWith=function(a){if(null==this.method)return null;var b=this._id;if(null==a)var c=this.method.apply(this.caller,this.args);else c=this.args||a.unshift?this.args?this.method.apply(this.caller,this.args.concat(a)):this.method.apply(this.caller,a):this.method.call(this.caller,a);return this._id===b&&this.once&&this.recover(),c},a.clear=function(){return this.caller=null,this.method=null,this.args=null,this},a.recover=function(){0<this._id&&(this._id=0,this.clear())},e.create=function(a,b,c,d){return void 0===d&&(d=!0),new e(a,b,c,d)},e._gid=1,e}(),B=function(){function a(){this._texture=null,this._fontCharDic={},this._fontWidthMap={},this._complete=null,this._path=null,this._maxWidth=0,this._spaceWidth=10,this._padding=null,this.fontSize=12,this.autoScaleSize=!1,this.letterSpacing=0}p(a,"laya.display.BitmapFont");var b=a.prototype;return b.loadFont=function(a,b){this._path=a,this._complete=b,x.loader.load([{url:this._path,type:"xml"},{url:this._path.replace(".fnt",".png"),type:"image"}],s.create(this,this.onLoaded))},b.onLoaded=function(){this.parseFont(ha.getRes(this._path),ha.getRes(this._path.replace(".fnt",".png"))),this._complete&&this._complete.runWith(this._texture?this:null)},b.parseFont=function(a,b){if(null!=a&&null!=b){this._texture=b;var c=a.getElementsByTagName("info");if(!c[0].getAttributeNode)return this.parseFont2(a,b);this.fontSize=parseInt(c[0].getAttributeNode("size").nodeValue);var d,e=c[0].getAttributeNode("padding").nodeValue.split(",");this._padding=[parseInt(e[0]),parseInt(e[1]),parseInt(e[2]),parseInt(e[3])],d=a.getElementsByTagName("char");var f=0;for(f=0;f<d.length;f++){var g=d[f],h=parseInt(g.getAttributeNode("id").nodeValue),i=parseInt(g.getAttributeNode("xoffset").nodeValue)/1,j=parseInt(g.getAttributeNode("yoffset").nodeValue)/1,k=parseInt(g.getAttributeNode("xadvance").nodeValue)/1,l=new z;l.x=parseInt(g.getAttributeNode("x").nodeValue),l.y=parseInt(g.getAttributeNode("y").nodeValue),l.width=parseInt(g.getAttributeNode("width").nodeValue),l.height=parseInt(g.getAttributeNode("height").nodeValue);var m=ka.create(b,l.x,l.y,l.width,l.height,i,j);this._maxWidth=Math.max(this._maxWidth,k+this.letterSpacing),this._fontCharDic[h]=m,this._fontWidthMap[h]=k}}},b.parseFont2=function(a,b){if(null!=a&&null!=b){this._texture=b;var c=a.getElementsByTagName("info");this.fontSize=parseInt(c[0].attributes.size.nodeValue);var d=c[0].attributes.padding.nodeValue.split(",");this._padding=[parseInt(d[0]),parseInt(d[1]),parseInt(d[2]),parseInt(d[3])];var e=a.getElementsByTagName("char"),f=0;for(f=0;f<e.length;f++){var g=e[f].attributes,h=parseInt(g.id.nodeValue),i=parseInt(g.xoffset.nodeValue)/1,j=parseInt(g.yoffset.nodeValue)/1,k=parseInt(g.xadvance.nodeValue)/1,l=new z;l.x=parseInt(g.x.nodeValue),l.y=parseInt(g.y.nodeValue),l.width=parseInt(g.width.nodeValue),l.height=parseInt(g.height.nodeValue);var m=ka.create(b,l.x,l.y,l.width,l.height,i,j);this._maxWidth=Math.max(this._maxWidth,k+this.letterSpacing),this._fontCharDic[h]=m,this._fontWidthMap[h]=k}}},b.getCharTexture=function(a){return this._fontCharDic[a.charCodeAt(0)]},b.destroy=function(){if(this._texture){for(var a in this._fontCharDic){var b=this._fontCharDic[a];b&&b.destroy()}this._texture.destroy(),this._fontCharDic=null,this._fontWidthMap=null,this._texture=null}},b.setSpaceWidth=function(a){this._spaceWidth=a},b.getCharWidth=function(a){var b=a.charCodeAt(0);return this._fontWidthMap[b]?this._fontWidthMap[b]+this.letterSpacing:" "==a?this._spaceWidth+this.letterSpacing:0},b.getTextWidth=function(a){for(var b=0,c=0,d=a.length;c<d;c++)b+=this.getCharWidth(a.charAt(c));return b},b.getMaxWidth=function(){return this._maxWidth},b.getMaxHeight=function(){return this.fontSize},b.drawText=function(a,b,c,d,e,f){var g,h=this.getTextWidth(a),i=0;"center"===e&&(i=(f-h)/2),"right"===e&&(i=f-h);for(var j=0,k=0,l=a.length;k<l;k++)(g=this.getCharTexture(a.charAt(k)))&&(b.graphics.drawTexture(g,c+j+i,d),j+=this.getCharWidth(a.charAt(k)))},a}(),h=function(){function c(){this.alpha=1,this.visible=!0,this.scrollRect=null,this.blendMode=null,this._type=0,this._tf=c._TF_EMPTY}p(c,"laya.display.css.Style");var a=c.prototype;return a.getTransform=function(){return this._tf},a.setTransform=function(a){this._tf="none"!==a&&a?a:c._TF_EMPTY},a.setTranslateX=function(a){this._tf===c._TF_EMPTY&&(this._tf=new e),this._tf.translateX=a},a.setTranslateY=function(a){this._tf===c._TF_EMPTY&&(this._tf=new e),this._tf.translateY=a},a.setScaleX=function(a){this._tf===c._TF_EMPTY&&(this._tf=new e),this._tf.scaleX=a},a.setScale=function(a,b){this._tf===c._TF_EMPTY&&(this._tf=new e),this._tf.scaleX=a,this._tf.scaleY=b},a.setScaleY=function(a){this._tf===c._TF_EMPTY&&(this._tf=new e),this._tf.scaleY=a},a.setRotate=function(a){this._tf===c._TF_EMPTY&&(this._tf=new e),this._tf.rotate=a},a.setSkewX=function(a){this._tf===c._TF_EMPTY&&(this._tf=new e),this._tf.skewX=a},a.setSkewY=function(a){this._tf===c._TF_EMPTY&&(this._tf=new e),this._tf.skewY=a},a.destroy=function(){this.scrollRect=null},a.render=function(a,b,c,d){},a.getCSSStyle=function(){return ba.EMPTY},a._enableLayout=function(){return!1},k(0,a,"scaleX",function(){return this._tf.scaleX},function(a){this.setScaleX(a)}),k(0,a,"transform",function(){return this.getTransform()},function(a){this.setTransform(a)}),k(0,a,"translateX",function(){return this._tf.translateX},function(a){this.setTranslateX(a)}),k(0,a,"translateY",function(){return this._tf.translateY},function(a){this.setTranslateY(a)}),k(0,a,"scaleY",function(){return this._tf.scaleY},function(a){this.setScaleY(a)}),k(0,a,"block",function(){return 0!=(1&this._type)}),k(0,a,"skewY",function(){return this._tf.skewY},function(a){this.setSkewY(a)}),k(0,a,"rotate",function(){return this._tf.rotate},function(a){this.setRotate(a)}),k(0,a,"skewX",function(){return this._tf.skewX},function(a){this.setSkewX(a)}),k(0,a,"paddingLeft",function(){return 0}),k(0,a,"paddingTop",function(){return 0}),k(0,a,"absolute",function(){return!0}),c.__init__=function(){c._TF_EMPTY=new e,c.EMPTY=new c},c.EMPTY=null,c._TF_EMPTY=null,c}(),n=function(){function b(a){this._type=0,this._weight=0,this._decoration=null,this._text=null,this.indent=0,this._color=Q.create(b.defaultColor),this.family=b.defaultFamily,this.stroke=b._STROKE,this.size=b.defaultSize,a&&a!==b.EMPTY&&a.copyTo(this)}p(b,"laya.display.css.Font");var a=b.prototype;return a.set=function(a){this._text=null;for(var b=a.split(" "),c=0,d=b.length;c<d;c++){var e=b[c];switch(e){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue}0<e.indexOf("px")&&(this.size=parseInt(e),this.family=b[c+1],c++)}},a.toString=function(){return this._text="",this.italic&&(this._text+="italic "),this.bold&&(this._text+="bold "),this._text+=this.size+"px "+this.family},a.copyTo=function(a){a._type=this._type,a._text=this._text,a._weight=this._weight,a._color=this._color,a.family=this.family,a.stroke=this.stroke!=b._STROKE?this.stroke.slice():b._STROKE,a.indent=this.indent,a.size=this.size},k(0,a,"password",function(){return 0!=(1024&this._type)},function(a){a?this._type|=1024:this._type&=-1025}),k(0,a,"color",function(){return this._color.strColor},function(a){this._color=Q.create(a)}),k(0,a,"italic",function(){return 0!=(512&this._type)},function(a){a?this._type|=512:this._type&=-513}),k(0,a,"bold",function(){return 0!=(2048&this._type)},function(a){a?this._type|=2048:this._type&=-2049}),k(0,a,"weight",function(){return""+this._weight},function(a){var b=0;switch(a){case"normal":break;case"bold":this.bold=!0,b=700;break;case"bolder":b=800;break;case"lighter":b=100;break;default:b=parseInt(a)}this._weight=b,this._text=null}),k(0,a,"decoration",function(){return this._decoration?this._decoration.value:null},function(a){var b=a.split(" ");switch(this._decoration||(this._decoration={}),b[0]){case"_":this._decoration.type="underline";break;case"-":this._decoration.type="line-through";break;case"overline":this._decoration.type="overline";break;default:this._decoration.type=b[0]}b[1]&&(this._decoration.color=Q.create(b)),this._decoration.value=a}),b.__init__=function(){b.EMPTY=new b(null)},b.EMPTY=null,b.defaultColor="#000000",b.defaultSize=12,b.defaultFamily="Arial",b.defaultFont="12px Arial",b._STROKE=[0,"#000000"],b._ITALIC=512,b._PASSWORD=1024,b._BOLD=2048,b}(),e=function(){function a(){this.translateX=0,this.translateY=0,this.scaleX=1,this.scaleY=1,this.rotate=0,this.skewX=0,this.skewY=0}return p(a,"laya.display.css.TransformInfo"),a}(),m=function(){function l(){if(this._one=null,this._cmds=null,this._render=this._renderEmpty,H.isConchNode){this._nativeObj=new g._conchGraphics,this.id=this._nativeObj.conchID}}p(l,"laya.display.Graphics");var a=l.prototype;return a.destroy=function(){this.clear(),this._graphicBounds&&this._graphicBounds.destroy(),this._graphicBounds=null,this._vectorgraphArray=null,this._sp&&(this._sp._renderType=0),this._sp=null},a.clear=function(a){void 0===a&&(a=!1);var b=0,c=0;if(a){var d=this._one;if(this._cmds){for(c=this._cmds.length,b=0;b<c;b++)!(d=this._cmds[b])||d.callee!==H._context._drawTexture&&d.callee!==H._context._drawTextureWithTransform||(d[0]=null,l._cache.push(d));this._cmds.length=0}else d&&(!d||d.callee!==H._context._drawTexture&&d.callee!==H._context._drawTextureWithTransform||(d[0]=null,l._cache.push(d)))}else this._cmds=null;if(this._one=null,this._render=this._renderEmpty,this._sp&&(this._sp._renderType&=-514),this._repaint(),this._vectorgraphArray){for(b=0,c=this._vectorgraphArray.length;b<c;b++)Z.getInstance().deleteShape(this._vectorgraphArray[b]);this._vectorgraphArray.length=0}},a._clearBoundsCache=function(){this._graphicBounds&&this._graphicBounds.reset()},a._initGraphicBounds=function(){this._graphicBounds||(this._graphicBounds=new c,this._graphicBounds._graphics=this)},a._repaint=function(){this._clearBoundsCache(),this._sp&&this._sp.repaint()},a._isOnlyOne=function(){return!this._cmds||0===this._cmds.length},a.getBounds=function(a){return void 0===a&&(a=!1),this._initGraphicBounds(),this._graphicBounds.getBounds(a)},a.getBoundPoints=function(a){return void 0===a&&(a=!1),this._initGraphicBounds(),this._graphicBounds.getBoundPoints(a)},a._addCmd=function(a){this._cmds=this._cmds||[],a.callee=a.shift(),this._cmds.push(a)},a.setFilters=function(a){this._saveToCmd(H._context._setFilters,a)},a.drawTexture=function(a,b,c,d,e,f,g){if(void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=0),void 0===e&&(e=0),void 0===g&&(g=1),!a||g<.01)return null;d||(d=a.sourceWidth),e||(e=a.sourceHeight),g=g<0?0:1<g?1:g;var h,i=!H.isWebGL&&(M.onFirefox||M.onEdge||M.onIE||M.onSafari)?.5:0,j=d/a.sourceWidth,k=e/a.sourceHeight;return d=a.width*j,e=a.height*k,a.loaded&&(d<=0||e<=0)?null:(b+=a.offsetX*j,c+=a.offsetY*k,this._sp&&(this._sp._renderType|=512),b-=i,c-=i,d+=2*i,e+=2*i,l._cache.length?((h=l._cache.pop())[0]=a,h[1]=b,h[2]=c,h[3]=d,h[4]=e,h[5]=f,h[6]=g):h=[a,b,c,d,e,f,g],h.callee=f||1!=g?H._context._drawTextureWithTransform:H._context._drawTexture,null!=this._one||f||1!=g?this._saveToCmd(h.callee,h):(this._one=h,this._render=this._renderOneImg),a.loaded||a.once("loaded",this,this._textureLoaded,[a,h]),this._repaint(),h)},a.cleanByTexture=function(a,b,c,d,e){if(void 0===d&&(d=0),void 0===e&&(e=0),!a)return this.clear();if(this._one&&this._render===this._renderOneImg){d||(d=a.sourceWidth),e||(e=a.sourceHeight);var f=d/a.sourceWidth,g=e/a.sourceHeight;d=a.width*f,e=a.height*g,b+=a.offsetX*f,c+=a.offsetY*g,this._one[0]=a,this._one[1]=b,this._one[2]=c,this._one[3]=d,this._one[4]=e,this._repaint()}else this.clear(),a&&this.drawTexture(a,b,c,d,e)},a.drawTextures=function(a,b){a&&this._saveToCmd(H._context._drawTextures,[a,b])},a.fillTexture=function(a,b,c,d,e,f,g){if(void 0===d&&(d=0),void 0===e&&(e=0),void 0===f&&(f="repeat"),a){var h=[a,b,c,d,e,f,g||y.EMPTY,{}];a.loaded||a.once("loaded",this,this._textureLoaded,[a,h]),this._saveToCmd(H._context._fillTexture,h)}},a._textureLoaded=function(a,b){b[3]=b[3]||a.width,b[4]=b[4]||a.height,this._repaint()},a.fillCircle=function(a,b,c,d,e,f,g){c.bitmap.enableMerageInAtlas=!1;var h=new Float32Array(2*(g+1)),i=new Float32Array(2*(g+1)),j=new Uint16Array(3*g),k=2*Math.PI/g,l=0;h[0]=d,h[1]=e,i[0]=d/c.width,i[1]=e/c.height;for(var m=2,n=0;n<g;n++){var o=f*Math.cos(l)+d,p=f*Math.sin(l)+e;h[m]=o,h[m+1]=p,i[m]=o/c.width,i[m+1]=p/c.height,l+=k,m+=2}for(n=m=0;n<g;n++)j[m++]=0,j[m++]=n+1,j[m++]=g+1<=n+2?1:n+2;this.drawTriangles(c,a,b,h,i,j)},a.drawTriangles=function(a,b,c,d,e,f,g,h,i,j){void 0===h&&(h=1),this._saveToCmd(H._context.drawTriangles,[a,b,c,d,e,f,g,h,i,j])},a._saveToCmd=function(a,b){return this._sp&&(this._sp._renderType|=512),null==this._one?(this._one=b,this._render=this._renderOne):(this._sp&&(this._sp._renderType&=-2),this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push(b)),b.callee=a,this._repaint(),b},a.clipRect=function(a,b,c,d){this._saveToCmd(H._context._clipRect,[a,b,c,d])},a.fillText=function(a,b,c,d,e,f,g){void 0===g&&(g=0),this._saveToCmd(H._context._fillText,[a,b,c,d||n.defaultFont,e,f])},a.fillBorderText=function(a,b,c,d,e,f,g,h){this._saveToCmd(H._context._fillBorderText,[a,b,c,d||n.defaultFont,e,f,g,h])},a.strokeText=function(a,b,c,d,e,f,g){this._saveToCmd(H._context._strokeText,[a,b,c,d||n.defaultFont,e,f,g])},a.alpha=function(a){a=a<0?0:1<a?1:a,this._saveToCmd(H._context._alpha,[a])},a.setAlpha=function(a){a=a<0?0:1<a?1:a,this._saveToCmd(H._context._setAlpha,[a])},a.transform=function(a,b,c){void 0===b&&(b=0),void 0===c&&(c=0),this._saveToCmd(H._context._transform,[a,b,c])},a.rotate=function(a,b,c){void 0===b&&(b=0),void 0===c&&(c=0),this._saveToCmd(H._context._rotate,[a,b,c])},a.scale=function(a,b,c,d){void 0===c&&(c=0),void 0===d&&(d=0),this._saveToCmd(H._context._scale,[a,b,c,d])},a.translate=function(a,b){this._saveToCmd(H._context._translate,[a,b])},a.save=function(){this._saveToCmd(H._context._save,[])},a.restore=function(){this._saveToCmd(H._context._restore,[])},a.replaceText=function(a){this._repaint();var b=this._cmds;if(b){for(var c=b.length-1;-1<c;c--)if(this._isTextCmd(b[c].callee))return b[c][0].toUpperCase?b[c][0]=a:b[c][0].setText(a),!0}else if(this._one&&this._isTextCmd(this._one.callee))return this._one[0].toUpperCase?this._one[0]=a:this._one[0].setText(a),!0;return!1},a._isTextCmd=function(a){return a===H._context._fillText||a===H._context._fillBorderText||a===H._context._strokeText},a.replaceTextColor=function(a){this._repaint();var b=this._cmds;if(b)for(var c=b.length-1;-1<c;c--)this._isTextCmd(b[c].callee)&&(b[c][4]=a,b[c][0].toUpperCase||(b[c][0].changed=!0));else this._one&&this._isTextCmd(this._one.callee)&&(this._one[4]=a,this._one[0].toUpperCase||(this._one[0].changed=!0))},a.loadImage=function(a,b,c,d,e,f){var g=this;void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=0),void 0===e&&(e=0);var h=ha.getRes(a);function i(a){a&&(g.drawTexture(a,b,c,d,e),null!=f&&f.call(g._sp,a))}h?i(h):x.loader.load(a,s.create(null,i),null,"image")},a._renderEmpty=function(a,b,c,d){},a._renderAll=function(a,b,c,d){for(var e,f=this._cmds,g=0,h=f.length;g<h;g++)(e=f[g]).callee.call(b,c,d,e)},a._renderOne=function(a,b,c,d){this._one.callee.call(b,c,d,this._one)},a._renderOneImg=function(a,b,c,d){this._one.callee.call(b,c,d,this._one),2305!==a._renderType&&(a._renderType|=1)},a.drawLine=function(a,b,c,d,e,f){void 0===f&&(f=1);var g=0;H.isWebGL&&(g=Z.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(g));var h=f%2==0?0:.5,i=[a+h,b+h,c+h,d+h,e,f,g];this._saveToCmd(H._context._drawLine,i)},a.drawLines=function(a,b,c,d,e){void 0===e&&(e=1);var f=0;if(c&&!(c.length<4)){H.isWebGL&&(f=Z.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(f));var g=e%2==0?0:.5,h=[a+g,b+g,c,d,e,f];this._saveToCmd(H._context._drawLines,h)}},a.drawCurves=function(a,b,c,d,e){void 0===e&&(e=1);var f=[a,b,c,d,e];this._saveToCmd(H._context._drawCurves,f)},a.drawRect=function(a,b,c,d,e,f,g){void 0===g&&(g=1);var h=f?g/2:0,i=f?g:0,j=[a+h,b+h,c-i,d-i,e,f,g];this._saveToCmd(H._context._drawRect,j)},a.drawCircle=function(a,b,c,d,e,f){void 0===f&&(f=1);var g=e?f/2:0,h=0;H.isWebGL&&(h=Z.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(h));var i=[a,b,c-g,d,e,f,h];this._saveToCmd(H._context._drawCircle,i)},a.drawPie=function(a,b,c,d,e,f,g,h){void 0===h&&(h=1);var i=g?h/2:0,j=g?h:0,k=0;H.isWebGL&&(k=Z.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(k));var l=[a+i,b+i,c-j,d,e,f,g,h,k];l[3]=Y.toRadian(d),l[4]=Y.toRadian(e),this._saveToCmd(H._context._drawPie,l)},a.drawPoly=function(a,b,c,d,e,f){void 0===f&&(f=1);var g=0,h=!1;H.isWebGL&&(g=Z.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(g),h=!(6<c.length));var i=e?f%2==0?0:.5:0,j=[a+i,b+i,c,d,e,f,g,h];this._saveToCmd(H._context._drawPoly,j)},a.drawPath=function(a,b,c,d,e){var f=[a,b,c,d,e];this._saveToCmd(H._context._drawPath,f)},k(0,a,"cmds",function(){return this._cmds},function(a){this._sp&&(this._sp._renderType|=512),this._cmds=a,this._render=this._renderAll,this._repaint()}),l.__init__=function(){if(H.isConchNode){for(var a=laya.display.Graphics.prototype,b=M.window.ConchGraphics.prototype,c=["clear","destroy","alpha","rotate","transform","scale","translate","save","restore","clipRect","blendMode","fillText","fillBorderText","_fands","drawRect","drawCircle","drawPie","drawPoly","drawPath","drawImageM","drawLine","drawLines","_drawPs","drawCurves","replaceText","replaceTextColor","_fillImage","fillTexture","setSkinMesh","drawParticle","drawImageS"],d=0,e=c.length;d<=e;d++){var f=c[d];a[f]=b[f]}a._saveToCmd=null,b.drawImageS&&(a.drawTextures=function(a,b){if(a&&a.loaded&&a.bitmap&&a.source){var c=a.uv,d=a.bitmap.width,e=a.bitmap.height;this.drawImageS(a.bitmap.source,c[0]*d,c[1]*e,(c[2]-c[0])*d,(c[5]-c[3])*e,a.offsetX,a.offsetY,a.width,a.height,b)}}),a.drawTexture=function(a,b,c,d,e,f,g){if(void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=0),void 0===e&&(e=0),void 0===g&&(g=1),a)if(a.loaded){if(a.loaded&&a.bitmap&&a.source&&(d||(d=a.sourceWidth),e||(e=a.sourceHeight),g=g<0?0:1<g?1:g,d=d-a.sourceWidth+a.width,e=e-a.sourceHeight+a.height,!(d<=0||e<=0))){b+=a.offsetX,c+=a.offsetY;var h=a.uv,i=a.bitmap.width,j=a.bitmap.height;h[4]<h[0]&&h[5]<h[1]?this.drawImageM(a.bitmap.source,h[4]*i,h[5]*j,(h[0]-h[4])*i,(h[1]-h[5])*j,b,c,d,e,f,g):this.drawImageM(a.bitmap.source,h[0]*i,h[1]*j,(h[2]-h[0])*i,(h[5]-h[3])*j,b,c,d,e,f,g),this._repaint()}}else a.once("loaded",this,function(){this.drawTexture(a,b,c,d,e,f)})},a.fillTexture=function(a,b,c,d,e,f,g){if(void 0===d&&(d=0),void 0===e&&(e=0),void 0===f&&(f="repeat"),a&&a.loaded){var h,i=H._context.ctx,j=a.bitmap.width,k=a.bitmap.height,l=a.uv;h=a.uv!=ka.DEF_UV?i.createPattern(a.bitmap.source,f,l[0]*j,l[1]*k,(l[2]-l[0])*j,(l[5]-l[3])*k):i.createPattern(a.bitmap.source,f);var m=0,n=0;g&&(b+=g.x%a.width,c+=g.y%a.height,m-=g.x%a.width,n-=g.y%a.height),this._fillImage(h,b,c,m,n,d,e)}}}},l._cache=[],l}(),c=function(){function t(){this._cacheBoundsType=!1}p(t,"laya.display.GraphicsBounds");var a=t.prototype;return a.destroy=function(){this._graphics=null,this._temp=null,this._rstBoundPoints=null,this._bounds=null},a.reset=function(){this._temp&&(this._temp.length=0)},a.getBounds=function(a){return void 0===a&&(a=!1),(!this._bounds||!this._temp||this._temp.length<1||a!=this._cacheBoundsType)&&(this._bounds=z._getWrapRec(this.getBoundPoints(a),this._bounds)),this._cacheBoundsType=a,this._bounds},a.getBoundPoints=function(a){return void 0===a&&(a=!1),(!this._temp||this._temp.length<1||a!=this._cacheBoundsType)&&(this._temp=this._getCmdPoints(a)),this._cacheBoundsType=a,this._rstBoundPoints=Y.copyArray(this._rstBoundPoints,this._temp)},a._getCmdPoints=function(a){void 0===a&&(a=!1);var b,c,d=H._context,e=this._graphics.cmds;if((b=this._temp||(this._temp=[])).length=0,e||null==this._graphics._one||(t._tempCmds.length=0,t._tempCmds.push(this._graphics._one),e=t._tempCmds),!e)return b;(c=t._tempMatrixArrays).length=0;var f=t._initMatrix;f.identity();for(var g,h,i=t._tempMatrix,j=NaN,k=NaN,l=NaN,m=NaN,n=NaN,o=NaN,p=0,q=e.length;p<q;p++)if((g=e[p]).callee)switch(g.callee){case d._save:case 7:c.push(f),f=f.clone();break;case d._restore:case 8:f=c.pop();break;case d._scale:case 5:i.identity(),i.translate(-g[2],-g[3]),i.scale(g[0],g[1]),i.translate(g[2],g[3]),this._switchMatrix(f,i);break;case d._rotate:case 3:i.identity(),i.translate(-g[1],-g[2]),i.rotate(g[0]),i.translate(g[1],g[2]),this._switchMatrix(f,i);break;case d._translate:case 6:i.identity(),i.translate(g[0],g[1]),this._switchMatrix(f,i);break;case d._transform:case 4:i.identity(),i.translate(-g[1],-g[2]),i.concat(g[0]),i.translate(g[1],g[2]),this._switchMatrix(f,i);break;case 16:case 24:t._addPointArrToRst(b,z._getBoundPointS(g[0],g[1],g[2],g[3]),f);break;case 17:f.copyTo(i),i.concat(g[4]),t._addPointArrToRst(b,z._getBoundPointS(g[0],g[1],g[2],g[3]),i);break;case d._drawTexture:h=g[0],a?g[3]&&g[4]?t._addPointArrToRst(b,z._getBoundPointS(g[1],g[2],g[3],g[4]),f):(h=g[0],t._addPointArrToRst(b,z._getBoundPointS(g[1],g[2],h.width,h.height),f)):(j=(g[3]||h.sourceWidth)/h.width,k=(g[4]||h.sourceHeight)/h.height,l=j*h.sourceWidth,m=k*h.sourceHeight,n=0<h.offsetX?h.offsetX:0,o=0<h.offsetY?h.offsetY:0,n*=j,o*=k,t._addPointArrToRst(b,z._getBoundPointS(g[1]-n,g[2]-o,l,m),f));break;case d._fillTexture:g[3]&&g[4]?t._addPointArrToRst(b,z._getBoundPointS(g[1],g[2],g[3],g[4]),f):(h=g[0],t._addPointArrToRst(b,z._getBoundPointS(g[1],g[2],h.width,h.height),f));break;case d._drawTextureWithTransform:var r;r=g[5]?(f.copyTo(i),i.concat(g[5]),i):f,a?g[3]&&g[4]?t._addPointArrToRst(b,z._getBoundPointS(g[1],g[2],g[3],g[4]),r):(h=g[0],t._addPointArrToRst(b,z._getBoundPointS(g[1],g[2],h.width,h.height),r)):(h=g[0],j=(g[3]||h.sourceWidth)/h.width,k=(g[4]||h.sourceHeight)/h.height,l=j*h.sourceWidth,m=k*h.sourceHeight,n=0<h.offsetX?h.offsetX:0,o=0<h.offsetY?h.offsetY:0,n*=j,o*=k,t._addPointArrToRst(b,z._getBoundPointS(g[1]-n,g[2]-o,l,m),r));break;case d._drawRect:case 13:t._addPointArrToRst(b,z._getBoundPointS(g[0],g[1],g[2],g[3]),f);break;case d._drawCircle:case d._fillCircle:case 14:t._addPointArrToRst(b,z._getBoundPointS(g[0]-g[2],g[1]-g[2],g[2]+g[2],g[2]+g[2]),f);break;case d._drawLine:case 20:t._tempPoints.length=0;var s;s=.5*g[5],g[0]==g[2]?t._tempPoints.push(g[0]+s,g[1],g[2]+s,g[3],g[0]-s,g[1],g[2]-s,g[3]):g[1]==g[3]?t._tempPoints.push(g[0],g[1]+s,g[2],g[3]+s,g[0],g[1]-s,g[2],g[3]-s):t._tempPoints.push(g[0],g[1],g[2],g[3]),t._addPointArrToRst(b,t._tempPoints,f);break;case d._drawCurves:case 22:t._addPointArrToRst(b,u.I.getBezierPoints(g[2]),f,g[0],g[1]);break;case d._drawPoly:case d._drawLines:case 18:t._addPointArrToRst(b,g[2],f,g[0],g[1]);break;case d._drawPath:case 19:t._addPointArrToRst(b,this._getPathPoints(g[2]),f,g[0],g[1]);break;case d._drawPie:case 15:t._addPointArrToRst(b,this._getPiePoints(g[0],g[1],g[2],g[3],g[4]),f)}return 200<b.length?b=Y.copyArray(b,z._getWrapRec(b)._getBoundPoints()):8<b.length&&(b=v.scanPList(b)),b},a._switchMatrix=function(a,b){b.concat(a),b.copyTo(a)},a._getPiePoints=function(a,b,c,d,e){var f=t._tempPoints;t._tempPoints.length=0,f.push(a,b);var g=(e-d)%(2*Math.PI)/10,h=NaN,i=d;for(h=0;h<=10;h++)f.push(a+c*Math.cos(i),b+c*Math.sin(i)),i+=g;return f},a._getPathPoints=function(a){var b,c,d=0,e=t._tempPoints;for(e.length=0,b=a.length,d=0;d<b;d++)1<(c=a[d]).length&&(e.push(c[1],c[2]),3<c.length&&e.push(c[3],c[4]));return e},t._addPointArrToRst=function(a,b,c,d,e){void 0===d&&(d=0),void 0===e&&(e=0);var f,g=0;for(f=b.length,g=0;g<f;g+=2)t._addPointToRst(a,b[g]+d,b[g+1]+e,c)},t._addPointToRst=function(a,b,c,d){var e=y.TEMP;e.setTo(b||0,c||0),d.transformPoint(e),a.push(e.x,e.y)},t._tempPoints=[],t._tempMatrixArrays=[],t._tempCmds=[],i(t,["_tempMatrix",function(){return this._tempMatrix=new E},"_initMatrix",function(){return this._initMatrix=new E}]),t}(),f=function(){function a(){}p(a,"laya.events.Event");var b=a.prototype;return b.setTo=function(a,b,c){return this.type=a,this.currentTarget=b,this.target=c,this},b.stopPropagation=function(){this._stoped=!0},k(0,b,"stageY",function(){return x.stage.mouseY}),k(0,b,"charCode",function(){return this.nativeEvent.charCode}),k(0,b,"touches",function(){var a=this.nativeEvent.touches;if(a)for(var b=x.stage,c=0,d=a.length;c<d;c++){var e=a[c],f=y.TEMP;f.setTo(e.clientX,e.clientY),b._canvasTransform.invertTransformPoint(f),b.transform.invertTransformPoint(f),e.stageX=f.x,e.stageY=f.y}return a}),k(0,b,"keyLocation",function(){return this.nativeEvent.keyLocation}),k(0,b,"ctrlKey",function(){return this.nativeEvent.ctrlKey}),k(0,b,"altKey",function(){return this.nativeEvent.altKey}),k(0,b,"shiftKey",function(){return this.nativeEvent.shiftKey}),k(0,b,"stageX",function(){return x.stage.mouseX}),a.EMPTY=new a,a.MOUSE_DOWN="mousedown",a.MOUSE_UP="mouseup",a.CLICK="click",a.RIGHT_MOUSE_DOWN="rightmousedown",a.RIGHT_MOUSE_UP="rightmouseup",a.RIGHT_CLICK="rightclick",a.MOUSE_MOVE="mousemove",a.MOUSE_OVER="mouseover",a.MOUSE_OUT="mouseout",a.MOUSE_WHEEL="mousewheel",a.ROLL_OVER="mouseover",a.ROLL_OUT="mouseout",a.DOUBLE_CLICK="doubleclick",a.CHANGE="change",a.CHANGED="changed",a.RESIZE="resize",a.ADDED="added",a.REMOVED="removed",a.DISPLAY="display",a.UNDISPLAY="undisplay",a.ERROR="error",a.COMPLETE="complete",a.LOADED="loaded",a.INITED="inited",a.PROGRESS="progress",a.INPUT="input",a.RENDER="render",a.OPEN="open",a.MESSAGE="message",a.CLOSE="close",a.KEY_DOWN="keydown",a.KEY_PRESS="keypress",a.KEY_UP="keyup",a.FRAME="enterframe",a.DRAG_START="dragstart",a.DRAG_MOVE="dragmove",a.DRAG_END="dragend",a.ENTER="enter",a.SELECT="select",a.BLUR="blur",a.FOCUS="focus",a.VISIBILITY_CHANGE="visibilitychange",a.FOCUS_CHANGE="focuschange",a.PLAYED="played",a.PAUSED="paused",a.STOPPED="stopped",a.START="start",a.END="end",a.ENABLE_CHANGED="enablechanged",a.ACTIVE_IN_HIERARCHY_CHANGED="activeinhierarchychanged",a.COMPONENT_ADDED="componentadded",a.COMPONENT_REMOVED="componentremoved",a.LAYER_CHANGED="layerchanged",a.HIERARCHY_LOADED="hierarchyloaded",a.RECOVERED="recovered",a.RELEASED="released",a.LINK="link",a.LABEL="label",a.FULL_SCREEN_CHANGE="fullscreenchange",a.DEVICE_LOST="devicelost",a.MESH_CHANGED="meshchanged",a.MATERIAL_CHANGED="materialchanged",a.WORLDMATRIX_NEEDCHANGE="worldmatrixneedchanged",a.ANIMATION_CHANGED="animationchanged",a.TRIGGER_ENTER="triggerenter",a.TRIGGER_STAY="triggerstay",a.TRIGGER_EXIT="triggerexit",a.TRAIL_FILTER_CHANGE="trailfilterchange",a.DOMINO_FILTER_CHANGE="dominofilterchange",a}(),l=(function(){function a(){}p(a,"laya.events.Keyboard"),a.NUMBER_0=48,a.NUMBER_1=49,a.NUMBER_2=50,a.NUMBER_3=51,a.NUMBER_4=52,a.NUMBER_5=53,a.NUMBER_6=54,a.NUMBER_7=55,a.NUMBER_8=56,a.NUMBER_9=57,a.A=65,a.B=66,a.C=67,a.D=68,a.E=69,a.F=70,a.G=71,a.H=72,a.I=73,a.J=74,a.K=75,a.L=76,a.M=77,a.N=78,a.O=79,a.P=80,a.Q=81,a.R=82,a.S=83,a.T=84,a.U=85,a.V=86,a.W=87,a.X=88,a.Y=89,a.Z=90,a.F1=112,a.F2=113,a.F3=114,a.F4=115,a.F5=116,a.F6=117,a.F7=118,a.F8=119,a.F9=120,a.F10=121,a.F11=122,a.F12=123,a.F13=124,a.F14=125,a.F15=126,a.NUMPAD=21,a.NUMPAD_0=96,a.NUMPAD_1=97,a.NUMPAD_2=98,a.NUMPAD_3=99,a.NUMPAD_4=100,a.NUMPAD_5=101,a.NUMPAD_6=102,a.NUMPAD_7=103,a.NUMPAD_8=104,a.NUMPAD_9=105,a.NUMPAD_ADD=107,a.NUMPAD_DECIMAL=110,a.NUMPAD_DIVIDE=111,a.NUMPAD_ENTER=108,a.NUMPAD_MULTIPLY=106,a.NUMPAD_SUBTRACT=109,a.SEMICOLON=186,a.EQUAL=187,a.COMMA=188,a.MINUS=189,a.PERIOD=190,a.SLASH=191,a.BACKQUOTE=192,a.LEFTBRACKET=219,a.BACKSLASH=220,a.RIGHTBRACKET=221,a.QUOTE=222,a.ALTERNATE=18,a.BACKSPACE=8,a.CAPS_LOCK=20,a.COMMAND=15,a.CONTROL=17,a.DELETE=46,a.ENTER=13,a.ESCAPE=27,a.PAGE_UP=33,a.PAGE_DOWN=34,a.END=35,a.HOME=36,a.LEFT=37,a.UP=38,a.RIGHT=39,a.DOWN=40,a.SHIFT=16,a.SPACE=32,a.TAB=9,a.INSERT=45}(),function(){function e(){}return p(e,"laya.events.KeyBoardManager"),e.__init__=function(){e._addEvent("keydown"),e._addEvent("keypress"),e._addEvent("keyup")},e._addEvent=function(b){M.document.addEventListener(b,function(a){laya.events.KeyBoardManager._dispatch(a,b)},!0)},e._dispatch=function(a,b){if(e.enabled){e._event._stoped=!1,e._event.nativeEvent=a,e._event.keyCode=a.keyCode||a.which||a.charCode,"keydown"===b?e._pressKeys[e._event.keyCode]=!0:"keyup"===b&&(e._pressKeys[e._event.keyCode]=null);for(var c=x.stage.focus&&null!=x.stage.focus.event&&x.stage.focus.displayedInStage?x.stage.focus:x.stage,d=c;d;)d.event(b,e._event.setTo(b,d,c)),d=d.parent}},e.hasKeyDown=function(a){return e._pressKeys[a]},e._pressKeys={},e.enabled=!0,i(e,["_event",function(){return this._event=new f}]),e}()),o=(function(){function a(){}p(a,"laya.events.KeyLocation"),a.STANDARD=0,a.LEFT=1,a.RIGHT=2,a.NUM_PAD=3}(),function(){function k(){this.mouseX=0,this.mouseY=0,this.disableMouseEvent=!1,this.mouseDownTime=0,this.mouseEventTime=M.now(),this.mouseMoveAccuracy=2,this._stage=null,this._target=null,this._lastMoveTimer=0,this._isLeftMouse=!1,this._eventList=[],this._touchIDs={},this._id=1,this._tTouchID=0,this._event=new f,this._matrix=new E,this._point=new y,this._rect=new z,this._prePoint=new y,this._curTouchID=NaN}p(k,"laya.events.MouseManager");var a=k.prototype;return a.__init__=function(a,b){var c=this;this._stage=a;var d=this,e=this._eventList;b.oncontextmenu=function(a){if(k.enabled)return!1},b.addEventListener("mousedown",function(a){k.enabled&&(M.onIE||a.preventDefault(),e.push(a),d.mouseDownTime=M.now())}),b.addEventListener("mouseup",function(a){k.enabled&&(a.preventDefault(),e.push(a),d.mouseDownTime=-M.now())},!0),b.addEventListener("mousemove",function(a){if(k.enabled){a.preventDefault();var b=M.now();if(b-d._lastMoveTimer<10)return;d._lastMoveTimer=b,e.push(a)}},!0),b.addEventListener("mouseout",function(a){k.enabled&&e.push(a)}),b.addEventListener("mouseover",function(a){k.enabled&&e.push(a)}),b.addEventListener("touchstart",function(a){k.enabled&&(e.push(a),k._isFirstTouch||va.isInputting||a.preventDefault(),d.mouseDownTime=M.now())}),b.addEventListener("touchend",function(a){k.enabled?(k._isFirstTouch||va.isInputting||a.preventDefault(),k._isFirstTouch=!1,e.push(a),d.mouseDownTime=-M.now()):c._curTouchID=NaN},!0),b.addEventListener("touchmove",function(a){k.enabled&&(a.preventDefault(),e.push(a))},!0),b.addEventListener("touchcancel",function(a){k.enabled?(a.preventDefault(),e.push(a)):c._curTouchID=NaN},!0),b.addEventListener("mousewheel",function(a){k.enabled&&e.push(a)}),b.addEventListener("DOMMouseScroll",function(a){k.enabled&&e.push(a)})},a.initEvent=function(a,b){var c,d=this;d._event._stoped=!1,d._event.nativeEvent=b||a,d._target=null,this._point.setTo(a.pageX||a.clientX,a.pageY||a.clientY),this._stage._canvasTransform.invertTransformPoint(this._point),d.mouseX=this._point.x,d.mouseY=this._point.y,d._event.touchId=a.identifier||0,this._tTouchID=d._event.touchId,(c=q.I._event)._stoped=!1,c.nativeEvent=d._event.nativeEvent,c.touchId=d._event.touchId},a.checkMouseWheel=function(a){this._event.delta=a.wheelDelta?.025*a.wheelDelta:-a.detail;for(var b=q.I.getLastOvers(),c=0,d=b.length;c<d;c++){var e=b[c];e.event("mousewheel",this._event.setTo("mousewheel",e,this._target))}},a.onMouseMove=function(a){q.I.onMouseMove(a,this._tTouchID)},a.onMouseDown=function(a){if(va.isInputting&&x.stage.focus&&x.stage.focus.focus&&!x.stage.focus.contains(this._target)){var b=x.stage.focus._tf||x.stage.focus,c=a._tf||a;c instanceof laya.display.Input&&c.multiline==b.multiline?b._focusOut():b.focus=!1}q.I.onMouseDown(a,this._tTouchID,this._isLeftMouse)},a.onMouseUp=function(a){q.I.onMouseUp(a,this._tTouchID,this._isLeftMouse)},a.check=function(a,b,c,d){this._point.setTo(b,c),a.fromParentPoint(this._point),b=this._point.x,c=this._point.y;var e=a.scrollRect;if(e&&(this._rect.setTo(e.x,e.y,e.width,e.height),!this._rect.contains(b,c)))return!1;if(!this.disableMouseEvent){if(a.hitTestPrior&&!a.mouseThrough&&!this.hitTest(a,b,c))return!1;for(var f=a._childs.length-1;-1<f;f--){var g=a._childs[f];if(!g.destroyed&&g.mouseEnabled&&g.visible&&this.check(g,b,c,d))return!0}}var h=!(!a.hitTestPrior||a.mouseThrough||this.disableMouseEvent)||this.hitTest(a,b,c);return h?(this._target=a,d.call(this,a)):d===this.onMouseUp&&a===this._stage&&(this._target=this._stage,d.call(this,this._target)),h},a.hitTest=function(a,b,c){var d=!1;if(a.scrollRect&&(b-=a.scrollRect.x,c-=a.scrollRect.y),a.hitArea instanceof laya.utils.HitArea)return a.hitArea.isHit(b,c);if(0<a.width&&0<a.height||a.mouseThrough||a.hitArea)if(a.mouseThrough)d=a.getGraphicBounds().contains(b,c);else{var e=this._rect;a.hitArea?e=a.hitArea:e.setTo(0,0,a.width,a.height),d=e.contains(b,c)}return d},a.runEvent=function(){var a=this._eventList.length;if(a){var b=this;b.mouseEventTime=M.now();var c,d=0,e=0,f=0;try{for(;d<a;){var g=this._eventList[d];switch("mousemove"!==g.type&&(this._prePoint.x=this._prePoint.y=-1e6),g.type){case"mousedown":this._touchIDs[0]=this._id++,k._isTouchRespond?k._isTouchRespond=!1:(b._isLeftMouse=0===g.button,b.initEvent(g),b.check(b._stage,b.mouseX,b.mouseY,b.onMouseDown));break;case"mouseup":b._isLeftMouse=0===g.button,b.initEvent(g),b.check(b._stage,b.mouseX,b.mouseY,b.onMouseUp);break;case"mousemove":Math.abs(this._prePoint.x-g.clientX)+Math.abs(this._prePoint.y-g.clientY)>=this.mouseMoveAccuracy&&(this._prePoint.x=g.clientX,this._prePoint.y=g.clientY,b.initEvent(g),b.check(b._stage,b.mouseX,b.mouseY,b.onMouseMove));break;case"touchstart":k._isTouchRespond=!0,b._isLeftMouse=!0;var h=g.changedTouches;for(e=0,f=h.length;e<f;e++)c=h[e],(k.multiTouchEnabled||isNaN(this._curTouchID))&&(this._curTouchID=c.identifier,this._id%200==0&&(this._touchIDs={}),this._touchIDs[c.identifier]=this._id++,b.initEvent(c,g),b.check(b._stage,b.mouseX,b.mouseY,b.onMouseDown));break;case"touchend":case"touchcancel":k._isTouchRespond=!0,b._isLeftMouse=!0;var i=g.changedTouches;for(e=0,f=i.length;e<f;e++)if(c=i[e],k.multiTouchEnabled||c.identifier==this._curTouchID){this._curTouchID=NaN,b.initEvent(c,g);b.check(b._stage,b.mouseX,b.mouseY,b.onMouseUp)||b.onMouseUp(null)}break;case"touchmove":var j=g.changedTouches;for(e=0,f=j.length;e<f;e++)c=j[e],(k.multiTouchEnabled||c.identifier==this._curTouchID)&&(b.initEvent(c,g),b.check(b._stage,b.mouseX,b.mouseY,b.onMouseMove));break;case"wheel":case"mousewheel":case"DOMMouseScroll":b.checkMouseWheel(g);break;case"mouseout":q.I.stageMouseOut();break;case"mouseover":b._stage.event("mouseover",b._event.setTo("mouseover",b._stage,b._stage))}d++}}catch(a){throw this._eventList.length=0,a}this._eventList.length=0}},k.enabled=!0,k.multiTouchEnabled=!0,k._isTouchRespond=!1,k._isFirstTouch=!0,i(k,["instance",function(){return this.instance=new k}]),k}()),q=function(){function o(){this.preOvers=[],this.preDowns=[],this.preRightDowns=[],this.enable=!0,this._lastClickTime=0,this._event=new f}p(o,"laya.events.TouchManager");var a=o.prototype;return a._clearTempArrs=function(){o._oldArr.length=0,o._newArr.length=0,o._tEleArr.length=0},a.getTouchFromArr=function(a,b){var c,d,e=0;for(c=b.length,e=0;e<c;e++)if((d=b[e]).id==a)return d;return null},a.removeTouchFromArr=function(a,b){var c=0;for(c=b.length-1;0<=c;c--)b[c].id==a&&b.splice(c,1)},a.createTouchO=function(a,b){var c;return(c=U.getItem("TouchData")||{}).id=b,c.tar=a,c},a.onMouseDown=function(a,b,c){var d,e,f,g;(void 0===c&&(c=!1),this.enable)&&(d=this.getTouchFromArr(b,this.preOvers),f=this.getEles(a,null,o._tEleArr),d?d.tar=a:(e=this.createTouchO(a,b),this.preOvers.push(e)),M.onMobile&&this.sendEvents(f,"mouseover",b),g=c?this.preDowns:this.preRightDowns,(d=this.getTouchFromArr(b,g))?d.tar=a:(e=this.createTouchO(a,b),g.push(e)),this.sendEvents(f,c?"mousedown":"rightmousedown",b),this._clearTempArrs())},a.sendEvents=function(a,b,c){void 0===c&&(c=0);var d,e,f,g=0;for(d=a.length,this._event._stoped=!1,e=a[0],g=0;g<d;g++){if((f=a[g]).destroyed)return;if(f.event(b,this._event.setTo(b,f,e)),this._event._stoped)break}},a.getEles=function(a,b,c){for(c?c.length=0:c=[];a&&a!=b;)c.push(a),a=a.parent;return c},a.checkMouseOutAndOverOfMove=function(a,b,c){if(void 0===c&&(c=0),b!=a){var d,e,f=0,g=0;if(b.contains(a))e=this.getEles(a,b,o._tEleArr),this.sendEvents(e,"mouseover",c);else if(a.contains(b))e=this.getEles(b,a,o._tEleArr),this.sendEvents(e,"mouseout",c);else{var h,i;(e=o._tEleArr).length=0,h=this.getEles(b,null,o._oldArr),i=this.getEles(a,null,o._newArr),g=h.length;var j=0;for(f=0;f<g;f++){if(d=h[f],0<=(j=i.indexOf(d))){i.splice(j,i.length-j);break}e.push(d)}0<e.length&&this.sendEvents(e,"mouseout",c),0<i.length&&this.sendEvents(i,"mouseover",c)}}},a.onMouseMove=function(a,b){var c,d;this.enable&&((c=this.getTouchFromArr(b,this.preOvers))?(this.checkMouseOutAndOverOfMove(a,c.tar),c.tar=a,d=this.getEles(a,null,o._tEleArr)):(d=this.getEles(a,null,o._tEleArr),this.sendEvents(d,"mouseover",b),this.preOvers.push(this.createTouchO(a,b))),this.sendEvents(d,"mousemove",b),this._clearTempArrs())},a.getLastOvers=function(){return(o._tEleArr.length=0)<this.preOvers.length&&this.preOvers[0].tar?this.getEles(this.preOvers[0].tar,null,o._tEleArr):(o._tEleArr.push(x.stage),o._tEleArr)},a.stageMouseOut=function(){var a;a=this.getLastOvers(),this.preOvers.length=0,this.sendEvents(a,"mouseout",0)},a.onMouseUp=function(a,b,c){if(void 0===c&&(c=!1),this.enable){var d,e,f,g,h,i,j=0,k=0,l=M.onMobile;if(e=this.getEles(a,null,o._tEleArr),this.sendEvents(e,c?"mouseup":"rightmouseup",b),i=c?this.preDowns:this.preRightDowns,d=this.getTouchFromArr(b,i)){var m,n=M.now();if(m=n-this._lastClickTime<300,this._lastClickTime=n,a==d.tar)h=e;else for(f=this.getEles(d.tar,null,o._oldArr),(h=o._newArr).length=0,k=f.length,j=0;j<k;j++)g=f[j],0<=e.indexOf(g)&&h.push(g);0<h.length&&this.sendEvents(h,c?"click":"rightclick",b),c&&m&&this.sendEvents(h,"doubleclick",b),this.removeTouchFromArr(b,i),d.tar=null,U.recover("TouchData",d)}else;(d=this.getTouchFromArr(b,this.preOvers))&&l&&((h=this.getEles(d.tar,null,h))&&0<h.length&&this.sendEvents(h,"mouseout",b),this.removeTouchFromArr(b,this.preOvers),d.tar=null,U.recover("TouchData",d)),this._clearTempArrs()}},o._oldArr=[],o._newArr=[],o._tEleArr=[],i(o,["I",function(){return this.I=new o}]),o}(),r=function(){function a(){this._action=null}p(a,"laya.filters.Filter");var b=a.prototype;return x.imps(b,{"laya.filters.IFilter":!0}),b.callNative=function(a){},k(0,b,"type",function(){return-1}),k(0,b,"action",function(){return this._action}),a.BLUR=16,a.COLOR=32,a.GLOW=8,a._filterStart=null,a._filterEnd=null,a._EndTarget=null,a._recycleScope=null,a._filter=null,a._useSrc=null,a._endSrc=null,a._useOut=null,a._endOut=null,a}(),t=function(){function a(){this.data=null}p(a,"laya.filters.ColorFilterAction");var b=a.prototype;return x.imps(b,{"laya.filters.IFilterAction":!0}),b.apply=function(a){var b=a.ctx.ctx,c=a.ctx.ctx.canvas;if(0==c.width||0==c.height)return c;for(var d,e=b.getImageData(0,0,c.width,c.height),f=e.data,g=0,h=f.length;g<h;g+=4)d=this.getColor(f[g],f[g+1],f[g+2],f[g+3]),0!=f[g+3]&&(f[g]=d[0],f[g+1]=d[1],f[g+2]=d[2],f[g+3]=d[3]);return b.putImageData(e,0,0),a},b.getColor=function(a,b,c,d){var e=[];if(this.data._mat&&this.data._alpha){var f=this.data._mat,g=this.data._alpha;e[0]=f[0]*a+f[1]*b+f[2]*c+f[3]*d+g[0],e[1]=f[4]*a+f[5]*b+f[6]*c+f[7]*d+g[1],e[2]=f[8]*a+f[9]*b+f[10]*c+f[11]*d+g[2],e[3]=f[12]*a+f[13]*b+f[14]*c+f[15]*d+g[3]}return e},a}(),u=(function(){function a(){}p(a,"laya.maths.Arith"),a.formatR=function(a){return a>Math.PI&&(a-=2*Math.PI),a<-Math.PI&&(a+=2*Math.PI),a},a.isPOT=function(a,b){return 0<a&&0==(a&a-1)&&0<b&&0==(b&b-1)},a.setMatToArray=function(a,b){a.a,a.b,a.c,a.d,a.tx,a.ty,b[0]=a.a,b[1]=a.b,b[4]=a.c,b[5]=a.d,b[12]=a.tx,b[13]=a.ty}}(),function(){function a(){this._controlPoints=[new y,new y,new y],this._calFun=this.getPoint2}p(a,"laya.maths.Bezier");var b=a.prototype;return b._switchPoint=function(a,b){var c=this._controlPoints.shift();c.setTo(a,b),this._controlPoints.push(c)},b.getPoint2=function(a,b){var c=this._controlPoints[0],d=this._controlPoints[1],e=this._controlPoints[2],f=Math.pow(1-a,2)*c.x+2*a*(1-a)*d.x+Math.pow(a,2)*e.x,g=Math.pow(1-a,2)*c.y+2*a*(1-a)*d.y+Math.pow(a,2)*e.y;b.push(f,g)},b.getPoint3=function(a,b){var c=this._controlPoints[0],d=this._controlPoints[1],e=this._controlPoints[2],f=this._controlPoints[3],g=Math.pow(1-a,3)*c.x+3*d.x*a*(1-a)*(1-a)+3*e.x*a*a*(1-a)+f.x*Math.pow(a,3),h=Math.pow(1-a,3)*c.y+3*d.y*a*(1-a)*(1-a)+3*e.y*a*a*(1-a)+f.y*Math.pow(a,3);b.push(g,h)},b.insertPoints=function(a,b){var c,d=NaN;for(c=1/(a=0<a?a:5),d=0;d<=1;d+=c)this._calFun(d,b)},b.getBezierPoints=function(a,b,c){void 0===b&&(b=5),void 0===c&&(c=2);var d,e,f=0;if((d=a.length)<2*(c+1))return[];switch(e=[],c){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(;this._controlPoints.length<=c;)this._controlPoints.push(new y);for(f=0;f<2*c;f+=2)this._switchPoint(a[f],a[f+1]);for(f=2*c;f<d;f+=2)this._switchPoint(a[f],a[f+1]),f/2%c==0&&this.insertPoints(b,e);return e},i(a,["I",function(){return this.I=new a}]),a}()),v=function(){function j(){}return p(j,"laya.maths.GrahamScan"),j.multiply=function(a,b,c){return(a.x-c.x)*(b.y-c.y)-(b.x-c.x)*(a.y-c.y)},j.dis=function(a,b){return(a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y)},j._getPoints=function(a,b,c){for(void 0===b&&(b=!1),j._mPointList||(j._mPointList=[]);j._mPointList.length<a;)j._mPointList.push(new y);return c||(c=[]),c.length=0,b?j.getFrom(c,j._mPointList,a):j.getFromR(c,j._mPointList,a),c},j.getFrom=function(a,b,c){var d=0;for(d=0;d<c;d++)a.push(b[d]);return a},j.getFromR=function(a,b,c){var d=0;for(d=0;d<c;d++)a.push(b.pop());return a},j.pListToPointList=function(a,b){void 0===b&&(b=!1);var c=0,d=a.length/2,e=j._getPoints(d,b,j._tempPointList);for(c=0;c<d;c++)e[c].setTo(a[c+c],a[c+c+1]);return e},j.pointListToPlist=function(a){var b,c=0,d=a.length,e=j._temPList;for(c=e.length=0;c<d;c++)b=a[c],e.push(b.x,b.y);return e},j.scanPList=function(a){return Y.copyArray(a,j.pointListToPlist(j.scan(j.pListToPointList(a,!0))))},j.scan=function(a){var b,c,d,e=0,f=0,g=0,h=a.length,i={};for((c=j._temArr).length=0,e=(h=a.length)-1;0<=e;e--)d=(b=a[e]).x+"_"+b.y,i.hasOwnProperty(d)||(i[d]=!0,c.push(b));for(h=c.length,Y.copyArray(a,c),e=1;e<h;e++)(a[e].y<a[g].y||a[e].y==a[g].y&&a[e].x<a[g].x)&&(g=e);for(b=a[0],a[0]=a[g],a[g]=b,e=1;e<h-1;e++){for(f=(g=e)+1;f<h;f++)(0<j.multiply(a[f],a[g],a[0])||0==j.multiply(a[f],a[g],a[0])&&j.dis(a[0],a[f])<j.dis(a[0],a[g]))&&(g=f);b=a[e],a[e]=a[g],a[g]=b}if((c=j._temArr).length=0,a.length<3)return Y.copyArray(c,a);for(c.push(a[0],a[1],a[2]),e=3;e<h;e++){for(;2<=c.length&&0<=j.multiply(a[e],c[c.length-1],c[c.length-2]);)c.pop();a[e]&&c.push(a[e])}return c},j._mPointList=null,j._tempPointList=[],j._temPList=[],j._temArr=[],j}(),w=function(){function e(){}return p(e,"laya.maths.MathUtil"),e.subtractVector3=function(a,b,c){c[0]=a[0]-b[0],c[1]=a[1]-b[1],c[2]=a[2]-b[2]},e.lerp=function(a,b,c){return a*(1-c)+b*c},e.scaleVector3=function(a,b,c){c[0]=a[0]*b,c[1]=a[1]*b,c[2]=a[2]*b},e.lerpVector3=function(a,b,c,d){var e=a[0],f=a[1],g=a[2];d[0]=e+c*(b[0]-e),d[1]=f+c*(b[1]-f),d[2]=g+c*(b[2]-g)},e.lerpVector4=function(a,b,c,d){var e=a[0],f=a[1],g=a[2],h=a[3];d[0]=e+c*(b[0]-e),d[1]=f+c*(b[1]-f),d[2]=g+c*(b[2]-g),d[3]=h+c*(b[3]-h)},e.slerpQuaternionArray=function(a,b,c,d,e,f,g){var h,i,j,k,l,m=a[b+0],n=a[b+1],o=a[b+2],p=a[b+3],q=c[d+0],r=c[d+1],s=c[d+2],t=c[d+3];return(i=m*q+n*r+o*s+p*t)<0&&(i=-i,q=-q,r=-r,s=-s,t=-t),l=1e-6<1-i?(h=Math.acos(i),j=Math.sin(h),k=Math.sin((1-e)*h)/j,Math.sin(e*h)/j):(k=1-e,e),f[g+0]=k*m+l*q,f[g+1]=k*n+l*r,f[g+2]=k*o+l*s,f[g+3]=k*p+l*t,f},e.getRotation=function(a,b,c,d){return Math.atan2(d-b,c-a)/Math.PI*180},e.sortBigFirst=function(a,b){return a==b?0:a<b?1:-1},e.sortSmallFirst=function(a,b){return a==b?0:a<b?-1:1},e.sortNumBigFirst=function(a,b){return parseFloat(b)-parseFloat(a)},e.sortNumSmallFirst=function(a,b){return parseFloat(a)-parseFloat(b)},e.sortByKey=function(c,a,b){var d;return void 0===a&&(a=!1),void 0===b&&(b=!0),d=a?b?e.sortNumBigFirst:e.sortBigFirst:b?e.sortNumSmallFirst:e.sortSmallFirst,function(a,b){return d(a[c],b[c])}},e}(),E=function(){function c(a,b,c,d,e,f){this.inPool=!1,this.bTransform=!1,void 0===a&&(a=1),void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=1),void 0===e&&(e=0),void 0===f&&(f=0),this.a=a,this.b=b,this.c=c,this.d=d,this.tx=e,this.ty=f,this._checkTransform()}p(c,"laya.maths.Matrix");var a=c.prototype;return a.identity=function(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this.bTransform=!1,this},a._checkTransform=function(){return this.bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d},a.setTranslate=function(a,b){return this.tx=a,this.ty=b,this},a.translate=function(a,b){return this.tx+=a,this.ty+=b,this},a.scale=function(a,b){this.a*=a,this.d*=b,this.c*=a,this.b*=b,this.tx*=a,this.ty*=b,this.bTransform=!0},a.rotate=function(a){var b=Math.cos(a),c=Math.sin(a),d=this.a,e=this.c,f=this.tx;this.a=d*b-this.b*c,this.b=d*c+this.b*b,this.c=e*b-this.d*c,this.d=e*c+this.d*b,this.tx=f*b-this.ty*c,this.ty=f*c+this.ty*b,this.bTransform=!0},a.skew=function(a,b){var c=Math.tan(a),d=Math.tan(b),e=this.a,f=this.b;return this.a+=d*this.c,this.b+=d*this.d,this.c+=c*e,this.d+=c*f,this},a.invertTransformPoint=function(a){var b=this.a,c=this.b,d=this.c,e=this.d,f=this.tx,g=b*e-c*d,h=e/g,i=-c/g,j=-d/g,k=b/g,l=(d*this.ty-e*f)/g,m=-(b*this.ty-c*f)/g;return a.setTo(h*a.x+j*a.y+l,i*a.x+k*a.y+m)},a.transformPoint=function(a){return a.setTo(this.a*a.x+this.c*a.y+this.tx,this.b*a.x+this.d*a.y+this.ty)},a.transformPointN=function(a){return a.setTo(this.a*a.x+this.c*a.y,this.b*a.x+this.d*a.y)},a.transformPointArray=function(a,b){for(var c=a.length,d=0;d<c;d+=2){var e=a[d],f=a[d+1];b[d]=this.a*e+this.c*f+this.tx,b[d+1]=this.b*e+this.d*f+this.ty}return b},a.transformPointArrayScale=function(a,b){for(var c=a.length,d=0;d<c;d+=2){var e=a[d],f=a[d+1];b[d]=this.a*e+this.c*f,b[d+1]=this.b*e+this.d*f}return b},a.getScaleX=function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)},a.getScaleY=function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)},a.invert=function(){var a=this.a,b=this.b,c=this.c,d=this.d,e=this.tx,f=a*d-b*c;return this.a=d/f,this.b=-b/f,this.c=-c/f,this.d=a/f,this.tx=(c*this.ty-d*e)/f,this.ty=-(a*this.ty-b*e)/f,this},a.setTo=function(a,b,c,d,e,f){return this.a=a,this.b=b,this.c=c,this.d=d,this.tx=e,this.ty=f,this},a.concat=function(a){var b=this.a,c=this.c,d=this.tx;return this.a=b*a.a+this.b*a.c,this.b=b*a.b+this.b*a.d,this.c=c*a.a+this.d*a.c,this.d=c*a.b+this.d*a.d,this.tx=d*a.a+this.ty*a.c+a.tx,this.ty=d*a.b+this.ty*a.d+a.ty,this},a.scaleEx=function(a,b){var c=this.a,d=this.b,e=this.c,f=this.d;0!==d||0!==e?(this.a=a*c,this.b=a*d,this.c=b*e):(this.a=a*c,this.b=0*f,this.c=0*c),this.d=b*f,this.bTransform=!0},a.rotateEx=function(a){var b=Math.cos(a),c=Math.sin(a),d=this.a,e=this.b,f=this.c,g=this.d;0!==e||0!==f?(this.a=b*d+c*f,this.b=b*e+c*g,this.c=-c*d+b*f,this.d=-c*e+b*g):(this.a=b*d,this.b=c*g,this.c=-c*d,this.d=b*g),this.bTransform=!0},a.clone=function(){var a=c.create();return a.a=this.a,a.b=this.b,a.c=this.c,a.d=this.d,a.tx=this.tx,a.ty=this.ty,a.bTransform=this.bTransform,a},a.copyTo=function(a){return a.a=this.a,a.b=this.b,a.c=this.c,a.d=this.d,a.tx=this.tx,a.ty=this.ty,a.bTransform=this.bTransform,a},a.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},a.destroy=function(){if(!this.inPool){var a=c._cache;this.inPool=!0,a._length||(a._length=0),(a[a._length++]=this).a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.bTransform=!1}},c.mul=function(a,b,c){var d=a.a,e=a.b,f=a.c,g=a.d,h=a.tx,i=a.ty,j=b.a,k=b.b,l=b.c,m=b.d,n=b.tx,o=b.ty;return 0!==k||0!==l?(c.a=d*j+e*l,c.b=d*k+e*m,c.c=f*j+g*l,c.d=f*k+g*m,c.tx=j*h+l*i+n,c.ty=k*h+m*i+o):(c.a=d*j,c.b=e*m,c.c=f*j,c.d=g*m,c.tx=j*h+n,c.ty=m*i+o),c},c.mul16=function(a,b,c){var d=a.a,e=a.b,f=a.c,g=a.d,h=a.tx,i=a.ty,j=b.a,k=b.b,l=b.c,m=b.d,n=b.tx,o=b.ty;return 0!==k||0!==l?(c[0]=d*j+e*l,c[1]=d*k+e*m,c[4]=f*j+g*l,c[5]=f*k+g*m,c[12]=j*h+l*i+n,c[13]=k*h+m*i+o):(c[0]=d*j,c[1]=e*m,c[4]=f*j,c[5]=g*m,c[12]=j*h+n,c[13]=m*i+o),c},c.mulPre=function(a,b,c,d,e,f,g,h){var i=a.a,j=a.b,k=a.c,l=a.d,m=a.tx,n=a.ty;return 0!==c||0!==d?(h.a=i*b+j*d,h.b=i*c+j*e,h.c=k*b+l*d,h.d=k*c+l*e,h.tx=b*m+d*n+f,h.ty=c*m+e*n+g):(h.a=i*b,h.b=j*e,h.c=k*b,h.d=l*e,h.tx=b*m+f,h.ty=e*n+g),h},c.mulPos=function(a,b,c,d,e,f,g,h){var i=a.a,j=a.b,k=a.c,l=a.d,m=a.tx,n=a.ty;return 0!==j||0!==k?(h.a=b*i+c*k,h.b=b*j+c*l,h.c=d*i+e*k,h.d=d*j+e*l,h.tx=i*f+k*g+m,h.ty=j*f+l*g+n):(h.a=b*i,h.b=c*l,h.c=d*i,h.d=e*l,h.tx=i*f+m,h.ty=l*g+n),h},c.preMul=function(a,b,c){var d=a.a,e=a.b,f=a.c,g=a.d,h=b.a,i=b.b,j=b.c,k=b.d,l=b.tx,m=b.ty;return c.a=h*d,c.b=c.c=0,c.d=k*g,c.tx=l*d+a.tx,c.ty=m*g+a.ty,0===i&&0===j&&0===e&&0===f||(c.a+=i*f,c.d+=j*e,c.b+=h*e+i*g,c.c+=j*d+k*f,c.tx+=m*f,c.ty+=l*e),c},c.preMulXY=function(a,b,c,d){var e=a.a,f=a.b,g=a.c,h=a.d;return d.a=e,d.b=f,d.c=g,d.d=h,d.tx=b*e+a.tx+c*g,d.ty=c*h+a.ty+b*f,d},c.create=function(){var a=c._cache,b=a._length?a[--a._length]:new c;return b.inPool=!1,b},c.EMPTY=new c,c.TEMP=new c,c._cache=[],c}(),y=function(){function a(a,b){void 0===a&&(a=0),void 0===b&&(b=0),this.x=a,this.y=b}p(a,"laya.maths.Point");var b=a.prototype;return b.setTo=function(a,b){return this.x=a,this.y=b,this},b.distance=function(a,b){return Math.sqrt((this.x-a)*(this.x-a)+(this.y-b)*(this.y-b))},b.toString=function(){return this.x+","+this.y},b.normalize=function(){var a=Math.sqrt(this.x*this.x+this.y*this.y);if(0<a){var b=1/a;this.x*=b,this.y*=b}},a.TEMP=new a,a.EMPTY=new a,a}(),z=function(){function j(a,b,c,d){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=0),this.x=a,this.y=b,this.width=c,this.height=d}p(j,"laya.maths.Rectangle");var a=j.prototype;return a.setTo=function(a,b,c,d){return this.x=a,this.y=b,this.width=c,this.height=d,this},a.copyFrom=function(a){return this.x=a.x,this.y=a.y,this.width=a.width,this.height=a.height,this},a.contains=function(a,b){return!(this.width<=0||this.height<=0)&&(a>=this.x&&a<this.right&&b>=this.y&&b<this.bottom)},a.intersects=function(a){return!(a.x>this.x+this.width||a.x+a.width<this.x||a.y>this.y+this.height||a.y+a.height<this.y)},a.intersection=function(a,b){return this.intersects(a)?(b||(b=new j),b.x=Math.max(this.x,a.x),b.y=Math.max(this.y,a.y),b.width=Math.min(this.right,a.right)-b.x,b.height=Math.min(this.bottom,a.bottom)-b.y,b):null},a.union=function(a,b){return b||(b=new j),this.clone(b),a.width<=0||a.height<=0?b:(b.addPoint(a.x,a.y),b.addPoint(a.right,a.bottom),this)},a.clone=function(a){return a||(a=new j),a.x=this.x,a.y=this.y,a.width=this.width,a.height=this.height,a},a.toString=function(){return this.x+","+this.y+","+this.width+","+this.height},a.equals=function(a){return!(!a||a.x!==this.x||a.y!==this.y||a.width!==this.width||a.height!==this.height)},a.addPoint=function(a,b){return this.x>a&&(this.width+=this.x-a,this.x=a),this.y>b&&(this.height+=this.y-b,this.y=b),this.width<a-this.x&&(this.width=a-this.x),this.height<b-this.y&&(this.height=b-this.y),this},a._getBoundPoints=function(){var a=j._temB;return(a.length=0)==this.width||0==this.height||a.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),a},a.isEmpty=function(){return this.width<=0||this.height<=0},k(0,a,"right",function(){return this.x+this.width}),k(0,a,"bottom",function(){return this.y+this.height}),j._getBoundPointS=function(a,b,c,d){var e=j._temA;return(e.length=0)==c||0==d||e.push(a,b,a+c,b,a,b+d,a+c,b+d),e},j._getWrapRec=function(a,b){if(!a||a.length<1)return b?b.setTo(0,0,0,0):j.TEMP.setTo(0,0,0,0);b=b||new j;var c,d,e,f,g,h=a.length,i=y.TEMP;for(e=g=-(d=f=99999),c=0;c<h;c+=2)i.x=a[c],i.y=a[c+1],d=d<i.x?d:i.x,f=f<i.y?f:i.y,e=e>i.x?e:i.x,g=g>i.y?g:i.y;return b.setTo(d,f,e-d,g-f)},j.EMPTY=new j,j.TEMP=new j,j._temB=[],j._temA=[],j}(),C=function(){function i(){}return p(i,"laya.media.SoundManager"),k(1,i,"useAudioMusic",function(){return i._useAudioMusic},function(a){i._useAudioMusic=a,i._musicClass=a?ca:null}),k(1,i,"autoStopMusic",function(){return i._autoStopMusic},function(a){x.stage.off("blur",null,i._stageOnBlur),x.stage.off("focus",null,i._stageOnFocus),x.stage.off("visibilitychange",null,i._visibilityChange),(i._autoStopMusic=a)&&(x.stage.on("blur",null,i._stageOnBlur),x.stage.on("focus",null,i._stageOnFocus),x.stage.on("visibilitychange",null,i._visibilityChange))}),k(1,i,"muted",function(){return i._muted},function(a){a!=i._muted&&(a&&i.stopAllSound(),i.musicMuted=a,i._muted=a)}),k(1,i,"musicMuted",function(){return i._musicMuted},function(a){a!=i._musicMuted&&(a?(i._tMusic&&i._musicChannel&&!i._musicChannel.isStopped?i._musicChannel.pause():i._musicChannel=null,i._musicMuted=a):(i._musicMuted=a,i._tMusic&&i._musicChannel&&i._musicChannel.resume()))}),k(1,i,"soundMuted",function(){return i._soundMuted},function(a){i._soundMuted=a}),i.addChannel=function(a){0<=i._channels.indexOf(a)||(i._channels.push(a),i.autoReleaseSound&&0!=i._notUsedCount&&i._notUsedUrls[a.url]&&(delete i._notUsedUrls[a.url],0==--i._notUsedCount&&x.timer.clear(i,i.disposeSoundIfNotUsed)))},i.removeChannel=function(a){var b=i._channels,c=b.indexOf(a);if(-1!=c&&(b.splice(c,1),i.autoReleaseSound)){var d=a.url,e=i.defaultIntervals[d]||2e4;if(0<e){var f=!0;for(c=b.length-1;0<=c;c--)if(b[c].url==d){f=!1;break}f&&(i._notUsedUrls[d]=Date.now()+e,0==i._notUsedCount++&&x.timer.loop(1e4,i,i.disposeSoundIfNotUsed))}}},i.disposeSoundIfNotUsed=function(){var a=i._notUsedUrls;if(0!=i._notUsedCount){var b=Date.now();for(var c in a)b>=a[c]&&(delete a[c],--i._notUsedCount,i.destroySound(c));if(0!=i._notUsedCount)return}x.timer.clear(i,i.disposeSoundIfNotUsed)},i._visibilityChange=function(){x.stage.isVisibility?i._stageOnFocus():i._stageOnBlur()},i._stageOnBlur=function(){i._isActive=!1,i._musicChannel&&(i._musicChannel.isStopped||(i._blurPaused=!0,i._musicChannel.pause())),i.stopAllSound(),x.stage.once("mousedown",null,i._stageOnFocus)},i._recoverWebAudio=function(){fa.ctx&&"running"!=fa.ctx.state&&fa.ctx.resume&&fa.ctx.resume()},i._stageOnFocus=function(){if(i._isActive=!0,i._recoverWebAudio(),x.stage.off("mousedown",null,i._stageOnFocus),i._blurPaused){var a=i._musicChannel;a&&i._music&&a.isStopped&&(i._blurPaused=!1,i._music._disposed?i.playMusic(a.url,a.loops,a.startHandler,a.completeHandler,a.startTime):a.audioBuffer?a.resume():i._music.play(a.startTime,a.loops,a.startHandler,a))}},i.playSound=function(a,b,c,d,e,f){if(void 0===b&&(b=1),void 0===f&&(f=0),!a)return null;if(i._muted)return null;if(i._recoverWebAudio(),a==i._tMusic){if(i._musicMuted)return null}else{if(!i._isActive)return null;if(i._soundMuted)return null}var g,h=i._pool[a];return e||(e=i._soundClass),h||((h=new e).load(a),i._pool[a]=h),(g=h.play(f,b,c))?(a==i._tMusic&&(i._music=h,i._isActive||(i._blurPaused=!0,g.pause())),g.url=a,g.volume=a==i._tMusic?i.musicVolume:i.soundVolume,g.completeHandler=d,g):null},i.destroySound=function(a){var b=i._pool[a];b&&(delete i._pool[a],b.dispose())},i.playMusic=function(a,b,c,d,e){return void 0===b&&(b=0),void 0===e&&(e=0),i._tMusic=a,i._musicChannel&&i._musicChannel.stop(),i._musicChannel=i.playSound(a,b,c,d,null,e)},i.stopSound=function(a){for(var b,c=i._channels.length-1;0<=c;c--)(b=i._channels[c]).url==a&&b.stop()},i.stopAll=function(){i._tMusic=null;var a=0;for(a=i._channels.length-1;0<=a;a--)i._channels[a].stop()},i.stopAllSound=function(){var a,b=0;for(b=i._channels.length-1;0<=b;b--)(a=i._channels[b]).url!=i._tMusic&&a.stop()},i.stopMusic=function(){i._musicChannel&&i._musicChannel.stop(),i._tMusic=null},i.setSoundVolume=function(a,b){if(b)i._setVolume(b,a);else{i.soundVolume=a;var c,d=0;for(d=i._channels.length-1;0<=d;d--)(c=i._channels[d]).url!=i._tMusic&&(c.volume=a)}},i.setMusicVolume=function(a){i.musicVolume=a,i._setVolume(i._tMusic,a)},i._setVolume=function(a,b){for(var c,d=i._channels.length-1;0<=d;d--)(c=i._channels[d]).url==a&&(c.volume=b)},i.musicVolume=1,i.soundVolume=1,i.playbackRate=1,i._useAudioMusic=!0,i._muted=!1,i._soundMuted=!1,i._musicMuted=!1,i._tMusic=null,i._musicChannel=null,i._music=null,i._channels=[],i._autoStopMusic=!1,i._blurPaused=!1,i._isActive=!0,i._soundClass=null,i._musicClass=null,i.autoReleaseSound=!0,i._pool={},i.defaultIntervals={},i._notUsedUrls={},i._notUsedCount=0,i}(),A=function(){var a;function c(){}return p(c,"laya.net.LocalStorage"),c.__init__=function(){c._baseClass||(c._baseClass=a).init(),c.items=c._baseClass.items,c.support=c._baseClass.support},c.setItem=function(a,b){c._baseClass.setItem(a,b)},c.getItem=function(a){return c._baseClass.getItem(a)},c.setJSON=function(a,b){c._baseClass.setJSON(a,b)},c.getJSON=function(a){return c._baseClass.getJSON(a)},c.removeItem=function(a){c._baseClass.removeItem(a)},c.clear=function(){c._baseClass.clear()},c._baseClass=null,c.items=null,c.support=!1,c.__init$=function(){a=function(){function c(){}return p(c,""),c.init=function(){try{c.support=!0,c.items=g.localStorage,c.setItem("laya","1"),c.removeItem("laya")}catch(a){c.support=!1}c.support||console.log("LocalStorage is not supprot or browser is private mode.")},c.setItem=function(a,b){try{c.support&&c.items.setItem(a,b)}catch(a){console.warn("set localStorage failed",a)}},c.getItem=function(a){return c.support?c.items.getItem(a):null},c.setJSON=function(a,b){try{c.support&&c.items.setItem(a,JSON.stringify(b))}catch(a){console.warn("set localStorage failed",a)}},c.getJSON=function(a){return JSON.parse(c.support?c.items.getItem(a):null)},c.removeItem=function(a){c.support&&c.items.removeItem(a)},c.clear=function(){c.support&&c.items.clear()},c.items=null,c.support=!1,c}()},c}(),F=(function(){function d(){}p(d,"laya.net.ResourceVersion"),d.enable=function(a,b,c){void 0===c&&(c=2),laya.net.ResourceVersion.type=c,x.loader.load(a,s.create(null,d.onManifestLoaded,[b]),null,"json"),G.customFormat=d.addVersionPrefix},d.onManifestLoaded=function(a,b){d.manifest=b,a.run(),b||console.warn("资源版本清单文件不存在，不使用资源版本管理。忽略ERR_FILE_NOT_FOUND错误。")},d.addVersionPrefix=function(a){return d.manifest&&d.manifest[a]?2==d.type?d.manifest[a]:d.manifest[a]+"/"+a:a},d.FOLDER_VERSION=1,d.FILENAME_VERSION=2,d.manifest=null,d.type=1}(),function(){function a(){this.fontName=null,this.complete=null,this.err=null,this._fontTxt=null,this._url=null,this._div=null,this._txtWidth=NaN,this._http=null}p(a,"laya.net.TTFLoader");var b=a.prototype;return b.load=function(a){var b=(this._url=a).split(".ttf")[0].split("/");this.fontName=b[b.length-1],M.window.conch?this._loadConch():M.window.FontFace?this._loadWithFontFace():this._loadWithCSS()},b._loadConch=function(){this._http=new ga,this._http.on("error",this,this._onErr),this._http.on("complete",this,this._onHttpLoaded),this._http.send(this._url,null,"get","arraybuffer")},b._onHttpLoaded=function(a){M.window.conch.setFontFaceFromBuffer(this.fontName,a),this._clearHttp(),this._complete()},b._clearHttp=function(){this._http&&(this._http.off("error",this,this._onErr),this._http.off("complete",this,this._onHttpLoaded),this._http=null)},b._onErr=function(){this._clearHttp(),this.err&&(this.err.runWith("fail:"+this._url),this.err=null)},b._complete=function(){x.timer.clear(this,this._complete),x.timer.clear(this,this._checkComplete),this._div&&this._div.parentNode&&(this._div.parentNode.removeChild(this._div),this._div=null),this.complete&&(this.complete.runWith(this),this.complete=null)},b._checkComplete=function(){D.measureText("LayaTTFFont",this._fontTxt).width!=this._txtWidth&&this._complete()},b._loadWithFontFace=function(){var a=new M.window.FontFace(this.fontName,"url('"+this._url+"')");M.window.document.fonts.add(a);var b=this;a.loaded.then(function(){b._complete()}),a.load()},b._createDiv=function(){this._div=M.createElement("div"),this._div.innerHTML="laya";var a=this._div.style;a.fontFamily=this.fontName,a.position="absolute",a.left="-100px",a.top="-100px",M.document.body.appendChild(this._div)},b._loadWithCSS=function(){var a=this,b=M.createElement("style");b.type="text/css",M.document.body.appendChild(b),b.textContent="@font-face { font-family:'"+this.fontName+"'; src:url('"+this._url+"');}",this._fontTxt="40px "+this.fontName,this._txtWidth=D.measureText("LayaTTFFont",this._fontTxt).width;var c=this;b.onload=function(){x.timer.once(1e4,c,a._complete)},x.timer.loop(20,this,this._checkComplete),this._createDiv()},a._testString="LayaTTFFont",a}()),G=function(){function d(a){this._url=null,this._path=null,this._url=d.formatURL(a),this._path=d.getPath(a)}p(d,"laya.net.URL");var a=d.prototype;return k(0,a,"path",function(){return this._path}),k(0,a,"url",function(){return this._url}),d.formatURL=function(a,b){if(!a)return"null path";if(0<a.indexOf(":"))return a;null!=d.customFormat&&(a=d.customFormat(a,b));var c=a.charAt(0);if("."===c)return d.formatRelativePath((b||d.basePath)+a);if("~"===c)return d.rootPath+a.substring(1);if("d"===c){if(0===a.indexOf("data:image"))return a}else if("/"===c)return a;return(b||d.basePath)+a},d.formatRelativePath=function(a){for(var b=a.split("/"),c=0,d=b.length;c<d;c++)".."==b[c]&&(b.splice(c-1,2),c-=2);return b.join("/")},d.isAbsolute=function(a){return 0<a.indexOf(":")||"/"==a.charAt(0)},d.getPath=function(a){var b=a.lastIndexOf("/");return 0<b?a.substr(0,b+1):""},d.getFileName=function(a){var b=a.lastIndexOf("/");return 0<b?a.substr(b+1):a},d.version={},d.basePath="",d.rootPath="",d.customFormat=function(a){var b=d.version[a];return!H.isConchApp&&b&&(a+="?v="+b),a},d}(),H=function(){function e(a,b){this._timeId=0;var c=e._mainCanvas.source.style;c.position="absolute",c.top=c.left="0px",c.background="#000000",e._mainCanvas.source.id="layaCanvas";var d=laya.renders.Render.isWebGL;e._mainCanvas.source.width=a,e._mainCanvas.source.height=b,d&&e.WebGL.init(e._mainCanvas,a,b),M.container.appendChild(e._mainCanvas.source),(e._context=new I(a,b,d?null:e._mainCanvas)).ctx.setIsMainContext(),M.window.requestAnimationFrame(function a(b){M.window.requestAnimationFrame(a);x.stage._loop()}),x.stage.on("visibilitychange",this,this._onVisibilitychange)}p(e,"laya.renders.Render");var a=e.prototype;return a._onVisibilitychange=function(){x.stage.isVisibility?0!=this._timeId&&M.window.clearInterval(this._timeId):this._timeId=M.window.setInterval(this._enterFrame,1e3)},a._enterFrame=function(a){x.stage._loop()},k(1,e,"context",function(){return e._context}),k(1,e,"canvas",function(){return e._mainCanvas.source}),e._context=null,e._mainCanvas=null,e.WebGL=null,e.isConchNode=!1,e.isConchApp=!1,e.isConchWebGL=!1,e.isWebGL=!1,e.is3DMode=!1,e.optimizeTextureMemory=function(a,b){return!0},e.__init$=function(){g.ConchRenderType=g.ConchRenderType||1,g.ConchRenderType|=g.conch?4:0,e.isConchNode=5==(5&g.ConchRenderType),e.isConchApp=4==(4&g.ConchRenderType),e.isConchWebGL=6==g.ConchRenderType},e}(),I=function(){function g(a,b,c){this.x=0,this.y=0,this._drawTexture=function(a,b,c){c[0].loaded&&this.ctx.drawTexture(c[0],c[1],c[2],c[3],c[4],a,b)},this._fillTexture=function(a,b,c){c[0].loaded&&this.ctx.fillTexture(c[0],c[1]+a,c[2]+b,c[3],c[4],c[5],c[6],c[7])},this._drawTextureWithTransform=function(a,b,c){c[0].loaded&&this.ctx.drawTextureWithTransform(c[0],c[1],c[2],c[3],c[4],c[5],a,b,c[6])},this._fillQuadrangle=function(a,b,c){this.ctx.fillQuadrangle(c[0],c[1],c[2],c[3],c[4])},this._drawRect=function(a,b,c){var d=this.ctx;null!=c[4]&&(d.fillStyle=c[4],d.fillRect(a+c[0],b+c[1],c[2],c[3],null)),null!=c[5]&&(d.strokeStyle=c[5],d.lineWidth=c[6],d.strokeRect(a+c[0],b+c[1],c[2],c[3],c[6]))},this._drawPie=function(a,b,c){var d=this.ctx;H.isWebGL&&d.setPathId(c[8]),d.beginPath(),H.isWebGL?(d.movePath(c[0]+a,c[1]+b),d.moveTo(0,0)):d.moveTo(a+c[0],b+c[1]),d.arc(a+c[0],b+c[1],c[2],c[3],c[4]),d.closePath(),this._fillAndStroke(c[5],c[6],c[7],!0)},this._clipRect=function(a,b,c){this.ctx.clipRect(a+c[0],b+c[1],c[2],c[3])},this._fillRect=function(a,b,c){this.ctx.fillRect(a+c[0],b+c[1],c[2],c[3],c[4])},this._drawCircle=function(a,b,c){var d=this.ctx;H.isWebGL&&d.setPathId(c[6]),V.drawCall++,d.beginPath(),H.isWebGL&&d.movePath(c[0]+a,c[1]+b),d.arc(c[0]+a,c[1]+b,c[2],0,g.PI2),d.closePath(),this._fillAndStroke(c[3],c[4],c[5],!0)},this._fillCircle=function(a,b,c){V.drawCall++;var d=this.ctx;d.beginPath(),d.fillStyle=c[3],d.arc(c[0]+a,c[1]+b,c[2],0,g.PI2),d.fill()},this._setShader=function(a,b,c){this.ctx.setShader(c[0])},this._drawLine=function(a,b,c){var d=this.ctx;H.isWebGL&&d.setPathId(c[6]),d.beginPath(),d.strokeStyle=c[4],d.lineWidth=c[5],H.isWebGL?(d.movePath(a,b),d.moveTo(c[0],c[1]),d.lineTo(c[2],c[3])):(d.moveTo(a+c[0],b+c[1]),d.lineTo(a+c[2],b+c[3])),d.stroke()},this._drawLines=function(a,b,c){var d=this.ctx;H.isWebGL&&d.setPathId(c[5]),d.beginPath(),a+=c[0],b+=c[1],H.isWebGL&&d.movePath(a,b),d.strokeStyle=c[3],d.lineWidth=c[4];var e=c[2],f=2,g=e.length;if(H.isWebGL)for(d.moveTo(e[0],e[1]);f<g;)d.lineTo(e[f++],e[f++]);else for(d.moveTo(a+e[0],b+e[1]);f<g;)d.lineTo(a+e[f++],b+e[f++]);d.stroke()},this._drawLinesWebGL=function(a,b,c){this.ctx.drawLines(a+this.x+c[0],b+this.y+c[1],c[2],c[3],c[4])},this._drawCurves=function(a,b,c){this.ctx.drawCurves(a,b,c)},this._draw=function(a,b,c){c[0].call(null,this,a,b)},this._transformByMatrix=function(a,b,c){this.ctx.transformByMatrix(c[0])},this._setTransform=function(a,b,c){this.ctx.setTransform(c[0],c[1],c[2],c[3],c[4],c[5])},this._setTransformByMatrix=function(a,b,c){this.ctx.setTransformByMatrix(c[0])},this._save=function(a,b,c){this.ctx.save()},this._restore=function(a,b,c){this.ctx.restore()},this._translate=function(a,b,c){this.ctx.translate(c[0],c[1])},this._transform=function(a,b,c){this.ctx.translate(c[1]+a,c[2]+b);var d=c[0];this.ctx.transform(d.a,d.b,d.c,d.d,d.tx,d.ty),this.ctx.translate(-a-c[1],-b-c[2])},this._rotate=function(a,b,c){this.ctx.translate(c[1]+a,c[2]+b),this.ctx.rotate(c[0]),this.ctx.translate(-a-c[1],-b-c[2])},this._scale=function(a,b,c){this.ctx.translate(c[2]+a,c[3]+b),this.ctx.scale(c[0],c[1]),this.ctx.translate(-a-c[2],-b-c[3])},this._alpha=function(a,b,c){this.ctx.globalAlpha*=c[0]},this._setAlpha=function(a,b,c){this.ctx.globalAlpha=c[0]},this._fillText=function(a,b,c){this.ctx.fillText(c[0],c[1]+a,c[2]+b,c[3],c[4],c[5])},this._strokeText=function(a,b,c){this.ctx.strokeText(c[0],c[1]+a,c[2]+b,c[3],c[4],c[5],c[6])},this._fillBorderText=function(a,b,c){this.ctx.fillBorderText(c[0],c[1]+a,c[2]+b,c[3],c[4],c[5],c[6],c[7])},this._blendMode=function(a,b,c){this.ctx.globalCompositeOperation=c[0]},this._beginClip=function(a,b,c){this.ctx.beginClip&&this.ctx.beginClip(a+c[0],b+c[1],c[2],c[3])},this._setIBVB=function(a,b,c){this.ctx.setIBVB(c[0]+a,c[1]+b,c[2],c[3],c[4],c[5],c[6],c[7])},this._fillTrangles=function(a,b,c){this.ctx.fillTrangles(c[0],c[1]+a,c[2]+b,c[3],c[4])},this._drawPath=function(a,b,c){var d=this.ctx;H.isWebGL&&d.setPathId(-1),d.beginPath(),a+=c[0],b+=c[1],H.isWebGL&&d.movePath(a,b);for(var e=c[2],f=0,g=e.length;f<g;f++){var h=e[f];switch(h[0]){case"moveTo":H.isWebGL?d.moveTo(h[1],h[2]):d.moveTo(a+h[1],b+h[2]);break;case"lineTo":H.isWebGL?d.lineTo(h[1],h[2]):d.lineTo(a+h[1],b+h[2]);break;case"arcTo":H.isWebGL?d.arcTo(h[1],h[2],h[3],h[4],h[5]):d.arcTo(a+h[1],b+h[2],a+h[3],b+h[4],h[5]);break;case"closePath":d.closePath()}}var i=c[3];null!=i&&(d.fillStyle=i.fillStyle,d.fill());var j=c[4];null!=j&&(d.strokeStyle=j.strokeStyle,d.lineWidth=j.lineWidth||1,d.lineJoin=j.lineJoin,d.lineCap=j.lineCap,d.miterLimit=j.miterLimit,d.stroke())},this.drawPoly=function(a,b,c){this.ctx.drawPoly(a+this.x+c[0],b+this.y+c[1],c[2],c[3],c[4],c[5],c[6])},this._drawPoly=function(a,b,c){var d=this.ctx,e=c[2],f=2,g=e.length;if(H.isWebGL)for(d.setPathId(c[6]),d.beginPath(),a+=c[0],b+=c[1],d.movePath(a,b),d.moveTo(e[0],e[1]);f<g;)d.lineTo(e[f++],e[f++]);else for(d.beginPath(),a+=c[0],b+=c[1],d.moveTo(a+e[0],b+e[1]);f<g;)d.lineTo(a+e[f++],b+e[f++]);d.closePath(),this._fillAndStroke(c[3],c[4],c[5],c[7])},this._drawSkin=function(a,b,c){var d=c[0];if(d){var e=this.ctx;d.render(e,a,b)}},this._drawParticle=function(a,b,c){this.ctx.drawParticle(a+this.x,b+this.y,c[0])},this._setFilters=function(a,b,c){this.ctx.setFilters(c)},c?this.ctx=c.getContext("2d"):(c=ta.create("3D"),this.ctx=D.createWebGLContext2D(c),c._setContext(this.ctx)),c.size(a,b),this.canvas=c}p(g,"laya.renders.RenderContext");var a=g.prototype;return a.destroy=function(){this.canvas&&(this.canvas.destroy(),this.canvas=null,this.ctx=null),this.ctx&&(this.ctx.destroy(),this.ctx=null)},a.drawTexture=function(a,b,c,d,e){a.loaded&&this.ctx.drawTexture(a,b,c,d,e,this.x,this.y)},a._drawTextures=function(a,b,c){c[0].loaded&&this.ctx.drawTextures(c[0],c[1],a+this.x,b+this.y)},a.drawTextureWithTransform=function(a,b,c,d,e,f,g){a.loaded&&this.ctx.drawTextureWithTransform(a,b,c,d,e,f,this.x,this.y,g)},a.fillQuadrangle=function(a,b,c,d,e){this.ctx.fillQuadrangle(a,b,c,d,e)},a.drawCanvas=function(a,b,c,d,e){this.ctx.drawCanvas(a,b+this.x,c+this.y,d,e)},a.drawRect=function(a,b,c,d,e,f){void 0===f&&(f=1);var g=this.ctx;g.strokeStyle=e,g.lineWidth=f,g.strokeRect(a+this.x,b+this.y,c,d,f)},a._fillAndStroke=function(a,b,c,d){void 0===d&&(d=!1);var e=this.ctx;null!=a&&(e.fillStyle=a,H.isWebGL?e.fill(d):e.fill()),null!=b&&0<c&&(e.strokeStyle=b,e.lineWidth=c,e.stroke())},a.clipRect=function(a,b,c,d){this.ctx.clipRect(a+this.x,b+this.y,c,d)},a.fillRect=function(a,b,c,d,e){this.ctx.fillRect(a+this.x,b+this.y,c,d,e)},a.drawCircle=function(a,b,c,d,e){void 0===e&&(e=1),V.drawCall++;var f=this.ctx;f.beginPath(),f.strokeStyle=d,f.lineWidth=e,f.arc(a+this.x,b+this.y,c,0,g.PI2),f.stroke()},a.drawTriangles=function(a,b,c){if(H.isWebGL)this.ctx.drawTriangles(c[0],a+c[1],b+c[2],c[3],c[4],c[5],c[6],c[7],c[8],c[9]);else{var d=c[5],e=0,f=d.length,g=this.ctx;for(e=0;e<f;e+=3){var h=2*d[e],i=2*d[e+1],j=2*d[e+2];g.drawTriangle(c[0],c[3],c[4],h,i,j,c[6],!0)}}},a.fillCircle=function(a,b,c,d){V.drawCall++;var e=this.ctx;e.beginPath(),e.fillStyle=d,e.arc(a+this.x,b+this.y,c,0,g.PI2),e.fill()},a.setShader=function(a){this.ctx.setShader(a)},a.drawLine=function(a,b,c,d,e,f){void 0===f&&(f=1);var g=this.ctx;g.beginPath(),g.strokeStyle=e,g.lineWidth=f,g.moveTo(this.x+a,this.y+b),g.lineTo(this.x+c,this.y+d),g.stroke()},a.clear=function(){this.ctx.clear()},a.transformByMatrix=function(a){this.ctx.transformByMatrix(a)},a.setTransform=function(a,b,c,d,e,f){this.ctx.setTransform(a,b,c,d,e,f)},a.setTransformByMatrix=function(a){this.ctx.setTransformByMatrix(a)},a.save=function(){this.ctx.save()},a.restore=function(){this.ctx.restore()},a.translate=function(a,b){this.ctx.translate(a,b)},a.transform=function(a,b,c,d,e,f){this.ctx.transform(a,b,c,d,e,f)},a.rotate=function(a){this.ctx.rotate(a)},a.scale=function(a,b){this.ctx.scale(a,b)},a.alpha=function(a){this.ctx.globalAlpha*=a},a.setAlpha=function(a){this.ctx.globalAlpha=a},a.fillWords=function(a,b,c,d,e,f){void 0===f&&(f=0),this.ctx.fillWords(a,b,c,d,e,f)},a.fillBorderWords=function(a,b,c,d,e,f,g){this.ctx.fillBorderWords(a,b,c,d,e,f,g)},a.fillText=function(a,b,c,d,e,f){this.ctx.fillText(a,b+this.x,c+this.y,d,e,f)},a.strokeText=function(a,b,c,d,e,f,g){this.ctx.strokeText(a,b+this.x,c+this.y,d,e,f,g)},a.blendMode=function(a){this.ctx.globalCompositeOperation=a},a.flush=function(){this.ctx.flush&&this.ctx.flush()},a.addRenderObject=function(a){this.ctx.addRenderObject(a)},a.beginClip=function(a,b,c,d){this.ctx.beginClip&&this.ctx.beginClip(a,b,c,d)},a.endClip=function(){this.ctx.endClip&&this.ctx.endClip()},a.fillTrangles=function(a,b,c){this.ctx.fillTrangles(c[0],c[1],c[2],c[3],4<c.length?c[4]:null)},g.PI2=2*Math.PI,g}(),J=function(){function g(a,b){switch(this._next=b||g.NORENDER,a){case 0:return void(this._fun=this._no);case 1:return void(this._fun=this._image);case 2:return void(this._fun=this._alpha);case 4:return void(this._fun=this._transform);case 8:return void(this._fun=this._blend);case 16:return void(this._fun=this._canvas);case 64:return void(this._fun=this._mask);case 128:return void(this._fun=this._clip);case 256:return void(this._fun=this._style);case 512:return void(this._fun=this._graphics);case 2048:return void(this._fun=this._childs);case 1024:return void(this._fun=this._custom);case 513:case 517:return void(this._fun=this._image2);case 32:return void(this._fun=r._filter);case 69905:return void(this._fun=g._initRenderFun)}this.onCreate(a)}p(g,"laya.renders.RenderSprite");var a=g.prototype;return a.onCreate=function(a){},a._style=function(a,b,c,d){a._style.render(a,b,c,d);var e=this._next;e._fun.call(e,a,b,c,d)},a._no=function(a,b,c,d){},a._custom=function(a,b,c,d){a.customRender(b,c,d);var e=a._style._tf;this._next._fun.call(this._next,a,b,c-e.translateX,d-e.translateY)},a._clip=function(a,b,c,d){var e=this._next;if(e!=g.NORENDER){var f=a._style.scrollRect;b.ctx.save(),b.ctx.clipRect(c,d,f.width,f.height),e._fun.call(e,a,b,c-f.x,d-f.y),b.ctx.restore()}},a._blend=function(a,b,c,d){var e=a._style;e.blendMode&&(b.ctx.globalCompositeOperation=e.blendMode);var f=this._next;f._fun.call(f,a,b,c,d),b.ctx.globalCompositeOperation="source-over"},a._mask=function(a,b,c,d){var e=this._next;e._fun.call(e,a,b,c,d);var f=a.mask;f&&(b.ctx.globalCompositeOperation="destination-in",(0<f.numChildren||!f.graphics._isOnlyOne())&&(f.cacheAsBitmap=!0),f.render(b,c-a.pivotX,d-a.pivotY)),b.ctx.globalCompositeOperation="source-over"},a._graphics=function(a,b,c,d){var e=a._style._tf;a._graphics&&a._graphics._render(a,b,c-e.translateX,d-e.translateY);var f=this._next;f._fun.call(f,a,b,c,d)},a._image=function(a,b,c,d){var e=a._style;b.ctx.drawTexture2(c,d,e._tf.translateX,e._tf.translateY,a.transform,e.alpha,e.blendMode,a._graphics._one)},a._image2=function(a,b,c,d){var e=a._style._tf;b.ctx.drawTexture2(c,d,e.translateX,e.translateY,a.transform,1,null,a._graphics._one)},a._alpha=function(a,b,c,d){var e;if(.01<(e=a._style.alpha)||a._needRepaint()){var f=b.ctx.globalAlpha;b.ctx.globalAlpha*=e;var g=this._next;g._fun.call(g,a,b,c,d),b.ctx.globalAlpha=f}},a._transform=function(a,b,c,d){var e=a.transform,f=this._next;e&&f!=g.NORENDER?(b.save(),b.transform(e.a,e.b,e.c,e.d,e.tx+c,e.ty+d),f._fun.call(f,a,b,0,0),b.restore()):f._fun.call(f,a,b,c,d)},a._childs=function(a,b,c,d){var e=a._style,f=e._tf;if(c=c-f.translateX+e.paddingLeft,d=d-f.translateY+e.paddingTop,e._calculation){var g=a._getWords();if(g){var h=e;h&&(h.stroke?b.fillBorderWords(g,c,d,h.font,h.color,h.strokeColor,h.stroke):b.fillWords(g,c,d,h.font,h.color,"none"!=h.textDecoration&&h.underLine?1:0))}}var i,j=a._childs,k=j.length;if(a.viewport||a.optimizeScrollRect&&a._style.scrollRect){var l=a.viewport||a._style.scrollRect,m=l.x,n=l.y,o=l.right,p=l.bottom,q=NaN,r=NaN;for(s=0;s<k;++s)(i=j[s]).visible&&(q=i._x)<o&&q+i.width>m&&(r=i._y)<p&&r+i.height>n&&i.render(b,c,d)}else for(var s=0;s<k;++s)(i=j[s])._style.visible&&i.render(b,c,d)},a._canvas=function(a,b,c,d){var e=a._$P.cacheCanvas;if(e){"bitmap"===e.type?V.canvasBitmap++:V.canvasNormal++;var f=e.ctx;if(a._needRepaint()||!f)this._canvas_repaint(a,b,c,d);else{var g=e._cacheRec;b.drawCanvas(f.canvas,c+g.x,d+g.y,g.width,g.height)}}else this._next._fun.call(this._next,a,b,c,d)},a._canvas_repaint=function(a,b,c,d){var e=a._$P.cacheCanvas,f=this._next;if(e){var g,h,i,j,k=e.ctx,l=a._needRepaint()||!k,m=e.type;if("bitmap"===m?V.canvasBitmap++:V.canvasNormal++,l){var n,o;e._cacheRec||(e._cacheRec=new z),H.isWebGL&&"bitmap"!==m?e._cacheRec.setTo(-a.pivotX,-a.pivotY,1,1):((j=a.getSelfBounds()).x=j.x-a.pivotX,j.y=j.y-a.pivotY,j.x=j.x-16,j.y=j.y-16,j.width=j.width+32,j.height=j.height+32,j.x=Math.floor(j.x+c)-c,j.y=Math.floor(j.y+d)-d,j.width=Math.floor(j.width),j.height=Math.floor(j.height),e._cacheRec.copyFrom(j)),j=e._cacheRec;var p,q=H.isWebGL?1:M.pixelRatio*x.stage.clientScaleX,r=H.isWebGL?1:M.pixelRatio*x.stage.clientScaleY;if(!H.isWebGL){var s,t=1,u=1;for(s=a;s&&s!=x.stage;)t*=s.scaleX,u*=s.scaleY,s=s.parent;H.isWebGL?(t<1&&(q*=t),u<1&&(r*=u)):(1<t&&(q*=t),1<u&&(r*=u))}if(a.scrollRect){var v=a.scrollRect;j.x-=v.x,j.y-=v.y}if(n=j.width*q,o=j.height*r,h=j.x,i=j.y,H.isWebGL&&"bitmap"===m&&(2048<n||2048<o))return console.warn("cache bitmap size larger than 2048,cache ignored"),e.ctx&&(U.recover("RenderContext",e.ctx),e.ctx.canvas.size(0,0),e.ctx=null),void f._fun.call(f,a,b,c,d);if(k||(k=e.ctx=U.getItem("RenderContext")||new I(n,o,ta.create("AUTO"))),k.ctx.sprite=a,(g=k.canvas).clear(),(g.width!=n||g.height!=o)&&g.size(n,o),"bitmap"===m?g.context.asBitmap=!0:"normal"===m&&(g.context.asBitmap=!1),1!=q||1!=r){var w=k.ctx;w.save(),w.scale(q,r),!H.isConchWebGL&&H.isConchApp&&(p=a._$P.cf)&&w.setFilterMatrix&&w.setFilterMatrix(p._mat,p._alpha),f._fun.call(f,a,k,-h,-i),w.restore(),H.isConchApp&&!H.isConchWebGL||a._applyFilters()}else w=k.ctx,!H.isConchWebGL&&H.isConchApp&&(p=a._$P.cf)&&w.setFilterMatrix&&w.setFilterMatrix(p._mat,p._alpha),f._fun.call(f,a,k,-h,-i),H.isConchApp&&!H.isConchWebGL||a._applyFilters();a._$P.staticCache&&(e.reCache=!1),V.canvasReCache++}else h=(j=e._cacheRec).x,i=j.y,g=k.canvas;b.drawCanvas(g,c+h,d+i,j.width,j.height)}else f._fun.call(f,a,k,c,d)},g.__init__=function(){var a,b,c=0;for(b=D.createRenderSprite(69905,null),a=g.renders.length=4096,c=0;c<a;c++)g.renders[c]=b;g.renders[0]=D.createRenderSprite(0,null),function(a,b){for(var c=0,d=0;d<a.length;d++)c|=a[d],g.renders[c]=b}([1,512,4,2],new g(1,null)),g.renders[513]=D.createRenderSprite(513,null),g.renders[517]=new g(517,null)},g._initRenderFun=function(a,b,c,d){var e=a._renderType;(g.renders[e]=g._getTypeRender(e))._fun(a,b,c,d)},g._getTypeRender=function(a){for(var b=null,c=2048;1<c;)c&a&&(b=D.createRenderSprite(c,b)),c>>=1;return b},g.IMAGE=1,g.ALPHA=2,g.TRANSFORM=4,g.BLEND=8,g.CANVAS=16,g.FILTERS=32,g.MASK=64,g.CLIP=128,g.STYLE=256,g.GRAPHICS=512,g.CUSTOM=1024,g.CHILDS=2048,g.INIT=69905,g.renders=[],g.NORENDER=new g(0,null),g}(),K=function(){function h(){this._repaint=!1}p(h,"laya.resource.Context");var a=h.prototype;return a.replaceReset=function(){var a,b,c=0;for(a=h.replaceKeys.length,c=0;c<a;c++)b=h.replaceKeys[c],this[h.newKeys[c]]=this[b]},a.replaceResotre=function(){this.__restore(),this.__reset()},a.setIsMainContext=function(){},a.drawTextures=function(a,b,c,d){V.drawCall+=b.length/2;for(var e=a.width,f=a.height,g=0,h=b.length;g<h;g+=2)this.drawTexture(a,b[g],b[g+1],e,f,c,d)},a.drawCanvas=function(a,b,c,d,e){V.drawCall++,this.drawImage(a.source,b,c,d,e)},a.fillRect=function(a,b,c,d,e){V.drawCall++,e&&(this.fillStyle=e),this.__fillRect(a,b,c,d)},a.fillText=function(a,b,c,d,e,f){V.drawCall++,3<arguments.length&&null!=d&&(this.font=d,this.fillStyle=e,this.textAlign=f,this.textBaseline="top"),this.__fillText(a,b,c)},a.fillBorderText=function(a,b,c,d,e,f,g,h){V.drawCall++,this.font=d,this.fillStyle=e,this.textBaseline="top",this.strokeStyle=f,this.lineWidth=g,this.textAlign=h,this.__strokeText(a,b,c),this.__fillText(a,b,c)},a.strokeText=function(a,b,c,d,e,f,g){V.drawCall++,3<arguments.length&&null!=d&&(this.font=d,this.strokeStyle=e,this.lineWidth=f,this.textAlign=g,this.textBaseline="top"),this.__strokeText(a,b,c)},a.transformByMatrix=function(a){this.transform(a.a,a.b,a.c,a.d,a.tx,a.ty)},a.setTransformByMatrix=function(a){this.setTransform(a.a,a.b,a.c,a.d,a.tx,a.ty)},a.clipRect=function(a,b,c,d){V.drawCall++,this.beginPath(),this.rect(a,b,c,d),this.clip()},a.drawTexture=function(a,b,c,d,e,f,g){V.drawCall++;var h=a.uv,i=a.bitmap.width,j=a.bitmap.height;this.drawImage(a.source,h[0]*i,h[1]*j,(h[2]-h[0])*i,(h[5]-h[3])*j,b+f,c+g,d,e)},a.drawTextureWithTransform=function(a,b,c,d,e,f,g,h,i){V.drawCall++;var j=a.uv,k=a.bitmap.width,l=a.bitmap.height;this.save(),1!=i&&(this.globalAlpha*=i),f?(this.transform(f.a,f.b,f.c,f.d,f.tx+g,f.ty+h),this.drawImage(a.source,j[0]*k,j[1]*l,(j[2]-j[0])*k,(j[5]-j[3])*l,b,c,d,e)):this.drawImage(a.source,j[0]*k,j[1]*l,(j[2]-j[0])*k,(j[5]-j[3])*l,b+g,c+h,d,e),this.restore()},a.drawTexture2=function(a,b,c,d,e,f,g,h){var i=h[0];if(i.loaded&&i.bitmap&&i.source){V.drawCall++;var j=1!==f;if(j){var k=this.globalAlpha;this.globalAlpha*=f}var l=i.uv,m=i.bitmap.width,n=i.bitmap.height;e?(this.save(),this.transform(e.a,e.b,e.c,e.d,e.tx+a,e.ty+b),this.drawImage(i.source,l[0]*m,l[1]*n,(l[2]-l[0])*m,(l[5]-l[3])*n,h[1]-c,h[2]-d,h[3],h[4]),this.restore()):this.drawImage(i.source,l[0]*m,l[1]*n,(l[2]-l[0])*m,(l[5]-l[3])*n,h[1]-c+a,h[2]-d+b,h[3],h[4]),j&&(this.globalAlpha=k)}},a.fillTexture=function(a,b,c,d,e,f,g,h){if(!h.pat){if(a.uv!=ka.DEF_UV){var i=new ta("2D");i.getContext("2d"),i.size(a.width,a.height),i.context.drawTexture(a,0,0,a.width,a.height,0,0),a=new ka(i)}h.pat=this.createPattern(a.bitmap.source,f)}var j=b,k=c,l=0,m=0;g&&(j+=g.x%a.width,k+=g.y%a.height,l-=g.x%a.width,m-=g.y%a.height),this.translate(j,k),this.fillRect(l,m,d,e,h.pat),this.translate(-j,-k)},a.drawTriangle=function(a,b,c,d,e,f,g,h){var i=a.bitmap,j=i.source,k=a.width,l=a.height,m=i.width,n=i.height,o=c[d]*m,p=c[e]*m,q=c[f]*m,r=c[d+1]*n,s=c[e+1]*n,t=c[f+1]*n,u=b[d],v=b[e],w=b[f],x=b[d+1],y=b[e+1],z=b[f+1];if(h){var A=(u+v+w)/3,B=(x+y+z)/3,C=u-A,D=x-B,E=Math.sqrt(C*C+D*D);u=A+C/E*(E+1),x=B+D/E*(E+1),D=y-B,v=A+(C=v-A)/(E=Math.sqrt(C*C+D*D))*(E+1),y=B+D/E*(E+1),D=z-B,w=A+(C=w-A)/(E=Math.sqrt(C*C+D*D))*(E+1),z=B+D/E*(E+1)}this.save(),g&&this.transform(g.a,g.b,g.c,g.d,g.tx,g.ty),this.beginPath(),this.moveTo(u,x),this.lineTo(v,y),this.lineTo(w,z),this.closePath(),this.clip();var F=1/(o*s+r*q+p*t-s*q-r*p-o*t),G=u*s+r*w+v*t-s*w-r*v-u*t,H=o*v+u*q+p*w-v*q-u*p-o*w,I=o*s*w+r*v*q+u*p*t-u*s*q-r*p*w-o*v*t,J=x*s+r*z+y*t-s*z-r*y-x*t,K=o*y+x*q+p*z-y*q-x*p-o*z,L=o*s*z+r*y*q+x*p*t-x*s*q-r*p*z-o*y*t;this.transform(G*F,J*F,H*F,K*F,I*F,L*F),this.drawImage(j,a.uv[0]*m,a.uv[1]*n,k,l,a.uv[0]*m,a.uv[1]*n,k,l),this.restore()},a.flush=function(){return 0},a.fillWords=function(a,b,c,d,e,f){d&&(this.font=d),e&&(this.fillStyle=e);this.textBaseline="top",this.textAlign="left";for(var g=0,h=a.length;g<h;g++){var i=a[g];if(this.__fillText(i.char,i.x+b,i.y+c),1===f){var j=i.height,k=.5*i.style.letterSpacing;k||(k=0),this.beginPath(),this.strokeStyle=e,this.lineWidth=1,this.moveTo(b+i.x-k+.5,c+i.y+j+.5),this.lineTo(b+i.x+i.width+k+.5,c+i.y+j+.5),this.stroke()}}},a.fillBorderWords=function(a,b,c,d,e,f,g){d&&(this.font=d),e&&(this.fillStyle=e),this.textBaseline="top",this.lineWidth=g,this.textAlign="left",this.strokeStyle=f;for(var h=0,i=a.length;h<i;h++){var j=a[h];this.__strokeText(j.char,j.x+b,j.y+c),this.__fillText(j.char,j.x+b,j.y+c)}},a.destroy=function(){this.canvas.width=this.canvas.height=0},a.clear=function(){this.clearRect(0,0,this._canvas.width,this._canvas.height),this._repaint=!1},a.drawCurves=function(a,b,c){this.beginPath(),this.strokeStyle=c[3],this.lineWidth=c[4];var d=c[2];a+=c[0],b+=c[1],this.moveTo(a+d[0],b+d[1]);for(var e=2,f=d.length;e<f;)this.quadraticCurveTo(a+d[e++],b+d[e++],a+d[e++],b+d[e++]);this.stroke()},h.__init__=function(b){var c=laya.resource.Context.prototype;if(!(b=b||CanvasRenderingContext2D.prototype).inited){b.inited=!0,b.__fillText=b.fillText,b.__fillRect=b.fillRect,b.__strokeText=b.strokeText;["drawTextures","drawTriangle","fillWords","fillBorderWords","setIsMainContext","fillRect","strokeText","fillTexture","fillText","transformByMatrix","setTransformByMatrix","clipRect","drawTexture","drawTexture2","drawTextureWithTransform","flush","clear","destroy","drawCanvas","fillBorderText","drawCurves"].forEach(function(a){b[a]=c[a]})}},h.replaceCanvasGetSet=function(a,b){var c=Object.getOwnPropertyDescriptor(a,b);if(!c||!c.configurable)return!1;var d,e={};for(d in c)"set"!=d&&(e[d]=c[d]);var f=c.set;return e.set=function(a){f.call(this,a);var b=this.getContext("2d");b&&"__reset"in b&&b.__reset()},Object.defineProperty(a,b,e),!0},h.replaceGetSet=function(a,b){var c=Object.getOwnPropertyDescriptor(a,b);if(!c||!c.configurable)return!1;var d,e={};for(d in c)"set"!=d&&(e[d]=c[d]);var f=c.set,g="___"+b+"__";return h.newKeys.push(g),e.set=function(a){a!=this[g]&&(this[g]=a,f.call(this,a))},Object.defineProperty(a,b,e),!0},h._default=new h,h.newKeys=[],i(h,["replaceKeys",function(){return this.replaceKeys=["font","fillStyle","textBaseline"]}]),h}(),L=function(){function f(a){this._id=0,this._name=null,this._resources=null,this._memorySize=0,this._garbageCollectionRate=NaN,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=0,this._id=++f._uniqueIDCounter,this._name=a||"Content Manager",f._isResourceManagersSorted=!1,this._memorySize=0,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=536870912,this._garbageCollectionRate=.2,f._resourceManagers.push(this),this._resources=[],this._records={}}p(f,"laya.resource.ResourceManager");var a=f.prototype;return x.imps(a,{"laya.resource.IDispose":!0}),a.getResourceByIndex=function(a){return this._resources[a]},a.getResourcesLength=function(){return this._resources.length},a.addResource=function(a){return a.resourceManager&&a.resourceManager.removeResource(a),-1===this._resources.indexOf(a)&&((a._resourceManager=this)._resources.push(a),this.addRecord(a.uri,a.__className,a.memorySize),this.addSize(a.memorySize),!0)},a.removeResource=function(a){var b=this._resources.indexOf(a);return-1!==b&&(this._resources.splice(b,1),a._resourceManager=null,this._memorySize-=a.memorySize,this.addRecord(a.uri,a.__className,-a.memorySize),!0)},a.unload=function(){for(var a=this._resources.slice(0,this._resources.length),b=0;b<a.length;b++){a[b].destroy()}a.length=0},a.dispose=function(){if(this===f._systemResourceManager)throw new Error("systemResourceManager不能被释放！");f._resourceManagers.splice(f._resourceManagers.indexOf(this),1),f._isResourceManagersSorted=!1;for(var a=this._resources.slice(0,this._resources.length),b=0;b<a.length;b++){var c=a[b];c.resourceManager.removeResource(c),c.destroy()}a.length=0},a.addSize=function(a){a&&(this.autoRelease&&0<a&&this._memorySize+a>this.autoReleaseMaxSize&&this.garbageCollection((1-this._garbageCollectionRate)*this.autoReleaseMaxSize),this._memorySize+=a)},a.addRecord=function(a,b,c){DEBUG&&c&&!a&&console.error(a,b,c),a&&(this._records.hasOwnProperty(b+"|"+a)||(this._records[b+"|"+a]=0),this._records[b+"|"+a]+=c,DEBUG&&this._records[b+"|"+a]<0&&console.error(a,b,this._records[b+"|"+a]))},a.garbageCollection=function(a){var b=this._resources;(b=b.slice()).sort(function(a,b){if(!a||!b)throw new Error("a或b不能为空！");return a.released&&b.released?0:a.released?1:b.released?-1:a._lastUseFrameCount-b._lastUseFrameCount});for(var c=V.loopCount,d=0,e=b.length;d<e;d++){var f=b[d];if(!(1<c-f._lastUseFrameCount))return void(this._memorySize>=a&&(this._isOverflow=!0));if(f.releaseResource(),this._memorySize<a)return void(this._isOverflow=!1)}},k(0,a,"id",function(){return this._id}),k(0,a,"name",function(){return this._name},function(a){!a&&""===a||this._name===a||(this._name=a,f._isResourceManagersSorted=!1)}),k(0,a,"memorySize",function(){return this._memorySize}),k(0,a,"records",function(){return this._records}),k(1,f,"systemResourceManager",function(){return f._systemResourceManager}),f.__init__=function(){f.currentResourceManager=f.systemResourceManager},f.getLoadedResourceManagerByIndex=function(a){return f._resourceManagers[a]},f.getLoadedResourceManagersCount=function(){return f._resourceManagers.length},f.recreateContentManagers=function(a){void 0===a&&(a=!1);for(var b=f.currentResourceManager,c=0;c<f._resourceManagers.length;c++){f.currentResourceManager=f._resourceManagers[c];for(var d=0;d<f.currentResourceManager._resources.length;d++)f.currentResourceManager._resources[d].releaseResource(a),f.currentResourceManager._resources[d].activeResource(a)}f.currentResourceManager=b},f.releaseContentManagers=function(a){void 0===a&&(a=!1);for(var b=f.currentResourceManager,c=0;c<f._resourceManagers.length;c++){f.currentResourceManager=f._resourceManagers[c];for(var d=0;d<f.currentResourceManager._resources.length;d++){var e=f.currentResourceManager._resources[d];!e.released&&e.releaseResource(a)}}f.currentResourceManager=b},f._uniqueIDCounter=0,f._isResourceManagersSorted=!1,f._resourceManagers=[],i(f,["_systemResourceManager",function(){return this._systemResourceManager=new f("System Resource Manager")},"currentResourceManager",function(){return this.currentResourceManager=f._systemResourceManager}]),f}(),M=(function(){function a(){}p(a,"laya.system.System"),a.changeDefinition=function(a,b){x[a]=b;var c=a+"=classObj";x._runScript(c)},a.__init__=function(){H.isConchApp&&(conch.disableConchResManager(),conch.disableConchAutoRestoreLostedDevice())}}(),function(){function c(){}return p(c,"laya.utils.Browser"),k(1,c,"pixelRatio",function(){return c.__init__(),-1<c.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")?2:D.getPixelRatio()}),k(1,c,"height",function(){return c.__init__(),(x.stage&&x.stage.canvasRotation?c.clientWidth:c.clientHeight)*c.pixelRatio}),k(1,c,"clientWidth",function(){return c.__init__(),c.window.innerWidth||c.document.body.clientWidth}),k(1,c,"window",function(){return c.__init__(),c._window}),k(1,c,"clientHeight",function(){return c.__init__(),c.window.innerHeight||c.document.body.clientHeight||c.document.documentElement.clientHeight}),k(1,c,"width",function(){return c.__init__(),(x.stage&&x.stage.canvasRotation?c.clientHeight:c.clientWidth)*c.pixelRatio}),k(1,c,"container",function(){return c.__init__(),c._container||((c._container=c.createElement("div")).id="layaContainer",c.document.body.appendChild(c._container)),c._container},function(a){c._container=a}),k(1,c,"document",function(){return c.__init__(),c._document}),c.__init__=function(){if(!c._window){c._window=D.getWindow(),c._document=c.window.document,c._window.addEventListener("message",function(a){laya.utils.Browser._onMessage(a)},!1),c.document.__createElement=c.document.createElement,g.requestAnimationFrame=g.requestAnimationFrame||g.webkitRequestAnimationFrame||g.mozRequestAnimationFrame||g.oRequestAnimationFrame||g.msRequestAnimationFrame||function(a){return g.setTimeout(a,1e3/60)};var a=g.document.body.style;a["-webkit-user-select"]="none",a["-webkit-tap-highlight-color"]="rgba(200,200,200,0)",c.userAgent=c.window.navigator.userAgent,c.onIOS=!!(c.u=c.userAgent).match(/\(i[^;]+;(U;)? CPU.+Mac OS X/),c.onMobile=-1<c.u.indexOf("Mobile"),c.onIPhone=-1<c.u.indexOf("iPhone"),c.onMac=-1<c.u.indexOf("Mac OS X"),c.onIPad=-1<c.u.indexOf("iPad"),c.onAndroid=-1<c.u.indexOf("Android")||-1<c.u.indexOf("Adr"),c.onWP=-1<c.u.indexOf("Windows Phone"),c.onQQBrowser=-1<c.u.indexOf("QQBrowser"),c.onMQQBrowser=-1<c.u.indexOf("MQQBrowser")||-1<c.u.indexOf("Mobile")&&-1<c.u.indexOf("QQ"),c.onIE=!!c.window.ActiveXObject||"ActiveXObject"in c.window,c.onWeiXin=-1<c.u.indexOf("MicroMessenger"),c.onPC=!c.onMobile,c.onSafari=-1<c.u.indexOf("Safari"),c.onFirefox=-1<c.u.indexOf("Firefox"),c.onEdge=-1<c.u.indexOf("Edge"),c.onMiniGame=-1<c.u.indexOf("MiniGame"),c.onLimixiu=-1<c.u.indexOf("limixiu"),c.httpProtocol="http:"==c.window.location.protocol,c.onMiniGame&&null==c.window.focus&&console.error("请先初始化小游戏适配库，详细教程https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0"),c.webAudioEnabled=!!(c.window.AudioContext||c.window.webkitAudioContext||c.window.mozAudioContext),c.soundType=c.webAudioEnabled?"WEBAUDIOSOUND":"AUDIOSOUND",ea=c.webAudioEnabled?fa:ca,c.webAudioEnabled&&fa.initWebAudio(),ca._initMusicAudio(),c.enableTouch="ontouchstart"in g||g.DocumentTouch&&b instanceof DocumentTouch,g.focus(),C._soundClass=ea,C._musicClass=ca,H._mainCanvas=H._mainCanvas||ta.create("2D"),c.canvas||(c.canvas=ta.create("2D"),c.context=c.canvas.getContext("2d"))}},c._onMessage=function(a){if(a.data&&"size"==a.data.name){if(c.window.innerWidth=a.data.width,c.window.innerHeight=a.data.height,c.window.__innerHeight=a.data.clientHeight,!c.document.createEvent)return void console.warn("no document.createEvent");var b=c.document.createEvent("HTMLEvents");return b.initEvent("resize",!1,!1),void c.window.dispatchEvent(b)}},c.createElement=function(a){return c.__init__(),c.document.__createElement(a)},c.getElementById=function(a){return c.__init__(),c.document.getElementById(a)},c.removeElement=function(a){a&&a.parentNode&&a.parentNode.removeChild(a)},c.now=function(){return D.now()},c._window=null,c._document=null,c._container=null,c.userAgent=null,c.u=null,c.onIOS=!1,c.onMac=!1,c.onMobile=!1,c.onIPhone=!1,c.onIPad=!1,c.onAndroid=!1,c.onWP=!1,c.onQQBrowser=!1,c.onMQQBrowser=!1,c.onSafari=!1,c.onFirefox=!1,c.onEdge=!1,c.onIE=!1,c.onWeiXin=!1,c.onMiniGame=!1,c.onLimixiu=!1,c.onPC=!1,c.httpProtocol=!1,c.webAudioEnabled=!1,c.soundType=null,c.enableTouch=!1,c.canvas=null,c.context=null,c.__init$=function(){},c}()),N=function(){function b(a){this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,a?(this._u8d_=new Uint8Array(a),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this.___resizeBuffer(this._allocated_)}p(b,"laya.utils.Byte");var a=b.prototype;return a.___resizeBuffer=function(b){try{var a=new Uint8Array(b);null!=this._u8d_&&(this._u8d_.length<=b?a.set(this._u8d_):a.set(this._u8d_.subarray(0,b))),this._u8d_=a,this._d_=new DataView(a.buffer)}catch(a){throw"___resizeBuffer err:"+b}},a.getString=function(){return this.rUTF(this.getUint16())},a.getFloat32Array=function(a,b){var c=a+b;c=c>this._length?this._length:c;var d=new Float32Array(this._d_.buffer.slice(a,c));return this._pos_=c,d},a.getUint8Array=function(a,b){var c=a+b;c=c>this._length?this._length:c;var d=new Uint8Array(this._d_.buffer.slice(a,c));return this._pos_=c,d},a.getInt16Array=function(a,b){var c=a+b;c=c>this._length?this._length:c;var d=new Int16Array(this._d_.buffer.slice(a,c));return this._pos_=c,d},a.getFloat32=function(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var a=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,a},a.getFloat64=function(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var a=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,a},a.writeFloat32=function(a){this.ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,a,this._xd_),this._pos_+=4},a.writeFloat64=function(a){this.ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,a,this._xd_),this._pos_+=8},a.getInt32=function(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var a=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,a},a.getUint32=function(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var a=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,a},a.writeInt32=function(a){this.ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,a,this._xd_),this._pos_+=4},a.writeUint32=function(a){this.ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,a,this._xd_),this._pos_+=4},a.getInt16=function(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var a=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,a},a.getUint16=function(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var a=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,a},a.writeUint16=function(a){this.ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,a,this._xd_),this._pos_+=2},a.writeInt16=function(a){this.ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,a,this._xd_),this._pos_+=2},a.getUint8=function(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._d_.getUint8(this._pos_++)},a.writeUint8=function(a){this.ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,a),this._pos_++},a._getUInt8=function(a){return this._d_.getUint8(a)},a._getUint16=function(a){return this._d_.getUint16(a,this._xd_)},a._getMatrix=function(){return new E(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32())},a.rUTF=function(a){for(var b=[],c=this._pos_+a,d=0,e=0,f=0,g=String.fromCharCode,h=this._u8d_;this._pos_<c;)(d=h[this._pos_++])<128?0!=d&&b.push(g(d)):d<224?b.push(g((63&d)<<6|127&h[this._pos_++])):d<240?(e=h[this._pos_++],b.push(g((31&d)<<12|(127&e)<<6|127&h[this._pos_++]))):(e=h[this._pos_++],f=h[this._pos_++],b.push(g((15&d)<<18|(127&e)<<12|f<<6&127|127&h[this._pos_++]))),0;return b.join("")},a.getCustomString=function(a){for(var b=[],c=0,d=0,e=0,f=String.fromCharCode,g=this._u8d_;0<a;)if((d=g[this._pos_])<128)b.push(f(d)),this._pos_++,a--;else for(c=d-128,this._pos_++,a-=c;0<c;)d=g[this._pos_++],e=g[this._pos_++],b.push(f(e<<8|d)),c--;return b.join("")},a.clear=function(){this._pos_=0,this.length=0},a.__getBuffer=function(){return this._d_.buffer},a.writeUTFBytes=function(a){for(var b=0,c=(a+="").length;b<c;b++){var d=a.charCodeAt(b);d<=127?this.writeByte(d):d<=2047?(this.ensureWrite(this._pos_+2),this._u8d_.set([192|d>>6,128|63&d],this._pos_),this._pos_+=2):d<=65535?(this.ensureWrite(this._pos_+3),this._u8d_.set([224|d>>12,128|d>>6&63,128|63&d],this._pos_),this._pos_+=3):(this.ensureWrite(this._pos_+4),this._u8d_.set([240|d>>18,128|d>>12&63,128|d>>6&63,128|63&d],this._pos_),this._pos_+=4)}},a.writeUTFString=function(a){var b=this.pos;this.writeUint16(1),this.writeUTFBytes(a);var c=this.pos-b-2;if(65536<=c)throw"writeUTFString byte len more than 65536";this._d_.setUint16(b,c,this._xd_)},a.readUTFString=function(){return this.readUTFBytes(this.getUint16())},a.getUTFString=function(){return this.readUTFString()},a.readUTFBytes=function(a){if(void 0===a&&(a=-1),0==a)return"";var b=this.bytesAvailable;if(b<a)throw"readUTFBytes error - Out of bounds";return a=0<a?a:b,this.rUTF(a)},a.getUTFBytes=function(a){return void 0===a&&(a=-1),this.readUTFBytes(a)},a.writeByte=function(a){this.ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,a),this._pos_+=1},a.readByte=function(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++)},a.getByte=function(){return this.readByte()},a.ensureWrite=function(a){this._length<a&&(this._length=a),this._allocated_<a&&(this.length=a)},a.writeArrayBuffer=function(a,b,c){if(void 0===b&&(b=0),void 0===c&&(c=0),b<0||c<0)throw"writeArrayBuffer error - Out of bounds";0==c&&(c=a.byteLength-b),this.ensureWrite(this._pos_+c);var d=new Uint8Array(a);this._u8d_.set(d.subarray(b,b+c),this._pos_),this._pos_+=c},k(0,a,"buffer",function(){var a=this._d_.buffer;return a.byteLength==this.length?a:a.slice(0,this.length)}),k(0,a,"endian",function(){return this._xd_?"littleEndian":"bigEndian"},function(a){this._xd_="littleEndian"==a}),k(0,a,"length",function(){return this._length},function(a){this._allocated_<a?this.___resizeBuffer(this._allocated_=Math.floor(Math.max(a,2*this._allocated_))):this._allocated_>a&&this.___resizeBuffer(this._allocated_=a),this._length=a}),k(0,a,"pos",function(){return this._pos_},function(a){this._pos_=a}),k(0,a,"bytesAvailable",function(){return this._length-this._pos_}),b.getSystemEndian=function(){if(!b._sysEndian){var a=new ArrayBuffer(2);new DataView(a).setInt16(0,256,!0),b._sysEndian=256===new Int16Array(a)[0]?"littleEndian":"bigEndian"}return b._sysEndian},b.BIG_ENDIAN="bigEndian",b.LITTLE_ENDIAN="littleEndian",b._sysEndian=null,b}(),O=function(){function e(){}return p(e,"laya.utils.CacheManager"),e.regCacheByFunction=function(a,b){var c;e.unRegCacheByFunction(a,b),c={tryDispose:a,getCacheList:b},e._cacheList.push(c)},e.unRegCacheByFunction=function(a,b){var c,d=0;for(c=e._cacheList.length,d=0;d<c;d++)if(e._cacheList[d].tryDispose==a&&e._cacheList[d].getCacheList==b)return void e._cacheList.splice(d,1)},e.forceDispose=function(){var a=0,b=e._cacheList.length;for(a=0;a<b;a++)e._cacheList[a].tryDispose(!0)},e.beginCheck=function(a){void 0===a&&(a=15e3),x.timer.loop(a,null,e._checkLoop)},e.stopCheck=function(){x.timer.clear(null,e._checkLoop)},e._checkLoop=function(){var a=e._cacheList;if(!(a.length<1)){var b,c=M.now(),d=0;for(b=d=a.length;0<d&&(a[e._index=++e._index%b].tryDispose(!1),!(M.now()-c>e.loopTimeLimit));)d--}},e.loopTimeLimit=2,e._cacheList=[],e._index=0,e}(),P=function(){function n(){}return p(n,"laya.utils.ClassUtils"),n.regClass=function(a,b){n._classMap[a]=b},n.getRegClass=function(a){return n._classMap[a]},n.getInstance=function(a){var b=n.getClass(a);return b?new b:(console.warn("[error] Undefined class:",a),null)},n.createByJson=function(a,b,c,d,e){"string"==typeof a&&(a=JSON.parse(a));var f=a.props;if(!b&&!(b=e?e.runWith(a):n.getInstance(f.runtime||a.type)))return null;var g=a.child;if(g)for(var h=0,i=g.length;h<i;h++){var j=g[h];if("render"!==j.props.name&&"render"!==j.props.renderType||!b._$set_itemRender)if("Graphic"==j.type)n.addGraphicsToSprite(j,b);else if(n.isDrawType(j.type))n.addGraphicToSprite(j,b,!0);else{var k=n.createByJson(j,null,c,d,e);"Script"==j.type?k.hasOwnProperty("owner")?k.owner=b:k.hasOwnProperty("target")&&(k.target=b):"mask"==j.props.renderType?b.mask=k:b.addChild(k)}else b.itemRender=j}if(f)for(var l in f){var m=f[l];"var"===l&&c?c[m]=b:m instanceof Array&&"function"==typeof b[l]?b[l].apply(b,m):b[l]=m}return d&&a.customProps&&d.runWith([b,a]),b.created&&b.created(),b},n.addGraphicsToSprite=function(a,b){var c;if((c=a.child)&&!(c.length<1)){var d;d=n._getGraphicsFromSprite(a,b);var e=0,f=0;a.props&&(e=n._getObjVar(a.props,"x",0),f=n._getObjVar(a.props,"y",0)),0!=e&&0!=f&&d.translate(e,f);var g,h=0;for(g=c.length,h=0;h<g;h++)n._addGraphicToGraphics(c[h],d);0!=e&&0!=f&&d.translate(-e,-f)}},n.addGraphicToSprite=function(a,b,c){var d;void 0===c&&(c=!1),d=c?n._getGraphicsFromSprite(a,b):b.graphics,n._addGraphicToGraphics(a,d)},n._getGraphicsFromSprite=function(a,b){var c,d;if(!a||!a.props)return b.graphics;switch(d=a.props.renderType){case"hit":case"unHit":var e;b.hitArea||(b.hitArea=new T),(e=b.hitArea)[d]||(e[d]=new m),c=e[d]}return c||(c=b.graphics),c},n._getTransformData=function(a){var b;(a.hasOwnProperty("pivotX")||a.hasOwnProperty("pivotY"))&&(b=b||new E).translate(-n._getObjVar(a,"pivotX",0),-n._getObjVar(a,"pivotY",0));var c=n._getObjVar(a,"scaleX",1),d=n._getObjVar(a,"scaleY",1),e=n._getObjVar(a,"rotation",0);n._getObjVar(a,"skewX",0),n._getObjVar(a,"skewY",0);return 1==c&&1==d&&0==e||((b=b||new E).scale(c,d),b.rotate(.0174532922222222*e)),b},n._addGraphicToGraphics=function(a,b){var c,d;if((c=a.props)&&(d=n.DrawTypeDic[a.type])){var e,f;e=b;var g=n._getParams(c,d[1],d[2],d[3]);((f=n._tM)||1!=n._alpha)&&(e.save(),f&&e.transform(f),1!=n._alpha&&e.alpha(n._alpha)),e[d[0]].apply(e,g),(f||1!=n._alpha)&&e.restore()}},n._adptLineData=function(a){return a[2]=parseFloat(a[0])+parseFloat(a[2]),a[3]=parseFloat(a[1])+parseFloat(a[3]),a},n._adptTextureData=function(a){return a[0]=ha.getRes(a[0]),a},n._adptLinesData=function(a){return a[2]=n._getPointListByStr(a[2]),a},n.isDrawType=function(a){return"Image"!=a&&n.DrawTypeDic.hasOwnProperty(a)},n._getParams=function(a,b,c,d){var e;void 0===c&&(c=0),(e=n._temParam).length=b.length;var f,g,h=0;for(f=b.length,h=0;h<f;h++)e[h]=n._getObjVar(a,b[h][0],b[h][1]);return n._alpha=n._getObjVar(a,"alpha",1),g=n._getTransformData(a),n._tM=g?(c||(c=0),g.translate(e[c],e[c+1]),e[c]=e[c+1]=0,g):null,d&&n[d]&&(e=n[d](e)),e},n._getPointListByStr=function(a){var b,c,d=0;for(c=(b=a.split(",")).length,d=0;d<c;d++)b[d]=parseFloat(b[d]);return b},n._getObjVar=function(a,b,c){return a.hasOwnProperty(b)?a[b]:c},n._temParam=[],n._classMap={Sprite:"laya.display.Sprite",Text:"laya.display.Text",Animation:"laya.display.Animation",Skeleton:"laya.ani.bone.Skeleton",Particle2D:"laya.particle.Particle2D",div:"laya.html.dom.HTMLDivElement",p:"laya.html.dom.HTMLElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",a:"laya.html.dom.HTMLElement","#text":"laya.html.dom.HTMLElement"},n.getClass=function(a){var b=n._classMap[a]||a;return"string"==typeof b?x.__classmap[b]:b},n._tM=null,n._alpha=NaN,i(n,["DrawTypeDic",function(){return this.DrawTypeDic={Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]}}]),n}(),Q=function(){function f(a){if(this._color=[],"string"==typeof a){null===(this.strColor=a)&&(a="#000000"),"#"==a.charAt(0)&&(a=a.substr(1));var b=a.length;if(3==b||4==b){for(var c="",d=0;d<b;d++)c+=a[d]+a[d];a=c}var e=this.numColor=parseInt(a,16);if(8==a.length)return void(this._color=[parseInt(a.substr(0,2),16)/255,((16711680&e)>>16)/255,((65280&e)>>8)/255,(255&e)/255])}else e=this.numColor=a,this.strColor=Y.toHexColor(e);this._color=[((16711680&e)>>16)/255,((65280&e)>>8)/255,(255&e)/255,1],this._color.__id=++f._COLODID}return p(f,"laya.utils.Color"),f._initDefault=function(){for(var a in f._DEFAULT={},f._COLOR_MAP)f._SAVE[a]=f._DEFAULT[a]=new f(f._COLOR_MAP[a]);return f._DEFAULT},f._initSaveMap=function(){for(var a in f._SAVE_SIZE=0,f._SAVE={},f._DEFAULT)f._SAVE[a]=f._DEFAULT[a]},f.create=function(a){var b=f._SAVE[a+""];return null!=b?b:(f._SAVE_SIZE<1e3||f._initSaveMap(),f._SAVE[a+""]=new f(a))},f._SAVE={},f._SAVE_SIZE=0,f._COLOR_MAP={white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#AAAAAA"},f._DEFAULT=f._initDefault(),f._COLODID=1,f}(),R=(function(){function a(){this._values=[],this._keys=[]}p(a,"laya.utils.Dictionary");var b=a.prototype;b.set=function(a,b){var c=this.indexOf(a);0<=c?this._values[c]=b:(this._keys.push(a),this._values.push(b))},b.indexOf=function(a){var b=this._keys.indexOf(a);return 0<=b?b:(a="string"==typeof a?Number(a):"number"==typeof a?a.toString():a,this._keys.indexOf(a))},b.get=function(a){var b=this.indexOf(a);return b<0?null:this._values[b]},b.remove=function(a){var b=this.indexOf(a);return 0<=b&&(this._keys.splice(b,1),this._values.splice(b,1),!0)},b.clear=function(){this._values.length=0,this._keys.length=0},k(0,b,"values",function(){return this._values}),k(0,b,"keys",function(){return this._keys})}(),function(){function a(){this.ratio=.92,this.maxOffset=60,this._dragging=!1,this._clickOnly=!0}p(a,"laya.utils.Dragging");var b=a.prototype;return b.start=function(a,b,c,d,e,f,g,h){void 0===h&&(h=.92),this.clearTimer(),this.target=a,this.area=b,this.hasInertia=c,this.elasticDistance=b?d:0,this.elasticBackTime=e,this.data=f,this._disableMouseEvent=g,this.ratio=h,1!=a.globalScaleX||1!=a.globalScaleY?this._parent=a.parent:this._parent=x.stage,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=this._parent.mouseX,this._lastY=this._parent.mouseY,x.stage.on("mouseup",this,this.onStageMouseUp),x.stage.on("mouseout",this,this.onStageMouseUp),x.timer.frameLoop(1,this,this.loop)},b.clearTimer=function(){x.timer.clear(this,this.loop),x.timer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null)},b.stop=function(){this._dragging&&(o.instance.disableMouseEvent=!1,x.stage.off("mouseup",this,this.onStageMouseUp),x.stage.off("mouseout",this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear())},b.loop=function(){var a=this._parent.getMousePoint(),b=a.x,c=a.y,d=b-this._lastX,e=c-this._lastY;if(this._clickOnly){if(!(1<Math.abs(d*x.stage._canvasTransform.getScaleX())||1<Math.abs(e*x.stage._canvasTransform.getScaleY())))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event("dragstart",this.data),o.instance.disableMouseEvent=this._disableMouseEvent,this.target._set$P("$_MOUSEDOWN",!1)}else this._offsets.push(d,e);0==d&&0==e||(this._lastX=b,this._lastY=c,this.target.x+=d*this._elasticRateX,this.target.y+=e*this._elasticRateY,this.area&&this.checkArea(),this.target.event("dragmove",this.data))},b.checkArea=function(){if(this.elasticDistance<=0)this.backToArea();else{if(this.target.x<this.area.x)var a=this.area.x-this.target.x;else a=this.target.x>this.area.x+this.area.width?this.target.x-this.area.x-this.area.width:0;if(this._elasticRateX=Math.max(0,1-a/this.elasticDistance),this.target.y<this.area.y)var b=this.area.y-this.target.y;else b=this.target.y>this.area.y+this.area.height?this.target.y-this.area.y-this.area.height:0;this._elasticRateY=Math.max(0,1-b/this.elasticDistance)}},b.backToArea=function(){this.target.x=Math.min(Math.max(this.target.x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target.y,this.area.y),this.area.y+this.area.height)},b.onStageMouseUp=function(a){if(o.instance.disableMouseEvent=!1,x.stage.off("mouseup",this,this.onStageMouseUp),x.stage.off("mouseout",this,this.onStageMouseUp),x.timer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var b=this._offsets.length,c=Math.min(b,6),d=this._offsets.length-c,e=b-1;d<e;e--)this._offsetY+=this._offsets[e--],this._offsetX+=this._offsets[e];this._offsetX=this._offsetX/c*2,this._offsetY=this._offsetY/c*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=0<this._offsetX?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=0<this._offsetY?this.maxOffset:-this.maxOffset),x.timer.frameLoop(1,this,this.tweenMove)}else 0<this.elasticDistance?this.checkElastic():this.clear()},b.checkElastic=function(){var a=NaN,b=NaN;if(this.target.x<this.area.x?a=this.area.x:this.target.x>this.area.x+this.area.width&&(a=this.area.x+this.area.width),this.target.y<this.area.y?b=this.area.y:this.target.y>this.area.y+this.area.height&&(b=this.area.y+this.area.height),isNaN(a)&&isNaN(b))this.clear();else{var c={};isNaN(a)||(c.x=a),isNaN(b)||(c.y=b),this._tween=X.to(this.target,c,this.elasticBackTime,S.sineOut,s.create(this,this.clear),0,!1,!1)}},b.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event("dragmove",this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&(x.timer.clear(this,this.tweenMove),0<this.elasticDistance?this.checkElastic():this.clear())},b.clear=function(){if(this.target){this.clearTimer();var a=this.target;this.target=null,this._parent=null,a.event("dragend",this.data)}},a}()),S=function(){function h(){}return p(h,"laya.utils.Ease"),h.linearNone=function(a,b,c,d){return c*a/d+b},h.linearIn=function(a,b,c,d){return c*a/d+b},h.linearInOut=function(a,b,c,d){return c*a/d+b},h.linearOut=function(a,b,c,d){return c*a/d+b},h.bounceIn=function(a,b,c,d){return c-h.bounceOut(d-a,0,c,d)+b},h.bounceInOut=function(a,b,c,d){return a<.5*d?.5*h.bounceIn(2*a,0,c,d)+b:.5*h.bounceOut(2*a-d,0,c,d)+.5*c+b},h.bounceOut=function(a,b,c,d){return(a/=d)<1/2.75?c*(7.5625*a*a)+b:a<2/2.75?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:a<2.5/2.75?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b},h.backIn=function(a,b,c,d,e){return void 0===e&&(e=1.70158),c*(a/=d)*a*((e+1)*a-e)+b},h.backInOut=function(a,b,c,d,e){return void 0===e&&(e=1.70158),(a/=.5*d)<1?.5*c*(a*a*((1+(e*=1.525))*a-e))+b:c/2*((a-=2)*a*((1+(e*=1.525))*a+e)+2)+b},h.backOut=function(a,b,c,d,e){return void 0===e&&(e=1.70158),c*((a=a/d-1)*a*((e+1)*a+e)+1)+b},h.elasticIn=function(a,b,c,d,e,f){var g;return void 0===e&&(e=0),void 0===f&&(f=0),0==a?b:1==(a/=d)?b+c:(f||(f=.3*d),g=!e||0<c&&e<c||c<0&&e<-c?(e=c,f/4):f/h.PI2*Math.asin(c/e),-e*Math.pow(2,10*(a-=1))*Math.sin((a*d-g)*h.PI2/f)+b)},h.elasticInOut=function(a,b,c,d,e,f){var g;return void 0===e&&(e=0),void 0===f&&(f=0),0==a?b:2==(a/=.5*d)?b+c:(f||(f=d*(.3*1.5)),g=!e||0<c&&e<c||c<0&&e<-c?(e=c,f/4):f/h.PI2*Math.asin(c/e),a<1?e*Math.pow(2,10*(a-=1))*Math.sin((a*d-g)*h.PI2/f)*-.5+b:e*Math.pow(2,-10*(a-=1))*Math.sin((a*d-g)*h.PI2/f)*.5+c+b)},h.elasticOut=function(a,b,c,d,e,f){var g;return void 0===e&&(e=0),void 0===f&&(f=0),0==a?b:1==(a/=d)?b+c:(f||(f=.3*d),g=!e||0<c&&e<c||c<0&&e<-c?(e=c,f/4):f/h.PI2*Math.asin(c/e),e*Math.pow(2,-10*a)*Math.sin((a*d-g)*h.PI2/f)+c+b)},h.strongIn=function(a,b,c,d){return c*(a/=d)*a*a*a*a+b},h.strongInOut=function(a,b,c,d){return(a/=.5*d)<1?.5*c*a*a*a*a*a+b:.5*c*((a-=2)*a*a*a*a+2)+b},h.strongOut=function(a,b,c,d){return c*((a=a/d-1)*a*a*a*a+1)+b},h.sineInOut=function(a,b,c,d){return.5*-c*(Math.cos(Math.PI*a/d)-1)+b},h.sineIn=function(a,b,c,d){return-c*Math.cos(a/d*h.HALF_PI)+c+b},h.sineOut=function(a,b,c,d){return c*Math.sin(a/d*h.HALF_PI)+b},h.quintIn=function(a,b,c,d){return c*(a/=d)*a*a*a*a+b},h.quintInOut=function(a,b,c,d){return(a/=.5*d)<1?.5*c*a*a*a*a*a+b:.5*c*((a-=2)*a*a*a*a+2)+b},h.quintOut=function(a,b,c,d){return c*((a=a/d-1)*a*a*a*a+1)+b},h.quartIn=function(a,b,c,d){return c*(a/=d)*a*a*a+b},h.quartInOut=function(a,b,c,d){return(a/=.5*d)<1?.5*c*a*a*a*a+b:.5*-c*((a-=2)*a*a*a-2)+b},h.quartOut=function(a,b,c,d){return-c*((a=a/d-1)*a*a*a-1)+b},h.cubicIn=function(a,b,c,d){return c*(a/=d)*a*a+b},h.cubicInOut=function(a,b,c,d){return(a/=.5*d)<1?.5*c*a*a*a+b:.5*c*((a-=2)*a*a+2)+b},h.cubicOut=function(a,b,c,d){return c*((a=a/d-1)*a*a+1)+b},h.quadIn=function(a,b,c,d){return c*(a/=d)*a+b},h.quadInOut=function(a,b,c,d){return(a/=.5*d)<1?.5*c*a*a+b:.5*-c*(--a*(a-2)-1)+b},h.quadOut=function(a,b,c,d){return-c*(a/=d)*(a-2)+b},h.expoIn=function(a,b,c,d){return 0==a?b:c*Math.pow(2,10*(a/d-1))+b-.001*c},h.expoInOut=function(a,b,c,d){return 0==a?b:a==d?b+c:(a/=.5*d)<1?.5*c*Math.pow(2,10*(a-1))+b:.5*c*(2-Math.pow(2,-10*--a))+b},h.expoOut=function(a,b,c,d){return a==d?b+c:c*(1-Math.pow(2,-10*a/d))+b},h.circIn=function(a,b,c,d){return-c*(Math.sqrt(1-(a/=d)*a)-1)+b},h.circInOut=function(a,b,c,d){return(a/=.5*d)<1?.5*-c*(Math.sqrt(1-a*a)-1)+b:.5*c*(Math.sqrt(1-(a-=2)*a)+1)+b},h.circOut=function(a,b,c,d){return c*Math.sqrt(1-(a=a/d-1)*a)+b},h.HALF_PI=.5*Math.PI,h.PI2=2*Math.PI,h}(),T=function(){function l(){this._hit=null,this._unHit=null}p(l,"laya.utils.HitArea");var a=l.prototype;return a.isHit=function(a,b){return!!l.isHitGraphic(a,b,this.hit)&&!l.isHitGraphic(a,b,this.unHit)},a.contains=function(a,b){return this.isHit(a,b)},k(0,a,"hit",function(){return this._hit||(this._hit=new m),this._hit},function(a){this._hit=a}),k(0,a,"unHit",function(){return this._unHit||(this._unHit=new m),this._unHit},function(a){this._unHit=a}),l.isHitGraphic=function(a,b,c){if(!c)return!1;var d;if(!(d=c.cmds)&&c._one&&((d=l._cmds).length=1,d[0]=c._one),!d)return!1;var e,f,g=0;for(e=d.length,g=0;g<e;g++)if(f=d[g]){var h=H._context;switch(f.callee){case h._translate:case 6:a-=f[0],b-=f[1]}if(l.isHitCmd(a,b,f))return!0}return!1},l.isHitCmd=function(a,b,c){if(!c)return!1;var d=H._context,e=!1;switch(c.callee){case d._drawRect:case 13:l._rec.setTo(c[0],c[1],c[2],c[3]),e=l._rec.contains(a,b);break;case d._drawCircle:case d._fillCircle:case 14:e=(a-=c[0])*a+(b-=c[1])*b<c[2]*c[2];break;case d._drawPoly:case 18:a-=c[0],b-=c[1],e=l.ptInPolygon(a,b,c[2])}return e},l.ptInPolygon=function(a,b,c){var d;(d=l._ptPoint).setTo(a,b);var e,f=0,g=NaN,h=NaN,i=NaN,j=NaN;e=c.length;for(var k=0;k<e;k+=2){if(g=c[k],h=c[k+1],i=c[(k+2)%e],h!=(j=c[(k+3)%e]))if(!(d.y<Math.min(h,j)))if(!(d.y>=Math.max(h,j)))(d.y-h)*(i-g)/(j-h)+g>d.x&&f++}return f%2==1},l._cmds=[],i(l,["_rec",function(){return this._rec=new z},"_ptPoint",function(){return this._ptPoint=new y}]),l}(),U=(function(){function e(a,b,c,d){this.char=a,this.charNum=a.charCodeAt(0),this._x=this._y=0,this.width=b,this.height=c,this.style=d,this.isWord=!e._isWordRegExp.test(a)}p(e,"laya.utils.HTMLChar");var a=e.prototype;x.imps(a,{"laya.display.ILayout":!0}),a.setSprite=function(a){this._sprite=a},a.getSprite=function(){return this._sprite},a._isChar=function(){return!0},a._getCSSStyle=function(){return this.style},k(0,a,"width",function(){return this._w},function(a){this._w=a}),k(0,a,"x",function(){return this._x},function(a){this._sprite&&(this._sprite.x=a),this._x=a}),k(0,a,"y",function(){return this._y},function(a){this._sprite&&(this._sprite.y=a),this._y=a}),k(0,a,"height",function(){return this._h},function(a){this._h=a}),e._isWordRegExp=new RegExp("[\\w.]","")}(),function(){function b(){}p(b,"laya.utils.Log"),b.enable=function(){b._logdiv||(b._logdiv=M.window.document.createElement("div"),M.window.document.body.appendChild(b._logdiv),b._logdiv.style.cssText="pointer-events:none;border:white;overflow:hidden;z-index:1000000;background:rgba(100,100,100,0.6);color:white;position: absolute;left:0px;top:0px;width:50%;height:50%;")},b.toggle=function(){var a=b._logdiv.style;"1px"==a.width?a.width=a.height="50%":a.width=a.height="1px"},b.print=function(a){b._logdiv&&(b.maxCount<=b._count&&b.clear(),b._count++,b._logdiv.innerText+=a+"\n",b._logdiv.scrollTop=b._logdiv.scrollHeight)},b.clear=function(){b._logdiv.innerText="",b._count=0},b._logdiv=null,b._count=0,b.maxCount=20}(),function(){function b(){}p(b,"laya.utils.Mouse"),k(1,b,"cursor",function(){return b._style.cursor},function(a){b._style.cursor=a}),b.hide=function(){"none"!=b.cursor&&(b._preCursor=b.cursor,b.cursor="none")},b.show=function(){"none"==b.cursor&&(b.cursor=b._preCursor?b._preCursor:"auto")},b._preCursor=null,i(b,["_style",function(){return this._style=M.document.body.style}])}(),function(){function f(){}return p(f,"laya.utils.Pool"),f.getPoolBySign=function(a){return f._poolDic[a]||(f._poolDic[a]=[])},f.clearBySign=function(a){f._poolDic[a]&&(f._poolDic[a].length=0)},f.recover=function(a,b){b.__InPool||(b.__InPool=!0,f.getPoolBySign(a).push(b))},f.getItemByClass=function(a,b){var c=f.getPoolBySign(a),d=c.length?c.pop():new b;return d.__InPool=!1,d},f.getItemByCreateFun=function(a,b,c){var d=f.getPoolBySign(a),e=d.length?d.pop():b.call(c);return e.__InPool=!1,e},f.getItem=function(a){var b=f.getPoolBySign(a),c=b.length?b.pop():null;return c&&(c.__InPool=!1),c},f._poolDic={},f.InPoolSign="__InPool",f}()),V=function(){function i(){}return p(i,"laya.utils.Stat"),k(1,i,"onclick",null,function(a){i._sp&&i._sp.on("click",i._sp,a),i._canvas&&(i._canvas.source.onclick=a,i._canvas.source.style.pointerEvents="")}),i.show=function(a,b,c){if(void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),!H.isConchApp||H.isConchWebGL){if(H.isConchWebGL||M.onMiniGame||M.onLimixiu||(i._useCanvas=!0),i._show=!0,i._fpsData.length=60,i._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"},i._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"},i._view[2]={title:"DrawCall",value:"drawCall",color:"green",units:"int"},i._view[3]={title:"CurMem",value:"currentMemorySize",color:"yellow",units:"M"},H.isWebGL)if(i._view[4]={title:"Shader",value:"shaderCall",color:"red",units:"int"},H.is3DMode){if(i._view[0].title="FPS(3D)",i._view[5]={title:"TriFaces",value:"trianglesFaces",color:"blue",units:"int"},i._view[6]={title:"treeNodeColl",value:"treeNodeCollision",color:"white",units:"int"},i._view[7]={title:"treeSpriteColl",value:"treeSpriteCollision",color:"white",units:"int"},1==c){var d=8;i._view[d++]={title:"VATTRIBS",value:"MAX_VERTEX_ATTRIBS",color:"white",units:"int",varying:1},i._view[d++]={title:"VUNIFORMS",value:"MAX_VERTEX_UNIFORM_VECTORS",color:"white",units:"int",varying:1},i._view[d++]={title:"VARYINGS",value:"MAX_VARYING_VECTORS",color:"white",units:"int",varying:1},i._view[d++]={title:"CTEXTURES",value:"MAX_COMBINED_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},i._view[d++]={title:"VTEXTURES",value:"MAX_VERTEX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},i._view[d++]={title:"TEXTURES",value:"MAX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},i._view[d++]={title:"FUNIFORMS",value:"MAX_FRAGMENT_UNIFORM_VECTORS",color:"white",units:"int",varying:1},i._view[d++]={title:"SVERSION",value:"SHADING_LANGUAGE_VERSION",color:"white",units:"string",varying:1},i._view[d++]={title:"VERSION",value:"VERSION",color:"white",units:"string",varying:1}}else if(2==c){d=8;i._view[d++]={title:"astc",value:"WEBGL_compressed_texture_astc",color:"white",units:"object",varying:2},i._view[d++]={title:"atc",value:"WEBGL_compressed_texture_atc",color:"white",units:"object",varying:2},i._view[d++]={title:"etc",value:"WEBGL_compressed_texture_etc",color:"white",units:"object",varying:2},i._view[d++]={title:"etc1",value:"WEBGL_compressed_texture_etc1",color:"white",units:"object",varying:2},i._view[d++]={title:"pvrtc",value:"WEBGL_compressed_texture_pvrtc",color:"white",units:"object",varying:2},i._view[d++]={title:"s3tc",value:"WEBGL_compressed_texture_s3tc",color:"white",units:"object",varying:2},i._view[d++]={title:"srgb",value:"WEBGL_compressed_texture_s3tc_srgb",color:"white",units:"object",varying:2}}}else i._view[0].title="FPS(WebGL)",i._view[5]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};else i._view[4]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};i._useCanvas?i.createUIPre(a,b):i.createUI(a,b),i.enable()}else M.window.conch.showFPS&&M.window.conch.showFPS(a,b)},i.createUIPre=function(a,b){var c=M.pixelRatio;i._width=170*c,i._vx=75*c,i._height=c*(12*i._view.length+3*c)+4,i._fontSize=12*c;for(var d=0;d<i._view.length;d++)i._view[d].x=4,i._view[d].y=d*i._fontSize+2*c;i._canvas||((i._canvas=new ta("2D")).size(i._width,i._height),(i._ctx=i._canvas.getContext("2d")).textBaseline="top",i._ctx.font=i._fontSize+"px Sans-serif",i._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+a+"px;top:"+b+"px;width:"+i._width/c+"px;height:"+i._height/c+"px;"),i._first=!0,i.loop(),i._first=!1,M.container.appendChild(i._canvas.source)},i.createUI=function(a,b){var c=i._sp,d=M.pixelRatio;c||(c=new la,(i._leftText=new qa).pos(5,5),i._leftText.color="#ffffff",c.addChild(i._leftText),(i._txt=new qa).pos(80*d,5),i._txt.color="#ffffff",c.addChild(i._txt),i._sp=c),c.pos(a,b);for(var e="",f=0;f<i._view.length;f++){e+=i._view[f].title+"\n"}i._leftText.text=e;var g=170*d,h=d*(12*i._view.length+3*d)+4;i._txt.fontSize=i._fontSize*d,i._leftText.fontSize=i._fontSize*d,c.size(g,h),c.graphics.clear(),c.graphics.setAlpha(.5),c.graphics.drawRect(0,0,g,h,"#999999"),c.graphics.setAlpha(1),i.loop()},i.enable=function(){x.timer.frameLoop(1,i,i.loop)},i.hide=function(){i._show=!1,x.timer.clear(i,i.loop),i._canvas&&M.removeElement(i._canvas.source)},i.clear=function(){i.trianglesFaces=i.drawCall=i.shaderCall=i.spriteCount=i.spriteRenderUseCacheCount=i.treeNodeCollision=i.treeSpriteCollision=i.canvasNormal=i.canvasBitmap=i.canvasReCache=0},i.loop=function(){i._count++;var a=M.now();if(!(a-i._timer<1e3)){var b=i._count;if(i.FPS=Math.round(1e3*b/(a-i._timer)),i._show){i.trianglesFaces=Math.round(i.trianglesFaces/b),i.spriteCount=i._useCanvas?(i.drawCall=Math.round(i.drawCall/b)-2,i.shaderCall=Math.round(i.shaderCall/b),Math.round(i.spriteCount/b)-1):(i.drawCall=Math.round(i.drawCall/b)-2,i.shaderCall=Math.round(i.shaderCall/b)-4,Math.round(i.spriteCount/b)-4),i.spriteRenderUseCacheCount=Math.round(i.spriteRenderUseCacheCount/b),i.canvasNormal=Math.round(i.canvasNormal/b),i.canvasBitmap=Math.round(i.canvasBitmap/b),i.canvasReCache=Math.ceil(i.canvasReCache/b),i.treeNodeCollision=Math.round(i.treeNodeCollision/b),i.treeSpriteCollision=Math.round(i.treeSpriteCollision/b);var c=0<i.FPS?Math.floor(1e3/i.FPS).toString():" ";i._fpsStr=i.FPS+(i.renderSlow?" slow":"")+" "+c,i._spriteStr=i.spriteCount+(i.spriteRenderUseCacheCount?"/"+i.spriteRenderUseCacheCount:""),i._canvasStr=i.canvasReCache+"/"+i.canvasNormal+"/"+i.canvasBitmap,i.currentMemorySize=L.systemResourceManager.memorySize,i._useCanvas?i.renderInfoPre():i.renderInfo(),i.clear()}i._count=0,i._timer=a}},i.renderInfoPre=function(){if(i._canvas){var a=i._ctx;a.clearRect(i._first?0:i._vx,0,i._width,i._height);for(var b=H.WebGL.mainContext,c=0;c<i._view.length;c++){var d=i._view[c];i._first&&(a.fillStyle="white",a.fillText(d.title,d.x,d.y,null,null,null)),a.fillStyle=d.color;var e=-1;if((d=i._view[c]).varying){if(b)switch(d.varying){case 1:e=b.getParameter(b[d.value]);break;case 2:e=b.getExtension(d.value)}}else e=i[d.value];"M"==d.units&&(e=Math.floor(e/1048576*100)/100+" M"),"K"==d.units&&(e=Math.floor(e/1024*100)/100+" K"),"string"==d.units&&(e=e.match(/\d+\.?\d/i)),a.fillText(e+"",d.x+i._vx,d.y,null,null,null)}}},i.renderInfo=function(){for(var a="",b=H.WebGL.mainContext,c=0;c<i._view.length;c++){var d=i._view[c],e=-1;if(d.varying){if(b)switch(d.varying){case 1:e=b.getParameter(b[d.value]);break;case 2:e=b.getExtension(d.value)}}else e=i[d.value];"M"==d.units&&(e=Math.floor(e/1048576*100)/100+" M"),"K"==d.units&&(e=Math.floor(e/1024*100)/100+" K"),"string"==d.units&&(e=e.match(/\d+\.?\d/i)),a+=e+"\n"}i._txt.text=a},i.FPS=0,i.loopCount=0,i.shaderCall=0,i.drawCall=0,i.trianglesFaces=0,i.spriteCount=0,i.spriteRenderUseCacheCount=0,i.treeNodeCollision=0,i.treeSpriteCollision=0,i.canvasNormal=0,i.canvasBitmap=0,i.canvasReCache=0,i.renderSlow=!1,i.currentMemorySize=0,i._fpsStr=null,i._canvasStr=null,i._spriteStr=null,i._fpsData=[],i._timer=0,i._count=0,i._view=[],i._fontSize=12,i._txt=null,i._leftText=null,i._sp=null,i._show=!1,i._useCanvas=!1,i._canvas=null,i._ctx=null,i._first=!1,i._vx=NaN,i._width=0,i._height=100,i}(),W=(function(){function a(){this._strsToID={},this._idToStrs=[],this._length=0}p(a,"laya.utils.StringKey");var b=a.prototype;b.add=function(a){var b=this._strsToID[a];return null!=b?b:(this._idToStrs[this._length]=a,this._strsToID[a]=this._length++)},b.getID=function(a){var b=this._strsToID[a];return null==b?-1:b},b.getName=function(a){var b=this._idToStrs[a];return null==b?void 0:b}}(),function(){var j;function a(){this._delta=0,this.scale=1,this.currFrame=0,this._mid=1,this._map={},this._laters=[],this._handlers=[],this._temp=[],this._count=0,this._errorRecord=!1,this.currTimer=this._now(),this._lastTimer=this._now(),this._init()}p(a,"laya.utils.Timer");var b=a.prototype;return b._init=function(){x.timer&&x.timer.frameLoop(1,this,this._update)},b._now=function(){return Date.now()},b._update=function(){if(this.scale<=0)this._lastTimer=this._now();else{var a=this.currFrame=this.currFrame+this.scale,b=this._now();this._delta=(b-this._lastTimer)*this.scale;var c=this.currTimer=this.currTimer+this._delta;x.isDebug&&6e4<Math.abs(b-this._lastTimer)&&console.error("系统时间错误！"+(b-this._lastTimer)),this._lastTimer=b;var d=this._handlers;for(g=this._count=0,h=d.length;g<h;g++)if(null!==(i=d[g]).method){var e=i.userFrame?a:c;if(e>=i.exeTime)if(i.repeat)if(i.jumpFrame)for(;e>=i.exeTime;)i.exeTime+=i.delay,i.run(!1);else i.exeTime+=i.delay,i.run(!1),e>i.exeTime&&(i.exeTime+=Math.ceil((e-i.exeTime)/i.delay)*i.delay);else i.run(!0)}else this._count++;(30<this._count||a%200==0)&&this._clearHandlers();for(var f=this._laters,g=0,h=f.length-1;g<=h;g++){var i=f[g];this._isIgnoreRecover(i)||(null!==i.method&&(delete this._map[i.key],i.run(!1)),this._recoverHandler(i)),g===h&&(h=f.length-1)}f.length=0}},b._clearHandlers=function(){for(var a=this._handlers,b=0,c=a.length;b<c;b++){var d=a[b];null!==d.method?this._temp.push(d):this._isIgnoreRecover(d)?this._temp.push(d):this._recoverHandler(d)}this._handlers=this._temp,this._temp=a,this._temp.length=0},b._recoverHandler=function(a){this._map[a.key]==a&&delete this._map[a.key],a.recover()},b._create=function(a,b,c,d,e,f,g,h){if(!c)return e.apply(d,f),null;if(g){var i=this._getHandler(d,e);if(i)return i.repeat=b,i.userFrame=a,i.delay=c,i.ignoreRecover=h,i.caller=d,i.method=e,i.args=f,i.exeTime=c+(a?this.currFrame:this.currTimer+this._now()-this._lastTimer),i}return(i=j.create()).repeat=b,i.userFrame=a,i.delay=c,i.ignoreRecover=h,i.caller=d,i.method=e,i.args=f,i.exeTime=c+(a?this.currFrame:this.currTimer+this._now()-this._lastTimer)+1,this._indexHandler(i),this._handlers.push(i),i},b._indexHandler=function(a){var b=a.caller,c=a.method,d=b?b.$_GID||(b.$_GID=Y.getGID()):0,e=c.$_TID||(c.$_TID=this._mid++);a.key=d+"_"+e,this._map[a.key]=a},b.once=function(a,b,c,d,e){void 0===e&&(e=!0),this._create(!1,!1,a,b,c,d,e,!1)},b.loop=function(a,b,c,d,e,f,g){void 0===e&&(e=!0),void 0===f&&(f=!1),void 0===g&&(g=!1);var h=this._create(!1,!0,a,b,c,d,e,g);h&&(h.jumpFrame=f)},b.frameOnce=function(a,b,c,d,e){void 0===e&&(e=!0),this._create(!0,!1,a,b,c,d,e,!1)},b.frameLoop=function(a,b,c,d,e,f){void 0===e&&(e=!0),void 0===f&&(f=!1),this._create(!0,!0,a,b,c,d,e,f)},b.toString=function(){return"callLater:"+this._laters.length+" handlers:"+this._handlers.length+" pool:"+j._freeCount},b.clear=function(a,b){var c=this._getHandler(a,b);return!(!c||this._isIgnoreRecover(c))&&(delete this._map[c.key],c.key=null,c.clear(),!0)},b.clearAll=function(a){if(a)for(var b=0,c=this._handlers.length;b<c;b++){var d=this._handlers[b];d.caller===a&&(this._isIgnoreRecover(d)||(delete this._map[d.key],d.key=null,d.clear()))}},b._getHandler=function(a,b){var c=a?a.$_GID||(a.$_GID=Y.getGID()):0,d=b.$_TID||(b.$_TID=this._mid++);return this._map[c+"_"+d]},b._isIgnoreRecover=function(a){if(a.ignoreRecover||a.caller&&"IgnoreRecover"==a.caller.callername){if(this._errorRecord)console.warn("核心定时器销毁忽略");else{this._errorRecord=!0;var b="";try{arguments.propertyIsEnumerable.caller}catch(a){b=a.stack}x.recordError("报错：核心定时器销毁忽略  "+b)}return!0}return!1},b.hasHandler=function(a,b){return this._map[a.$_GID+"_"+b.$_TID]},b.callLater=function(a,b,c){if(null==this._getHandler(a,b)){var d=j.create();d.caller=a,d.method=b,d.args=c,this._indexHandler(d),this._laters.push(d)}},b.runCallLater=function(a,b){var c=this._getHandler(a,b);c&&null!=c.method&&(this._isIgnoreRecover(c)||(delete this._map[c.key],c.run(!0)))},b.runTimer=function(a,b){this.runCallLater(a,b)},k(0,b,"delta",function(){return this._delta}),a.__init$=function(){j=function(){function b(){this.key=null,this.repeat=!1,this.delay=0,this.userFrame=!1,this.ignoreRecover=!1,this.exeTime=0,this.caller=null,this.method=null,this.args=null,this.jumpFrame=!1}p(b,"");var a=b.prototype;return a.clear=function(){this.caller=null,this.method=null,this.args=null,this.ignoreRecover=!1},a.recover=function(){this.clear(),this.args=b._freeHandler,b._freeHandler=this,b._freeCount++},a.run=function(a){var b=this.caller;if(b&&b.destroyed)return this.clear();var c=this.method,d=this.args;a&&this.clear(),null!=c&&(d?c.apply(b,d):c.call(b))},b._freeHandler=null,b._freeCount=0,b.create=function(){var a=b._freeHandler;return a?(b._freeHandler=a.args,--b._freeCount,a.args=null,a):new b},b}()},a}()),X=function(){function l(){this.gid=0}p(l,"laya.utils.Tween");var a=l.prototype;return a.to=function(a,b,c,d,e,f,g){return void 0===f&&(f=0),void 0===g&&(g=!1),this._create(a,b,c,d,e,f,g,!0,!1,!0)},a.from=function(a,b,c,d,e,f,g){return void 0===f&&(f=0),void 0===g&&(g=!1),this._create(a,b,c,d,e,f,g,!1,!1,!0)},a._create=function(a,b,c,d,e,f,g,h,i,j){if(!a)throw new Error("Tween:target is null");this._target=a,this._duration=c,this._ease=d||b.ease||l.easeNone,this._complete=e||b.complete,this._delay=f,this._props=[],this._usedTimer=0,this._startTimer=M.now(),this._usedPool=i,this._delayParam=null,this.update=b.update;var k=a.$_GID||(a.$_GID=Y.getGID());return l.tweenMap[k]?(g&&l.clearTween(a),l.tweenMap[k].push(this)):l.tweenMap[k]=[this],j?f<=0?this.firstStart(a,b,h):(this._delayParam=[a,b,h],x.scaleTimer.once(f,this,this.firstStart,this._delayParam)):this._initProps(a,b,h),this},a.firstStart=function(a,b,c){this._delayParam=null,a.destroyed?this.clear():(this._initProps(a,b,c),this._beginLoop())},a._initProps=function(a,b,c){for(var d in b)if("number"==typeof a[d]){var e=c?a[d]:b[d],f=c?b[d]:a[d];this._props.push([d,e,f-e]),c||(a[d]=e)}},a._beginLoop=function(){x.scaleTimer.frameLoop(1,this,this._doEase)},a._doEase=function(){this._updateEase(M.now())},a._updateEase=function(a){var b=this._target;if(b){if(b.destroyed)return l.clearTween(b);var c=this._usedTimer=a-this._startTimer-this._delay;if(!(c<0)){if(c>=this._duration)return this.complete();for(var d=0<c?this._ease(c,0,1,this._duration):0,e=this._props,f=0,g=e.length;f<g;f++){var h=e[f];b[h[0]]=h[1]+d*h[2]}this.update&&this.update.run()}}},a.complete=function(){if(this._target){x.scaleTimer.runTimer(this,this.firstStart);for(var a=this._target,b=this._props,c=this._complete,d=0,e=b.length;d<e;d++){var f=b[d];a[f[0]]=f[1]+f[2]}this.update&&this.update.run(),this.clear(),c&&c.run()}},a.pause=function(){x.scaleTimer.clear(this,this._beginLoop),x.scaleTimer.clear(this,this._doEase),x.scaleTimer.clear(this,this.firstStart);var a;(a=M.now()-this._startTimer-this._delay)<0&&(this._usedTimer=a)},a.setStartTime=function(a){this._startTimer=a},a.clear=function(){this._target&&(this._remove(),this._clear())},a._clear=function(){this.pause(),x.scaleTimer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._delayParam=null,this._usedPool&&(this.update=null,U.recover("tween",this))},a.recover=function(){this._usedPool=!0,this._clear()},a._remove=function(){var a=l.tweenMap[this._target.$_GID];if(a)for(var b=0,c=a.length;b<c;b++)if(a[b]===this){a.splice(b,1);break}},a.restart=function(){if(this.pause(),this._usedTimer=0,this._startTimer=M.now(),this._delayParam)x.scaleTimer.once(this._delay,this,this.firstStart,this._delayParam);else{for(var a=this._props,b=0,c=a.length;b<c;b++){var d=a[b];this._target[d[0]]=d[1]}x.scaleTimer.once(this._delay,this,this._beginLoop)}},a.resume=function(){this._usedTimer>=this._duration||(this._startTimer=M.now()-this._usedTimer-this._delay,this._delayParam?this._usedTimer<0?x.scaleTimer.once(-this._usedTimer,this,this.firstStart,this._delayParam):this.firstStart.apply(this,this._delayParam):this._beginLoop())},k(0,a,"progress",null,function(a){var b=a*this._duration;this._startTimer=M.now()-this._delay-b}),l.to=function(a,b,c,d,e,f,g,h){return void 0===f&&(f=0),void 0===g&&(g=!1),void 0===h&&(h=!0),U.getItemByClass("tween",l)._create(a,b,c,d,e,f,g,!0,h,!0)},l.from=function(a,b,c,d,e,f,g,h){return void 0===f&&(f=0),void 0===g&&(g=!1),void 0===h&&(h=!0),U.getItemByClass("tween",l)._create(a,b,c,d,e,f,g,!1,h,!0)},l.clearAll=function(a){if(a&&a.$_GID){var b=l.tweenMap[a.$_GID];if(b){for(var c=0,d=b.length;c<d;c++)b[c]._clear();b.length=0}}},l.clear=function(a){a.clear()},l.clearTween=function(a){l.clearAll(a)},l.easeNone=function(a,b,c,d){return c*a/d+b},l.tweenMap={},l}(),Y=function(){function h(){}return p(h,"laya.utils.Utils"),h.toRadian=function(a){return a*h._pi2},h.toAngle=function(a){return a*h._pi},h.toHexColor=function(a){if(a<0||isNaN(a))return null;for(var b=a.toString(16);b.length<6;)b="0"+b;return"#"+b},h.getGID=function(){return h._gid++},h.concatArray=function(a,b){if(!b)return a;if(!a)return b;var c=0,d=b.length;for(c=0;c<d;c++)a.push(b[c]);return a},h.clearArray=function(a){return a&&(a.length=0),a},h.copyArray=function(a,b){if(a||(a=[]),!b)return a;a.length=b.length;var c=0,d=b.length;for(c=0;c<d;c++)a[c]=b[c];return a},h.getGlobalRecByPoints=function(a,b,c,d,e){var f,g;return f=new y(b,c),f=a.localToGlobal(f),g=new y(d,e),g=a.localToGlobal(g),z._getWrapRec([f.x,f.y,g.x,g.y])},h.getGlobalPosAndScale=function(a){return h.getGlobalRecByPoints(a,0,0,1,1)},h.bind=function(a,b){return a.bind(b)},h.measureText=function(a,b){return D.measureText(a,b)},h.updateOrder=function(a){if(!a||a.length<2)return!1;for(var b,c=1,d=0,e=a.length,f=NaN;c<e;){for(b=a[d=c],f=a[d]._zOrder;-1<--d&&a[d]._zOrder>f;)a[d+1]=a[d];a[d+1]=b,c++}var g=b.parent.conchModel;if(g)if(null!=g.updateZOrder)g.updateZOrder();else{for(c=0;c<e;c++)g.removeChild(a[c].conchModel);for(c=0;c<e;c++)g.addChildAt(a[c].conchModel,c)}return!0},h.transPointList=function(a,b,c){var d=0,e=a.length;for(d=0;d<e;d+=2)a[d]+=b,a[d+1]+=c},h.parseInt=function(a,b){void 0===b&&(b=0);var c=M.window.parseInt(a,b);return isNaN(c)?0:c},h.getFileExtension=function(a){h._extReg.lastIndex=a.lastIndexOf(".");var b=h._extReg.exec(a);return b&&1<b.length?b[1].toLowerCase():null},h.getTransformRelativeToWindow=function(a,b,c){var d=x.stage,e=laya.utils.Utils.getGlobalPosAndScale(a),f=d._canvasTransform.clone(),g=f.tx,h=f.ty;f.rotate(-Math.PI/180*x.stage.canvasDegree),f.scale(x.stage.clientScaleX,x.stage.clientScaleY);var i=x.stage.canvasDegree%180!=0,j=NaN,k=NaN;i?(j=c+e.y,k=b+e.x,j*=f.d,k*=f.a,90==x.stage.canvasDegree?(j=g-j,k+=h):(j+=g,k=h-k)):(j=b+e.x,k=c+e.y,j*=f.a,k*=f.d,j+=g,k+=h);var l=NaN,m=NaN;return m=i?(l=f.d*e.height,f.a*e.width):(l=f.a*e.width,f.d*e.height),{x:j,y:k,scaleX:l,scaleY:m}},h.fitDOMElementInArea=function(a,b,c,d,e,f){a._fitLayaAirInitialized||(a._fitLayaAirInitialized=!0,a.style.transformOrigin=a.style.webKittransformOrigin="left top",a.style.position="absolute");var g=h.getTransformRelativeToWindow(b,c,d);a.style.transform=a.style.webkitTransform="scale("+g.scaleX+","+g.scaleY+") rotate("+x.stage.canvasDegree+"deg)",a.style.width=e+"px",a.style.height=f+"px",a.style.left=g.x+"px",a.style.top=g.y+"px"},h.isOkTextureList=function(a){if(!a)return!1;var b,c=0,d=a.length;for(c=0;c<d;c++)if(!(b=a[c])||!b.source)return!1;return!0},h.isOKCmdList=function(a){if(!a)return!1;var b,c,d=0,e=a.length,f=H._context;for(d=0;d<e;d++)switch((b=a[d]).callee){case f._drawTexture:case f._fillTexture:case f._drawTextureWithTransform:if(!(c=b[0])||!c.source)return!1}return!0},h._gid=1,h._pi=180/Math.PI,h._pi2=Math.PI/180,h._extReg=/\.(\w+)\??/g,h.parseXMLFromString=function(a){var b;if(a=a.replace(/>\s+</g,"><"),-1<(b=(new DOMParser).parseFromString(a,"text/xml")).firstChild.textContent.indexOf("This page contains the following errors"))throw new Error(b.firstChild.firstChild.textContent);return b},h}(),Z=function(){function a(){this.useDic={},this.shapeDic={},this.shapeLineDic={},this._id=0,this._checkKey=!1,this._freeIdArray=[],H.isWebGL&&O.regCacheByFunction(Y.bind(this.startDispose,this),Y.bind(this.getCacheList,this))}p(a,"laya.utils.VectorGraphManager");var b=a.prototype;return b.getId=function(){return this._id++},b.addShape=function(a,b){this.shapeDic[a]=b,this.useDic[a]||(this.useDic[a]=!0)},b.addLine=function(a,b){this.shapeLineDic[a]=b,this.shapeLineDic[a]||(this.shapeLineDic[a]=!0)},b.getShape=function(a){this._checkKey&&null!=this.useDic[a]&&(this.useDic[a]=!0)},b.deleteShape=function(a){this.shapeDic[a]&&(this.shapeDic[a]=null,delete this.shapeDic[a]),this.shapeLineDic[a]&&(this.shapeLineDic[a]=null,delete this.shapeLineDic[a]),null!=this.useDic[a]&&delete this.useDic[a]},b.getCacheList=function(){var a,b=[];for(a in this.shapeDic)b.push(this.shapeDic[a]);for(a in this.shapeLineDic)b.push(this.shapeLineDic[a]);return b},b.startDispose=function(a){var b;for(b in this.useDic)this.useDic[b]=!1;this._checkKey=!0},b.endDispose=function(){if(this._checkKey){var a;for(a in this.useDic)this.useDic[a]||this.deleteShape(a);this._checkKey=!1}},a.getInstance=function(){return a.instance=a.instance||new a},a.instance=null,a}(),$=function(){function d(){this._obj=null,this._obj=d.supportWeakMap?new M.window.WeakMap:{},d.supportWeakMap||d._maps.push(this)}p(d,"laya.utils.WeakObject");var a=d.prototype;return a.set=function(a,b){if(null!=a)if(d.supportWeakMap){var c=a;"string"!=typeof a&&"number"!=typeof a||(c=d._keys[a])||(c=d._keys[a]={k:a}),this._obj.set(c,b)}else"string"==typeof a||"number"==typeof a?this._obj[a]=b:(a.$_GID||(a.$_GID=Y.getGID()),this._obj[a.$_GID]=b)},a.get=function(a){if(null==a)return null;if(d.supportWeakMap){var b="string"==typeof a||"number"==typeof a?d._keys[a]:a;return b?this._obj.get(b):null}return"string"==typeof a||"number"==typeof a?this._obj[a]:this._obj[a.$_GID]},a.del=function(a){if(null!=a)if(d.supportWeakMap){var b="string"==typeof a||"number"==typeof a?d._keys[a]:a;if(!b)return;this._obj.delete(b)}else"string"==typeof a||"number"==typeof a?delete this._obj[a]:delete this._obj[this._obj.$_GID]},a.has=function(a){if(null==a)return!1;if(d.supportWeakMap){var b="string"==typeof a||"number"==typeof a?d._keys[a]:a;return this._obj.has(b)}return"string"==typeof a||"number"==typeof a?null!=this._obj[a]:null!=this._obj[this._obj.$_GID]},d.__init__=function(){(d.supportWeakMap=null!=M.window.WeakMap)||x.timer.loop(d.delInterval,null,d.clearCache)},d.clearCache=function(){for(var a=0,b=d._maps.length;a<b;a++){d._maps[a]._obj={}}},d.supportWeakMap=!1,d.delInterval=3e5,d._keys={},d._maps=[],i(d,["I",function(){return this.I=new d}]),d}(),_=function(){function a(){this.id=NaN,this.save=[],this.toUpperCase=null,this.changed=!1,this._text=null}p(a,"laya.utils.WordText");var b=a.prototype;return b.setText=function(a){this.changed=!0,this._text=a},b.toString=function(){return this._text},b.charCodeAt=function(a){return this._text?this._text.charCodeAt(a):NaN},b.charAt=function(a){return this._text?this._text.charAt(a):null},k(0,b,"length",function(){return this._text?this._text.length:0}),a}(),aa=function(a){function g(){this._bits=0,this._displayedInStage=!1,this._parent=null,this.conchModel=null,this.name="",this._destroyed=!1,g.__super.call(this),this._childs=g.ARRAY_EMPTY,this._$P=g.PROP_EMPTY,this.timer=x.scaleTimer,this.conchModel=H.isConchNode?this.createConchModel():null}p(g,"laya.display.Node",j);var b=g.prototype;return b._setBit=function(a,b){1==a&&(this._getBit(a)!=b&&this._updateDisplayedInstage());b?this._bits|=a:this._bits&=~a},b._getBit=function(a){return 0!=(this._bits&a)},b._setUpNoticeChain=function(){this._getBit(1)&&this._setUpNoticeType(1)},b._setUpNoticeType=function(a){var b=this;for(b._setBit(a,!0),b=b.parent;b;){if(b._getBit(a))return;b._setBit(a,!0),b=b.parent}},b.on=function(a,b,c,d){return"display"!==a&&"undisplay"!==a||this._getBit(1)||this._setUpNoticeType(1),this._createListener(a,b,c,d,!1)},b.once=function(a,b,c,d){return"display"!==a&&"undisplay"!==a||this._getBit(1)||this._setUpNoticeType(1),this._createListener(a,b,c,d,!0)},b.createConchModel=function(){return null},b.destroy=function(a){void 0===a&&(a=!0),this._destroyed=!0,this._parent&&this._parent.removeChild(this),this._childs&&(a?this.destroyChildren():this.removeChildren()),this._childs=null,this._$P=null,this.offAll(),this.timer.clearAll(this)},b.destroyChildren=function(){if(this._childs)for(var a=this._childs.length-1;-1<a;a--)this._childs[a].destroy(!0)},b.addChild=function(a){if(!a||this.destroyed||a===this)return a;if(a.zOrder&&this._set$P("hasZorder",!0),a._parent===this){var b=this.getChildIndex(a);b!==this._childs.length-1&&(this._childs.splice(b,1),this._childs.push(a),this.conchModel&&(this.conchModel.removeChild(a.conchModel),this.conchModel.addChildAt(a.conchModel,this._childs.length-1)),this._childChanged())}else a.parent&&a.parent.removeChild(a),this._childs===g.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(a),this.conchModel&&this.conchModel.addChildAt(a.conchModel,this._childs.length-1),(a.parent=this)._childChanged();return a},b.addChildren=function(a){for(var b=arguments,c=0,d=b.length;c<d;)this.addChild(b[c++])},b.addChildAt=function(a,b){if(!a||this.destroyed||a===this)return a;if(a.zOrder&&this._set$P("hasZorder",!0),0<=b&&b<=this._childs.length){if(a._parent===this){var c=this.getChildIndex(a);this._childs.splice(c,1),this._childs.splice(b,0,a),this.conchModel&&(this.conchModel.removeChild(a.conchModel),this.conchModel.addChildAt(a.conchModel,b)),this._childChanged()}else a.parent&&a.parent.removeChild(a),this._childs===g.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(b,0,a),this.conchModel&&this.conchModel.addChildAt(a.conchModel,b),a.parent=this;return a}throw new Error("appendChildAt:The index is out of bounds")},b.getChildIndex=function(a){return this._childs.indexOf(a)},b.getChildByName=function(a){var b=this._childs;if(b)for(var c=0,d=b.length;c<d;c++){var e=b[c];if(e.name===a)return e}return null},b._get$P=function(a){return this._$P[a]},b._set$P=function(a,b){return this.destroyed||(this._$P===g.PROP_EMPTY&&(this._$P={}),this._$P[a]=b),b},b.getChildAt=function(a){return this._childs[a]},b.setChildIndex=function(a,b){var c=this._childs;if(b<0||b>=c.length)throw new Error("setChildIndex:The index is out of bounds.");var d=this.getChildIndex(a);if(d<0)throw new Error("setChildIndex:node is must child of this object.");return c.splice(d,1),c.splice(b,0,a),this.conchModel&&(this.conchModel.removeChild(a.conchModel),this.conchModel.addChildAt(a.conchModel,b)),this._childChanged(),a},b._childChanged=function(a){},b.removeChild=function(a){if(!this._childs)return a;var b=this._childs.indexOf(a);return this.removeChildAt(b)},b.removeSelf=function(){return this._parent&&this._parent.removeChild(this),this},b.removeChildByName=function(a){var b=this.getChildByName(a);return b&&this.removeChild(b),b},b.removeChildAt=function(a){var b=this.getChildAt(a);if(b){for(var c=this._childs.length-1,d=a;d<c;++d)this._childs[d]=this._childs[d+1];this._childs.length=c,this.conchModel&&this.conchModel.removeChild(b.conchModel),b.parent=null}return b},b.removeChildren=function(a,b){if(void 0===a&&(a=0),void 0===b&&(b=2147483647),this._childs&&0<this._childs.length){var c=this._childs;if(0===a&&f<=b){var d=c;this._childs=g.ARRAY_EMPTY}else d=c.splice(a,b-a);for(var e=0,f=d.length;e<f;e++)d[e].parent=null,this.conchModel&&this.conchModel.removeChild(d[e].conchModel)}return this},b.replaceChild=function(a,b){var c=this._childs.indexOf(b);return-1<c?(this._childs.splice(c,1,a),this.conchModel&&(this.conchModel.removeChild(b.conchModel),this.conchModel.addChildAt(a.conchModel,c)),b.parent=null,a.parent=this,a):null},b._updateDisplayedInstage=function(){var a;a=this;var b=x.stage;for(this._displayedInStage=!1;a;){if(a._getBit(1)){this._displayedInStage=a._displayedInStage;break}if(a==b||a._displayedInStage){this._displayedInStage=!0;break}a=a.parent}},b._setDisplay=function(a){this._displayedInStage!==a&&((this._displayedInStage=a)?this.event("display"):this.event("undisplay"))},b._displayChild=function(a,b){var c=a._childs;if(c)for(var d=0;d<c.length;d++){var e=c[d];e&&e._getBit(1)&&(0<e._childs.length?this._displayChild(e,b):e._setDisplay(b))}a._setDisplay(b)},b.contains=function(a){if(a===this)return!0;for(;a;){if(a.parent===this)return!0;a=a.parent}return!1},b.timerLoop=function(a,b,c,d,e,f){void 0===e&&(e=!0),void 0===f&&(f=!1),this.timer.loop(a,b,c,d,e,f)},b.timerOnce=function(a,b,c,d,e){void 0===e&&(e=!0),this.timer._create(!1,!1,a,b,c,d,e)},b.frameLoop=function(a,b,c,d,e){void 0===e&&(e=!0),this.timer._create(!0,!0,a,b,c,d,e)},b.frameOnce=function(a,b,c,d,e){void 0===e&&(e=!0),this.timer._create(!0,!1,a,b,c,d,e)},b.clearTimer=function(a,b){this.timer.clear(a,b)},k(0,b,"numChildren",function(){return this._childs.length}),k(0,b,"destroyed",function(){return this._destroyed}),k(0,b,"parent",function(){return this._parent},function(a){this._parent!==a&&(a?(this._parent=a,this.event("added"),this._getBit(1)&&(this._setUpNoticeChain(),a.displayedInStage&&this._displayChild(this,!0)),a._childChanged(this)):(this.event("removed"),this._parent._childChanged(),this._getBit(1)&&this._displayChild(this,!1),this._parent=a))}),k(0,b,"displayedInStage",function(){return this._getBit(1)||this._setUpNoticeType(1),this._displayedInStage}),g.ARRAY_EMPTY=[],g.PROP_EMPTY={},g.NOTICE_DISPLAY=1,g.MOUSEENABLE=2,g}(),ba=function(a){function m(a){this._bgground=null,this._border=null,this._rect=null,this.underLine=0,this.lineHeight=0,m.__super.call(this),this._padding=m._PADDING,this._spacing=m._SPACING,this._aligns=m._ALIGNS,this._font=n.EMPTY,this._ower=a}p(m,"laya.display.css.CSSStyle",a);var b=m.prototype;return b.destroy=function(){this._ower=null,this._font=null,this._rect=null},b.inherit=function(a){this._font=a._font,this._spacing=a._spacing===m._SPACING?m._SPACING:a._spacing.slice(),this.lineHeight=a.lineHeight},b._widthAuto=function(){return 0!=(262144&this._type)},b.widthed=function(a){return 0!=(8&this._type)},b._calculation=function(a,b){if(b.indexOf("%")<0)return!1;var d=this._ower,e=d.parent,f=this._rect;function g(a,b,c){return a*c[0]+b*c[1]+c[2]}function c(a){var b=e.width,c=d.width;f.width&&(d.width=g(b,c,f.width)),f.height&&(d.height=g(b,c,f.height)),f.left&&(d.x=g(b,c,f.left)),f.top&&(d.y=g(b,c,f.top))}null===f&&(e._getCSSStyle()._type|=524288,e.on("resize",this,c),this._rect=f={input:{}});var h=b.split(" ");return h[0]=parseFloat(h[0])/100,1==h.length?h[1]=h[2]=0:(h[1]=parseFloat(h[1])/100,h[2]=parseFloat(h[2])),f[a]=h,f.input[a]=b,c(),!0},b.heighted=function(a){return 0!=(8192&this._type)},b.size=function(a,b){var c=this._ower,d=!1;-1!==a&&a!=this._ower.width&&(this._type|=8,this._ower.width=a,d=!0),-1!==b&&b!=this._ower.height&&(this._type|=8192,this._ower.height=b,d=!0),d&&(c._layoutLater(),524288&this._type&&c.event("resize",this))},b._getAlign=function(){return this._aligns[0]},b._getValign=function(){return this._aligns[1]},b._getCssFloat=function(){return 0!=(32768&this._type)?32768:0},b._createFont=function(){return 4096&this._type?this._font:(this._type|=4096,this._font=new n(this._font))},b.render=function(a,b,c,d){var e=a.width,f=a.height;c-=a.pivotX,d-=a.pivotY,this._bgground&&null!=this._bgground.color&&b.ctx.fillRect(c,d,e,f,this._bgground.color),this._border&&this._border.color&&b.drawRect(c,d,e,f,this._border.color.strColor,this._border.size)},b.getCSSStyle=function(){return this},b.cssText=function(a){this.attrs(m.parseOneCSS(a,";"))},b.attrs=function(a){if(a)for(var b=0,c=a.length;b<c;b++){var d=a[b];this[d[0]]=d[1]}},b.setTransform=function(a){"none"===a?this._tf=h._TF_EMPTY:this.attrs(m.parseOneCSS(a,","))},b.translate=function(a,b){this._tf===h._TF_EMPTY&&(this._tf=new e),this._tf.translateX=a,this._tf.translateY=b},b.scale=function(a,b){this._tf===h._TF_EMPTY&&(this._tf=new e),this._tf.scaleX=a,this._tf.scaleY=b},b._enableLayout=function(){return 0==(2&this._type)&&0==(4&this._type)},k(0,b,"block",a.prototype._$get_block,function(a){a?this._type|=1:this._type&=-2}),k(0,b,"valign",function(){return m._valigndef[this._aligns[1]]},function(a){this._aligns===m._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[1]=m._valigndef[a]}),k(0,b,"height",null,function(a){if(this._type|=8192,"string"==typeof a){if(this._calculation("height",a))return;a=parseInt(a)}this.size(-1,a)}),k(0,b,"width",null,function(a){if(this._type|=8,"string"==typeof a){var b=a.indexOf("auto");if(0<=b&&(this._type|=262144,a=a.substr(0,b)),this._calculation("width",a))return;a=parseInt(a)}this.size(a,-1)}),k(0,b,"fontWeight",function(){return this._font.weight},function(a){this._createFont().weight=a}),k(0,b,"left",null,function(a){var b=this._ower;if("string"==typeof a){if("center"===a?a="50% -50% 0":"right"===a&&(a="100% -100% 0"),this._calculation("left",a))return;a=parseInt(a)}b.x=a}),k(0,b,"_translate",null,function(a){this.translate(a[0],a[1])}),k(0,b,"absolute",function(){return 0!=(4&this._type)}),k(0,b,"top",null,function(a){var b=this._ower;if("string"==typeof a){if("middle"===a?a="50% -50% 0":"bottom"===a&&(a="100% -100% 0"),this._calculation("top",a))return;a=parseInt(a)}b.y=a}),k(0,b,"align",function(){return m._aligndef[this._aligns[0]]},function(a){this._aligns===m._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[0]=m._aligndef[a]}),k(0,b,"bold",function(){return this._font.bold},function(a){this._createFont().bold=a}),k(0,b,"padding",function(){return this._padding},function(a){this._padding=a}),k(0,b,"leading",function(){return this._spacing[1]},function(a){"string"==typeof a&&(a=parseInt(a+"")),this._spacing===m._SPACING&&(this._spacing=[0,0]),this._spacing[1]=a}),k(0,b,"lineElement",function(){return 0!=(65536&this._type)},function(a){a?this._type|=65536:this._type&=-65537}),k(0,b,"cssFloat",function(){return 0!=(32768&this._type)?"right":"left"},function(a){this.lineElement=!1,"right"===a?this._type|=32768:this._type&=-32769}),k(0,b,"textDecoration",function(){return this._font.decoration},function(a){this._createFont().decoration=a}),k(0,b,"whiteSpace",function(){return 131072&this._type?"nowrap":""},function(a){"nowrap"===a&&(this._type|=131072),"none"===a&&(this._type&=-131073)}),k(0,b,"background",null,function(a){a?(this._bgground||(this._bgground={}),this._bgground.color=a,this._ower.conchModel&&this._ower.conchModel.bgColor(a),this._type|=16384,this._ower._renderType|=256):this._bgground=null}),k(0,b,"wordWrap",function(){return 0==(131072&this._type)},function(a){a?this._type&=-131073:this._type|=131072}),k(0,b,"color",function(){return this._font.color},function(a){this._createFont().color=a}),k(0,b,"password",function(){return this._font.password},function(a){this._createFont().password=a}),k(0,b,"backgroundColor",function(){return this._bgground?this._bgground.color:null},function(a){"none"===a?this._bgground=null:(this._bgground||(this._bgground={}),this._bgground.color=a),this._ower.conchModel&&this._ower.conchModel.bgColor(a),this._ower._renderType|=256}),k(0,b,"font",function(){return this._font.toString()},function(a){this._createFont().set(a)}),k(0,b,"weight",null,function(a){this._createFont().weight=a}),k(0,b,"letterSpacing",function(){return this._spacing[0]},function(a){"string"==typeof a&&(a=parseInt(a+"")),this._spacing===m._SPACING&&(this._spacing=[0,0]),this._spacing[0]=a}),k(0,b,"fontSize",function(){return this._font.size},function(a){this._createFont().size=a}),k(0,b,"italic",function(){return this._font.italic},function(a){this._createFont().italic=a}),k(0,b,"fontFamily",function(){return this._font.family},function(a){this._createFont().family=a}),k(0,b,"stroke",function(){return this._font.stroke[0]},function(a){this._createFont().stroke===n._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[0]=a}),k(0,b,"strokeColor",function(){return this._font.stroke[1]},function(a){this._createFont().stroke===n._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[1]=a}),k(0,b,"border",function(){return this._border?this._border.value:""},function(a){if("none"!=a){this._border||(this._border={});var b=(this._border.value=a).split(" ");if(this._border.color=Q.create(b[b.length-1]),1==b.length)return this._border.size=1,void(this._border.type="solid");var c=0;0<b[0].indexOf("px")?(this._border.size=parseInt(b[0]),c++):this._border.size=1,this._border.type=b[c],this._ower._renderType|=256}else this._border=null}),k(0,b,"borderColor",function(){return this._border&&this._border.color?this._border.color.strColor:null},function(a){a?(this._border||(this._border={size:1,type:"solid"}),this._border.color=null==a?null:Q.create(a),this._ower.conchModel&&this._ower.conchModel.border(this._border.color.strColor),this._ower._renderType|=256):this._border=null}),k(0,b,"position",function(){return 4&this._type?"absolute":""},function(a){"absolute"==a?this._type|=4:this._type&=-5}),k(0,b,"display",null,function(a){switch(a){case"":this._type&=-3,this.visible=!0;break;case"none":this._type|=2,this.visible=!1,this._ower._layoutLater()}}),k(0,b,"paddingLeft",function(){return this.padding[3]}),k(0,b,"paddingTop",function(){return this.padding[0]}),k(0,b,"_scale",null,function(a){this._ower.scale(a[0],a[1])}),k(0,b,"_rotate",null,function(a){this._ower.rotation=a}),m.parseOneCSS=function(a,b){for(var c,d=[],e=a.split(b),f=0,g=e.length;f<g;f++){var h=e[f],i=h.indexOf(":"),j=h.substr(0,i).replace(/^\s+|\s+$/g,"");if(0!=j.length){var k=h.substr(i+1).replace(/^\s+|\s+$/g,""),l=[j,k];switch(j){case"italic":case"bold":l[1]="true"==k;break;case"line-height":l[0]="lineHeight",l[1]=parseInt(k);break;case"font-size":l[0]="fontSize",l[1]=parseInt(k);break;case"padding":1<(c=k.split(" ")).length||(c[1]=c[2]=c[3]=c[0]),l[1]=[parseInt(c[0]),parseInt(c[1]),parseInt(c[2]),parseInt(c[3])];break;case"rotate":l[0]="_rotate",l[1]=parseFloat(k);break;case"scale":c=k.split(" "),l[0]="_scale",l[1]=[parseFloat(c[0]),parseFloat(c[1])];break;case"translate":c=k.split(" "),l[0]="_translate",l[1]=[parseInt(c[0]),parseInt(c[1])];break;default:(l[0]=m._CSSTOVALUE[j])||(l[0]=j)}d.push(l)}}return d},m.parseCSS=function(a,b){for(var c;null!=(c=m._parseCSSRegExp.exec(a));)m.styleSheets[c[1]]=m.parseOneCSS(c[2],";")},m.EMPTY=new m(null),m._CSSTOVALUE={"letter-spacing":"letterSpacing","line-spacing":"lineSpacing","white-space":"whiteSpace","line-height":"lineHeight","scale-x":"scaleX","scale-y":"scaleY","translate-x":"translateX","translate-y":"translateY","font-family":"fontFamily","font-weight":"fontWeight","vertical-align":"valign","text-decoration":"textDecoration","background-color":"backgroundColor","border-color":"borderColor",float:"cssFloat"},m._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g"),m._aligndef={left:0,center:1,right:2,0:"left",1:"center",2:"right"},m._valigndef={top:0,middle:1,bottom:2,0:"top",1:"middle",2:"bottom"},m.styleSheets={},m.ALIGN_CENTER=1,m.ALIGN_RIGHT=2,m.VALIGN_MIDDLE=1,m.VALIGN_BOTTOM=2,m._CSS_BLOCK=1,m._DISPLAY_NONE=2,m._ABSOLUTE=4,m._WIDTH_SET=8,m._PADDING=[0,0,0,0],m._RECT=[-1,-1,-1,-1],m._SPACING=[0,0],m._ALIGNS=[0,0,0],m.ADDLAYOUTED=512,m._NEWFONT=4096,m._HEIGHT_SET=8192,m._BACKGROUND_SET=16384,m._FLOAT_RIGHT=32768,m._LINE_ELEMENT=65536,m._NOWARP=131072,m._WIDTHAUTO=262144,m._LISTERRESZIE=524288,m}(h),ca=function(a){function g(){this.url=null,this.audio=null,this.loaded=!1,g.__super.call(this)}p(g,"laya.media.h5audio.AudioSound",j);var b=g.prototype;return b.dispose=function(){var a=g._audioCache[this.url];a&&(a.src="",delete g._audioCache[this.url])},b.load=function(a){var b;if(a=G.formatURL(a),(this.url=a)==C._tMusic?(g._initMusicAudio(),(b=g._musicAudio).src!=a&&(g._audioCache[b.src]=null,b=null)):b=g._audioCache[a],b&&2<=b.readyState)this.event("complete");else{b||(b=a==C._tMusic?(g._initMusicAudio(),g._musicAudio):M.createElement("audio"),(g._audioCache[a]=b).src=a),b.addEventListener("canplaythrough",d),b.addEventListener("error",e);var c=this;(this.audio=b).load?b.load():e()}function d(){f(),c.loaded=!0,c.event("complete")}function e(){b.load=null,f(),c.event("error")}function f(){b.removeEventListener("canplaythrough",d),b.removeEventListener("error",e)}},b.play=function(a,b,c){if(void 0===a&&(a=0),void 0===b&&(b=0),!this.url)return null;var d,e;if(!(d=this.url==C._tMusic?g._musicAudio:g._audioCache[this.url]))return null;e=U.getItem("audio:"+this.url),H.isConchApp?e||((e=M.createElement("audio")).src=this.url):this.url==C._tMusic?(g._initMusicAudio(),(e=g._musicAudio).src=this.url):e=e||d.cloneNode(!0);var f=new ma(e);return f.url=this.url,f.loops=b,f.startTime=a,f.startHandler=c,f.play(!1),C.addChannel(f),f},k(0,b,"duration",function(){var a;return(a=g._audioCache[this.url])?a.duration:0}),g._initMusicAudio=function(){g._musicAudio||(g._musicAudio||(g._musicAudio=M.createElement("audio")),H.isConchApp||M.document.addEventListener("mousedown",g._makeMusicOK))},g._makeMusicOK=function(){M.document.removeEventListener("mousedown",g._makeMusicOK),g._musicAudio.src?g._musicAudio.play():(g._musicAudio.src="",g._musicAudio.load())},g._audioCache={},g._musicAudio=null,g}(),da=function(a){function b(){this.url=null,this.loops=0,this.startTime=NaN,this.isStopped=!1,this.startHandler=null,this.completeHandler=null,b.__super.call(this)}p(b,"laya.media.SoundChannel",j);var c=b.prototype;return c.play=function(){},c.stop=function(){},c.pause=function(){},c.resume=function(){},c.__runComplete=function(a){a&&a.run()},k(0,c,"volume",function(){return 1},function(a){}),k(0,c,"position",function(){return 0}),k(0,c,"duration",function(){return 0}),b}(),ea=function(a){function b(){b.__super.call(this)}p(b,"laya.media.Sound",j);var c=b.prototype;return c.load=function(a){},c.play=function(a,b,c){return void 0===a&&(a=0),void 0===b&&(b=0),null},c.dispose=function(){},k(0,c,"duration",function(){return 0}),b}(),fa=function(a){function e(){this.url=null,this.loaded=!1,this.data=null,this.audioBuffer=null,this.__toPlays=null,this._disposed=!1,e.__super.call(this)}p(e,"laya.media.webaudio.WebAudioSound",j);var b=e.prototype;return b.load=function(a){this.url=a,this.audioBuffer=e._dataCache[a],this.audioBuffer?this._loaded(this.audioBuffer):(e.e.on("loaded:"+a,this,this._loaded),e.e.on("err:"+a,this,this._err),e.__loadingSound[a]||(e.__loadingSound[a]=!0,x.loader.load(a,s.create(this,this.onloaded),null,ha.BUFFER,4,!1,null,!0)))},b.onloaded=function(a){a||this._err(),this._disposed?this._removeLoadEvents():(this.data=a,e.buffs.push({buffer:this.data,url:this.url}),e.decode())},b._err=function(){if(this._removeLoadEvents(),e.__loadingSound[this.url]=!1,this.event("error"),this.__toPlays){var a,b,c,d=0;for(a=(b=this.__toPlays).length,d=0;d<a;d++)(c=b[d])[3]&&!c[3].isStopped&&c[3].event("error");this.__toPlays.length=0}},b._loaded=function(a){this._removeLoadEvents(),this._disposed||(this.audioBuffer=a,this.loaded=!0,this.event("complete"))},b._removeLoadEvents=function(){e.e.off("loaded:"+this.url,this,this._loaded),e.e.off("err:"+this.url,this,this._err)},b.__playAfterLoaded=function(){if(this.__toPlays){var a,b,c,d=0;for(a=(b=this.__toPlays).length,d=0;d<a;d++)(c=b[d])[3]&&!c[3].isStopped&&this.play(c[0],c[1],c[2],c[3]);this.__toPlays.length=0}},b.play=function(a,b,c,d){return void 0===a&&(a=0),void 0===b&&(b=0),d=d||new na,this.audioBuffer||this.url&&(this.__toPlays||(this.__toPlays=[]),this.__toPlays.push([a,b,c,d]),this.once("complete",this,this.__playAfterLoaded),this.load(this.url)),d.url=this.url,d.loops=b,d.audioBuffer=this.audioBuffer,d.startTime=a,d.startHandler=c,d.play(!1),C.addChannel(d),d},b.dispose=function(){this._disposed=!0,delete e._dataCache[this.url],delete e.__loadingSound[this.url],this.audioBuffer=null,this.data=null,this.__toPlays=[]},k(0,b,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),e.decode=function(){if(!(e.buffs.length<=0||e.isDecoding))if(e.isDecoding=!0,(e.tInfo=e.buffs.shift())&&e.tInfo.buffer&&e.tInfo.buffer.byteLength)try{e.ctx.decodeAudioData(e.tInfo.buffer,e._done,e._fail)}catch(a){console.error("decodeAudioData error  byteLength:"+e.tInfo.buffer.byteLength+"  url:"+e.tInfo.url)}else e._fail()},e._done=function(a){e.e.event("loaded:"+e.tInfo.url,a),e._dataCache[e.tInfo.url]=a,e.isDecoding=!1,e.decode()},e._fail=function(){e.e.event("err:"+e.tInfo.url,null),e.isDecoding=!1,e.decode()},e._playEmptySound=function(){if(null!=e.ctx){if(e._emptySource&&(e._emptySource.stop(),e._emptySource.disconnect(0),!na._tryCleanFailed))try{e._emptySource.buffer=null}catch(a){na._tryCleanFailed=!0}var a=e.ctx.createBufferSource();a.buffer=e._miniBuffer,a.connect(e.ctx.destination),a.start(0,0,0),e._emptySource=a}},e._unlock=function(){e._unlocked||(e._playEmptySound(),"running"==e.ctx.state?(M.document.removeEventListener("mousedown",e._unlock,!0),M.document.removeEventListener("touchend",e._unlock,!0),M.document.removeEventListener("touchstart",e._unlock,!0),e._unlocked=!0):"suspended"==e.ctx.state&&C._recoverWebAudio())},e.initWebAudio=function(){"running"!=e.ctx.state&&(e._unlock(),M.document.addEventListener("mousedown",e._unlock,!0),M.document.addEventListener("touchend",e._unlock,!0),M.document.addEventListener("touchstart",e._unlock,!0))},e._emptySource=null,e._dataCache={},e.buffs=[],e.isDecoding=!1,e._unlocked=!1,e.tInfo=null,e.__loadingSound={},i(e,["window",function(){return this.window=M.window},"webAudioEnabled",function(){return this.webAudioEnabled=e.window.AudioContext||e.window.webkitAudioContext||e.window.mozAudioContext},"ctx",function(){return this.ctx=e.webAudioEnabled?new(e.window.AudioContext||e.window.webkitAudioContext||e.window.mozAudioContext):void 0},"_miniBuffer",function(){return this._miniBuffer=e.ctx.createBuffer(1,1,22050)},"e",function(){return this.e=new j}]),e}(),ga=function(a){function b(){this._responseType=null,this._data=null,b.__super.call(this),this._http=new M.window.XMLHttpRequest}p(b,"laya.net.HttpRequest",j);var c=b.prototype;return c.send=function(a,b,c,d,e){void 0===c&&(c="get"),void 0===d&&(d="text"),this._responseType=d,this._data=null;var f=this,g=this._http;if(g.open(c,a,!0),e)for(var h=0;h<e.length;h++)g.setRequestHeader(e[h++],e[h]);else H.isConchApp||(b&&"string"!=typeof b?g.setRequestHeader("Content-Type","application/json"):g.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));g.responseType="arraybuffer"!==d?"text":"arraybuffer",g.onerror=function(a){f._onError(a)},g.onabort=function(a){f._onAbort(a)},g.onprogress=function(a){f._onProgress(a)},g.onload=function(a){f._onLoad(a)},g.send(b)},c._onProgress=function(a){a&&a.lengthComputable&&this.event("progress",a.loaded/a.total)},c._onAbort=function(a){this.error("Request was aborted by user")},c._onError=function(a){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)},c._onLoad=function(a){var b=this._http,c=void 0!==b.status?b.status:200;200===c||204===c||0===c?this.complete():this.error("["+b.status+"]"+b.statusText+":"+b.responseURL)},c.error=function(a){this.clear(),this.event("error",a)},c.complete=function(){this.clear();var b=!0;try{"json"===this._responseType?this._data=JSON.parse(this._http.responseText):"xml"===this._responseType?this._data=Y.parseXMLFromString(this._http.responseText):this._data=this._http.response||this._http.responseText}catch(a){b=!1,this.error(a.message)}b&&this.event("complete",this._data instanceof Array?[this._data]:this._data)},c.clear=function(){var a=this._http;a.onerror=a.onabort=a.onprogress=a.onload=null},k(0,c,"url",function(){return this._http.responseURL}),k(0,c,"http",function(){return this._http}),k(0,c,"data",function(){return this._data}),b}(),ha=function(a){function A(){this._data=null,this._class=null,this._url=null,this._type=null,this._cache=!1,this._http=null,this._customParse=!1,A.__super.call(this),this._onImageCallback=this._loadImageComplete.bind(this),this._onLoadedCallback=this._loadedComplete.bind(this),this.priority=-1,this.realTime=!1}p(A,"laya.net.Loader",j);var b=A.prototype;return b.load=function(a,b,c,d,e){if(a&&""!=a||console.error("Loader 加载的url不合法 "+a),void 0===c&&(c=!0),void 0===e&&(e=!1),0===(this._url=a).indexOf("data:image")?this._type=b="image":this._type=b||(b=this.getTypeFromUrl(a)),this._cache=c,this._data=null,!e&&A.loadedMap[a])return this._data=A.loadedMap[a],this.event("progress",1),void this.event("complete",this._data);if(d&&A.setGroup(a,d),null!=A.parserMap[b])return this._customParse=!0,void(A.parserMap[b]instanceof laya.utils.Handler?A.parserMap[b].runWith(this):A.parserMap[b].call(null,this));if("image"===b||"htmlimage"===b||"nativeimage"===b)return this._loadImage(a);if("ttf"===b)return this._loadTTF(a);switch(b){case"atlas":case"plf":"json";break;case"font":"xml";break;case"pkm":"arraybuffer";break;default:b}A.preLoadedMap[a]?this.onLoaded(A.preLoadedMap[a]):g.resMgrLoad(a,this._onLoadedCallback,0<=this.priority?this.priority:2,this.realTime)},b.getTypeFromUrl=function(a){var b=Y.getFileExtension(a);return b?A.typeMap[b]:(console.warn("Not recognize the resources suffix",a),"text")},b._loadTTF=function(a){a=G.formatURL(a);var b=new F;b.complete=s.create(this,this.onLoaded),b.load(a)},b._loadImage=function(a){g.imgMgrLoad(a,this._onImageCallback,0<=this.priority?this.priority:2,this.realTime)},b._loadImageComplete=function(a,b,c){if(null!=c)if(c instanceof ArrayBuffer){var d=new DataView(c),e=new laya.webgl.resource.WebGLImage(new Uint8Array(c,8),a,0,!1,d.getUint32(0),d.getUint32(4));this.onLoaded(e)}else if(c instanceof ka)A.imgMgrSet[a]=b,g.imgMgrLock(a,A.imgMgrSet[a]),this._url=a,this.complete(c);else{var f=-1!=a.indexOf(".png",a.length-4)?6408:6407;e=new laya.webgl.resource.WebGLImage(c,a,f,!1,c.width,c.height);this.onLoaded(e)}else this.event("error","Load image failed")},b._loadSound=function(a){var b=new C._soundClass,c=this;function d(){b.offAll()}b.on("complete",this,function(){d(),c.onLoaded(b)}),b.on("error",this,function(){d(),b.dispose(),c.event("error","Load sound failed")}),b.load(a)},b.onProgress=function(a){"atlas"===this._type?this.event("progress",.3*a):this.event("progress",a)},b.onError=function(a){this.event("error",a)},b._loadedComplete=function(a,b,c){if(null!=c)switch(this._type){case"atlas":case"plf":case"json":var d=new N(c);this.onLoaded(JSON.parse(d.readUTFBytes()));break;case"font":d=new N(c);this.onLoaded(Y.parseXMLFromString(d.readUTFBytes()));break;default:this.onLoaded(c)}else this.event("error",a)},b.onLoaded=function(a){var b=this._type;if("plf"==b)this.parsePLFData(a),this.complete(a);else if("image"===b){var c=new ka(a);c.url=this._url,this.complete(c)}else if("sound"===b||"htmlimage"===b||"nativeimage"===b)this.complete(a);else if("atlas"===b){if(!a.src&&!a._setContext){if(!this._data){if((this._data=a).meta&&a.meta.image)for(var d=a.meta.image.split(","),e=0<=this._url.indexOf("/")?"/":"\\",f=this._url.lastIndexOf(e),g=0<=f?this._url.substr(0,f+1):"",h=0,i=d.length;h<i;h++)d[h]=g+d[h];else d=[this._url.replace(".json",".png")];d.reverse(),a.toLoads=d,a.pics=[]}return this.event("progress",.3+1/d.length*.6),this._loadImage(d.pop())}if(!this._data.pics)throw new Error("this._data.pics == null, "+this._url);if(this._data.pics.push(a),0<this._data.toLoads.length)return this.event("progress",.3+1/this._data.toLoads.length*.6),this._loadImage(this._data.toLoads.pop());var j=this._data.frames,k=this._url.split("?")[0],l=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:k.substring(0,k.lastIndexOf("."))+"/",m=this._data.pics,n=G.formatURL(this._url),o=A.atlasMap[n]||(A.atlasMap[n]=[]);o.dir=l;var p=1;if(this._data.meta&&this._data.meta.scale&&1!=this._data.meta.scale)for(var q in p=parseFloat(this._data.meta.scale),j){var r,s=j[q],t=m[s.frame.idx?s.frame.idx:0],u=G.formatURL(l+q);t.scaleRate=p,r=ka.create(t,s.frame.x,s.frame.y,s.frame.w,s.frame.h,s.spriteSourceSize.x,s.spriteSourceSize.y,s.sourceSize.w,s.sourceSize.h),A.cacheRes(u,r),A.keepCache(this._url,l+q),r.url=u,o.push(u)}else for(q in j)t=m[(s=j[q]).frame.idx?s.frame.idx:0],u=G.formatURL(l+q),A.cacheRes(u,ka.create(t,s.frame.x,s.frame.y,s.frame.w,s.frame.h,s.spriteSourceSize.x,s.spriteSourceSize.y,s.sourceSize.w,s.sourceSize.h)),A.loadedMap[u].url=u,A.keepCache(this._url,l+q),o.push(u);delete this._data.pics,this.complete(this._data)}else if("font"==b){if(!a.src)return this._data=a,this.event("progress",.5),this._loadImage(this._url.replace(".fnt",".png"));var v=new B;v.parseFont(this._data,a);var w=this._url.split(".fnt")[0].split("/"),x=w[w.length-1];qa.registerBitmapFont(x,v),this._data=v,this.complete(this._data)}else if("pkm"==b){var y=wa.create(a,this._url),z=new ka(y);z.url=this._url,this.complete(z)}else this.complete(a)},b.parsePLFData=function(a){var b,c,d;for(b in a)switch(d=a[b],b){case"json":case"text":for(c in d)A.preLoadedMap[G.formatURL(c)]=d[c];break;default:for(c in d)A.preLoadedMap[G.formatURL(c)]=d[c]}},b.complete=function(a){this._data=a,this._customParse?this.event("loaded",a instanceof Array?[a]:a):(A._loaders.push(this),A._isWorking||A.checkNext())},b.endLoad=function(a){a&&(this._data=a),this._cache&&A.cacheRes(this._url,this._data),this.event("progress",1),this.event("complete",this.data instanceof Array?[this.data]:this.data)},k(0,b,"url",function(){return this._url}),k(0,b,"data",function(){return this._data}),k(0,b,"cache",function(){return this._cache}),k(0,b,"type",function(){return this._type}),A.checkNext=function(){A._isWorking=!0;for(var a=M.now();A._startIndex<A._loaders.length;)if(M.now(),A._loaders[A._startIndex].endLoad(),A._startIndex++,M.now()-a>A.maxTimeOut)return console.warn("loader callback cost a long time:"+(M.now()-a)+" url="+A._loaders[A._startIndex-1].url),void x.timer.frameOnce(1,null,A.checkNext);A._loaders.length=0,A._startIndex=0,A._isWorking=!1},A.clearRes=function(a,b){if(null!=a){void 0===b&&(b=!1),a=G.formatURL(a);var c=A.getAtlas(a);if(c){for(var d=0,e=c.length;d<e;d++){var f=c[d],g=A.getRes(f);delete A.loadedMap[f],A.clearCache(a.substring(G.basePath.length),f.substring(G.basePath.length)),g&&g.destroy(b)}c.length=0,delete A.atlasMap[a],delete A.loadedMap[a]}else{var h=A.loadedMap[a];h&&(delete A.loadedMap[a],h instanceof laya.resource.Texture&&h.bitmap&&h.destroy(b))}}},A.clearTextureRes=function(a){a=G.formatURL(a);var b=laya.net.Loader.getAtlas(a),c=b&&0<b.length?laya.net.Loader.getRes(b[0]):laya.net.Loader.getRes(a);c&&c.bitmap&&(H.isConchApp&&!H.isConchWebGL?c.bitmap.source.releaseTexture&&c.bitmap.source.releaseTexture():null==c.bitmap._atlaser&&c.bitmap.releaseResource(!0))},A.getRes=function(a){return A.loadedMap[G.formatURL(a)]},A.getAtlas=function(a){return A.atlasMap[G.formatURL(a)]},A.cacheRes=function(a,b){a=G.formatURL(a),null!=A.loadedMap[a]?console.warn("Resources already exist,is repeated loading:",a):A.loadedMap[a]=b},A.setGroup=function(a,b){A.groupMap[b]||(A.groupMap[b]=[]),A.groupMap[b].push(a)},A.clearResByGroup=function(a){if(A.groupMap[a]){var b=A.groupMap[a],c=0,d=b.length;for(c=0;c<d;c++)A.clearRes(b[c]);b.length=0}},A.keepCache=function(a,b){if(a&&b){var c=A.cacheSet[b];c?-1==c.indexOf(a)&&c.push(a):A.cacheSet[b]=[a]}},A.clearCache=function(a,b){if(a&&b){var c=A.cacheSet[b];if(c){var d=c.indexOf(a);if(-1!==d){var e=c.length-1;0==e?(delete A.cacheSet[b],0<A.imgMgrSet[b]?g.imgMgrFree(b,A.imgMgrSet[b]):A.clearRes(b,!0)):(c[d]=c[e],c.length=e)}}}},A.saveObject=function(a,b,c){if(b&&a){var d=A.objectSet[a];d?(console.warn("Loader.saveObject: "+a),d[0]=b,d[1]=c):A.objectSet[a]=[b,c,[]]}},A.findObject=function(a){if(a){var b=A.objectSet[a];if(b)return b[0]}return null},A.keepObject=function(a,b){if(a&&b){var c=A.objectSet[b];c&&-1===c[2].indexOf(a)&&c[2].push(a)}},A.clearObject=function(a,b){if(a&&b){var c=A.objectSet[b];if(c){var d=c[2],e=d.indexOf(a);if(-1!==e){var f=d.length-1;0==f?(delete A.objectSet[b],c[1]&&c[1].call(null,c[0])):(d[e]=d[f],d.length=f)}}}},A.TEXT="text",A.JSON="json",A.XML="xml",A.BUFFER="arraybuffer",A.IMAGE="image",A.SOUND="sound",A.ATLAS="atlas",A.FONT="font",A.TTF="ttf",A.PLF="plf",A.PKM="pkm",A.typeMap={png:"image",jpg:"image",jpeg:"image",txt:"text",json:"json",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",pkm:"pkm",ttf:"ttf",plf:"plf"},A.parserMap={},A.groupMap={},A.maxTimeOut=100,A.loadedMap={},A.preLoadedMap={},A.atlasMap={},A._loaders=[],A._isWorking=!1,A._startIndex=0,A.imgCache={},A.cacheSet={},A.objectSet={},A.imgMgrSet={},A}(),ia=function(a){var m;function n(){this.retryNum=3,this.retryDelay=10,this.maxLoader=8,this._loaders=[],this._loaderCount=0,this._resInfos=[],this._infoPool=[],this._maxPriority=5,this._failRes={},n.__super.call(this);for(var a=0;a<this._maxPriority;a++)this._resInfos[a]=[]}p(n,"laya.net.LoaderManager",j);var b=n.prototype;return b.create=function(a,c,b,d,e,f,g,h){if(null==f&&(f=2),null==g&&(g=!0),a instanceof Array){var i=a,j=i.length,k=0;if(b)var l=s.create(b.caller,b.method,b.args,!1);for(var m=0;m<j;m++){var n=i[m];"string"==typeof n&&(n=i[m]={url:n}),n.progress=0}for(m=0;m<j;m++){n=i[m];var o=b?s.create(null,r,[n],!1):null,p=b||c?s.create(null,q,[n]):null;this._create(n.url,p,o,n.clas||d,n.params||e,null!=n.priority&&0<=n.priority?n.priority:f,g,n.group||h)}function q(a,b){k++,a.progress=1,k===j&&c&&c.run()}function r(a,b){a.progress=b;for(var c=0,d=0;d<j;d++){c+=i[d].progress}var e=c/j;l.runWith(e)}return!0}return this._create(a,c,b,d,e,f,g,h)},b._create=function(b,c,a,d,e,f,g,h){b&&""!=b||console.error("加载的url不合法 "+b),null==f&&(f=2),null==g&&(g=!0);var i=G.formatURL(b),j=this.getRes(i);if(j)!j.hasOwnProperty("loaded")||j.loaded?(a&&a.runWith(1),c&&c.run()):c&&x.loader._createListener(b,c.caller,c.method,c.args,!0,!1);else{var k=Y.getFileExtension(b),l=n.createMap[k];if(!l)throw new Error("LoaderManager:unknown file("+b+") extension with: "+k+".");d||(d=l[0]);var m=l[1];if("atlas"==k)this.load(b,c,a,m,f,g);else{d===ka&&(m="htmlimage"),(j=d?new d:null).hasOwnProperty("_loaded")&&(j._loaded=!1),j._setUrl(b),h&&j._setGroup(h),this._createLoad(j,b,s.create(null,function(a){j&&!j.destroyed&&a&&j.onAsynLoaded.call(j,b,a,e),c&&c.run();x.loader.event(b)}),a,m,f,!1,h,!0),g&&this.cacheRes(i,j)}}return j},b.load=function(a,b,c,d,e,f,g,h){a&&""!=a||console.error("加载的url不合法 "+a);var i=this;if(null==e&&(e=2),null==f&&(f=!0),void 0===h&&(h=!1),a instanceof Array)return this._loadAssets(a,b,c,d,e,f,g);var j=ha.getRes(a);if(null!=j)x.timer.frameOnce(1,null,function(){c&&c.runWith(1),b&&b.runWith(j),i._loaderCount||i.event("complete")});else{var k=n._resMap[a];k?(b&&k._createListener("complete",b.caller,b.method,b.args,!1,!1),c&&k._createListener("progress",c.caller,c.method,c.args,!1,!1)):((k=this._infoPool.length?this._infoPool.pop():new m).url=a,k.type=d,k.cache=f,k.group=g,k.ignoreCache=h,k.priority=e,b&&k.on("complete",b.caller,b.method,b.args),c&&k.on("progress",c.caller,c.method,c.args),n._resMap[a]=k,e=e<this._maxPriority?0<=e?e:0:this._maxPriority-1,this._resInfos[e].push(k),this._next())}return this},b._createLoad=function(a,b,c,d,e,f,g,h,i){var j=this;if(null==f&&(f=2),null==g&&(g=!0),void 0===i&&(i=!1),b instanceof Array)return this._loadAssets(b,c,d,e,f,g,h);var k=ha.getRes(b);if(null!=k)x.timer.frameOnce(1,null,function(){d&&d.runWith(1),c&&c.runWith(k),j._loaderCount||j.event("complete")});else{var l=n._resMap[b];l?(c&&l._createListener("complete",c.caller,c.method,c.args,!1,!1),d&&l._createListener("progress",d.caller,d.method,d.args,!1,!1)):((l=this._infoPool.length?this._infoPool.pop():new m).url=b,l.clas=a,l.type=e,l.cache=g,l.group=h,l.ignoreCache=i,l.priority=f,c&&l.on("complete",c.caller,c.method,c.args),d&&l.on("progress",d.caller,d.method,d.args),n._resMap[b]=l,f=f<this._maxPriority?0<=f?f:0:this._maxPriority-1,this._resInfos[f].push(l),this._next())}return this},b._next=function(){if(!(this._loaderCount>=this.maxLoader)){for(var a=0;a<this._maxPriority;a++)for(var b=this._resInfos[a];0<b.length;){var c=b.shift();if(c)return this._doLoad(c)}this._loaderCount||this.event("complete")}},b._doLoad=function(b){this._loaderCount++;var c=this._loaders.length?this._loaders.pop():new ha;c.on("complete",null,e),c.on("progress",null,function(a){b.event("progress",a)}),c.on("error",null,function(a){e(null)});var d=this;function e(a){c.offAll(),c._data=null,c._customParse=!1,d._loaders.push(c),d._endLoad(b,a instanceof Array?[a]:a),d._loaderCount--,d._next()}c._class=b.clas,1<=b.priority?(c.priority=b.priority,c.realTime=!1):(c.priority=0,c.realTime=!0),c.load(b.url,b.type,b.cache,b.group,b.ignoreCache)},b._endLoad=function(a,b){var c=a.url;if(null==b){var d=this._failRes[c]||0;if(d<this.retryNum)return console.warn("[warn]Retry to load:",c),this._failRes[c]=d+1,void x.timer.once(this.retryDelay,this,this._addReTry,[a],!1);console.warn("[error]Failed to load:",c),this.event("error",c)}this._failRes[c]&&(this._failRes[c]=0),delete n._resMap[c],a.event("complete",b),a.offAll(),this._infoPool.push(a)},b._addReTry=function(a){this._resInfos[this._maxPriority-1].push(a),this._next()},b.clearRes=function(a,b){void 0===b&&(b=!1),ha.clearRes(a,b)},b.getRes=function(a){return ha.getRes(a)},b.cacheRes=function(a,b){ha.cacheRes(a,b)},b.clearTextureRes=function(a){ha.clearTextureRes(a)},b.setGroup=function(a,b){ha.setGroup(a,b)},b.clearResByGroup=function(a){ha.clearResByGroup(a)},b.clearUnLoaded=function(){for(var a=0;a<this._maxPriority;a++){for(var b=this._resInfos[a],c=b.length-1;-1<c;c--){var d=b[c];d&&(d.offAll(),this._infoPool.push(d))}b.length=0}this._loaderCount=0,n._resMap={}},b.cancelLoadByUrls=function(a){if(a)for(var b=0,c=a.length;b<c;b++)this.cancelLoadByUrl(a[b])},b.cancelLoadByUrl=function(a){for(var b=0;b<this._maxPriority;b++)for(var c=this._resInfos[b],d=c.length-1;-1<d;d--){var e=c[d];e&&e.url===a&&(c[d]=null,e.offAll(),this._infoPool.push(e))}n._resMap[a]&&delete n._resMap[a]},b._loadAssets=function(a,c,g,b,d,e,f){null==d&&(d=2),null==e&&(e=!0);for(var h=a.length,i=0,j=0,k=[],l=!0,m=0;m<h;m++){var n=a[m];if(!n)throw new Error("LoaderManager._loadAssets 加载列表错误 arr="+a);"string"==typeof n&&(n={url:n,type:b,size:1,priority:d}),n.size||(n.size=1),n.progress=0,j+=n.size,k.push(n);var o=g?s.create(null,r,[n],!1):null,p=c||g?s.create(null,q,[n]):null;this.load(n.url,p,o,n.type,null!=n.priority&&0<=n.priority?n.priority:2,e,n.group||f)}function q(a,b){i++,a.progress=1,b||(l=!1),i===h&&c&&c.runWith(l)}function r(a,b){if(null!=g){a.progress=b;for(var c=0,d=0;d<k.length;d++){var e=k[d];c+=e.size*e.progress}var f=c/j;g.runWith(f)}}return this},n.cacheRes=function(a,b){ha.cacheRes(a,b)},n._resMap={},i(n,["createMap",function(){return this.createMap={atlas:[null,"atlas"]}}]),n.__init$=function(){m=function(a){function b(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.priority=-1,b.__super.call(this)}return p(b,"",j),b}()},n}(),ja=(function(a){function e(a){e.__super.call(this),a||(a=[.3,.59,.11,0,0,.3,.59,.11,0,0,.3,.59,.11,0,0,0,0,0,1,0]),this._mat=new Float32Array(16),this._alpha=new Float32Array(4);for(var b=0,c=0,d=0;d<20;d++)d%5!=4?this._mat[b++]=a[d]:this._alpha[c++]=a[d];this._action=D.createFilterAction(32),this._action.data=this}p(e,"laya.filters.ColorFilter",r);var b=e.prototype;x.imps(b,{"laya.filters.IFilter":!0}),b.callNative=function(a){a._$P.cf=this;a.conchModel&&a.conchModel.setFilterMatrix&&a.conchModel.setFilterMatrix(this._mat,this._alpha)},k(0,b,"type",function(){return 32}),k(0,b,"action",function(){return this._action})}(),function(a){function d(a,b,c){this._endian=null,this._stamp=NaN,this._socket=null,this._connected=!1,this._addInputPosition=0,this._input=null,this._output=null,this.timeout=0,this.objectEncoding=0,this.disableInput=!1,this._byteClass=null,this.protocols=[],void 0===b&&(b=0),d.__super.call(this),this._byteClass=c||N,this.endian="bigEndian",this.timeout=2e4,this._addInputPosition=0,a&&0<b&&b<65535&&this.connect(a,b)}p(d,"laya.net.Socket",j);var b=d.prototype;b.connect=function(a,b){var c="ws://"+a+":"+b;c="https:"==M.window.location.protocol?"wss://"+a+":"+b:"ws://"+a+":"+b,this.connectByUrl(c)},b.connectByUrl=function(a){var b=this;null!=this._socket&&this.close(),this._socket&&this.cleanSocket(),this.protocols&&0!=this.protocols.length?this._socket=new M.window.WebSocket(a,this.protocols):this._socket=new M.window.WebSocket(a),this._socket.binaryType="arraybuffer",this._output=new this._byteClass,this._output.endian=this.endian,this._input=new this._byteClass,this._input.endian=this.endian,this._addInputPosition=0,this._socket.onopen=function(a){b._onOpen(a)},this._socket.onmessage=function(a){b._onMessage(a)},this._socket.onclose=function(a){b._onClose(a)},this._socket.onerror=function(a){b._onError(a)}},b.cleanSocket=function(){try{this._socket.close()}catch(a){}this._connected=!1,this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null,this._socket=null},b.close=function(){if(null!=this._socket)try{this._socket.close()}catch(a){}},b._onOpen=function(a){this._connected=!0,this.event("open",a)},b._onMessage=function(a){if(a&&a.data){var b=a.data;if(this.disableInput&&b)this.event("message",b);else{0<this._input.length&&this._input.bytesAvailable<1&&(this._input.clear(),this._addInputPosition=0);var c=this._input.pos;!this._addInputPosition&&(this._addInputPosition=0),this._input.pos=this._addInputPosition,b&&("string"==typeof b?this._input.writeUTFBytes(b):this._input.writeArrayBuffer(b),this._addInputPosition=this._input.pos,this._input.pos=c),this.event("message",b)}}},b._onClose=function(a){this._connected=!1,this.event("close",a)},b._onError=function(a){this.event("error",a)},b.send=function(a){this._socket.send(a)},b.flush=function(){if(this._output&&0<this._output.length){var b;try{this._socket&&this._socket.send(this._output.__getBuffer().slice(0,this._output.length))}catch(a){b=a}this._output.endian=this.endian,this._output.clear(),b&&this.event("error",b)}},k(0,b,"input",function(){return this._input}),k(0,b,"output",function(){return this._output}),k(0,b,"connected",function(){return this._connected}),k(0,b,"endian",function(){return this._endian},function(a){this._endian=a,null!=this._input&&(this._input.endian=a),null!=this._output&&(this._output.endian=a)}),d.LITTLE_ENDIAN="littleEndian",d.BIG_ENDIAN="bigEndian"}(),function(a){function h(){h.__super.call(this),this._$1__id=++h._uniqueIDCounter,this.__loaded=!0,this._destroyed=!1,this._referenceCount=0,(h._idResourcesMap[this.id]=this)._released=!0,this.lock=!1,this._memorySize=0,this._lastUseFrameCount=-1,L.currentResourceManager&&L.currentResourceManager.addResource(this)}p(h,"laya.resource.Resource",j);var b=h.prototype;return x.imps(b,{"laya.resource.ICreateResource":!0,"laya.resource.IDispose":!0}),b._setUrl=function(a){var b;this._url!==a&&(this._url&&((b=h._urlResourcesMap[this._url]).splice(b.indexOf(this),1),0===b.length&&delete h._urlResourcesMap[this._url]),a&&((b=h._urlResourcesMap[a])||(h._urlResourcesMap[a]=b=[]),b.push(this)),this._url=a)},b._getGroup=function(){return this._group},b._setGroup=function(a){var b;this._group!==a&&(this._group&&((b=h._groupResourcesMap[this._group]).splice(b.indexOf(this),1),0===b.length&&delete h._groupResourcesMap[this._group]),a&&((b=h._groupResourcesMap[a])||(h._groupResourcesMap[a]=b=[]),b.push(this)),this._group=a)},b._addReference=function(){this._referenceCount++},b._removeReference=function(){this._referenceCount--},b._clearReference=function(){this._referenceCount=0},b._endLoaded=function(){this.__loaded=!0,this.event("loaded",this)},b.recreateResource=function(){this.completeCreate()},b.disposeResource=function(){},b.activeResource=function(a){void 0===a&&(a=!1),this._lastUseFrameCount=V.loopCount,!this._destroyed&&this.__loaded&&(this._released||a)&&this.recreateResource()},b.releaseResource=function(a){return void 0===a&&(a=!0),!(!a&&this.lock)&&(!(this._released&&!a)&&(this.disposeResource(),this._released=!0,this._lastUseFrameCount=-1,this.event("released",this),!0))},b.onAsynLoaded=function(a,b,c){throw new Error("Resource: must override this function!")},b.destroy=function(){var a;this._destroyed||(null!==this._resourceManager&&this._resourceManager.removeResource(this),this._destroyed=!0,this.lock=!1,this.releaseResource(),delete h._idResourcesMap[this.id],this._url&&((a=h._urlResourcesMap[this._url])&&(a.splice(a.indexOf(this),1),0===a.length&&delete h._urlResourcesMap[this.url]),ha.clearRes(this._url),this.__loaded||D.cancelLoadByUrl(this._url)),this._group&&((a=h._groupResourcesMap[this._group]).splice(a.indexOf(this),1),0===a.length&&delete h._groupResourcesMap[this.url]))},b.completeCreate=function(){this._released=!1,this.event("recovered",this)},b.dispose=function(){this.destroy()},k(0,b,"memorySize",function(){return this._memorySize},function(a){var b=a-this._memorySize;this._memorySize=a,this.resourceManager&&this.resourceManager.addRecord(this.uri,this.__className,b),this.resourceManager&&this.resourceManager.addSize(b)}),k(0,b,"_loaded",null,function(a){this.__loaded=a}),k(0,b,"loaded",function(){return this.__loaded}),k(0,b,"id",function(){return this._$1__id}),k(0,b,"destroyed",function(){return this._destroyed}),k(0,b,"group",function(){return this._getGroup()},function(a){this._setGroup(a)}),k(0,b,"resourceManager",function(){return this._resourceManager}),k(0,b,"url",function(){return this._url}),k(0,b,"released",function(){return this._released}),k(0,b,"referenceCount",function(){return this._referenceCount}),h.getResourceByID=function(a){return h._idResourcesMap[a]},h.getResourceByURL=function(a,b){return void 0===b&&(b=0),null==h._urlResourcesMap[a]?null:h._urlResourcesMap[a][b]},h.getResourceCountByURL=function(a){return h._urlResourcesMap[a].length},h.destroyUnusedResources=function(a){var b;if(a){var c=h._groupResourcesMap[a];if(c)for(var d=c.slice(),e=0,f=d.length;e<f;e++)(b=d[e]).lock||0!==b._referenceCount||b.destroy()}else for(var g in h._idResourcesMap)(b=h._idResourcesMap[g]).lock||0!==b._referenceCount||b.destroy()},h._uniqueIDCounter=0,h._idResourcesMap={},h._urlResourcesMap={},h._groupResourcesMap={},h}()),ka=function(a){function A(a,b){this.offsetX=0,this.offsetY=0,this.sourceWidth=0,this.sourceHeight=0,this._w=0,this._h=0,this._uvID=0,this._atlasID=-1,this.scaleRate=1,A.__super.call(this),a&&null!=a._addReference&&a._addReference(),this.setTo(a,b)}p(A,"laya.resource.Texture",j);var b=A.prototype;return b._setUrl=function(a){this.url=a},b.setTo=function(a,b){if(a instanceof g.HTMLElement){var c=ta.create("2D",a);this.bitmap=c}else this.bitmap=a;if(this.uv=b||A.DEF_UV,a){this._w=a.width,this._h=a.height,this.sourceWidth=this.sourceWidth||this._w,this.sourceHeight=this.sourceHeight||this._h,this._loaded=0<this._w;var d=this;if(this._loaded)D.addToAtlas&&D.addToAtlas(d);else{var e=a;e instanceof laya.resource.HTMLImage&&e.image&&e.image.addEventListener("load",function(a){D.addToAtlas&&D.addToAtlas(d)},!1)}}},b.active=function(){this.bitmap&&this.bitmap.activeResource()},b.destroy=function(a){if(void 0===a&&(a=!1),this.alphaTexture&&(this.alphaTexture.destroy(a),this.alphaTexture=null),this.bitmap&&0<this.bitmap.referenceCount){var b=this.bitmap;a?(H.isConchApp&&b.source&&b.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,b.dispose(),b._clearReference()):(b._removeReference(),0==b.referenceCount&&(H.isConchApp&&b.source&&b.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,b.dispose())),this.url&&this===x.loader.getRes(this.url)&&x.loader.clearRes(this.url,a),this._loaded=!1}},b.load=function(a){var b=this;this._loaded=!1,a=G.customFormat(a);var c=this.bitmap||(this.bitmap=wa.create(a));c.uri=a,c&&c._addReference();var d=this;c.onload=function(){c.onload=null,d._loaded=!0,b.sourceWidth=b._w=c.width,b.sourceHeight=b._h=c.height,d.event("loaded",this),D.addToAtlas&&D.addToAtlas(d)}},b.addTextureToAtlas=function(a){D.addTextureToAtlas(this)},b.getPixels=function(a,b,c,d){if(H.isConchApp){var e=this.bitmap;if(e.source&&e.source.getImageData){var f=e.source.getImageData(a,b,c,d),g=new Uint8Array(f);return Array.from(g)}return null}return H.isWebGL?D.getTexturePixels(this,a,b,c,d):(M.canvas.size(c,d),M.canvas.clear(),M.context.drawTexture(this,-a,-b,this.width,this.height,0,0),M.context.getImageData(0,0,c,d).data)},b.onAsynLoaded=function(a,b){if(b){if("function"!=typeof b._addReference)throw new Error("bitmap._addReference is not a function. "+b.className+" "+typeof b._addReference+" "+b.constructor);b._addReference()}this.setTo(b,this.uv),this._loaded&&this.event("loaded",this)},k(0,b,"source",function(){return this.bitmap?(this.bitmap.activeResource(),this.bitmap.source):null}),k(0,b,"loaded",function(){return this._loaded}),k(0,b,"released",function(){return!this.bitmap||this.bitmap.released}),k(0,b,"width",function(){return this._w?this._w:this.uv&&this.uv!==A.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width},function(a){this._w=a,this.sourceWidth||(this.sourceWidth=a)}),k(0,b,"repeat",function(){return!H.isWebGL||!this.bitmap||this.bitmap.repeat},function(a){a&&H.isWebGL&&this.bitmap&&(this.bitmap.repeat=a)&&(this.bitmap.enableMerageInAtlas=!1)}),k(0,b,"height",function(){return this._h?this._h:this.uv&&this.uv!==A.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height},function(a){this._h=a,this.sourceHeight||(this.sourceHeight=a)}),k(0,b,"isLinearSampling",function(){return!H.isWebGL||9728!=this.bitmap.minFifter},function(a){!a&&H.isWebGL&&(a||-1!=this.bitmap.minFifter||-1!=this.bitmap.magFifter||(this.bitmap.minFifter=9728,this.bitmap.magFifter=9728,this.bitmap.enableMerageInAtlas=!1))}),A.moveUV=function(a,b,c){for(var d=0;d<8;d+=2)c[d]+=a,c[d+1]+=b;return c},A.create=function(a,b,c,d,e,f,g,h,i){void 0===f&&(f=0),void 0===g&&(g=0),void 0===h&&(h=0),void 0===i&&(i=0);var j=a instanceof laya.resource.Texture,k=j?a.uv:A.DEF_UV,l=j?a.bitmap:a,m=D.isAtlas(l);if(m){var n=l._atlaser,o=a._atlasID;if(-1==o)throw new Error("create texture error");l=n._inAtlasTextureBitmapValue[o],k=n._inAtlasTextureOriUVValue[o]}var p=new A(l,null);l.width&&b+d>l.width&&(d=l.width-b),l.height&&c+e>l.height&&(e=l.height-c),p.width=d,p.height=e,p.offsetX=f,p.offsetY=g,p.sourceWidth=h||d,p.sourceHeight=i||e;var q=1/l.width,r=1/l.height;b*=q,c*=r,d*=q,e*=r;var s=p.uv[0],t=p.uv[1],u=p.uv[4],v=p.uv[5],w=u-s,x=v-t,y=A.moveUV(k[0],k[1],[b,c,b+d,c,b+d,c+e,b,c+e]);p.uv=[s+y[0]*w,t+y[1]*x,u-(1-y[2])*w,t+y[3]*x,u-(1-y[4])*w,v-(1-y[5])*x,s+y[6]*w,v-(1-y[7])*x],m&&p.addTextureToAtlas();var z=l.scaleRate;return z&&1!=z?(p.sourceWidth/=z,p.sourceHeight/=z,p.width/=z,p.height/=z,p.scaleRate=z,p.offsetX/=z,p.offsetY/=z):p.scaleRate=1,p},A.createFromTexture=function(a,b,c,d,e){var f=a.scaleRate;1!=f&&(b*=f,c*=f,d*=f,e*=f);var g=z.TEMP.setTo(b-a.offsetX,c-a.offsetY,d,e),h=g.intersection(A._rect1.setTo(0,0,a.width,a.height),A._rect2);if(!h)return null;var i=A.create(a,h.x,h.y,h.width,h.height,h.x-g.x,h.y-g.y,d,e);if(i.bitmap&&i.bitmap._removeReference)return i.bitmap._removeReference(),i;var j="bitmap:"+(i.bitmap?i.bitmap.constructor?i.bitmap.constructor.name:i.bitmap.__className:"")+", url:"+(a.url+" | "+(i.bitmap?i.bitmap.url:a.url))+", x="+b+",y="+c+",width="+d+",height="+e+", result="+(h?h.x+","+h.y+","+h.width+","+h.height:"null")+", rect="+g.x+","+g.y+","+g.width+","+g.height;throw new Error("报错：bitmap._removeReference is not a function  "+j)},A.DEF_UV=[0,0,1,0,1,1,0,1],A.INV_UV=[0,1,1,1,1,0,0,0],A._rect1=new z,A._rect2=new z,A}(),a=function(a){var h;function f(){this._labelDic=null,this._tweenDic={},this._tweenDataList=[],this._endTweenDataList=null,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this._firstTweenDic={},this._startTimeSort=!1,this._endTimeSort=!1,this._loopKey=!1,this.scale=1,this._frameRate=60,this._frameIndex=0,this._total=0,f.__super.call(this)}p(f,"laya.utils.TimeLine",j);var b=f.prototype;return b.to=function(a,b,c,d,e){return void 0===e&&(e=0),this._create(a,b,c,d,e,!0)},b.from=function(a,b,c,d,e){return void 0===e&&(e=0),this._create(a,b,c,d,e,!1)},b._create=function(a,b,c,d,e,f){var g=U.getItemByClass("tweenData",h);return g.isTo=f,g.type=0,g.target=a,g.duration=c,g.data=b,g.startTime=this._startTime+e,g.endTime=g.startTime+g.duration,g.ease=d,this._startTime=Math.max(g.endTime,this._startTime),this._tweenDataList.push(g),this._startTimeSort=!0,this._endTimeSort=!0,this},b.addLabel=function(a,b){var c=U.getItemByClass("tweenData",h);return c.type=1,c.data=a,c.endTime=c.startTime=this._startTime+b,this._labelDic||(this._labelDic={}),this._labelDic[a]=c,this._tweenDataList.push(c),this},b.removeLabel=function(a){if(this._labelDic&&this._labelDic[a]){var b=this._labelDic[a];if(b){var c=this._tweenDataList.indexOf(b);-1<c&&this._tweenDataList.splice(c,1)}delete this._labelDic[a]}},b.gotoTime=function(a){if(null!=this._tweenDataList&&0!=this._tweenDataList.length){var b,c,d,e;for(var f in this._firstTweenDic)if(c=this._firstTweenDic[f])for(var g in c)c.diyTarget.hasOwnProperty(g)&&(c.diyTarget[g]=c[g]);for(f in this._tweenDic)(b=this._tweenDic[f]).clear(),delete this._tweenDic[f];if(this._index=0,this._gidIndex=0,this._currTime=a,this._lastTime=M.now(),null==this._endTweenDataList||this._endTimeSort){this._endTimeSort=!1,this._endTweenDataList=d=this._tweenDataList.concat(),d.sort(function(a,b){return a.endTime>b.endTime?1:a.endTime<b.endTime?-1:0})}else d=this._endTweenDataList;for(var h=0,i=d.length;h<i;h++)if(0==(e=d[h]).type){if(!(a>=e.endTime))break;this._index=Math.max(this._index,h+1);var j=e.data;if(e.isTo)for(var k in j)e.target[k]=j[k]}for(h=0,i=this._tweenDataList.length;h<i;h++)0==(e=this._tweenDataList[h]).type&&a>=e.startTime&&a<e.endTime&&(this._index=Math.max(this._index,h+1),this._gidIndex++,(b=U.getItemByClass("tween",X))._create(e.target,e.data,e.duration,e.ease,s.create(this,this._animComplete,[this._gidIndex]),0,!1,e.isTo,!0,!1),b.setStartTime(this._currTime-(a-e.startTime)),b._updateEase(this._currTime),b.gid=this._gidIndex,this._tweenDic[this._gidIndex]=b)}},b.gotoLabel=function(a){if(null!=this._labelDic){var b=this._labelDic[a];b&&this.gotoTime(b.startTime)}},b.pause=function(){x.timer.clear(this,this._update)},b.resume=function(){this.play(this._currTime,this._loopKey)},b.play=function(a,b){if(void 0===a&&(a=0),void 0===b&&(b=!1),this._tweenDataList){if(this._startTimeSort){this._startTimeSort=!1,this._tweenDataList.sort(function(a,b){return a.startTime>b.startTime?1:a.startTime<b.startTime?-1:0});for(var c=0,d=this._tweenDataList.length;c<d;c++){var e=this._tweenDataList[c];if(null!=e&&0==e.type){var f=e.target,g=f.$_GID||(f.$_GID=Y.getGID()),h=null;for(var i in null==this._firstTweenDic[g]?((h={}).diyTarget=f,this._firstTweenDic[g]=h):h=this._firstTweenDic[g],e.data)null==h[i]&&(h[i]=f[i])}}}"string"==typeof a?this.gotoLabel(a):this.gotoTime(a),this._loopKey=b,this._lastTime=M.now(),x.timer.frameLoop(1,this,this._update)}},b._update=function(){if(this._currTime>=this._startTime){if(!this._loopKey){for(var a in this._tweenDic)(b=this._tweenDic[a]).complete();return this._complete(),void this.pause()}if(this._complete(),!this._tweenDataList)return;this.gotoTime(0)}var b,c=M.now(),d=c-this._lastTime,e=this._currTime+=d*this.scale;for(a in this._lastTime=c,this._tweenDic)(b=this._tweenDic[a])._updateEase(e);if(0!=this._tweenDataList.length&&this._index<this._tweenDataList.length){var f=this._tweenDataList[this._index];e>=f.startTime&&(this._index++,0==f.type?(this._gidIndex++,(b=U.getItemByClass("tween",X))._create(f.target,f.data,f.duration,f.ease,s.create(this,this._animComplete,[this._gidIndex]),0,!1,f.isTo,!0,!1),b.setStartTime(e),b.gid=this._gidIndex,(this._tweenDic[this._gidIndex]=b)._updateEase(e)):this.event("label",f.data))}},b._animComplete=function(a){this._tweenDic[a]&&delete this._tweenDic[a]},b._complete=function(){this.event("complete")},b.reset=function(){var a;if(this._labelDic)for(a in this._labelDic)delete this._labelDic[a];for(a in this._tweenDic)this._tweenDic[a].clear(),delete this._tweenDic[a];for(a in this._firstTweenDic)delete this._firstTweenDic[a];if(this._endTweenDataList=null,this._tweenDataList&&this._tweenDataList.length){var b,c=0;for(b=this._tweenDataList.length,c=0;c<b;c++)this._tweenDataList[c]&&this._tweenDataList[c].destroy()}this._tweenDataList.length=0,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this.scale=1,x.timer.clear(this,this._update)},b.destroy=function(){this.reset(),this._labelDic=null,this._tweenDic=null,this._tweenDataList=null,this._firstTweenDic=null},k(0,b,"index",function(){return this._frameIndex},function(a){this._frameIndex=a,this.gotoTime(this._frameIndex/this._frameRate*1e3)}),k(0,b,"total",function(){return this._total=Math.floor(this._startTime/1e3*this._frameRate),this._total}),f.to=function(a,b,c,d,e){return void 0===e&&(e=0),(new f).to(a,b,c,d,e)},f.from=function(a,b,c,d,e){return void 0===e&&(e=0),(new f).from(a,b,c,d,e)},f.__init$=function(){h=function(){function a(){this.type=0,this.isTo=!0,this.startTime=NaN,this.endTime=NaN,this.target=null,this.duration=NaN,this.ease=null,this.data=null}return p(a,""),a.prototype.destroy=function(){this.target=null,this.ease=null,this.data=null,this.isTo=!0,this.type=0,U.recover("tweenData",this)},a}()},f}(),la=function(e){function c(){this._transform=null,this._tfChanged=!1,this._x=0,this._y=0,this._width=0,this._height=0,this._repaint=1,this._mouseEnableState=0,this._zOrder=0,this._graphics=null,this._renderType=0,this._optimizeScrollRect=!1,this._texture=null,this.mouseThrough=!1,this.autoSize=!1,this.hitTestPrior=!1,this.viewport=null,c.__super.call(this),this._style=h.EMPTY}p(c,"laya.display.Sprite",e);var a=c.prototype;return x.imps(a,{"laya.display.ILayout":!0}),a.createConchModel=function(){return new ConchNode},a.destroy=function(a){if(void 0===a&&(a=!0),this._releaseMem(),!this._destroyed){this.filters=null;var b=this.mask;b&&(this.mask=null,b.destroy(a))}e.prototype.destroy.call(this,a),this._style&&this._style.destroy(),this._transform&&this._transform.destroy(),this._transform=null,this._style=null,this._graphics=null},a.updateZOrder=function(){Y.updateOrder(this._childs)&&this.repaint()},a.reCache=function(){this._$P.cacheCanvas&&(this._$P.cacheCanvas.reCache=!0),this._repaint=1},a.setBounds=function(a){this._set$P("uBounds",a)},a.getBounds=function(){return this._$P.mBounds||this._set$P("mBounds",new z),z._getWrapRec(this._boundPointsToParent(),this._$P.mBounds)},a.getSelfBounds=function(){return this._$P.uBounds?this._$P.uBounds:(this._$P.mBounds||this._set$P("mBounds",new z),z._getWrapRec(this._getBoundPointsM(!1),this._$P.mBounds))},a._boundPointsToParent=function(a){void 0===a&&(a=!1);var b=0,c=0;this._style&&(b=this._style._tf.translateX,c=this._style._tf.translateY,a=a||0!==this._style._tf.rotate,this._style.scrollRect&&(b+=this._style.scrollRect.x,c+=this._style.scrollRect.y));var d=this._getBoundPointsM(a);if(!d||d.length<1)return d;if(8!=d.length&&(d=a?v.scanPList(d):z._getWrapRec(d,z.TEMP)._getBoundPoints()),!this.transform)return Y.transPointList(d,this._x-b,this._y-c),d;var e=y.TEMP,f=0,g=d.length;for(f=0;f<g;f+=2)e.x=d[f],e.y=d[f+1],this.toParentPoint(e),d[f]=e.x,d[f+1]=e.y;return d},a.getGraphicBounds=function(a){return void 0===a&&(a=!1),this._graphics?this._graphics.getBounds(a):z.TEMP.setTo(0,0,0,0)},a._getBoundPointsM=function(a){if(void 0===a&&(a=!1),this._$P.uBounds)return this._$P.uBounds._getBoundPoints();if(this._$P.temBM||this._set$P("temBM",[]),this.scrollRect){var b=Y.clearArray(this._$P.temBM),c=z.TEMP;return c.copyFrom(this.scrollRect),Y.concatArray(b,c._getBoundPoints()),b}for(var d,e,f,g=this._graphics?this._graphics.getBoundPoints():Y.clearArray(this._$P.temBM),h=0,i=(f=this._childs).length;h<i;h++)(d=f[h])instanceof laya.display.Sprite&&1==d.visible&&(e=d._boundPointsToParent(a))&&(g=g?Y.concatArray(g,e):e);return g},a.getStyle=function(){return this._style===h.EMPTY&&(this._style=new h),this._style},a.setStyle=function(a){this._style=a},a._adjustTransform=function(){this._tfChanged=!1;var a,b=this._style._tf,c=b.scaleX,d=b.scaleY;if(b.rotate||1!==c||1!==d||b.skewX||b.skewY){(a=this._transform||(this._transform=E.create())).bTransform=!0;var e=.0174532922222222*(b.rotate-b.skewX),f=.0174532922222222*(b.rotate+b.skewY),g=Math.cos(f),h=Math.sin(f),i=Math.sin(e),j=Math.cos(e);return a.a=c*g,a.b=c*h,a.c=-d*i,a.d=d*j,a.tx=a.ty=0,a}return this._transform&&this._transform.destroy(),this._transform=null,this._renderType&=-5,a},a.pos=function(a,b,c){if(void 0===c&&(c=!1),this._x!==a||this._y!==b){if(this.destroyed)return this;if(c){this._x=a,this._y=b,this.conchModel&&this.conchModel.pos(this._x,this._y);var d=this._parent;d&&0===d._repaint&&(d._repaint=1,d.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}else this.x=a,this.y=b}return this},a.pivot=function(a,b){return this.pivotX=a,this.pivotY=b,this},a.size=function(a,b){return this.width=a,this.height=b,this},a.scale=function(a,b,c){void 0===c&&(c=!1);var d=this.getStyle(),e=d._tf;if(e.scaleX!=a||e.scaleY!=b){if(this.destroyed)return this;if(c){d.setScale(a,b),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(a,b),this._renderType|=4;var f=this._parent;f&&0===f._repaint&&(f._repaint=1,f.parentRepaint())}else this.scaleX=a,this.scaleY=b}return this},a.skew=function(a,b){return this.skewX=a,this.skewY=b,this},a.render=function(a,b,c){V.spriteCount++,J.renders[this._renderType]._fun(this,a,b+this._x,c+this._y),this._repaint=0},a.drawToCanvas=function(a,b,c,d){if(H.isConchNode){var e=ta.create("2D");return new I(a,b,e).ctx.setCanvasType(1),this.conchModel.drawToCanvas(e.source,c,d),e}return D.drawToCanvas(this,this._renderType,a,b,c,d)},a.customRender=function(a,b,c){this._renderType|=1024},a._applyFilters=function(){var a;if(!H.isWebGL&&((a=this._$P.filters)&&!(a.length<1)))for(var b=0,c=a.length;b<c;b++)a[b].action.apply(this._$P.cacheCanvas)},a._isHaveGlowFilter=function(){var a,b=0;if(this.filters)for(b=0;b<this.filters.length;b++)if(8==this.filters[b].type)return!0;for(b=0,a=this._childs.length;b<a;b++)if(this._childs[b]._isHaveGlowFilter())return!0;return!1},a.localToGlobal=function(a,b){void 0===b&&(b=!1),!0===b&&(a=new y(a.x,a.y));for(var c=this;c&&c!=x.stage;)a=c.toParentPoint(a),c=c.parent;return a},a.globalToLocal=function(a,b){void 0===b&&(b=!1),b&&(a=new y(a.x,a.y));for(var c=this,d=[];c&&c!=x.stage;)d.push(c),c=c.parent;for(var e=d.length-1;0<=e;)a=(c=d[e]).fromParentPoint(a),e--;return a},a.toParentPoint=function(a){if(!a)return a;a.x-=this.pivotX,a.y-=this.pivotY,this.transform&&this._transform.transformPoint(a),a.x+=this._x,a.y+=this._y;var b=this._style.scrollRect;return b&&(a.x-=b.x,a.y-=b.y),a},a.fromParentPoint=function(a){if(!a)return a;a.x-=this._x,a.y-=this._y;var b=this._style.scrollRect;return b&&(a.x+=b.x,a.y+=b.y),this.transform&&this._transform.invertTransformPoint(a),a.x+=this.pivotX,a.y+=this.pivotY,a},a.on=function(a,b,c,d){return 1!==this._mouseEnableState&&this.isMouseEvent(a)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(a,b,c,d,!1)):e.prototype.on.call(this,a,b,c,d)},a.once=function(a,b,c,d){return 1!==this._mouseEnableState&&this.isMouseEvent(a)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(a,b,c,d,!0)):e.prototype.once.call(this,a,b,c,d)},a._$2__onDisplay=function(){if(1!==this._mouseEnableState){var a=this;for(a=a.parent;a&&1!==a._mouseEnableState&&!a._getBit(2);)a.mouseEnabled=!0,a._setBit(2,!0),a=a.parent}},a.loadImage=function(a,b,c,d,e,f){var g=this;return void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=0),void 0===e&&(e=0),this.graphics.loadImage(a,b,c,d,e,function(a){g.destroyed||(g.size(b+(d||a.width),c+(e||a.height)),g.repaint(),f&&f.runWith(a))}),this},a.repaint=function(){this.conchModel&&this.conchModel.repaint&&this.conchModel.repaint(),0===this._repaint&&(this._repaint=1,this.parentRepaint()),this._$P&&this._$P.maskParent&&this._$P.maskParent.repaint()},a._needRepaint=function(){return 0!==this._repaint&&this._$P.cacheCanvas&&this._$P.cacheCanvas.reCache},a._childChanged=function(a){this._childs.length?this._renderType|=2048:this._renderType&=-2049,a&&this._get$P("hasZorder")&&x.timer.callLater(this,this.updateZOrder),this.repaint()},a.parentRepaint=function(){var a=this._parent;a&&0===a._repaint&&(a._repaint=1,a.parentRepaint())},a.startDrag=function(a,b,c,d,e,f,g){void 0===b&&(b=!1),void 0===c&&(c=0),void 0===d&&(d=300),void 0===f&&(f=!1),void 0===g&&(g=.92),this._$P.dragging||this._set$P("dragging",new R),this._$P.dragging.start(this,a,b,c,d,e,f,g)},a.stopDrag=function(){this._$P.dragging&&this._$P.dragging.stop()},a._releaseMem=function(){if(this._$P){var a=this._$P.cacheCanvas;a&&a.ctx&&(U.recover("RenderContext",a.ctx),a.ctx.canvas.size(0,0),a.ctx=null);var b=this._$P._filterCache;b&&(b.destroy(),b.recycle(),this._set$P("_filterCache",null)),this._$P._isHaveGlowFilter&&this._set$P("_isHaveGlowFilter",!1),this._$P._isHaveGlowFilter=null}},a._setDisplay=function(a){a||this._releaseMem(),e.prototype._setDisplay.call(this,a)},a.hitTestPoint=function(a,b){var c=this.globalToLocal(y.TEMP.setTo(a,b));return a=c.x,b=c.y,(this._$P.hitArea?this._$P.hitArea:0<this._width&&0<this._height?z.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds()).contains(a,b)},a.getMousePoint=function(){return this.globalToLocal(y.TEMP.setTo(x.stage.mouseX,x.stage.mouseY))},a._getWords=function(){return null},a._addChildsToLayout=function(a){var b=this._getWords();if(null==b&&0==this._childs.length)return!1;if(b)for(var c=0,d=b.length;c<d;c++)a.push(b[c]);c=0;for(var e=this._childs.length;c<e;++c){var f=this._childs[c];f._style._enableLayout()&&f._addToLayout(a)}return!0},a._addToLayout=function(a){this._style.absolute||(this._style.block?a.push(this):this._addChildsToLayout(a)&&(this.x=this.y=0))},a._isChar=function(){return!1},a._getCSSStyle=function(){return this._style.getCSSStyle()},a._setAttributes=function(a,b){switch(a){case"x":this.x=parseFloat(b);break;case"y":this.y=parseFloat(b);break;case"width":this.width=parseFloat(b);break;case"height":this.height=parseFloat(b);break;default:this[a]=b}},a._layoutLater=function(){this.parent&&this.parent._layoutLater()},k(0,a,"optimizeScrollRect",function(){return this._optimizeScrollRect},function(a){this._optimizeScrollRect!=a&&(this._optimizeScrollRect=a,this.conchModel&&this.conchModel.optimizeScrollRect(a))}),k(0,a,"customRenderEnable",null,function(a){if(a&&(this._renderType|=1024,H.isConchNode)){c.CustomList.push(this);var b=new ta("2d");b._setContext(new CanvasRenderingContext2D),this.customContext=new I(0,0,b),b.context.setCanvasType&&b.context.setCanvasType(2),this.conchModel.custom(b.context)}}),k(0,a,"cacheAsBitmap",function(){return"none"!==this.cacheAs},function(a){this.cacheAs=a?this._$P.hasFilter?"none":"normal":"none"}),k(0,a,"cacheAs",function(){return null==this._$P.cacheCanvas?"none":this._$P.cacheCanvas.type},function(a){var b=this._$P.cacheCanvas;if(a!==(b?b.type:"none")){if("none"!==a)this._getBit(1)||this._setUpNoticeType(1),b||(b=this._set$P("cacheCanvas",U.getItemByClass("cacheCanvas",Object))),b.type=a,b.reCache=!0,this._renderType|=16,"bitmap"==a&&this.conchModel&&this.conchModel.cacheAs(1),this._set$P("cacheForFilters",!1);else if(this._$P._mask);else if(this._$P.hasFilter)this._set$P("cacheForFilters",!0);else{if(b){var c=b;c&&c.ctx&&(U.recover("RenderContext",c.ctx),c.ctx.canvas.size(0,0),c.ctx=null),U.recover("cacheCanvas",b)}this._$P.cacheCanvas=null,this._renderType&=-17,this.conchModel&&this.conchModel.cacheAs(0)}this.repaint()}}),k(0,a,"zOrder",function(){return this._zOrder},function(a){this._zOrder!=a&&(this._zOrder=a,this.conchModel&&this.conchModel.setZOrder&&this.conchModel.setZOrder(a),this._parent&&(a&&this._parent._set$P("hasZorder",!0),x.timer.callLater(this._parent,this.updateZOrder)))}),k(0,a,"rotation",function(){return this._style._tf.rotate},function(a){var b=this.getStyle();if(b._tf.rotate!==a){b.setRotate(a),this._tfChanged=!0,this.conchModel&&this.conchModel.rotate(a),this._renderType|=4;var c=this._parent;c&&0===c._repaint&&(c._repaint=1,c.parentRepaint())}}),k(0,a,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function(a){this._width!==a&&(this._width=a,this.conchModel&&this.conchModel.size(a,this._height),this.repaint())}),k(0,a,"x",function(){return this._x},function(a){if(this._x!==a){if(this.destroyed)return;this._x=a,this.conchModel&&this.conchModel.pos(a,this._y);var b=this._parent;b&&0===b._repaint&&(b._repaint=1,b.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),k(0,a,"globalScaleY",function(){for(var a=1,b=this;b&&b!==x.stage;)a*=b.scaleY,b=b.parent;return a}),k(0,a,"hitArea",function(){return this._$P.hitArea},function(a){this._set$P("hitArea",a)}),k(0,a,"staticCache",function(){return this._$P.staticCache},function(a){this._set$P("staticCache",a),a||this.reCache()}),k(0,a,"texture",function(){return this._texture},function(a){this._texture!=a&&(this._texture=a,this.graphics.cleanByTexture(a,0,0))}),k(0,a,"y",function(){return this._y},function(a){if(this._y!==a){if(this.destroyed)return;this._y=a,this.conchModel&&this.conchModel.pos(this._x,a);var b=this._parent;b&&0===b._repaint&&(b._repaint=1,b.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),k(0,a,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function(a){this._height!==a&&(this._height=a,this.conchModel&&this.conchModel.size(this._width,a),this.repaint())}),k(0,a,"blendMode",function(){return this._style.blendMode},function(a){this.getStyle().blendMode=a,this.conchModel&&this.conchModel.blendMode(a),a&&"source-over"!=a?this._renderType|=8:this._renderType&=-9,this.parentRepaint()}),k(0,a,"scaleX",function(){return this._style._tf.scaleX},function(a){var b=this.getStyle();if(b._tf.scaleX!==a){b.setScaleX(a),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(a,b._tf.scaleY),this._renderType|=4;var c=this._parent;c&&0===c._repaint&&(c._repaint=1,c.parentRepaint())}}),k(0,a,"scaleY",function(){return this._style._tf.scaleY},function(a){var b=this.getStyle();if(b._tf.scaleY!==a){b.setScaleY(a),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(b._tf.scaleX,a),this._renderType|=4;var c=this._parent;c&&0===c._repaint&&(c._repaint=1,c.parentRepaint())}}),k(0,a,"stage",function(){return x.stage}),k(0,a,"skewX",function(){return this._style._tf.skewX},function(a){var b=this.getStyle();if(b._tf.skewX!==a){b.setSkewX(a),this._tfChanged=!0,this.conchModel&&this.conchModel.skew(a,b._tf.skewY),this._renderType|=4;var c=this._parent;c&&0===c._repaint&&(c._repaint=1,c.parentRepaint())}}),k(0,a,"scrollRect",function(){return this._style.scrollRect},function(a){this.getStyle().scrollRect=a,this.repaint(),a?(this._renderType|=128,this.conchModel&&this.conchModel.scrollRect(a.x,a.y,a.width,a.height)):(this._renderType&=-129,this.conchModel&&(c.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(64):this.conchModel.removeType(128)))}),k(0,a,"skewY",function(){return this._style._tf.skewY},function(a){var b=this.getStyle();if(b._tf.skewY!==a){b.setSkewY(a),this._tfChanged=!0,this.conchModel&&this.conchModel.skew(b._tf.skewX,a),this._renderType|=4;var c=this._parent;c&&0===c._repaint&&(c._repaint=1,c.parentRepaint())}}),k(0,a,"transform",function(){return this._tfChanged?this._adjustTransform():this._transform},function(a){this._tfChanged=!1,(this._transform=a)&&(this._x=a.tx,this._y=a.ty,a.tx=a.ty=0,this.conchModel&&this.conchModel.transform(a.a,a.b,a.c,a.d,this._x,this._y)),a?this._renderType|=4:(this._renderType&=-5,this.conchModel&&this.conchModel.removeType(4)),this.parentRepaint()}),k(0,a,"pivotX",function(){return this._style._tf.translateX},function(a){this.getStyle().setTranslateX(a),this.conchModel&&this.conchModel.pivot(a,this._style._tf.translateY),this.repaint()}),k(0,a,"pivotY",function(){return this._style._tf.translateY},function(a){this.getStyle().setTranslateY(a),this.conchModel&&this.conchModel.pivot(this._style._tf.translateX,a),this.repaint()}),k(0,a,"alpha",function(){return this._style.alpha},function(a){this._style&&this._style.alpha!==a&&(a=a<0?0:1<a?1:a,this.getStyle().alpha=a,this.conchModel&&this.conchModel.alpha(a),1!==a?this._renderType|=2:this._renderType&=-3,this.parentRepaint())}),k(0,a,"visible",function(){return this._style.visible},function(a){this._style&&this._style.visible!==a&&(this.getStyle().visible=a,this.conchModel&&this.conchModel.visible(a),this.parentRepaint())}),k(0,a,"graphics",function(){return this._graphics||(this.graphics=D.createGraphics())},function(a){this._graphics&&(this._graphics._sp=null),(this._graphics=a)?(this._renderType&=-2,this._renderType|=512,(a._sp=this).conchModel&&this.conchModel.graphics(this._graphics)):(this._renderType&=-513,this._renderType&=-2,this.conchModel&&(c.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(256):this.conchModel.removeType(512))),this.repaint()}),k(0,a,"filters",function(){return this._$P.filters},function(a){a&&0===a.length&&(a=null),this._$P.filters!=a&&(this._set$P("filters",a?a.slice():null),H.isConchApp&&(this.conchModel&&(c.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(16):this.conchModel.removeType(32)),this._$P.filters&&1==this._$P.filters.length&&this._$P.filters[0].callNative(this)),H.isWebGL&&(a&&a.length?this._renderType|=32:this._renderType&=-33),a&&0<a.length?(this._getBit(1)||this._setUpNoticeType(1),H.isWebGL&&1==a.length&&a[0]instanceof laya.filters.ColorFilter||("bitmap"!=this.cacheAs&&(H.isConchNode||(this.cacheAs="bitmap"),this._set$P("cacheForFilters",!0)),this._set$P("hasFilter",!0))):(this._set$P("hasFilter",!1),this._$P.cacheForFilters&&"bitmap"==this.cacheAs&&(this.cacheAs="none")),this.repaint())}),k(0,a,"parent",e.prototype._$get_parent,function(a){x.superSet(aa,this,"parent",a),a&&this._getBit(2)&&this._$2__onDisplay()}),k(0,a,"mask",function(){return this._$P._mask},function(a){a&&this.mask&&this.mask._$P.maskParent||(a?(this.cacheAs="bitmap",this._set$P("_mask",a),a._set$P("maskParent",this)):(this.mask&&this.mask._set$P("maskParent",null),this._set$P("_mask",a),this.cacheAs="none"),this.conchModel&&this.conchModel.mask(a?a.conchModel:null),this._renderType|=64,this.parentRepaint())}),k(0,a,"mouseEnabled",function(){return 1<this._mouseEnableState},function(a){this._mouseEnableState=a?2:1}),k(0,a,"globalScaleX",function(){for(var a=1,b=this;b&&b!==x.stage;)a*=b.scaleX,b=b.parent;return a}),k(0,a,"mouseX",function(){return this.getMousePoint().x}),k(0,a,"mouseY",function(){return this.getMousePoint().y}),c.fromImage=function(a){return(new c).loadImage(a)},c._cachePool=[],c.CustomList=[],i(c,["RUNTIMEVERION",function(){return this.RUNTIMEVERION=g.conch?conchConfig.getRuntimeVersion().substr(conchConfig.getRuntimeVersion().lastIndexOf("-")+1):""}]),c}(aa),ma=function(a){function b(a){this._audio=null,this._onEnd=null,this._resumePlay=null,b.__super.call(this),this._onEnd=Y.bind(this.__onEnd,this),this._resumePlay=Y.bind(this.__resumePlay,this),a.addEventListener("ended",this._onEnd),this._audio=a}p(b,"laya.media.h5audio.AudioSoundChannel",da);var c=b.prototype;return c.__onEnd=function(){if(1==this.loops)return this.completeHandler&&(x.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},c.__resumePlay=function(){this._audio&&this._audio.removeEventListener("canplay",this._resumePlay);try{this._audio.currentTime=this.startTime,M.container.appendChild(this._audio),this._audio.play()}catch(a){this.event("error")}},c.play=function(a){this.isStopped=!1;try{this._audio.playbackRate=C.playbackRate,this._audio.currentTime=this.startTime}catch(a){return void this._audio.addEventListener("canplay",this._resumePlay)}C.addChannel(this),M.container.appendChild(this._audio),!a&&this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play()},c.stop=function(){this.isStopped=!0,C.removeChannel(this),this.startHandler=null,this.completeHandler=null,this._audio&&("pause"in this._audio&&H.isConchApp&&this._audio.stop(),this._audio.pause(),this._audio.removeEventListener("ended",this._onEnd),this._audio.removeEventListener("canplay",this._resumePlay),M.onIE||this._audio!=ca._musicAudio&&U.recover("audio:"+this.url,this._audio),M.removeElement(this._audio),this._audio=null)},c.pause=function(){this.isStopped=!0,C.removeChannel(this),"pause"in this._audio&&this._audio.pause()},c.resume=function(){this._audio&&(this.isStopped=!1,C.addChannel(this),this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play())},k(0,c,"position",function(){return this._audio?this._audio.currentTime:0}),k(0,c,"duration",function(){return this._audio?this._audio.duration:0}),k(0,c,"volume",function(){return this._audio?this._audio.volume:1},function(a){this._audio&&(this._audio.volume=a)}),b}(),na=function(a){function b(){this.audioBuffer=null,this.gain=null,this.bufferSource=null,this._currentTime=0,this._volume=1,this._startTime=0,this._pauseTime=0,this._onPlayEnd=null,this.context=fa.ctx,b.__super.call(this),this._onPlayEnd=Y.bind(this.__onPlayEnd,this),this.context.createGain?this.gain=this.context.createGain():this.gain=this.context.createGainNode()}p(b,"laya.media.webaudio.WebAudioSoundChannel",da);var c=b.prototype;return c.play=function(a){if(C.addChannel(this),this.isStopped=!1,this._clearBufferSource(),this.audioBuffer){var b=this.context,c=this.gain,d=b.createBufferSource();(this.bufferSource=d).buffer=this.audioBuffer,d.connect(c),c&&c.disconnect(),c.connect(b.destination),d.onended=this._onPlayEnd,this.startTime>=this.duration&&(this.startTime=0),this._startTime=M.now(),this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(this._volume,this.context.currentTime,.1):this.gain.gain.value=this._volume,0==this.loops&&(d.loop=!0),d.playbackRate.setTargetAtTime?d.playbackRate.setTargetAtTime(C.playbackRate,this.context.currentTime,.1):d.playbackRate.value=C.playbackRate,d.start(0,this.startTime),!a&&this.startHandler&&this.startHandler.runWith(this),this._currentTime=0}},c.__onPlayEnd=function(){if(1==this.loops)return this.completeHandler&&(x.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},c._clearBufferSource=function(){if(this.bufferSource){var a=this.bufferSource;a.stop?a.stop(0):a.noteOff(0),a.disconnect(0),a.onended=null,b._tryCleanFailed||this._tryClearBuffer(a),this.bufferSource=null}},c._tryClearBuffer=function(a){try{a.buffer=null}catch(a){b._tryCleanFailed=!0}},c.stop=function(){this._clearBufferSource(),this.audioBuffer=null,this.gain&&this.gain.disconnect(),this.isStopped=!0,C.removeChannel(this),this.startHandler=null,this.completeHandler=null},c.pause=function(){this.isStopped||(this._pauseTime=this.position),this._clearBufferSource(),this.gain&&this.gain.disconnect(),this.isStopped=!0,C.removeChannel(this)},c.resume=function(){this.startTime=this._pauseTime,this.play(!1)},k(0,c,"position",function(){return this.bufferSource?(M.now()-this._startTime)/1e3+this.startTime:0}),k(0,c,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),k(0,c,"volume",function(){return this._volume},function(a){this.isStopped||(this._volume=a,this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(a,this.context.currentTime,.1):this.gain.gain.value=a)}),b._tryCleanFailed=!1,b}(),oa=function(a){function b(){b.__super.call(this),this._w=0,this._h=0}p(b,"laya.resource.Bitmap",ja);var c=b.prototype;return k(0,c,"width",function(){return this._w}),k(0,c,"height",function(){return this._h}),k(0,c,"source",function(){return this._source}),b}(),pa=function(b){function a(){this.loop=!1,this.wrapMode=0,this._index=0,this._count=0,this._isPlaying=!1,this._labels=null,this._isReverse=!1,this._frameRateChanged=!1,this._controlNode=null,this._actionName=null,a.__super.call(this),this._interval=d.animationInterval,this._setUpNoticeType(1)}p(a,"laya.display.AnimationPlayerBase",b);var c=a.prototype;return c.play=function(a,b,c,d){void 0===a&&(a=0),void 0===b&&(b=!0),void 0===c&&(c=""),void 0===d&&(d=!0),this._isPlaying=!0,this.index="string"==typeof a?this._getFrameByLabel(a):a,this.loop=b,this._actionName=c,this._isReverse=1==this.wrapMode,0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},c._getFrameByLabel=function(a){var b=0;for(b=0;b<this._count;b++)if(this._labels[b]&&0<=this._labels[b].indexOf(a))return b;return 0},c._frameLoop=function(){if(this._isReverse){if(this._index--,this._index<0){if(!this.loop)return this._index=0,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<this._count?1:0,this._isReverse=!1):this._index=this._count-1,this.event("complete")}}else if(this._index++,this._index>=this._count){if(!this.loop)return this._index--,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<=this._count-2?this._count-2:0,this._isReverse=!0):this._index=0,this.event("complete")}this.index=this._index},c._setControlNode=function(a){this._controlNode&&(this._controlNode.off("display",this,this._checkResumePlaying),this._controlNode.off("undisplay",this,this._checkResumePlaying)),(this._controlNode=a)&&a!=this&&(a.on("display",this,this._checkResumePlaying),a.on("undisplay",this,this._checkResumePlaying))},c._setDisplay=function(a){b.prototype._setDisplay.call(this,a),this._checkResumePlaying()},c._checkResumePlaying=function(){this._isPlaying&&(this._controlNode.displayedInStage?this.play(this._index,this.loop,this._actionName):this.clearTimer(this,this._frameLoop))},c.stop=function(){this._isPlaying=!1,this.clearTimer(this,this._frameLoop)},c.addLabel=function(a,b){this._labels||(this._labels={}),this._labels[b]||(this._labels[b]=[]),this._labels[b].push(a)},c.removeLabel=function(a){if(a){if(this._labels)for(var b in this._labels)this._removeLabelFromLabelList(this._labels[b],a)}else this._labels=null},c._removeLabelFromLabelList=function(a,b){if(a)for(var c=a.length-1;0<=c;c--)a[c]==b&&a.splice(c,1)},c.gotoAndStop=function(a){this.index="string"==typeof a?this._getFrameByLabel(a):a,this.stop()},c._displayToIndex=function(a){},c.clear=function(){this.stop(),this._labels=null},k(0,c,"interval",function(){return this._interval},function(a){this._interval!=a&&(this._frameRateChanged=!0,this._interval=a,this._isPlaying&&0<a&&this.timerLoop(a,this,this._frameLoop,null,!0,!0))}),k(0,c,"isPlaying",function(){return this._isPlaying}),k(0,c,"index",function(){return this._index},function(a){if(this._index=a,this._displayToIndex(a),this._labels&&this._labels[a])for(var b=this._labels[a],c=0,d=b.length;c<d;c++)this.event("label",b[c])}),k(0,c,"count",function(){return this._count}),a.WRAP_POSITIVE=0,a.WRAP_REVERSE=1,a.WRAP_PINGPONG=2,a}(la),qa=function(b){function n(){this._clipPoint=null,this._currBitmapFont=null,this._text=null,this._isChanged=!1,this._textWidth=0,this._textHeight=0,this._lines=[],this._lineWidths=[],this._startX=NaN,this._startY=NaN,this._lastVisibleLineIndex=-1,this._words=null,this._charSize={},this.underline=!1,this._underlineColor=null,n.__super.call(this),this.overflow=n.VISIBLE,this._style=new ba(this),this._style.wordWrap=!1}p(n,"laya.display.Text",b);var a=n.prototype;return a.destroy=function(a){void 0===a&&(a=!0),b.prototype.destroy.call(this,a),this._lines=null,this._words&&(this._words.length=0,this._words=null)},a._getBoundPointsM=function(a){void 0===a&&(a=!1);var b=z.TEMP;return b.setTo(0,0,this.width,this.height),b._getBoundPoints()},a.getGraphicBounds=function(a){void 0===a&&(a=!1);var b=z.TEMP;return b.setTo(0,0,this.width,this.height),b},a._getCSSStyle=function(){return this._style},a.lang=function(a,b,c,d,e,f,g,h,i,j,k){if(a=n.langPacks&&n.langPacks[a]?n.langPacks[a]:a,arguments.length<2)this._text=a;else{for(var l=0,m=arguments.length;l<m;l++)a=a.replace("{"+l+"}",arguments[l+1]);this._text=a}},a._isPassWordMode=function(){var a=this._style.password;return"prompt"in this&&this.prompt==this._text&&(a=!1),a},a._getPassWordTxt=function(a){var b;b="";for(var c=a.length;0<c;c--)b+="●";return b},a.renderText=function(a,b){var c=this.graphics;c.clear(!0);var d=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+(M.onIPhone&&laya.display.Text._fontFamilyMap[this.font]||this.font);M.context.font=d;var e=this.padding,f=e[3],g="left",h=this._lines,i=this.leading+this._charSize.height,j=this._currBitmapFont;j&&(i=this.leading+j.getMaxHeight());var k=e[0];if(!j&&0<this._width&&this._textWidth<=this._width&&("right"==this.align?(g="right",f=this._width-e[1]):"center"==this.align&&(g="center",f=.5*this._width+e[3]-e[1])),0<this._height){var l=this._textHeight>this._height?"top":this.valign;"middle"===l?k=.5*(this._height-b*i)+e[0]-e[2]:"bottom"===l&&(k=this._height-b*i-e[2])}var m=this._style;if(j&&j.autoScaleSize)var n=j.fontSize/this.fontSize;if(this._clipPoint)if(c.save(),j&&j.autoScaleSize){var o=0,p=0;o=this._width?this._width-e[3]-e[1]:this._textWidth,p=this._height?this._height-e[0]-e[2]:this._textHeight,o*=n,p*=n,c.clipRect(e[3],e[0],o,p)}else c.clipRect(e[3],e[0],this._width?this._width-e[3]-e[1]:this._textWidth,this._height?this._height-e[0]-e[2]:this._textHeight);var q=m.password;"prompt"in this&&this.prompt==this._text&&(q=!1);for(var r=0,s=0,t=Math.min(this._lines.length,b+a)||1,u=a;u<t;u++){var v,w=h[u];if(q){var x=w.length;w="";for(var y=x;0<y;y--)w+="●"}if(r=f-(this._clipPoint?this._clipPoint.x:0),s=k+i*u-(this._clipPoint?this._clipPoint.y:0),this.underline&&this.drawUnderline(g,r,s,u),j){var z=this.width;j.autoScaleSize&&(z=this.width*n),j.drawText(w,this,r,s,this.align,z)}else H.isWebGL?(this._words||(this._words=[]),(v=this._words.length>u-a?this._words[u-a]:new _).setText(w)):v=w,m.stroke?c.fillBorderText(v,r,s,d,this.color,m.strokeColor,m.stroke,g):c.fillText(v,r,s,d,this.color,g)}if(j&&j.autoScaleSize){var A=1/n;this.scale(A,A)}this._clipPoint&&c.restore(),this._startX=f,this._startY=k},a.drawUnderline=function(a,b,c,d){var e=this._lineWidths[d];switch(a){case"center":b-=e/2;break;case"right":b-=e}c+=this._charSize.height,this._graphics.drawLine(b,c,b+e,c,this.underlineColor||this.color,1)},a.typeset=function(){if(this._isChanged=!1,!this._text)return this._clipPoint=null,this._textWidth=this._textHeight=0,void this.graphics.clear(!0);M.context.font=this._getCSSStyle().font,this._lines.length=0,this._lineWidths.length=0,this._isPassWordMode()?this.parseLines(this._getPassWordTxt(this._text)):this.parseLines(this._text),this.evalTextSize(),this.checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new y(0,0)):this._clipPoint=null;var a=this._lines.length;if(this.overflow!=n.VISIBLE){var b=this.overflow==n.HIDDEN?Math.floor:Math.ceil;a=Math.min(a,b((this.height-this.padding[0]-this.padding[2])/(this.leading+this._charSize.height)))}var c=this.scrollY/(this._charSize.height+this.leading)|0;this.renderText(c,a),this.repaint()},a.evalTextSize=function(){var a,b=NaN;a=Math.max.apply(this,this._lineWidths),b=this._currBitmapFont?this._lines.length*(this._currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2],a==this._textWidth&&b==this._textHeight||(this._textWidth=a,this._textHeight=b,this._width&&this._height||this.conchModel&&this.conchModel.size(this._width||this._textWidth,this._height||this._textHeight))},a.checkEnabledViewportOrNot=function(){return this.overflow==n.SCROLL&&(0<this._width&&this._textWidth>this._width||0<this._height&&this._textHeight>this._height)},a.changeText=function(a){this._text!==a&&(this.lang(a+""),this._graphics&&this._graphics.replaceText(this._text)||this.typeset())},a.parseLines=function(a){var b=this.wordWrap||this.overflow==n.HIDDEN;if(b)var c=this.getWordWrapWidth();if(this._currBitmapFont)this._charSize.width=this._currBitmapFont.getMaxWidth(),this._charSize.height=this._currBitmapFont.getMaxHeight();else{var d=M.context.measureText(n._testWord);H.isConchApp&&0===d.width&&0===d.height&&(d=M.context.measureText("W")),this._charSize.width=d.width,this._charSize.height=d.height||this.fontSize}for(var e=a.replace(/\r\n/g,"\n").split("\n"),f=0,g=e.length;f<g;f++){var h=e[f];b?this.parseLine(h,c):(this._lineWidths.push(this.getTextWidth(h)),this._lines.push(h))}},a.parseLine=function(a,b){M.context;var c,d=this._lines,e=0,f=NaN,g=NaN,h=0;if((f=this.getTextWidth(a))<=b)return d.push(a),void this._lineWidths.push(f);f=this._charSize.width,0==(e=Math.floor(b/f))&&(e=1),g=f=this.getTextWidth(a.substring(0,e));for(var i=e,j=a.length;i<j;i++)if(b<(g+=f=this.getTextWidth(a.charAt(i))))if(this.wordWrap){var k=a.substring(h,i);if(k.charCodeAt(k.length-1)<255?(c=/(?:\w|-)+$/.exec(k))&&(i=c.index+h,0==c.index?i+=k.length:k=a.substring(h,i)):n.RightToLeft&&(c=/([\u0600-\u06FF])+$/.exec(k))&&(i=c.index+h,0==c.index?i+=k.length:k=a.substring(h,i)),d.push(k),this._lineWidths.push(g-f),!((h=i)+e<j)){d.push(a.substring(h,j)),this._lineWidths.push(this.getTextWidth(d[d.length-1])),h=-1;break}i+=e,g=f=this.getTextWidth(a.substring(h,i)),i--}else if(this.overflow==n.HIDDEN)return d.push(a.substring(0,i)),void this._lineWidths.push(this.getTextWidth(d[d.length-1]));this.wordWrap&&-1!=h&&(d.push(a.substring(h,j)),this._lineWidths.push(this.getTextWidth(d[d.length-1])))},a.getTextWidth=function(a){return this._currBitmapFont?this._currBitmapFont.getTextWidth(a):M.context.measureText(a).width},a.getWordWrapWidth=function(){var a=this.padding,b=NaN;return(b=this._currBitmapFont&&this._currBitmapFont.autoScaleSize?this._width*(this._currBitmapFont.fontSize/this.fontSize):this._width)<=0&&(b=this.wordWrap?100:M.width),b<=0&&(b=100),b-a[3]-a[1]},a.getCharPoint=function(a,b){this._isChanged&&x.timer.runCallLater(this,this.typeset);for(var c=0,d=this._lines,e=0,f=0,g=d.length;f<g;f++){if(a<(c+=d[f].length)){var h=f;break}e=c}var i=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;M.context.font=i;var j=this.getTextWidth(this._text.substring(e,a));return(b||new y).setTo(this._startX+j-(this._clipPoint?this._clipPoint.x:0),this._startY+h*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))},k(0,a,"width",function(){return this._width?this._width:this.textWidth+this.padding[1]+this.padding[3]},function(a){a!=this._width&&(x.superSet(la,this,"width",a),this.isChanged=!0)}),k(0,a,"textWidth",function(){return this._isChanged&&x.timer.runCallLater(this,this.typeset),this._textWidth}),k(0,a,"height",function(){return this._height?this._height:this.textHeight},function(a){a!=this._height&&(x.superSet(la,this,"height",a),this.isChanged=!0)}),k(0,a,"textHeight",function(){return this._isChanged&&x.timer.runCallLater(this,this.typeset),this._textHeight}),k(0,a,"padding",function(){return this._getCSSStyle().padding},function(a){this._getCSSStyle().padding=a,this.isChanged=!0}),k(0,a,"bold",function(){return this._getCSSStyle().bold},function(a){this._getCSSStyle().bold=a,this.isChanged=!0}),k(0,a,"text",function(){return this._text||""},function(a){this._text!==a&&(this.lang(a+""),this.isChanged=!0,this.event("change"))}),k(0,a,"color",function(){return this._getCSSStyle().color},function(a){this._getCSSStyle().color!=a&&(this._getCSSStyle().color=a,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0)}),k(0,a,"font",function(){return this._getCSSStyle().fontFamily},function(a){this._currBitmapFont&&(this._currBitmapFont=null,this.scale(1,1)),n._bitmapFonts&&n._bitmapFonts[a]&&(this._currBitmapFont=n._bitmapFonts[a]),this._getCSSStyle().fontFamily=a,this.isChanged=!0}),k(0,a,"fontSize",function(){return this._getCSSStyle().fontSize},function(a){this._getCSSStyle().fontSize=a,this.isChanged=!0}),k(0,a,"italic",function(){return this._getCSSStyle().italic},function(a){this._getCSSStyle().italic=a,this.isChanged=!0}),k(0,a,"align",function(){return this._getCSSStyle().align},function(a){this._getCSSStyle().align=a,this.isChanged=!0}),k(0,a,"valign",function(){return this._getCSSStyle().valign},function(a){this._getCSSStyle().valign=a,this.isChanged=!0}),k(0,a,"wordWrap",function(){return this._getCSSStyle().wordWrap},function(a){this._getCSSStyle().wordWrap=a,this.isChanged=!0}),k(0,a,"leading",function(){return this._getCSSStyle().leading},function(a){this._getCSSStyle().leading=a,this.isChanged=!0}),k(0,a,"bgColor",function(){return this._getCSSStyle().backgroundColor},function(a){this._getCSSStyle().backgroundColor=a,this.isChanged=!0}),k(0,a,"borderColor",function(){return this._getCSSStyle().borderColor},function(a){this._getCSSStyle().borderColor=a,this.isChanged=!0}),k(0,a,"stroke",function(){return this._getCSSStyle().stroke},function(a){this._getCSSStyle().stroke=a,this.isChanged=!0}),k(0,a,"strokeColor",function(){return this._getCSSStyle().strokeColor},function(a){this._getCSSStyle().strokeColor=a,this.isChanged=!0}),k(0,a,"isChanged",null,function(a){this._isChanged!==a&&(this._isChanged=a)&&x.timer.callLater(this,this.typeset)}),k(0,a,"scrollX",function(){return this._clipPoint?this._clipPoint.x:0},function(a){if(!(this.overflow!=n.SCROLL||this.textWidth<this._width)&&this._clipPoint){a=a<this.padding[3]?this.padding[3]:a;var b=this._textWidth-this._width;a=b<a?b:a;var c=this._height/(this._charSize.height+this.leading)|1;this._clipPoint.x=a,this.renderText(this._lastVisibleLineIndex,c)}}),k(0,a,"scrollY",function(){return this._clipPoint?this._clipPoint.y:0},function(a){if(!(this.overflow!=n.SCROLL||this.textHeight<this._height)&&this._clipPoint){a=a<this.padding[0]?this.padding[0]:a;var b=this._textHeight-this._height,c=(a=b<a?b:a)/(this._charSize.height+this.leading)|0;this._lastVisibleLineIndex=c;var d=1+(this._height/(this._charSize.height+this.leading)|0);this._clipPoint.y=a,this.renderText(c,d)}}),k(0,a,"maxScrollX",function(){return this.textWidth<this._width?0:this._textWidth-this._width}),k(0,a,"maxScrollY",function(){return this.textHeight<this._height?0:this._textHeight-this._height}),k(0,a,"lines",function(){return this._isChanged&&this.typeset(),this._lines}),k(0,a,"underlineColor",function(){return this._underlineColor},function(a){this._underlineColor=a,this._isChanged=!0,this.typeset()}),n.registerBitmapFont=function(a,b){n._bitmapFonts||(n._bitmapFonts={}),n._bitmapFonts[a]=b},n.unregisterBitmapFont=function(a,b){if(void 0===b&&(b=!0),n._bitmapFonts&&n._bitmapFonts[a]){var c=n._bitmapFonts[a];b&&c.destroy(),delete n._bitmapFonts[a]}},n.setTextRightToLeft=function(){var a;(a=M.canvas.source.style).display="none",a.position="absolute",a.direction="rtl",H._mainCanvas.source.style.direction="rtl",laya.display.Text.RightToLeft=!0,M.document.body.appendChild(M.canvas.source)},n.supportFont=function(a){M.context.font="10px sans-serif";var b=M.context.measureText("abcji").width;M.context.font="10px "+a;var c=M.context.measureText("abcji").width;return console.log(b,c),b!==c},n._testWord="游",n.langPacks=null,n.VISIBLE="visible",n.SCROLL="scroll",n.HIDDEN="hidden",n.CharacterCache=!0,n.RightToLeft=!1,n._bitmapFonts=null,i(n,["_fontFamilyMap",function(){return this._fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"}}]),n}(la),ra=function(l){function g(){this.focus=null,this.designWidth=0,this.designHeight=0,this.canvasRotation=!1,this.canvasDegree=0,this.renderingEnabled=!0,this.screenAdaptationEnabled=!0,this._screenMode="none",this._scaleMode="noscale",this._alignV="top",this._alignH="left",this._bgColor="black",this._mouseMoveTime=0,this._renderCount=0,this._frameStartTime=NaN,this._isFocused=!1,this._isVisibility=!1,this._scenes=null,this._frameRate="fast",g.__super.call(this),this.offset=new y,this._canvasTransform=new E,this._previousOrientation=M.window.orientation;var b=this;this.transform=E.create(),this._scenes=[],this.mouseEnabled=!0,this.hitTestPrior=!0,this.autoSize=!1,this._displayedInStage=!0,this._isFocused=!0,this._isVisibility=!0;var a=M.window,c=this;a.addEventListener("focus",function(){b._isFocused=!0,c.event("focus"),c.event("focuschange")}),a.addEventListener("blur",function(){b._isFocused=!1,c.event("blur"),c.event("focuschange"),c._isInputting()&&(va.inputElement.target.focus=!1)});var d="visibilityState",e="visibilitychange",f=a.document;void 0!==f.hidden?(e="visibilitychange",d="visibilityState"):void 0!==f.mozHidden?(e="mozvisibilitychange",d="mozVisibilityState"):void 0!==f.msHidden?(e="msvisibilitychange",d="msVisibilityState"):void 0!==f.webkitHidden&&(e="webkitvisibilitychange",d="webkitVisibilityState"),a.document.addEventListener(e,function(){"hidden"==M.document[d]?c._setStageVisible(!1):c._setStageVisible(!0)}),a.document.addEventListener("qbrowserVisibilityChange",function(a){c._setStageVisible(!a.hidden)}),a.addEventListener("resize",function(){var a=M.window.orientation;null!=a&&a!=b._previousOrientation&&c._isInputting()&&(va.inputElement.target.focus=!1),b._previousOrientation=a,c._isInputting()||c._resetCanvas()}),a.addEventListener("orientationchange",function(a){c._resetCanvas()}),this.on("mousemove",this,this._onmouseMove),M.onMobile&&this.on("mousedown",this,this._onmouseMove)}p(g,"laya.display.Stage",l);var a=g.prototype;return a._setStageVisible=function(a){this._isVisibility!=a&&(this._isVisibility=a,this._isVisibility||this._isInputting()&&(va.inputElement.target.focus=!1),this.event("visibilitychange"))},a._isInputting=function(){return M.onMobile&&va.isInputting},a._changeCanvasSize=function(){this.setScreenSize(M.clientWidth*M.pixelRatio,M.clientHeight*M.pixelRatio)},a._resetCanvas=function(){if(this.screenAdaptationEnabled){var a=H._mainCanvas;a.source.style;a.size(1,1),x.timer.once(100,this,this._changeCanvasSize)}},a.setScreenSize=function(a,b){var c=!1;if("none"!==this._screenMode&&(c=(a/b<1?"vertical":"horizontal")!==this._screenMode)){var d=b;b=a,a=d}this.canvasRotation=c;var e=H._mainCanvas,f=e.source.style,g=this._canvasTransform.identity(),h=this._scaleMode,i=a/this.designWidth,j=b/this.designHeight,k=this.designWidth,l=this.designHeight,m=a,n=b,o=M.pixelRatio;switch(this._width=this.designWidth,this._height=this.designHeight,h){case"noscale":i=j=1,m=this.designWidth,n=this.designHeight;break;case"showall":i=j=Math.min(i,j),k=m=Math.round(this.designWidth*i),l=n=Math.round(this.designHeight*j);break;case"noborder":i=j=Math.max(i,j),m=Math.round(this.designWidth*i),n=Math.round(this.designHeight*j);break;case"full":i=j=1,this._width=k=a,this._height=l=b;break;case"fixedwidth":j=i,this._height=l=Math.round(b/i);break;case"fixedheight":i=j,this._width=k=Math.round(a/j);break;case"fixedauto":a/b<this.designWidth/this.designHeight?(j=i,this._height=l=Math.round(b/i)):(i=j,this._width=k=Math.round(a/j))}this._height=this._height+1&2147483646,this._width=this._width+1&2147483646,k=k+1&2147483646,l=l+1&2147483646,this.conchModel&&this.conchModel.size(this._width,this._height),i*=this.scaleX,j*=this.scaleY,1===i&&1===j?this.transform.identity():(this.transform.a=this._formatData(i/(m/k)),this.transform.d=this._formatData(j/(n/l)),this.conchModel&&this.conchModel.scale(this.transform.a,this.transform.d)),e.size(k,l),D.changeWebGLSize(k,l),g.scale(m/k/o,n/l/o),"left"===this._alignH?this.offset.x=0:"right"===this._alignH?this.offset.x=(a-m)/o:this.offset.x=.5*(a-m)/o,"top"===this._alignV?this.offset.y=0:"bottom"===this._alignV?this.offset.y=(b-n)/o:this.offset.y=.5*(b-n)/o,this.offset.x=Math.round(this.offset.x),this.offset.y=Math.round(this.offset.y),g.translate(this.offset.x,this.offset.y),this.canvasDegree=0,c&&("horizontal"===this._screenMode?(g.rotate(Math.PI/2),g.translate(b/o,0),this.canvasDegree=90):(g.rotate(-Math.PI/2),g.translate(0,a/o),this.canvasDegree=-90)),g.a=this._formatData(g.a),g.d=this._formatData(g.d),g.tx=this._formatData(g.tx),g.ty=this._formatData(g.ty),f.transformOrigin=f.webkitTransformOrigin=f.msTransformOrigin=f.mozTransformOrigin=f.oTransformOrigin="0px 0px 0px",f.transform=f.webkitTransform=f.msTransform=f.mozTransform=f.oTransform="matrix("+g.toString()+")",g.translate(parseInt(f.left)||0,parseInt(f.top)||0),this.visible=!0,this._repaint=1,this.event("resize")},a._formatData=function(a){return Math.abs(a)<1e-6?0:Math.abs(1-a)<.001?0<a?1:-1:a},a.getMousePoint=function(){return y.TEMP.setTo(this.mouseX,this.mouseY)},a.repaint=function(){this._repaint=1},a.parentRepaint=function(){},a._loop=function(){return this.render(H.context,0,0),!0},a._onmouseMove=function(a){this._mouseMoveTime=M.now()},a.getTimeFromFrameStart=function(){return M.now()-this._frameStartTime},a.render=function(a,b,c){if("sleep"===this._frameRate&&!H.isConchApp){var d=M.now();if(!(1e3<=d-this._frameStartTime))return this._renderCount++,void(this._renderCount%2==0&&(V.loopCount++,o.instance.runEvent(),x.timer._update()));this._frameStartTime=d}if(this._renderCount++,H.isFlash&&this.repaint(),this._style.visible){this._frameStartTime=M.now();var e="slow"!==("mouse"===this._frameRate?this._frameStartTime-this._mouseMoveTime<2e3?"fast":"slow":this._frameRate),f=this._renderCount%2==0;if(V.renderSlow=!e,e||f||H.isConchApp){var g;V.loopCount++,o.instance.runEvent(),x.timer._update(),D.update3DLoop();var h=0,i=0;if(H.isConchNode)for(h=0,i=this._scenes.length;h<i;h++)(g=this._scenes[h])&&g._updateSceneConch();else for(h=0,i=this._scenes.length;h<i;h++)(g=this._scenes[h])&&g._updateScene();if(H.isConchNode){var j=la.CustomList;for(h=0,i=j.length;h<i;h++){var k=j[h];k.customRender(k.customContext,0,0)}return}}H.isConchNode||this.renderingEnabled&&(e||!f||H.isConchWebGL)&&(H.isWebGL?(a.clear(),l.prototype.render.call(this,a,b,c),V._show&&V._sp&&V._sp.render(a,b,c),D.clear(this._bgColor),D.beginFlush(),a.flush(),D.endFinish(),Z.instance&&Z.getInstance().endDispose()):(D.clear(this._bgColor),l.prototype.render.call(this,a,b,c),V._show&&V._sp&&V._sp.render(a,b,c)))}else this._renderCount%5==0&&(V.loopCount++,o.instance.runEvent(),x.timer._update())},a._requestFullscreen=function(){var a=M.document.documentElement;a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen()},a._fullScreenChanged=function(){x.stage.event("fullscreenchange")},a.exitFullscreen=function(){var a=M.document;a.exitFullscreen?a.exitFullscreen():a.mozCancelFullScreen?a.mozCancelFullScreen():a.webkitExitFullscreen&&a.webkitExitFullscreen()},k(0,a,"clientScaleX",function(){return this._transform?this._transform.getScaleX():1}),k(0,a,"desginHeight",function(){return console.debug("desginHeight已经弃用，请使用designHeight代替"),this.designHeight}),k(0,a,"frameRate",function(){return this._frameRate},function(a){if(this._frameRate=a,H.isConchApp)switch(this._frameRate){case"slow":M.window.conch&&M.window.conchConfig.setSlowFrame&&M.window.conchConfig.setSlowFrame(!0);break;case"fast":M.window.conch&&M.window.conchConfig.setSlowFrame&&M.window.conchConfig.setSlowFrame(!1);break;case"mouse":M.window.conch&&M.window.conchConfig.setMouseFrame&&M.window.conchConfig.setMouseFrame(2e3);break;case"sleep":M.window.conch&&M.window.conchConfig.setLimitFPS&&M.window.conchConfig.setLimitFPS(1);break;default:throw new Error("Stage:frameRate invalid.")}}),k(0,a,"clientScaleY",function(){return this._transform?this._transform.getScaleY():1}),k(0,a,"width",l.prototype._$get_width,function(a){this.designWidth=a,x.superSet(la,this,"width",a),x.timer.callLater(this,this._changeCanvasSize)}),k(0,a,"alignH",function(){return this._alignH},function(a){this._alignH=a,x.timer.callLater(this,this._changeCanvasSize)}),k(0,a,"isFocused",function(){return this._isFocused}),k(0,a,"height",l.prototype._$get_height,function(a){this.designHeight=a,x.superSet(la,this,"height",a),x.timer.callLater(this,this._changeCanvasSize)}),k(0,a,"transform",function(){return this._tfChanged&&this._adjustTransform(),this._transform=this._transform||E.create()},l.prototype._$set_transform),k(0,a,"isVisibility",function(){return this._isVisibility}),k(0,a,"desginWidth",function(){return console.debug("desginWidth已经弃用，请使用designWidth代替"),this.designWidth}),k(0,a,"scaleMode",function(){return this._scaleMode},function(a){this._scaleMode=a,x.timer.callLater(this,this._changeCanvasSize)}),k(0,a,"alignV",function(){return this._alignV},function(a){this._alignV=a,x.timer.callLater(this,this._changeCanvasSize)}),k(0,a,"bgColor",function(){return this._bgColor},function(a){this._bgColor=a,this.conchModel&&this.conchModel.bgColor(a),H.isWebGL&&(a?g._wgColor=Q.create(a)._color:M.onMiniGame||(g._wgColor=null)),M.onLimixiu?g._wgColor=Q.create(a)._color:H.canvas.style.background=a||"none"}),k(0,a,"mouseX",function(){return Math.round(o.instance.mouseX/this.clientScaleX)}),k(0,a,"mouseY",function(){return Math.round(o.instance.mouseY/this.clientScaleY)}),k(0,a,"screenMode",function(){return this._screenMode},function(a){this._screenMode=a}),k(0,a,"visible",l.prototype._$get_visible,function(a){this.visible!==a&&(x.superSet(la,this,"visible",a),H._mainCanvas.source.style.visibility=a?"visible":"hidden")}),k(0,a,"fullScreenEnabled",null,function(a){var b=M.document,c=H.canvas;a?(c.addEventListener("mousedown",this._requestFullscreen),c.addEventListener("touchstart",this._requestFullscreen),b.addEventListener("fullscreenchange",this._fullScreenChanged),b.addEventListener("mozfullscreenchange",this._fullScreenChanged),b.addEventListener("webkitfullscreenchange",this._fullScreenChanged),b.addEventListener("msfullscreenchange",this._fullScreenChanged)):(c.removeEventListener("mousedown",this._requestFullscreen),c.removeEventListener("touchstart",this._requestFullscreen),b.removeEventListener("fullscreenchange",this._fullScreenChanged),b.removeEventListener("mozfullscreenchange",this._fullScreenChanged),b.removeEventListener("webkitfullscreenchange",this._fullScreenChanged),b.removeEventListener("msfullscreenchange",this._fullScreenChanged))}),g.SCALE_NOSCALE="noscale",g.SCALE_EXACTFIT="exactfit",g.SCALE_SHOWALL="showall",g.SCALE_NOBORDER="noborder",g.SCALE_FULL="full",g.SCALE_FIXED_WIDTH="fixedwidth",g.SCALE_FIXED_HEIGHT="fixedheight",g.SCALE_FIXED_AUTO="fixedauto",g.ALIGN_LEFT="left",g.ALIGN_RIGHT="right",g.ALIGN_CENTER="center",g.ALIGN_TOP="top",g.ALIGN_MIDDLE="middle",g.ALIGN_BOTTOM="bottom",g.SCREEN_NONE="none",g.SCREEN_HORIZONTAL="horizontal",g.SCREEN_VERTICAL="vertical",g.FRAME_FAST="fast",g.FRAME_SLOW="slow",g.FRAME_MOUSE="mouse",g.FRAME_SLEEP="sleep",g.FRAME_MOUSE_THREDHOLD=2e3,i(g,["_wgColor",function(){return this._wgColor=[0,0,0,1]}]),g}(la),sa=(function(a){function b(){this.url=null,this._channel=null,this._tar=null,this._playEvents=null,this._stopEvents=null,b.__super.call(this),this.visible=!1,this.on("added",this,this._onParentChange),this.on("removed",this,this._onParentChange)}p(b,"laya.media.SoundNode",la);var c=b.prototype;c._onParentChange=function(){this.target=this.parent},c.play=function(a,b){void 0===a&&(a=1),isNaN(a)&&(a=1),this.url&&(this.stop(),this._channel=C.playSound(this.url,a,null,b))},c.stop=function(){this._channel&&!this._channel.isStopped&&this._channel.stop(),this._channel=null},c._setPlayAction=function(a,b,c,d){void 0===d&&(d=!0),this[c]&&a&&(d?a.on(b,this,this[c]):a.off(b,this,this[c]))},c._setPlayActions=function(a,b,c,d){if(void 0===d&&(d=!0),a&&b){var e,f=b.split(","),g=0;for(e=f.length,g=0;g<e;g++)this._setPlayAction(a,f[g],c,d)}},k(0,c,"playEvent",null,function(a){(this._playEvents=a)&&this._tar&&this._setPlayActions(this._tar,a,"play")}),k(0,c,"target",null,function(a){this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!1),this._setPlayActions(this._tar,this._stopEvents,"stop",!1)),this._tar=a,this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!0),this._setPlayActions(this._tar,this._stopEvents,"stop",!0))}),k(0,c,"stopEvent",null,function(a){(this._stopEvents=a)&&this._tar&&this._setPlayActions(this._tar,a,"stop")})}(),function(a){function b(){this._src=null,this._onload=null,this._onerror=null,b.__super.call(this)}p(b,"laya.resource.FileBitmap",oa);var c=b.prototype;return k(0,c,"src",function(){return this._src},function(a){this._src=a}),k(0,c,"onload",null,function(a){}),k(0,c,"onerror",null,function(a){}),b}()),ta=function(a){function c(a,b){this._is2D=!1,c.__super.call(this);var d=this;if(this._source=this,"2D"===a||"AUTO"===a&&!H.isWebGL){this._is2D=!0,this._source=b||M.createElement("canvas"),this._w=this._source.width,this._h=this._source.height;var e=this;e.getContext=function(a,b){if(d._ctx)return d._ctx;var c=d._ctx=d._source.getContext(a,b);return c&&(c._canvas=e,H.isFlash||M.onLimixiu||(c.size=function(a,b){})),c}}this.uri="HTMLCanvas_"+this.id,this.lock=!0}p(c,"laya.resource.HTMLCanvas",oa);var b=c.prototype;return b.clear=function(){this._ctx&&this._ctx.clear()},b.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},b.release=function(){},b._setContext=function(a){this._ctx=a},b.getContext=function(a,b){return this._ctx?this._ctx:this._ctx=c._createContext(this)},b.getMemSize=function(){return 0},b.size=function(a,b){(this._w!=a||this._h!=b||this._source&&(this._source.width!=a||this._source.height!=b))&&(this._w=a,this._h=b,this.memorySize=this._w*this._h*4,this._ctx&&this._ctx.size(a,b),this._source&&(this._source.height=b,this._source.width=a))},b.getCanvas=function(){return this._source},b.toBase64=function(a,b,c){if(this._source)if(H.isConchApp&&this._source.toBase64)this._source.toBase64(a,b,c);else{var d=this._source.toDataURL(a,b);c.call(this,d)}},k(0,b,"context",function(){return this._ctx}),k(0,b,"asBitmap",null,function(a){}),c.create=function(a,b){return new c(a,b)},c.TYPE2D="2D",c.TYPE3D="3D",c.TYPEAUTO="AUTO",c._createContext=null,c}(),ua=(function(a){function i(a,b,c,d,e,f,g,h){throw i.__super.call(this),new Error("不允许new！")}p(i,"laya.resource.HTMLSubImage",oa),i.create=function(a,b,c,d,e,f,g,h){return void 0===h&&(h=!1),new i(a,b,c,d,e,f,g,h)}}(),function(a){function l(){this._frames=null,this._url=null,l.__super.call(this),this._setControlNode(this)}p(l,"laya.display.Animation",a);var b=l.prototype;b.destroy=function(a){void 0===a&&(a=!0),this.stop(),laya.display.Sprite.prototype.destroy.call(this,a),this._frames=null,this._labels=null},b.play=function(a,b,c,d){void 0===a&&(a=0),void 0===b&&(b=!0),void 0===c&&(c=""),void 0===d&&(d=!0),c&&this._setFramesFromCache(c,d),this._isPlaying=!0,this.index="string"==typeof a?this._getFrameByLabel(a):a,this.loop=b,this._actionName=c,this._isReverse=1==this.wrapMode,this._frames&&0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},b._setFramesFromCache=function(a,b){var c;return void 0===b&&(b=!1),this._url&&(a=this._url+"#"+a),a&&l.framesMap[a]?((c=l.framesMap[a])instanceof Array?(this._frames=l.framesMap[a],this._count=this._frames.length):(c.nodeRoot&&(l.framesMap[a]=this._parseGraphicAnimationByData(c),c=l.framesMap[a]),this._frames=c.frames,this._count=this._frames.length,this._frameRateChanged||(this._interval=c.interval),this._labels=this._copyLabels(c.labels)),!0):(b&&console.log("ani not found:",a),!1)},b._copyLabels=function(a){if(!a)return null;var b,c;for(c in b={},a)b[c]=Y.copyArray([],a[c]);return b},b._frameLoop=function(){this._style.visible&&.01<this._style.alpha&&a.prototype._frameLoop.call(this)},b._displayToIndex=function(a){this._frames&&(this.graphics=this._frames[a])},b.clear=function(){this.stop(),this.graphics=null,this._frames=null,this._labels=null},b.loadImages=function(a,b){return void 0===b&&(b=""),this._url="",this._setFramesFromCache(b)||(this.frames=l.framesMap[b]?l.framesMap[b]:l.createFrames(a,b)),this},b.loadAtlas=function(b,c,d){void 0===d&&(d=""),this._url="";var e=this;function a(a){b===a&&(e.frames=l.framesMap[d]?l.framesMap[d]:l.createFrames(b,d),c&&c.run())}return e._setFramesFromCache(d)||(ha.getAtlas(b)?a(b):x.loader.load(b,s.create(null,a,[b]),null,"atlas")),this},b.loadAnimation=function(a,b,c){this._url=a;return this._actionName||(this._actionName=""),this._setFramesFromCache("")?(this._setFramesFromCache(this._actionName,!0),this.index=0,b&&b.run()):!c||ha.getAtlas(c)?this._loadAnimationData(a,b,c):x.loader.load(c,s.create(this,this._loadAnimationData,[a,b,c]),null,"atlas"),this},b._loadAnimationData=function(h,i,a){var j=this;if(!a||ha.getAtlas(a)){var k=this;ha.getRes(h)?b(h):x.loader.load(h,s.create(null,b,[h]),null,"json"),ha.clearRes(h)}else console.warn("atlas load fail:"+a);function b(a){if(ha.getRes(a)&&h===a){var b;if(l.framesMap[h+"#"])k._setFramesFromCache(j._actionName,!0),j.index=0,j._checkResumePlaying();else{var c=k._parseGraphicAnimation(ha.getRes(h));if(!c)return;var d,e=c.animationList,f=0,g=e.length;for(f=0;f<g;f++)b=e[f],l.framesMap[h+"#"+b.name]=b,d||(d=b);d&&(l.framesMap[h+"#"]=d,k._setFramesFromCache(j._actionName,!0),j.index=0),j._checkResumePlaying()}i&&i.run()}}},b._parseGraphicAnimation=function(a){return xa.parseAnimationData(a)},b._parseGraphicAnimationByData=function(a){return xa.parseAnimationByData(a)},k(0,b,"frames",function(){return this._frames},function(a){(this._frames=a)&&(this._count=a.length,this._isPlaying?this.play(this._index,this.loop,this._actionName):this.index=this._index)}),k(0,b,"autoPlay",null,function(a){a?this.play():this.stop()}),k(0,b,"source",null,function(a){-1<a.indexOf(".ani")?this.loadAnimation(a):-1<a.indexOf(".json")||-1<a.indexOf("als")||-1<a.indexOf("atlas")?this.loadAtlas(a):this.loadImages(a.split(","))}),k(0,b,"autoAnimation",null,function(a){this.play(0,!0,a,!1)}),l.createFrames=function(a,b){var c,d,e=0,f=0;if("string"==typeof a){var g=ha.getAtlas(a);if(g&&g.length)for(c=[],e=0,f=g.length;e<f;e++)(d=new D.createGraphics).drawTexture(ha.getRes(g[e]),0,0),c.push(d)}else if(a instanceof Array)for(c=[],e=0,f=a.length;e<f;e++)(d=new D.createGraphics).loadImage(a[e],0,0),c.push(d);return b&&(l.framesMap[b]=c),c},l.clearCache=function(a){var b,c=l.framesMap,d=a+"#";for(b in c)b!==a&&0!=b.indexOf(d)||delete l.framesMap[b]},l.framesMap={}}(pa),function(a){function f(){this._targetDic=null,this._animationData=null,this._animationNewFrames=null,f.__super.call(this),null==f._sortIndexFun&&(f._sortIndexFun=w.sortByKey("index",!1,!0))}p(f,"laya.display.FrameAnimation",a);var b=f.prototype;return b._setUp=function(a,b){this._labels=null,this._animationNewFrames=null,this._targetDic=a,this._animationData=b,this.interval=1e3/b.frameRate,b.parsed?(this._count=b.count,this._labels=b.labels,this._animationNewFrames=b.animationNewFrames):(this._animationNewFrames=[],this._calculateDatas()),b.parsed=!0,b.labels=this._labels,b.count=this._count,b.animationNewFrames=this._animationNewFrames},b.clear=function(){a.prototype.clear.call(this),this._targetDic=null,this._animationData=null},b._displayToIndex=function(a){if(this._animationData){a<0&&(a=0),a>this._count&&(a=this._count);var b=this._animationData.nodes,c=0,d=b.length;for(c=0;c<d;c++)this._displayNodeToFrame(b[c],a)}},b._displayNodeToFrame=function(a,b,c){c||(c=this._targetDic);var d=c[a.target];if(d){var e,f,g,h=a.frames,i=a.keys,j=0,k=i.length;for(j=0;j<k;j++)g=(f=h[e=i[j]]).length>b?f[b]:f[f.length-1],d[e]=g}},b._calculateDatas=function(){if(this._animationData){var a,b=this._animationData.nodes,c=0,d=b.length;for(c=this._count=0;c<d;c++)a=b[c],this._calculateNodeKeyFrames(a);this._count+=1}},b._calculateNodeKeyFrames=function(a){var b,c,d=a.keyframes,e=a.target;for(b in a.frames||(a.frames={}),a.keys?a.keys.length=0:a.keys=[],a.initValues||(a.initValues={}),d)c=d[b],a.frames[b]||(a.frames[b]=[]),this._targetDic&&this._targetDic[e]&&(a.initValues[b]=this._targetDic[e][b]),c.sort(f._sortIndexFun),a.keys.push(b),this._calculateNodePropFrames(c,a.frames[b],b,e)},b.resetToInitState=function(){if(this._targetDic&&this._animationData){var a,b,c=this._animationData.nodes,d=0,e=c.length;for(d=0;d<e;d++)if(b=(a=c[d]).initValues){var f,g=this._targetDic[a.target];if(g)for(f in b)g[f]=b[f]}}},b._calculateNodePropFrames=function(a,b,c,d){var e=0,f=a.length-1;if(0<f){for(b.length=a[f].index+1,e=0;e<f;e++)this._dealKeyFrame(a[e]),this._calculateFrameValues(a[e],a[e+1],b);this._dealKeyFrame(a[e])}0==f&&(b[a[0].index]=a[0].value,this._animationNewFrames&&(this._animationNewFrames[a[0].index]=!0))},b._dealKeyFrame=function(a){a.label&&""!=a.label&&this.addLabel(a.label,a.index)},b._calculateFrameValues=function(a,b,c){var d,e=0,f=a.index,g=b.index,h=a.value,i=b.value-a.value,j=g-f;if(g>this._count&&(this._count=g),a.tween)for(null==(d=S[a.tweenMethod])&&(d=S.linearNone),e=f;e<g;e++)c[e]=d(e-f,h,i,j),this._animationNewFrames&&(this._animationNewFrames[e]=!0);else for(e=f;e<g;e++)c[e]=h;this._animationNewFrames&&(this._animationNewFrames[a.index]=!0,this._animationNewFrames[b.index]=!0),c[b.index]=b.value},f._sortIndexFun=null,f}(pa)),va=function(b){function e(){this._focus=!1,this._multiline=!1,this._editable=!0,this._restrictPattern=null,this._type="text",this._prompt="",this._promptColor="#A9A9A9",this._originColor="#000000",this._content="",e.__super.call(this),this._maxChars=1e5,this._width=100,this._height=20,this.multiline=!1,this.overflow=qa.SCROLL,this.on("mousedown",this,this._onMouseDown),this.on("undisplay",this,this._onUnDisplay)}p(e,"laya.display.Input",b);var a=e.prototype;return a.setSelection=function(a,b){this.focus=!0,laya.display.Input.inputElement.selectionStart=a,laya.display.Input.inputElement.selectionEnd=b},a._onUnDisplay=function(a){this.focus=!1},a._onMouseDown=function(a){this.focus=!0},a._syncInputTransform=function(){var a=this.nativeInput,b=Y.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]),c=this._width-this.padding[1]-this.padding[3],d=this._height-this.padding[0]-this.padding[2];H.isConchApp?(a.setScale(b.scaleX,b.scaleY),a.setSize(c,d),a.setPos(b.x,b.y)):(e.inputContainer.style.transform=e.inputContainer.style.webkitTransform="scale("+b.scaleX+","+b.scaleY+") rotate("+x.stage.canvasDegree+"deg)",a.style.width=c+"px",a.style.height=d+"px",e.inputContainer.style.left=b.x+"px",e.inputContainer.style.top=b.y+"px")},a.select=function(){this.nativeInput&&this.nativeInput.select&&this.nativeInput.select()},a._setInputMethod=function(){e.input.parentElement&&e.inputContainer.removeChild(e.input),e.area.parentElement&&e.inputContainer.removeChild(e.area),e.inputElement=this._multiline?e.area:e.input,e.inputContainer.appendChild(e.inputElement),qa.RightToLeft&&(e.inputElement.style.direction="rtl")},a._focusIn=function(){laya.display.Input.isInputting=!0;var a=this.nativeInput;this._focus=!0;var b=a.style;b.whiteSpace=this.wordWrap?"pre-wrap":"nowrap",this._setPromptColor(),a.readOnly=!this._editable,H.isConchApp&&(a.setType(this._type),a.setForbidEdit(!this._editable)),a.maxLength=this._maxChars;this.padding;if(a.type=this._type,a.value=this._content,a.placeholder=this._prompt,x.stage.off("keydown",this,this._onKeyDown),x.stage.on("keydown",this,this._onKeyDown),(x.stage.focus=this).event("focus"),M.onPC&&a.focus(),!M.onMiniGame){this._text;this._text=null}this.typeset(),a.setColor(this._originColor),a.setFontSize(this.fontSize),a.setFontFace(M.onIPhone&&qa._fontFamilyMap[this.font]||this.font),H.isConchApp&&a.setMultiAble&&a.setMultiAble(this._multiline),b.lineHeight=this.leading+this.fontSize+"px",b.fontStyle=this.italic?"italic":"normal",b.fontWeight=this.bold?"bold":"normal",b.textAlign=this.align,b.padding="0 0",this._syncInputTransform(),!H.isConchApp&&M.onPC&&x.timer.frameLoop(1,this,this._syncInputTransform)},a._setPromptColor=function(){(e.promptStyleDOM=M.getElementById("promptStyle"))||((e.promptStyleDOM=M.createElement("style")).setAttribute("id","promptStyle"),M.document.head.appendChild(e.promptStyleDOM)),e.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {color:"+this._promptColor+"}input:-moz-placeholder, textarea:-moz-placeholder {color:"+this._promptColor+"}input::-moz-placeholder, textarea::-moz-placeholder {color:"+this._promptColor+"}input:-ms-input-placeholder, textarea:-ms-input-placeholder {color:"+this._promptColor+"}"},a._focusOut=function(){laya.display.Input.isInputting=!1,this._focus=!1,this._text=null,this._content=this.nativeInput.value,this._content?(x.superSet(qa,this,"text",this._content),x.superSet(qa,this,"color",this._originColor)):(x.superSet(qa,this,"text",this._prompt),x.superSet(qa,this,"color",this._promptColor)),x.stage.off("keydown",this,this._onKeyDown),x.stage.focus=null,this.event("blur"),H.isConchApp&&this.nativeInput.blur(),M.onPC&&x.timer.clear(this,this._syncInputTransform)},a._onKeyDown=function(a){13===a.keyCode&&(M.onMobile&&!this._multiline&&(this.focus=!1),this.event("enter"))},a.changeText=function(a){this._content=a,this._focus?(this.nativeInput.value=a||"",this.event("change")):b.prototype.changeText.call(this,a)},k(0,a,"color",b.prototype._$get_color,function(a){this._focus&&this.nativeInput.setColor(a),x.superSet(qa,this,"color",this._content?a:this._promptColor),this._originColor=a}),k(0,a,"inputElementYAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。"),0},function(a){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。")}),k(0,a,"multiline",function(){return this._multiline},function(a){this._multiline=a,this.valign=a?"top":"middle"}),k(0,a,"maxChars",function(){return this._maxChars},function(a){a<=0&&(a=1e5),this._maxChars=a}),k(0,a,"text",function(){return this._focus?this.nativeInput.value:this._content||""},function(a){x.superSet(qa,this,"color",this._originColor),a+="",this._focus?(this.nativeInput.value=a||"",this.event("change")):(this._multiline||(a=a.replace(/\r?\n/g,"")),(this._content=a)?x.superSet(qa,this,"text",a):(x.superSet(qa,this,"text",this._prompt),x.superSet(qa,this,"color",this.promptColor)))}),k(0,a,"nativeInput",function(){return this._multiline?e.area:e.input}),k(0,a,"prompt",function(){return this._prompt},function(a){!this._text&&a&&x.superSet(qa,this,"color",this._promptColor),this.promptColor=this._promptColor,this._text?x.superSet(qa,this,"text",this._text==this._prompt?a:this._text):x.superSet(qa,this,"text",a),this._prompt=qa.langPacks&&qa.langPacks[a]?qa.langPacks[a]:a}),k(0,a,"focus",function(){return this._focus},function(a){var b=this.nativeInput;this._focus!==a&&(a?(b.target?b.target._focusOut():this._setInputMethod(),(b.target=this)._focusIn()):(b.target=null,this._focusOut(),M.document.body.scrollTop=0,b.blur(),H.isConchApp?b.setPos(-1e4,-1e4):e.inputContainer.contains(b)&&e.inputContainer.removeChild(b)))}),k(0,a,"restrict",function(){return this._restrictPattern?this._restrictPattern.source:""},function(a){a?(-1<(a="[^"+a+"]").indexOf("^^")&&(a=a.replace("^^","")),this._restrictPattern=new RegExp(a,"g")):this._restrictPattern=null}),k(0,a,"editable",function(){return this._editable},function(a){this._editable=a,H.isConchApp&&e.input.setForbidEdit(!a)}),k(0,a,"promptColor",function(){return this._promptColor},function(a){this._promptColor=a,this._content||x.superSet(qa,this,"color",a)}),k(0,a,"type",function(){return this._type},function(a){this._getCSSStyle().password="password"==a,this._type=a,H.isConchApp&&this.nativeInput.setType(a)}),k(0,a,"inputElementXAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。"),0},function(a){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。")}),k(0,a,"asPassword",function(){return this._getCSSStyle().password},function(a){this._getCSSStyle().password=a,this._type="password",console.warn('deprecated: 使用type="password"替代设置asPassword, asPassword将在下次重大更新时删去'),this.isChanged=!0}),e.__init__=function(){e._createInputElement(),M.onMobile&&H.canvas.addEventListener(e.IOS_IFRAME?M.onMiniGame?"touchend":"click":"touchend",e._popupInputMethod)},e._popupInputMethod=function(a){laya.display.Input.isInputting&&laya.display.Input.inputElement.focus()},e._createInputElement=function(){e._initInput(e.area=M.createElement("textarea")),e._initInput(e.input=M.createElement("input")),(e.inputContainer=M.createElement("div")).style.position="absolute",e.inputContainer.style.zIndex=1e5,M.container.appendChild(e.inputContainer),e.inputContainer.setPos=function(a,b){e.inputContainer.style.left=a+"px",e.inputContainer.style.top=b+"px"}},e._initInput=function(b){var a=b.style;a.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;",a.resize="none",a.backgroundColor="transparent",a.border="none",a.outline="none",a.zIndex=1,b.addEventListener("input",e._processInputting),b.addEventListener("mousemove",e._stopEvent),b.addEventListener("mousedown",e._stopEvent),b.addEventListener("touchmove",e._stopEvent),b.setFontFace=function(a){b.style.fontFamily=a},H.isConchApp||(b.setColor=function(a){b.style.color=a},b.setFontSize=function(a){b.style.fontSize=a+"px"})},e._processInputting=function(a){var b=laya.display.Input.inputElement.target;if(b){var c=laya.display.Input.inputElement.value;b._restrictPattern&&(c=c.replace(/\u2006|\x27/g,""),b._restrictPattern.test(c)&&(c=c.replace(b._restrictPattern,""),laya.display.Input.inputElement.value=c)),b._text=c,b.event("input")}},e._stopEvent=function(a){"touchmove"==a.type&&a.preventDefault(),a.stopPropagation&&a.stopPropagation()},e.TYPE_TEXT="text",e.TYPE_PASSWORD="password",e.TYPE_EMAIL="email",e.TYPE_URL="url",e.TYPE_NUMBER="number",e.TYPE_RANGE="range",e.TYPE_DATE="date",e.TYPE_MONTH="month",e.TYPE_WEEK="week",e.TYPE_TIME="time",e.TYPE_DATE_TIME="datetime",e.TYPE_DATE_TIME_LOCAL="datetime-local",e.TYPE_SEARCH="search",e.input=null,e.area=null,e.inputElement=null,e.inputContainer=null,e.confirmButton=null,e.promptStyleDOM=null,e.inputHeight=45,e.isInputting=!1,e.stageMatrix=null,i(e,["IOS_IFRAME",function(){return this.IOS_IFRAME=M.onIOS&&M.window.top!=M.window.self}]),e}(qa),wa=function(a){function c(a,b){this._recreateLock=!1,this._needReleaseAgain=!1,this._enableMerageInAtlas=!0,c.__super.call(this),a&&this._init_(a,b)}p(c,"laya.resource.HTMLImage",sa);var b=c.prototype;return b._init_=function(a,b){this._src=a,this._source=new M.window.Image,b&&(b.onload&&(this.onload=b.onload),b.onerror&&(this.onerror=b.onerror),b.onCreate&&b.onCreate(this)),0!=a.indexOf("data:image")&&(this._source.crossOrigin=""),a&&(this._source.src=a)},b.recreateResource=function(){var a=this;if(""===this._src)throw new Error("src no null！");if(this._needReleaseAgain=!1,this._source){if(this._recreateLock)return;this.memorySize=this._w*this._h*4,this._recreateLock=!1,this.completeCreate()}else{this._recreateLock=!0;var b=this;this._source=new M.window.Image,this._source.crossOrigin="",this._source.onload=function(){if(b._needReleaseAgain)return b._needReleaseAgain=!1,b._source.onload=null,void(b._source=null);b._source.onload=null,b.memorySize=a._w*a._h*4,b._recreateLock=!1,b.completeCreate()},this._source.src=this._src}},b.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(this._source=null,this.memorySize=0)},b.onresize=function(){this._w=this._source.width,this._h=this._source.height},k(0,b,"onload",null,function(a){var b=this;this._onload=a,this._source&&(this._source.onload=null!=this._onload?function(){b.onresize(),b._onload()}:null)}),k(0,b,"onerror",null,function(a){var b=this;this._onerror=a,this._source&&(this._source.onerror=null!=this._onerror?function(){b._onerror()}:null)}),k(0,b,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(a){this._enableMerageInAtlas=a,H.isConchApp&&this._source&&(this._source.enableMerageInAtlas=a)}),c.create=function(a,b){return new c(a,b)},c}(),xa=(function(f){function a(){this._target=null,this._playEvents=null,this._initData={},this._aniKeys=null,this._effectClass=null,a.__super.call(this)}p(a,"laya.display.EffectAnimation",f);var b=a.prototype;b._onOtherBegin=function(a){a!=this&&this.stop()},b.addEvent=function(){this._target&&this._playEvents&&(this._setControlNode(this._target),this._target.on(this._playEvents,this,this._onPlayAction))},b._onPlayAction=function(){this.play(0,!1)},b.play=function(a,b,c,d){void 0===a&&(a=0),void 0===b&&(b=!0),void 0===c&&(c=""),void 0===d&&(d=!0),this._target&&(this._target.event("effectanimationbegin",[this]),this._recordInitData(),laya.display.AnimationPlayerBase.prototype.play.call(this,a,b,c,d))},b._recordInitData=function(){if(this._aniKeys){var a,b,c=0;for(a=this._aniKeys.length,c=0;c<a;c++)b=this._aniKeys[c],this._initData[b]=this._target[b]}},b._displayToIndex=function(a){if(this._animationData){a<0&&(a=0),a>this._count&&(a=this._count);var b=this._animationData.nodes,c=0,d=b.length;for(d=1<d?1:d,c=0;c<d;c++)this._displayNodeToFrame(b[c],a)}},b._displayNodeToFrame=function(a,b,c){if(this._target){var d;d=this._target;var e,f,g,h,i=a.frames,j=a.keys,k=0,l=j.length;h=a.secondFrames;var m,n,o,p,q=0;for(k=0;k<l;k++)f=i[e=j[k]],g=-1==(q=h[e])?this._initData[e]:b<q?(o=(n=a.keyframes[e])[0]).tween?(null==(m=S[o.tweenMethod])&&(m=S.linearNone),p=n[1],m(b,this._initData[e],p.value-this._initData[e],p.index)):this._initData[e]:f.length>b?f[b]:f[f.length-1],d[e]=g}},b._calculateNodeKeyFrames=function(a){f.prototype._calculateNodeKeyFrames.call(this,a);var b,c,d,e=a.keyframes;a.target;for(b in d={},a.secondFrames=d,e)(c=e[b]).length<=1?d[b]=-1:d[b]=c[1].index},k(0,b,"target",function(){return this._target},function(a){this._target&&this._target.off("effectanimationbegin",this,this._onOtherBegin),this._target=a,this._target&&this._target.on("effectanimationbegin",this,this._onOtherBegin),this.addEvent()}),k(0,b,"playEvent",null,function(a){(this._playEvents=a)&&this.addEvent()}),k(0,b,"effectData",null,function(a){var b;a&&((b=a.animations)&&b[0]&&(this._setUp({},b[0]),b[0].nodes&&b[0].nodes[0]&&(this._aniKeys=b[0].nodes[0].keys)))}),k(0,b,"effectClass",null,function(a){var b,c;(this._effectClass=P.getClass(a),this._effectClass)&&((b=this._effectClass.uiView)&&(c=b.animations)&&c[0]&&(this._setUp({},c[0]),c[0].nodes&&c[0].nodes[0]&&(this._aniKeys=c[0].nodes[0].keys)))}),a.EffectAnimationBegin="effectanimationbegin"}(ua),function(b){var B;function C(){this.animationList=null,this.animationDic=null,this._nodeList=null,this._nodeDefaultProps=null,this._gList=null,this._nodeIDAniDic={},this._rootNode=null,this._nodeGDic=null,C.__super.call(this)}p(C,"laya.utils.GraphicAnimation",b);var a=C.prototype;return a._parseNodeList=function(a){this._nodeList||(this._nodeList=[]),this._nodeDefaultProps[a.compId]=a.props,a.compId&&this._nodeList.push(a.compId);var b=a.child;if(b){var c=0,d=b.length;for(c=0;c<d;c++)this._parseNodeList(b[c])}},a._calGraphicData=function(a){var b;if(this._setUp(null,a),this._createGraphicData(),this._nodeIDAniDic)for(b in this._nodeIDAniDic)this._nodeIDAniDic[b]=null},a._createGraphicData=function(){var a,b=[],c=0,d=this.count,e=this._animationNewFrames;for(e||(e=[]),c=0;c<d;c++)!e[c]&&a||(a=this._createFrameGraphic(c)),b.push(a);this._gList=b},a._createFrameGraphic=function(a){var b=D.createGraphics();return C._rootMatrix||(C._rootMatrix=new E),this._updateNodeGraphic(this._rootNode,a,C._rootMatrix,b),b},a._updateNodeGraphic=function(a,b,c,d,e){var f;void 0===e&&(e=1);var g,h,i,j=(f=this._nodeGDic[a.compId]=this._getNodeGraphicData(a.compId,b,this._nodeGDic[a.compId])).alpha*e;if(!(j<.01)&&(f.resultTransform||(f.resultTransform=E.create()),g=f.resultTransform,E.mul(f.transform,c,g),f.skin&&(h=this._getTextureByUrl(f.skin))&&(g._checkTransform()?(d.drawTexture(h,0,0,f.width,f.height,g,j),f.resultTransform=null):d.drawTexture(h,g.tx,g.ty,f.width,f.height,null,j)),i=a.child)){var k,l=0;for(k=i.length,l=0;l<k;l++)this._updateNodeGraphic(i[l],b,g,d,j)}},a._updateNoChilds=function(a,b){if(a.skin){var c=this._getTextureByUrl(a.skin);if(c){var d=a.transform;d._checkTransform();!d.bTransform?b.drawTexture(c,d.tx,d.ty,a.width,a.height,null,a.alpha):b.drawTexture(c,0,0,a.width,a.height,d.clone(),a.alpha)}}},a._updateNodeGraphic2=function(a,b,c){var d;if(d=this._nodeGDic[a.compId]=this._getNodeGraphicData(a.compId,b,this._nodeGDic[a.compId]),a.child){var e=d.transform;e._checkTransform();var f,g;g=(f=!e.bTransform)&&(0!=e.tx||0!=e.ty);var h,i,j;if((h=e.bTransform||1!=d.alpha)&&c.save(),1!=d.alpha&&c.alpha(d.alpha),f?g&&c.translate(e.tx,e.ty):c.transform(e.clone()),i=a.child,d.skin&&(j=this._getTextureByUrl(d.skin))&&c.drawTexture(j,0,0,d.width,d.height),i){var k,l=0;for(k=i.length,l=0;l<k;l++)this._updateNodeGraphic2(i[l],b,c)}h?c.restore():f?g&&c.translate(-e.tx,-e.ty):c.transform(e.clone().invert())}else this._updateNoChilds(d,c)},a._calculateNodeKeyFrames=function(a){b.prototype._calculateNodeKeyFrames.call(this,a),this._nodeIDAniDic[a.target]=a},a.getNodeDataByID=function(a){return this._nodeIDAniDic[a]},a._getParams=function(a,b,c,d){var e=C._temParam;e.length=b.length;var f=0,g=b.length;for(f=0;f<g;f++)e[f]=this._getObjVar(a,b[f][0],c,b[f][1],d);return e},a._getObjVar=function(a,b,c,d,e){if(a.hasOwnProperty(b)){var f=a[b];if(c>=f.length&&(c=f.length-1),null!=a[b][c])return a[b][c]}return e.hasOwnProperty(b)?e[b]:d},a._getNodeGraphicData=function(a,b,c){c||(c=B.create()),c.transform?c.transform.identity():c.transform=E.create();var d=this.getNodeDataByID(a);if(!d)return c;var e,f,g=d.frames,h=this._getParams(g,C._drawTextureCmd,b,this._nodeDefaultProps[a]),i=h[0],j=NaN,k=NaN,l=h[5],m=h[6],n=h[13],o=h[14],p=h[7],q=h[8],r=h[9],s=h[11],t=h[12];j=h[3],k=h[4],0!=j&&0!=k||(i=null),-1==j&&(j=0),-1==k&&(k=0),c.skin=i,c.width=j,c.height=k,i&&((e=this._getTextureByUrl(i))?(j||(j=e.sourceWidth),k||(k=e.sourceHeight)):console.warn("lost skin:",i,",you may load pics first")),c.alpha=h[10],f=c.transform,0!=n&&(l=n*j),0!=o&&(m=o*k),0==l&&0==m||f.translate(-l,-m);var u=null;if(r||1!==p||1!==q||s||t){(u=C._tempMt).identity(),u.bTransform=!0;var v=.0174532922222222*(r-s),w=.0174532922222222*(r+t),x=Math.cos(w),y=Math.sin(w),z=Math.sin(v),A=Math.cos(v);u.a=p*x,u.b=p*y,u.c=-q*z,u.d=q*A,u.tx=u.ty=0}return u&&(f=E.mul(f,u,f)),f.translate(h[1],h[2]),c},a._getTextureByUrl=function(a){return ha.getRes(a)},a.setAniData=function(a,b){if(a.animations){this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=a,this._parseNodeList(a);var c,d={},e=[],f=a.animations,g=0,h=f.length;for(g=0;g<h;g++)if(c=f[g],this._labels=null,(!b||b==c.name)&&c){try{this._calGraphicData(c)}catch(a){console.warn("parse animation fail:"+c.name+",empty animation created"),this._gList=[]}var i={};i.interval=1e3/c.frameRate,i.frames=this._gList,i.labels=this._labels,i.name=c.name,e.push(i),d[c.name]=i}this.animationList=e,this.animationDic=d}C._temParam.length=0},a.parseByData=function(a){var b,c;b=a.nodeRoot,c=a.aniO,delete a.nodeRoot,delete a.aniO,this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=b,this._parseNodeList(b),this._labels=null;try{this._calGraphicData(c)}catch(a){console.warn("parse animation fail:"+c.name+",empty animation created"),this._gList=[]}var d=a;return d.interval=1e3/c.frameRate,d.frames=this._gList,d.labels=this._labels,d.name=c.name,d},a.setUpAniData=function(a){if(a.animations){var b,c={},d=[],e=a.animations,f=0,g=e.length;for(f=0;f<g;f++)if(b=e[f]){var h={};h.name=b.name,h.aniO=b,h.nodeRoot=a,d.push(h),c[b.name]=h}this.animationList=d,this.animationDic=c}},a._clear=function(){var a,b;if(this.animationList=null,this.animationDic=null,this._gList=null,this._nodeGDic)for(a in this._nodeGDic)(b=this._nodeGDic[a])&&b.recover();this._nodeGDic=null},C.parseAnimationByData=function(a){var b;return C._I||(C._I=new C),b=C._I.parseByData(a),C._I._clear(),b},C.parseAnimationData=function(a){var b;return C._I||(C._I=new C),C._I.setUpAniData(a),(b={}).animationList=C._I.animationList,b.animationDic=C._I.animationDic,C._I._clear(),b},C._drawTextureCmd=[["skin",null],["x",0],["y",0],["width",-1],["height",-1],["pivotX",0],["pivotY",0],["scaleX",1],["scaleY",1],["rotation",0],["alpha",1],["skewX",0],["skewY",0],["anchorX",0],["anchorY",0]],C._temParam=[],C._I=null,C._rootMatrix=null,i(C,["_tempMt",function(){return this._tempMt=new E}]),C.__init$=function(){B=function(){function a(){this.skin=null,this.transform=null,this.resultTransform=null,this.width=NaN,this.height=NaN,this.alpha=1}return p(a,""),a.prototype.recover=function(){this.skin=null,this.width=0,this.height=0,this.alpha=1,this.transform&&(this.transform.destroy(),this.transform=null),this.resultTransform&&(this.resultTransform.destroy(),this.resultTransform=null),U.recover("GraphicNode",this)},a.create=function(){return U.getItemByClass("GraphicNode",a)},a}()},C}(ua));x.__init([j,ia,H,M,W,A,a,xa])}(window,document,Laya),function(a,b,c){c.un,c.uns,c.static;var d=c.class;c.getset,c.__newvec;new(function(){function a(){}return d(a,"LayaMain"),a}())}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(a,b){"use strict";for(var c in Object.defineProperty(b,"__esModule",{value:!0}),Laya){var d=Laya[c];d&&d.__isclass&&(b[c]=d)}}),function(a,b,w){w.un,w.uns;var g=w.static,m=w.class,d=w.getset,f=w.__newvec,k=laya.maths.Arith,l=laya.maths.Bezier,c=laya.resource.Bitmap,n=laya.utils.Browser,i=laya.utils.Byte,o=laya.utils.Color,x=(laya.filters.ColorFilter,w.Config),e=laya.resource.Context,y=(laya.events.Event,laya.filters.Filter),h=laya.display.Graphics,j=laya.resource.HTMLCanvas,p=(laya.utils.HTMLChar,laya.resource.HTMLImage),q=laya.resource.HTMLSubImage,z=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),A=laya.maths.Point,B=laya.maths.Rectangle,r=laya.renders.Render,s=(laya.renders.RenderContext,laya.renders.RenderSprite),t=laya.resource.Resource,u=laya.resource.ResourceManager,v=laya.utils.RunDriver,C=laya.display.Sprite,D=laya.display.Stage,E=laya.utils.Stat,F=laya.utils.StringKey,G=(laya.display.css.Style,laya.system.System),H=laya.display.Text,I=laya.resource.Texture,J=(laya.display.css.TransformInfo,laya.net.URL,laya.utils.Utils),K=laya.utils.VectorGraphManager;laya.utils.WordText;w.interface("laya.webgl.shapes.IShape"),w.interface("laya.webgl.submit.ISubmit"),w.interface("laya.webgl.text.ICharSegment"),w.interface("laya.webgl.canvas.save.ISaveData"),w.interface("laya.webgl.resource.IMergeAtlasBitmap"),w.interface("laya.filters.IFilterActionGL","laya.filters.IFilterAction");var L=function(){function a(){}m(a,"laya.filters.webgl.FilterActionGL");var b=a.prototype;return w.imps(b,{"laya.filters.IFilterActionGL":!0}),b.setValue=function(a){},b.setValueMix=function(a){},b.apply3d=function(a,b,c,d,e){return null},b.apply=function(a){return null},d(0,b,"typeMix",function(){return 0}),a}(),M=function(){function a(){}return m(a,"laya.webgl.shader.ShaderValue"),a}(),N=function(){var d,e;function a(a,b,c){this._atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._failSize=new e,void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),this._cells=null,this._rowInfo=null,this._init(a,b),this._atlasID=c}m(a,"laya.webgl.atlas.AtlasGrid");var b=a.prototype;return b.getAltasID=function(){return this._atlasID},b.setAltasID=function(a){0<=a&&(this._atlasID=a)},b.addTex=function(a,b,c){var d=this._get(b,c);return 0==d.ret||(this._fill(d.x,d.y,b,c,a),this._texCount++),d},b._release=function(){null!=this._cells&&(this._cells.length=0,this._cells=null),this._rowInfo&&(this._rowInfo.length=0,this._rowInfo=null)},b._init=function(a,b){if(this._width=a,this._height=b,this._release(),0==this._width)return!1;this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=f(this._height);for(var c=0;c<this._height;c++)this._rowInfo[c]=new d;return this._clear(),!0},b._get=function(a,b){var c=new P;if(a>=this._failSize.width&&b>=this._failSize.height)return c;for(var d=-1,e=-1,f=this._width,g=this._height,h=this._cells,i=0;i<g;i++)if(!(this._rowInfo[i].spaceCount<a))for(var j=0;j<f;){var k=3*(i*f+j);if(0!=h[k]||h[1+k]<a||h[2+k]<b)j+=h[1+k];else{d=j,e=i;for(var l=0;l<a;l++)if(h[3*l+k+2]<b){d=-1;break}if(!(d<0))return c.ret=!0,c.x=d,c.y=e,c;j+=h[1+k]}}return c},b._fill=function(a,b,c,d,e){var f=this._width,g=this._height;this._check(a+c<=f&&b+d<=g);for(var h=b;h<d+b;++h){this._check(this._rowInfo[h].spaceCount>=c),this._rowInfo[h].spaceCount-=c;for(var i=0;i<c;i++){var j=3*(a+h*f+i);this._check(0==this._cells[j]),this._cells[j]=e,this._cells[1+j]=c,this._cells[2+j]=d}}if(0<a)for(h=0;h<d;++h){var k=0;for(i=a-1;0<=i&&0==this._cells[3*((b+h)*f+i)];--i,++k);for(i=k;0<i;--i)this._cells[3*((b+h)*f+a-i)+1]=i,this._check(0<i)}if(0<b)for(i=a;i<a+c;++i){for(k=0,h=b-1;0<=h&&0==this._cells[3*(i+h*f)];--h,k++);for(h=k;0<h;--h)this._cells[3*(i+(b-h)*f)+2]=h,this._check(0<h)}},b._check=function(a){0==a&&console.log("xtexMerger 错误啦")},b._clear=function(){for(var a=this._texCount=0;a<this._height;a++)this._rowInfo[a].spaceCount=this._width;for(var b=0;b<this._height;b++)for(var c=0;c<this._width;c++){var d=3*(b*this._width+c);this._cells[d]=0,this._cells[1+d]=this._width-c,this._cells[2+d]=this._width-b}this._failSize.width=this._width+1,this._failSize.height=this._height+1},a.__init$=function(){d=function(){function a(){this.spaceCount=0}return m(a,""),a}(),e=function(){function a(){this.width=0,this.height=0}return m(a,""),a}()},a}(),O=function(){function r(a,b,c,d){this._currentAtlasCount=0,this._maxAtlaserCount=0,this._width=0,this._height=0,this._gridSize=0,this._gridNumX=0,this._gridNumY=0,this._init=!1,this._curAtlasIndex=0,this._setAtlasParam=!1,this._atlaserArray=null,this._needGC=!1,this._setAtlasParam=!0,this._width=a,this._height=b,this._gridSize=c,this._maxAtlaserCount=d,this._gridNumX=a/c,this._gridNumY=b/c,this._curAtlasIndex=0,this._atlaserArray=[]}m(r,"laya.webgl.atlas.AtlasResourceManager");var a=r.prototype;return a.setAtlasParam=function(a,b,c,d){if(1==this._setAtlasParam)return r._sid_=0,this._width=a,this._height=b,this._gridSize=c,this._maxAtlaserCount=d,this._gridNumX=a/c,this._gridNumY=b/c,this._curAtlasIndex=0,this.freeAll(),!0;throw console.log("设置大图合集参数错误，只能在开始页面设置各种参数"),-1},a.pushData=function(a){var b,c=a.bitmap,d=-1,e=null,f=0,g=0;for(f=0,b=this._atlaserArray.length;f<b&&(g=(this._curAtlasIndex+f)%b,-1==(d=(e=this._atlaserArray[g]).findBitmapIsExist(c)));f++);if(-1!=d){var h=e.InAtlasWebGLImagesOffsetValue[d];return o=h[0],p=h[1],e.addToAtlas(a,o,p),!0}this._setAtlasParam=!1;for(var i=Math.ceil((a.bitmap.width+2)/this._gridSize),j=Math.ceil((a.bitmap.height+2)/this._gridSize),k=!1,l=0;l<2;l++){var m=this._maxAtlaserCount;for(f=0;f<m;f++){g=(this._curAtlasIndex+f)%m,this._atlaserArray.length-1>=g||this._atlaserArray.push(new Ba(this._gridNumX,this._gridNumY,this._width,this._height,r._sid_++));var n=this._atlaserArray[g],o=0,p=0,q=n.addTex(1,i,j);if(q.ret){o=q.x*this._gridSize+1,p=q.y*this._gridSize+1,c.lock=!0,n.addToAtlasTexture(c,o,p),n.addToAtlas(a,o,p),k=!0,this._curAtlasIndex=g;break}}if(k)break;this._atlaserArray.push(new Ba(this._gridNumX,this._gridNumY,this._width,this._height,r._sid_++)),this._needGC=!0,this.garbageCollection(),this._curAtlasIndex=this._atlaserArray.length-1}return k||console.log(">>>AtlasManager pushData error"),k},a.addToAtlas=function(a){laya.webgl.atlas.AtlasResourceManager.instance.pushData(a)},a.garbageCollection=function(){if(!0===this._needGC){for(var a=this._atlaserArray.length-this._maxAtlaserCount,b=0;b<a;b++)this._atlaserArray[b].dispose(),console.log("AtlasResourceManager:Dispose the inner Atlas。");console.log(">>>>altas garbageCollection ="+a),this._atlaserArray.splice(0,a),this._needGC=!1}return!0},a.freeAll=function(){for(var a=0,b=this._atlaserArray.length;a<b;a++)this._atlaserArray[a].dispose();this._atlaserArray.length=0,this._curAtlasIndex=0},a.getAtlaserCount=function(){return this._atlaserArray.length},a.getAtlaserByIndex=function(a){return this._atlaserArray[a]},d(1,r,"instance",function(){return r._Instance||(r._Instance=new r(laya.webgl.atlas.AtlasResourceManager.atlasTextureWidth,laya.webgl.atlas.AtlasResourceManager.atlasTextureHeight,16,laya.webgl.atlas.AtlasResourceManager.maxTextureCount)),r._Instance}),d(1,r,"enabled",function(){return x.atlasEnable}),d(1,r,"atlasLimitWidth",function(){return r._atlasLimitWidth},function(a){r._atlasLimitWidth=a}),d(1,r,"atlasLimitHeight",function(){return r._atlasLimitHeight},function(a){r._atlasLimitHeight=a}),r._enable=function(){x.atlasEnable=!0},r._disable=function(){x.atlasEnable=!1},r.__init__=function(){r.atlasTextureWidth=2048,r.atlasTextureHeight=2048,r.maxTextureCount=6,r.atlasLimitWidth=512,r.atlasLimitHeight=512},r._atlasLimitWidth=0,r._atlasLimitHeight=0,r.gridSize=16,r.atlasTextureWidth=0,r.atlasTextureHeight=0,r.maxTextureCount=0,r._atlasRestore=0,r.BOARDER_TYPE_NO=0,r.BOARDER_TYPE_RIGHT=1,r.BOARDER_TYPE_LEFT=2,r.BOARDER_TYPE_BOTTOM=4,r.BOARDER_TYPE_TOP=8,r.BOARDER_TYPE_ALL=15,r._sid_=0,r._Instance=null,r}(),P=function(){function a(){this.x=0,this.y=0,this.ret=!1,this.ret=!1,this.x=0,this.y=0}return m(a,"laya.webgl.atlas.MergeFillInfo"),a}(),Q=function(){function b(){}return m(b,"laya.webgl.canvas.BlendMode"),b._init_=function(a){b.fns=[b.BlendNormal,b.BlendAdd,b.BlendMultiply,b.BlendScreen,b.BlendOverlay,b.BlendLight,b.BlendMask,b.BlendDestinationOut],b.targetFns=[b.BlendNormalTarget,b.BlendAddTarget,b.BlendMultiplyTarget,b.BlendScreenTarget,b.BlendOverlayTarget,b.BlendLightTarget,b.BlendMask,b.BlendDestinationOut]},b.BlendNormal=function(a){a.blendFunc(1,771)},b.BlendAdd=function(a){a.blendFunc(1,772)},b.BlendMultiply=function(a){a.blendFunc(774,771)},b.BlendScreen=function(a){a.blendFunc(1,1)},b.BlendOverlay=function(a){a.blendFunc(1,769)},b.BlendLight=function(a){a.blendFunc(1,1)},b.BlendNormalTarget=function(a){a.blendFunc(1,771)},b.BlendAddTarget=function(a){a.blendFunc(1,772)},b.BlendMultiplyTarget=function(a){a.blendFunc(774,771)},b.BlendScreenTarget=function(a){a.blendFunc(1,1)},b.BlendOverlayTarget=function(a){a.blendFunc(1,769)},b.BlendLightTarget=function(a){a.blendFunc(1,1)},b.BlendMask=function(a){a.blendFunc(0,770)},b.BlendDestinationOut=function(a){a.blendFunc(0,0)},b.activeBlendFunction=null,b.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],b.TOINT={normal:0,add:1,multiply:2,screen:3,lighter:1,overlay:4,light:5,mask:6,"destination-out":7},b.NORMAL="normal",b.ADD="add",b.MULTIPLY="multiply",b.SCREEN="screen",b.LIGHT="light",b.OVERLAY="overlay",b.DESTINATIONOUT="destination-out",b.fns=[],b.targetFns=[],b}(),R=function(){function c(a){this._color=o.create("black"),this.setValue(a)}m(c,"laya.webgl.canvas.DrawStyle");var a=c.prototype;return a.setValue=function(a){if(a){if("string"==typeof a)return void(this._color=o.create(a));if(a instanceof laya.utils.Color)return void(this._color=a)}},a.reset=function(){this._color=o.create("black")},a.equal=function(a){return"string"==typeof a?this._color.strColor===a:a instanceof laya.utils.Color&&this._color.numColor===a.numColor},a.toColorStr=function(){return this._color.strColor},c.create=function(a){var b;if(a&&("string"==typeof a?b=o.create(a):a instanceof laya.utils.Color&&(b=a),b))return b._drawStyle||(b._drawStyle=new c(a));return laya.webgl.canvas.DrawStyle.DEFAULT},g(c,["DEFAULT",function(){return this.DEFAULT=new c("#000000")}]),c}(),S=function(){function a(){this._x=0,this._y=0,this.dirty=!1,this.offset=0,this.count=0,this.geoStart=0,this.tempArray=[],this.closePath=!1,this.geomatrys=[];ua.mainContext;this.ib=$a.create(35048),this.vb=_a.create(5)}m(a,"laya.webgl.canvas.Path");var b=a.prototype;return b.addPoint=function(a,b){this.tempArray.push(a,b)},b.getEndPointX=function(){return this.tempArray[this.tempArray.length-2]},b.getEndPointY=function(){return this.tempArray[this.tempArray.length-1]},b.polygon=function(a,b,c,d,e,f){var g;return this.geomatrys.push(this._curGeomatry=g=new Fa(a,b,c,d,e,f)),d||(g.fill=!1),null==f&&(g.borderWidth=0),g},b.setGeomtry=function(a){this.geomatrys.push(this._curGeomatry=a)},b.drawLine=function(a,b,c,d,e){var f;return this.closePath?this.geomatrys.push(this._curGeomatry=f=new Ea(a,b,c,d,e)):this.geomatrys.push(this._curGeomatry=f=new Da(a,b,c,d,e)),f.fill=!1,f},b.update=function(){var a=this.ib._byteLength,b=this.geomatrys.length;this.offset=a;for(var c=this.geoStart;c<b;c++)this.geomatrys[c].getData(this.ib,this.vb,this.vb._byteLength/20);this.geoStart=b,this.count=(this.ib._byteLength-a)/pa.BYTES_PIDX},b.reset=function(){this.vb.clear(),this.ib.clear(),this.offset=this.count=this.geoStart=0,this.geomatrys.length=0},b.recover=function(){this._curGeomatry=null,this.vb.destory(),this.vb=null,this.ib.destory(),this.ib=null},a}(),T=function(){function h(){}m(h,"laya.webgl.canvas.save.SaveBase");var a=h.prototype;return w.imps(a,{"laya.webgl.canvas.save.ISaveData":!0}),a.isSaveMark=function(){return!1},a.restore=function(a){this._dataObj[this._valueName]=this._value,(h._cache[h._cache._length++]=this)._newSubmit&&(a._curSubmit=fa.RENDERBASE,a._renderKey=0)},h._createArray=function(){var a=[];return a._length=0,a},h._init=function(){var a=h._namemap={};return a[1]="ALPHA",a[2]="fillStyle",a[8]="font",a[256]="lineWidth",a[512]="strokeStyle",a[8192]="_mergeID",a[1024]=a[2048]=a[4096]=[],a[16384]="textBaseline",a[32768]="textAlign",a[65536]="_nBlendType",a[1048576]="shader",a[2097152]="filters",a},h.save=function(a,b,c,d){if((a._saveMark._saveuse&b)!==b){a._saveMark._saveuse|=b;var e=h._cache,f=0<e._length?e[--e._length]:new h;f._value=c[f._valueName=h._namemap[b]],f._dataObj=c,f._newSubmit=d;var g=a._save;g[g._length++]=f}},h._cache=laya.webgl.canvas.save.SaveBase._createArray(),h._namemap=h._init(),h}(),U=function(){function f(){this._clipRect=new B}m(f,"laya.webgl.canvas.save.SaveClipRect");var a=f.prototype;return w.imps(a,{"laya.webgl.canvas.save.ISaveData":!0}),a.isSaveMark=function(){return!1},a.restore=function(a){a._clipRect=this._clipSaveRect,(f._cache[f._cache._length++]=this)._submitScissor.submitLength=a._submits._length-this._submitScissor.submitIndex,a._curSubmit=fa.RENDERBASE,a._renderKey=0},f.save=function(a,b){if(131072!=(131072&a._saveMark._saveuse)){a._saveMark._saveuse|=131072;var c=f._cache,d=0<c._length?c[--c._length]:new f;d._clipSaveRect=a._clipRect,a._clipRect=d._clipRect.copyFrom(a._clipRect),d._submitScissor=b;var e=a._save;e[e._length++]=d}},g(f,["_cache",function(){return this._cache=T._createArray()}]),f}(),V=function(){function n(){this._contextX=0,this._contextY=0,this._clipRect=new B,this._rect=new B,this._matrix=new z}m(n,"laya.webgl.canvas.save.SaveClipRectStencil");var a=n.prototype;return w.imps(a,{"laya.webgl.canvas.save.ISaveData":!0}),a.isSaveMark=function(){return!1},a.restore=function(a){ka.restore(a,this._rect,this._saveMatrix,this._contextX,this._contextY),a._clipRect=this._clipSaveRect,a._curMat=this._saveMatrix,a._x=this._contextX,a._y=this._contextY,n._cache[n._cache._length++]=this,a._curSubmit=fa.RENDERBASE},n.save=function(a,b,c,d,e,f,g,h,i,j){if(262144!=(262144&a._saveMark._saveuse)){a._saveMark._saveuse|=262144;var k=n._cache,l=0<k._length?k[--k._length]:new n;l._clipSaveRect=a._clipRect,l._clipRect.setTo(g,h,i,j),a._clipRect=l._clipRect,l._rect.x=c,l._rect.y=d,l._rect.width=e,l._rect.height=f,l._contextX=a._x,l._contextY=a._y,l._saveMatrix=a._curMat,a._curMat.copyTo(l._matrix),a._curMat=l._matrix,l._submitStencil=b;var m=a._save;m[m._length++]=l}},g(n,["_cache",function(){return this._cache=T._createArray()}]),n}(),W=function(){function d(){this._saveuse=0}m(d,"laya.webgl.canvas.save.SaveMark");var a=d.prototype;return w.imps(a,{"laya.webgl.canvas.save.ISaveData":!0}),a.isSaveMark=function(){return!0},a.restore=function(a){a._saveMark=this._preSaveMark,d._no[d._no._length++]=this},d.Create=function(a){var b=d._no,c=0<b._length?b[--b._length]:new d;return c._saveuse=0,c._preSaveMark=a._saveMark,a._saveMark=c},g(d,["_no",function(){return this._no=T._createArray()}]),d}(),X=function(){function f(){this._matrix=new z}m(f,"laya.webgl.canvas.save.SaveTransform");var a=f.prototype;return w.imps(a,{"laya.webgl.canvas.save.ISaveData":!0}),a.isSaveMark=function(){return!1},a.restore=function(a){a._curMat=this._savematrix,f._no[f._no._length++]=this},f.save=function(a){var b=a._saveMark;if(2048!=(2048&b._saveuse)){b._saveuse|=2048;var c=f._no,d=0<c._length?c[--c._length]:new f;d._savematrix=a._curMat,a._curMat=a._curMat.copyTo(d._matrix);var e=a._save;e[e._length++]=d}},g(f,["_no",function(){return this._no=T._createArray()}]),f}(),Y=function(){function e(){}m(e,"laya.webgl.canvas.save.SaveTranslate");var a=e.prototype;return w.imps(a,{"laya.webgl.canvas.save.ISaveData":!0}),a.isSaveMark=function(){return!1},a.restore=function(a){a._curMat;a._x=this._x,a._y=this._y,e._no[e._no._length++]=this},e.save=function(a){var b=e._no,c=0<b._length?b[--b._length]:new e;c._x=a._x,c._y=a._y;var d=a._save;d[d._length++]=c},g(e,["_no",function(){return this._no=T._createArray()}]),e}(),Z=function(){function a(){this.target=null,this.repaint=!1,this._width=NaN,this._height=NaN,this._sp=null,this._clipRect=new B}m(a,"laya.webgl.resource.RenderTargetMAX");var b=a.prototype;return b.setSP=function(a){this._sp=a},b.size=function(a,b){var c=this;this._width!==a||this._height!==b?(this.repaint=!0,this._width=a,this._height=b,this.target?this.target.size(a,b):this.target=Ka.create(a,b),this.target.hasListener("recovered")||this.target.on("recovered",this,function(a){w.timer.callLater(c._sp,c._sp.repaint)})):this.target.size(a,b)},b._flushToTarget=function(a,b){if(!b._destroy){var c=sa.worldScissorTest,d=sa.worldClipRect;sa.worldClipRect=this._clipRect,this._clipRect.x=this._clipRect.y=0,this._clipRect.width=this._width,this._clipRect.height=this._height,sa.worldScissorTest=!1,ua.mainContext.disable(3089);var e=sa.worldAlpha,f=sa.worldMatrix4,g=sa.worldMatrix,h=sa.worldFilters,i=sa.worldShaderDefines;if(sa.worldMatrix=z.EMPTY,sa.restoreTempArray(),sa.worldMatrix4=sa.TEMPMAT4_ARRAY,sa.worldAlpha=1,sa.worldFilters=null,sa.worldShaderDefines=null,Ja.activeShader=null,b.start(),x.showCanvasMark?b.clear(0,1,0,.3):b.clear(0,0,0,0),a.flush(),b.end(),Ja.activeShader=null,sa.worldAlpha=e,sa.worldMatrix4=f,sa.worldMatrix=g,sa.worldFilters=h,sa.worldShaderDefines=i,sa.worldScissorTest=c){var j=sa.height-d.y-d.height;ua.mainContext.scissor(d.x,j,d.width,d.height),ua.mainContext.enable(3089)}sa.worldClipRect=d}},b.flush=function(a){this.repaint&&(this._flushToTarget(a,this.target),this.repaint=!1)},b.drawTo=function(a,b,c,d,e){a.drawTexture(this.target.getTexture(),b,c,d,e,0,0)},b.destroy=function(){this.target&&(this.target.destroy(),this.target=null,this._sp=null)},a}(),$=function(){function a(){this.ALPHA=1,this.shaderType=0,this.defines=new Ca}return m(a,"laya.webgl.shader.d2.Shader2D"),a.prototype.destroy=function(){this.defines=null,this.filters=null,this.glTexture=null,this.strokeStyle=null,this.fillStyle=null},a.__init__=function(){var a,b;Wa.addInclude("parts/ColorFilter_ps_uniform.glsl","uniform vec4 colorAlpha;\nuniform mat4 colorMat;"),Wa.addInclude("parts/ColorFilter_ps_logic.glsl","mat4 alphaMat =colorMat;\n\nalphaMat[0][3] *= gl_FragColor.a;\nalphaMat[1][3] *= gl_FragColor.a;\nalphaMat[2][3] *= gl_FragColor.a;\n\ngl_FragColor = gl_FragColor * alphaMat;\ngl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n"),Wa.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;"),Wa.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\tvec4 vec4Color2 = texture2D(texture, v_texcoord + vec2FilterDir + vec2Off); \n\n      #ifdef TXTALPHA\n   vec4Color2.a = texture2D(texture1, v_texcoord + vec2FilterDir + vec2Off).a;\n   #endif\n\n    vec4Color += vec4Color2/floatIterationTotalTime;        \n\t}\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\ngl_FragColor.rgb *= gl_FragColor.a;"),Wa.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor =   blur();\ngl_FragColor.w*=alpha;"),Wa.addInclude("parts/BlurFilter_ps_uniform.glsl","uniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\n//float sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\n//float sig2 = sigma*sigma;\n//float _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\n//float gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoord-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4 vec4Color1 = texture2D(texture, ctexcoord); \n\n      #ifdef TXTALPHA\n   vec4Color1.a = texture2D(texture1, ctexcoord).a;\n   #endif\n\n    vec4Color += vec4Color1*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}"),Wa.addInclude("parts/ColorAdd_ps_uniform.glsl","uniform vec4 colorAdd;\n"),Wa.addInclude("parts/ColorAdd_ps_logic.glsl","gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\ngl_FragColor.xyz *= colorAdd.a;"),a="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",b='precision mediump float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec4 color= texture2D(texture, v_texcoord);\n\n   #ifdef TXTCOMPRESS\n   color.rgb *= color.a;\n   #endif\n\n   #ifdef TXTALPHA\n   color.rgba *= texture2D(texture1, v_texcoord).a;\n   #endif\n\n   color.a*=alpha;\n   color.rgb*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',Wa.preCompile2D(0,1,a,b,null),a="attribute vec4 position;\nuniform vec2 size;\nuniform mat4 mmat;\nvoid main() {\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n}",b='precision mediump float;\nuniform vec4 color;\nuniform float alpha;\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\nvoid main() {\n\tvec4 a = vec4(color.r, color.g, color.b, color.a);\n\ta.w = alpha;\n\ta.xyz *= alpha;\n\tgl_FragColor = a;\n\t#include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n}',Wa.preCompile2D(0,2,a,b,null),a="attribute vec4 position;\nattribute vec3 a_color;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nuniform vec2 u_pos;\nuniform vec2 size;\nvarying vec3 color;\nvoid main(){\n  vec4 tPos = vec4(position.x + u_pos.x,position.y + u_pos.y,position.z,position.w);\n  vec4 pos=mmat*u_mmat2*tPos;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  color=a_color;\n}",b="precision mediump float;\nvarying vec3 color;\nuniform float alpha;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor=vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=alpha;\n}",Wa.preCompile2D(0,4,a,b,null),a="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",b='#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n\n   #ifdef TXTALPHA\n   color.a = texture2D(texture1, newTexCoord).a;\n   #endif\n\n   color.a*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',Wa.preCompile2D(0,256,a,b,null),a="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}",b="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\n   #ifdef TXTALPHA\n   t_color.a = texture2D(texture1, v_texcoord).a;\n   #endif\n\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",Wa.preCompile2D(0,512,a,b,null)},a}(),_=function(){function b(a,b,c){this._value=0,this._name2int=a,this._int2name=b,this._int2nameMap=c}m(b,"laya.webgl.shader.ShaderDefines");var a=b.prototype;return a.add=function(a){return"string"==typeof a&&(a=this._name2int[a]),this._value|=a,this._value},a.addInt=function(a){return this._value|=a,this._value},a.remove=function(a){return"string"==typeof a&&(a=this._name2int[a]),this._value&=~a,this._value},a.isDefine=function(a){return(this._value&a)===a},a.getValue=function(){return this._value},a.setValue=function(a){this._value=a},a.toNameDic=function(){var a=this._int2nameMap[this._value];return a||b._toText(this._value,this._int2name,this._int2nameMap)},b._reg=function(a,b,c,d){d[c[a]=b]=a},b._toText=function(a,b,c){var d=c[a];if(d)return d;for(var e={},f=1,g=0;g<32&&!(a<(f=1<<g));g++)if(a&f){var h=b[f];h&&(e[h]="")}return c[a]=e},b._toInt=function(a,b){for(var c=a.split("."),d=0,e=0,f=c.length;e<f;e++){var g=b[c[e]];if(!g)throw new Error("Defines to int err:"+a+"/"+c[e]);d|=g}return d},b}(),aa=function(){function g(){this.mVBBuffer=null,this.mIBBuffer=null,this.mVBData=null,this.mIBData=null,this.mEleNum=0,this.mTexture=null,this.transform=null,this._vs=null,this._ps=null,this._indexStart=-1,this._verticles=null,this._uvs=null,this._tempMatrix=new z}m(g,"laya.webgl.shader.d2.skinAnishader.SkinMesh");var a=g.prototype;return a.init=function(a,b,c){if(b)this._vs=b;else{this._vs=[];var d=a.width,e=a.height;this._vs.push(0,0,0,0,1,1,1,1),this._vs.push(d,0,1,0,1,1,1,1),this._vs.push(d,e,1,1,1,1,1,1),this._vs.push(0,e,0,1,1,1,1,1)}c?this._ps=c:(g._defaultPS||(g._defaultPS=[]).push(0,1,3,3,1,2),this._ps=g._defaultPS),this.mVBData=new Float32Array(this._vs),this.mIBData=new Uint16Array(this._ps.length),this.mIBData.start=-1,this.mEleNum=this._ps.length,this.mTexture=a},a.init2=function(a,b,c,d,e){this.transform&&(this.transform=null),c?this._ps=c:(this._ps=[],this._ps.push(0,1,3,3,1,2)),this._verticles=d,this._uvs=e,this.mEleNum=this._ps.length,this.mTexture=a,(r.isConchNode||r.isConchApp)&&(this._initMyData(),this.mVBData=new Float32Array(this._vs))},a._initMyData=function(){var a=0,b=0,c=4*this._verticles.length;this._vs=g._tempVS;var d=!1;if(r.isConchNode||r.isConchApp?(this._vs.length=c,d=!0):this._vs.length<c&&(this._vs.length=c,d=!0),g._tVSLen=c,d)for(;a<c;)this._vs[a]=this._verticles[b],this._vs[a+1]=this._verticles[b+1],this._vs[a+2]=this._uvs[b],this._vs[a+3]=this._uvs[b+1],this._vs[a+4]=1,this._vs[a+5]=1,this._vs[a+6]=1,this._vs[a+7]=1,a+=8,b+=2;else for(;a<c;)this._vs[a]=this._verticles[b],this._vs[a+1]=this._verticles[b+1],this._vs[a+2]=this._uvs[b],this._vs[a+3]=this._uvs[b+1],a+=8,b+=2},a.getData2=function(a,b,c){var d;this.mVBBuffer=a,this.mIBBuffer=b,this._initMyData(),a.appendEx2(this._vs,Float32Array,g._tVSLen,4),this._indexStart=b._byteLength,(d=g._tempIB).length<this._ps.length&&(d.length=this._ps.length);for(var e=0,f=this._ps.length;e<f;e++)d[e]=this._ps[e]+c;b.appendEx2(d,Uint16Array,this._ps.length,2)},a.getData=function(a,b,c){if(this.mVBBuffer=a,this.mIBBuffer=b,a.append(this.mVBData),this._indexStart=b._byteLength,this.mIBData.start!=c){for(var d=0,e=this._ps.length;d<e;d++)this.mIBData[d]=this._ps[d]+c;this.mIBData.start=c}b.append(this.mIBData)},a.render=function(a,b,c){if(r.isWebGL&&this.mTexture){a._renderKey=0,a._shader2D.glTexture=null,ba.getInstance().addSkinMesh(this);var d=fa.createShape(a,this.mIBBuffer,this.mVBBuffer,this.mEleNum,this._indexStart,ya.create(512,0));this.transform||(this.transform=z.EMPTY),this.transform.translate(b,c),z.mul(this.transform,a._curMat,this._tempMatrix),this.transform.translate(-b,-c);var e=d.shaderValue,f=e.u_mmat2||sa.getMatrArray();sa.mat2MatArray(this._tempMatrix,f),e.textureHost=this.mTexture,e.offsetX=0,e.offsetY=0,e.u_mmat2=f,e.ALPHA=a._shader2D.ALPHA,a._submits[a._submits._length++]=d}else r.isConchApp&&this.mTexture&&(this.transform||(this.transform=z.EMPTY),a.setSkinMesh&&a.setSkinMesh(b,c,this._ps,this.mVBData,this.mEleNum,0,this.mTexture,this.transform))},g._tempVS=[],g._tempIB=[],g._defaultPS=null,g._tVSLen=0,g}(),ba=function(){function a(){this.ib=null,this.vb=null;ua.mainContext;this.ib=$a.create(35048),this.vb=_a.create(8)}m(a,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var b=a.prototype;return b.addSkinMesh=function(a){a.getData2(this.vb,this.ib,this.vb._byteLength/32)},b.reset=function(){this.vb.clear(),this.ib.clear()},a.getInstance=function(){return a.instance=a.instance||new a},a.instance=null,a}(),ca=function(){function a(a,b,c,d,e,f,g,h,i){this.r0=0,this.fill=!0,this.r1=Math.PI/2,void 0===i&&(i=0),this.x=a,this.y=b,this.width=c,this.height=d,this.edges=e,this.color=f,this.borderWidth=g,this.borderColor=h}m(a,"laya.webgl.shapes.BasePoly");var b=a.prototype;return w.imps(b,{"laya.webgl.shapes.IShape":!0}),b.getData=function(a,b,c){},b.rebuild=function(a){},b.setMatrix=function(a){},b.needUpdate=function(a){return!0},b.sector=function(a,b,c){var d=this.x,e=this.y,f=this.edges,g=(this.r1-this.r0)/f,h=this.width,i=this.height,j=this.color,k=(j>>16&255)/255,l=(j>>8&255)/255,m=(255&j)/255;a.push(d,e,k,l,m);for(var n=0;n<f+1;n++)a.push(d+Math.sin(g*n+this.r0)*h,e+Math.cos(g*n+this.r0)*i),a.push(k,l,m);for(n=0;n<f;n++)b.push(c,c+n+1,c+n+2)},b.createLine2=function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A=a.concat(),B=e,C=this.borderColor,D=(C>>16&255)/255,E=(C>>8&255)/255,F=(255&C)/255,G=A.length/2,H=d,I=c/2;i=A[0],j=A[1],p=i-(k=A[2]),o=(o=-(j-(l=A[3])))/(z=Math.sqrt(o*o+p*p))*I,p=p/z*I,B.push(i-o+this.x,j-p+this.y,D,E,F,i+o+this.x,j+p+this.y,D,E,F);for(var J=1;J<G-1;J++)i=A[2*(J-1)],j=A[2*(J-1)+1],k=A[2*J],l=A[2*J+1],m=A[2*(J+1)],n=A[2*(J+1)+1],p=i-k,r=k-m,u=(-(o=(o=-(j-l))/(z=Math.sqrt(o*o+p*p))*I)+i)*(-(p=p/z*I)+l)-(-o+k)*(-p+j),x=(-(q=(q=-(l-n))/(z=Math.sqrt(q*q+r*r))*I)+m)*(-(r=r/z*I)+l)-(-q+k)*(-r+n),y=(s=-p+j-(-p+l))*(w=-q+k-(-q+m))-(v=-r+n-(-r+l))*(t=-o+k-(-o+i)),Math.abs(y)<.1?(y+=10.1,B.push(k-o+this.x,l-p+this.y,D,E,F,k+o+this.x,l+p+this.y,D,E,F)):(((g=(t*x-w*u)/y)-k)*(g-k)+((h=(v*u-s*x)/y)-l)+(h-l),B.push(g+this.x,h+this.y,D,E,F,k-(g-k)+this.x,l-(h-l)+this.y,D,E,F));i=A[A.length-4],j=A[A.length-3],p=i-(k=A[A.length-2]),o=(o=-(j-(l=A[A.length-1])))/(z=Math.sqrt(o*o+p*p))*I,p=p/z*I,B.push(k-o+this.x,l-p+this.y,D,E,F,k+o+this.x,l+p+this.y,D,E,F);var K=f;for(J=1;J<K;J++)b.push(H+2*(J-1),H+2*(J-1)+1,H+2*J+1,H+2*J+1,H+2*J,H+2*(J-1));return B},b.createLine=function(a,b,c,d){var e=a.concat(),f=a,g=this.borderColor,h=(g>>16&255)/255,i=(g>>8&255)/255,j=(255&g)/255;e.splice(0,5);var k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E=e.length/5,F=d,G=c/2;m=e[0],n=e[1],t=m-(o=e[5]),s=(s=-(n-(p=e[6])))/(D=Math.sqrt(s*s+t*t))*G,t=t/D*G,f.push(m-s,n-t,h,i,j,m+s,n+t,h,i,j);for(var H=1;H<E-1;H++)m=e[5*(H-1)],n=e[5*(H-1)+1],o=e[5*H],p=e[5*H+1],q=e[5*(H+1)],r=e[5*(H+1)+1],t=m-o,v=o-q,y=(-(s=(s=-(n-p))/(D=Math.sqrt(s*s+t*t))*G)+m)*(-(t=t/D*G)+p)-(-s+o)*(-t+n),B=(-(u=(u=-(p-r))/(D=Math.sqrt(u*u+v*v))*G)+q)*(-(v=v/D*G)+p)-(-u+o)*(-v+r),C=(w=-t+n-(-t+p))*(A=-u+o-(-u+q))-(z=-v+r-(-v+p))*(x=-s+o-(-s+m)),Math.abs(C)<.1?(C+=10.1,f.push(o-s,p-t,h,i,j,o+s,p+t,h,i,j)):(((k=(x*B-A*y)/C)-o)*(k-o)+((l=(z*y-w*B)/C)-p)+(l-p),f.push(k,l,h,i,j,o-(k-o),p-(l-p),h,i,j));m=e[e.length-10],n=e[e.length-9],t=m-(o=e[e.length-5]),s=(s=-(n-(p=e[e.length-4])))/(D=Math.sqrt(s*s+t*t))*G,t=t/D*G,f.push(o-s,p-t,h,i,j,o+s,p+t,h,i,j);var I=this.edges+1;for(H=1;H<I;H++)b.push(F+2*(H-1),F+2*(H-1)+1,F+2*H+1,F+2*H+1,F+2*H,F+2*(H-1));return f},b.createLoopLine=function(a,b,c,d,e,f){var g=a.concat(),h=e||a,i=this.borderColor,j=(i>>16&255)/255,k=(i>>8&255)/255,l=(255&i)/255;g.splice(0,5);var m=[g[0],g[1]],n=[g[g.length-5],g[g.length-4]],o=n[0]+.5*(m[0]-n[0]),p=n[1]+.5*(m[1]-n[1]);g.unshift(o,p,0,0,0),g.push(o,p,0,0,0);var q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K=g.length/5,L=d,M=c/2;s=g[0],t=g[1],z=s-(u=g[5]),y=(y=-(t-(v=g[6])))/(J=Math.sqrt(y*y+z*z))*M,z=z/J*M,h.push(s-y,t-z,j,k,l,s+y,t+z,j,k,l);for(var N=1;N<K-1;N++)s=g[5*(N-1)],t=g[5*(N-1)+1],u=g[5*N],v=g[5*N+1],w=g[5*(N+1)],x=g[5*(N+1)+1],z=s-u,B=u-w,E=(-(y=(y=-(t-v))/(J=Math.sqrt(y*y+z*z))*M)+s)*(-(z=z/J*M)+v)-(-y+u)*(-z+t),H=(-(A=(A=-(v-x))/(J=Math.sqrt(A*A+B*B))*M)+w)*(-(B=B/J*M)+v)-(-A+u)*(-B+x),I=(C=-z+t-(-z+v))*(G=-A+u-(-A+w))-(F=-B+x-(-B+v))*(D=-y+u-(-y+s)),Math.abs(I)<.1?(I+=10.1,h.push(u-y,v-z,j,k,l,u+y,v+z,j,k,l)):(((q=(D*H-G*E)/I)-u)*(q-u)+((r=(F*E-C*H)/I)-v)+(r-v),h.push(q,r,j,k,l,u-(q-u),v-(r-v),j,k,l));f&&(b=f);var O=this.edges+1;for(N=1;N<O;N++)b.push(L+2*(N-1),L+2*(N-1)+1,L+2*N+1,L+2*N+1,L+2*N,L+2*(N-1));return b.push(L+2*(N-1),L+2*(N-1)+1,L+1,L+1,L,L+2*(N-1)),h},a}(),da=function(){function p(){}return m(p,"laya.webgl.shapes.Earcut"),p.earcut=function(a,b,c){c=c||2;var d,e,f,g,h,i,j,k=b&&b.length,l=k?b[0]*c:a.length,m=p.linkedList(a,0,l,c,!0),n=[];if(!m)return n;if(k&&(m=p.eliminateHoles(a,b,m,c)),a.length>80*c){d=f=a[0],e=g=a[1];for(var o=c;o<l;o+=c)(h=a[o])<d&&(d=h),(i=a[o+1])<e&&(e=i),f<h&&(f=h),g<i&&(g=i);j=0!==(j=Math.max(f-d,g-e))?1/j:0}return p.earcutLinked(m,n,c,d,e,j),n},p.linkedList=function(a,b,c,d,e){var f,g;if(e===0<p.signedArea(a,b,c,d))for(f=b;f<c;f+=d)g=p.insertNode(f,a[f],a[f+1],g);else for(f=c-d;b<=f;f-=d)g=p.insertNode(f,a[f],a[f+1],g);return g&&p.equals(g,g.next)&&(p.removeNode(g),g=g.next),g},p.filterPoints=function(a,b){if(!a)return a;b||(b=a);var c,d=a;do{if(c=!1,d.steiner||!p.equals(d,d.next)&&0!==p.area(d.prev,d,d.next))d=d.next;else{if(p.removeNode(d),(d=b=d.prev)===d.next)break;c=!0}}while(c||d!==b);return b},p.earcutLinked=function(a,b,c,d,e,f,g){if(a){!g&&f&&p.indexCurve(a,d,e,f);for(var h,i,j=a;a.prev!==a.next;)if(h=a.prev,i=a.next,f?p.isEarHashed(a,d,e,f):p.isEar(a))b.push(h.i/c),b.push(a.i/c),b.push(i.i/c),p.removeNode(a),a=i.next,j=i.next;else if((a=i)===j){g?1===g?(a=p.cureLocalIntersections(a,b,c),p.earcutLinked(a,b,c,d,e,f,2)):2===g&&p.splitEarcut(a,b,c,d,e,f):p.earcutLinked(p.filterPoints(a,null),b,c,d,e,f,1);break}}},p.isEar=function(a){var b=a.prev,c=a,d=a.next;if(0<=p.area(b,c,d))return!1;for(var e=a.next.next;e!==a.prev;){if(p.pointInTriangle(b.x,b.y,c.x,c.y,d.x,d.y,e.x,e.y)&&0<=p.area(e.prev,e,e.next))return!1;e=e.next}return!0},p.isEarHashed=function(a,b,c,d){var e=a.prev,f=a,g=a.next;if(0<=p.area(e,f,g))return!1;for(var h=e.x<f.x?e.x<g.x?e.x:g.x:f.x<g.x?f.x:g.x,i=e.y<f.y?e.y<g.y?e.y:g.y:f.y<g.y?f.y:g.y,j=e.x>f.x?e.x>g.x?e.x:g.x:f.x>g.x?f.x:g.x,k=e.y>f.y?e.y>g.y?e.y:g.y:f.y>g.y?f.y:g.y,l=p.zOrder(h,i,b,c,d),m=p.zOrder(j,k,b,c,d),n=a.nextZ;n&&n.z<=m;){if(n!==a.prev&&n!==a.next&&p.pointInTriangle(e.x,e.y,f.x,f.y,g.x,g.y,n.x,n.y)&&0<=p.area(n.prev,n,n.next))return!1;n=n.nextZ}for(n=a.prevZ;n&&n.z>=l;){if(n!==a.prev&&n!==a.next&&p.pointInTriangle(e.x,e.y,f.x,f.y,g.x,g.y,n.x,n.y)&&0<=p.area(n.prev,n,n.next))return!1;n=n.prevZ}return!0},p.cureLocalIntersections=function(a,b,c){var d=a;do{var e=d.prev,f=d.next.next;!p.equals(e,f)&&p.intersects(e,d,d.next,f)&&p.locallyInside(e,f)&&p.locallyInside(f,e)&&(b.push(e.i/c),b.push(d.i/c),b.push(f.i/c),p.removeNode(d),p.removeNode(d.next),d=a=f),d=d.next}while(d!==a);return d},p.splitEarcut=function(a,b,c,d,e,f){var g=a;do{for(var h=g.next.next;h!==g.prev;){if(g.i!==h.i&&p.isValidDiagonal(g,h)){var i=p.splitPolygon(g,h);return g=p.filterPoints(g,g.next),i=p.filterPoints(i,i.next),p.earcutLinked(g,b,c,d,e,f),void p.earcutLinked(i,b,c,d,e,f)}h=h.next}g=g.next}while(g!==a)},p.eliminateHoles=function(a,b,c,d){var e,f,g,h,i,j=[];for(e=0,f=b.length;e<f;e++)g=b[e]*d,h=e<f-1?b[e+1]*d:a.length,(i=p.linkedList(a,g,h,d,!1))===i.next&&(i.steiner=!0),j.push(p.getLeftmost(i));for(j.sort(p.compareX),e=0;e<j.length;e++)p.eliminateHole(j[e],c),c=p.filterPoints(c,c.next);return c},p.compareX=function(a,b){return a.x-b.x},p.eliminateHole=function(a,b){if(b=p.findHoleBridge(a,b)){var c=p.splitPolygon(b,a);p.filterPoints(c,c.next)}},p.findHoleBridge=function(a,b){var c,d=b,e=a.x,f=a.y,g=-1/0;do{if(f<=d.y&&f>=d.next.y&&d.next.y!==d.y){var h=d.x+(f-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(h<=e&&g<h){if((g=h)===e){if(f===d.y)return d;if(f===d.next.y)return d.next}c=d.x<d.next.x?d:d.next}}d=d.next}while(d!==b);if(!c)return null;if(e===g)return c.prev;var i,j=c,k=c.x,l=c.y,m=1/0;for(d=c.next;d!==j;)e>=d.x&&d.x>=k&&e!==d.x&&p.pointInTriangle(f<l?e:g,f,k,l,f<l?g:e,f,d.x,d.y)&&((i=Math.abs(f-d.y)/(e-d.x))<m||i===m&&d.x>c.x)&&p.locallyInside(d,a)&&(c=d,m=i),d=d.next;return c},p.indexCurve=function(a,b,c,d){for(var e=a;null===e.z&&(e.z=p.zOrder(e.x,e.y,b,c,d)),e.prevZ=e.prev,e.nextZ=e.next,(e=e.next)!==a;);e.prevZ.nextZ=null,e.prevZ=null,p.sortLinked(e)},p.sortLinked=function(a){var b,c,d,e,f,g,h,i,j=1;do{for(c=a,f=a=null,g=0;c;){for(g++,d=c,b=h=0;b<j&&(h++,d=d.nextZ);b++);for(i=j;0<h||0<i&&d;)0!==h&&(0===i||!d||c.z<=d.z)?(c=(e=c).nextZ,h--):(d=(e=d).nextZ,i--),f?f.nextZ=e:a=e,e.prevZ=f,f=e;c=d}f.nextZ=null,j*=2}while(1<g);return a},p.zOrder=function(a,b,c,d,e){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-c)*e)|a<<8))|a<<4))|a<<2))|a<<1))|(b=1431655765&((b=858993459&((b=252645135&((b=16711935&((b=32767*(b-d)*e)|b<<8))|b<<4))|b<<2))|b<<1))<<1},p.getLeftmost=function(a){for(var b=a,c=a;b.x<c.x&&(c=b),(b=b.next)!==a;);return c},p.pointInTriangle=function(a,b,c,d,e,f,g,h){return 0<=(e-g)*(b-h)-(a-g)*(f-h)&&0<=(a-g)*(d-h)-(c-g)*(b-h)&&0<=(c-g)*(f-h)-(e-g)*(d-h)},p.isValidDiagonal=function(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!p.intersectsPolygon(a,b)&&p.locallyInside(a,b)&&p.locallyInside(b,a)&&p.middleInside(a,b)},p.area=function(a,b,c){return(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)},p.equals=function(a,b){return a.x===b.x&&a.y===b.y},p.intersects=function(a,b,c,d){return!!(p.equals(a,b)&&p.equals(c,d)||p.equals(a,d)&&p.equals(c,b))||0<p.area(a,b,c)!=0<p.area(a,b,d)&&0<p.area(c,d,a)!=0<p.area(c,d,b)},p.intersectsPolygon=function(a,b){var c=a;do{if(c.i!==a.i&&c.next.i!==a.i&&c.i!==b.i&&c.next.i!==b.i&&p.intersects(c,c.next,a,b))return!0;c=c.next}while(c!==a);return!1},p.locallyInside=function(a,b){return p.area(a.prev,a,a.next)<0?0<=p.area(a,b,a.next)&&0<=p.area(a,a.prev,b):p.area(a,b,a.prev)<0||p.area(a,a.next,b)<0},p.middleInside=function(a,b){for(var c=a,d=!1,e=(a.x+b.x)/2,f=(a.y+b.y)/2;c.y>f!=c.next.y>f&&c.next.y!==c.y&&e<(c.next.x-c.x)*(f-c.y)/(c.next.y-c.y)+c.x&&(d=!d),(c=c.next)!==a;);return d},p.splitPolygon=function(a,b){var c=new ea(a.i,a.x,a.y),d=new ea(b.i,b.x,b.y),e=a.next,f=b.prev;return(a.next=b).prev=a,(c.next=e).prev=c,(d.next=c).prev=d,(f.next=d).prev=f,d},p.insertNode=function(a,b,c,d){var e=new ea(a,b,c);return d?(e.next=d.next,(e.prev=d).next.prev=e,d.next=e):(e.prev=e).next=e,e},p.removeNode=function(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)},p.signedArea=function(a,b,c,d){for(var e=0,f=b,g=c-d;f<c;f+=d)e+=(a[g]-a[f])*(a[f+1]+a[g+1]),g=f;return e},p}(),ea=function(){function a(a,b,c){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=a,this.x=b,this.y=c,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return m(a,"laya.webgl.shapes.EarcutNode"),a}(),fa=(function(){function a(a,b,c,d,e,f,g){this.lineWidth=a,this.lineColor=b,this.lineAlpha=c,this.fillColor=d,this.fillAlpha=e,this.shape=g,this.fill=f}m(a,"laya.webgl.shapes.GeometryData");var b=a.prototype;b.clone=function(){return new a(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},b.getIndexData=function(){return null},b.getVertexData=function(){return null},b.destroy=function(){this.shape=null}}(),function(){function a(a){if(a instanceof Float32Array)this.points=a;else if(a instanceof Array){a.length;this.points=new Float32Array(a)}}m(a,"laya.webgl.shapes.Vertex");var b=a.prototype;w.imps(b,{"laya.webgl.shapes.IShape":!0}),b.getData=function(a,b,c){},b.needUpdate=function(a){return!1},b.rebuild=function(a){},b.setMatrix=function(a){}}(),function(){function i(a){void 0===a&&(a=1e4),this._renderType=a}m(i,"laya.webgl.submit.Submit");var a=i.prototype;return w.imps(a,{"laya.webgl.submit.ISubmit":!0}),a.releaseRender=function(){var a=i._cache;(a[a._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},a.getRenderType=function(){return this._renderType},a.renderSubmit=function(){if(0===this._numEle)return 1;var a=this.shaderValue.textureHost;if(a){var b=a.source;if(!a.bitmap||!b)return 1;this.shaderValue.texture=b,a.alphaTexture&&a.alphaTexture.source&&(this.shaderValue.texture1=a.alphaTexture.source)}this._vb.bind_upload(this._ib);var c=ua.mainContext;return this.shaderValue.upload(),Q.activeBlendFunction!==this._blendFn&&(c.enable(3042),this._blendFn(c),Q.activeBlendFunction=this._blendFn),E.drawCall++,E.trianglesFaces+=this._numEle/3,c.drawElements(4,this._numEle,5123,this._startIdx),1},i.__init__=function(){var a=i.RENDERBASE=new i(-1);a.shaderValue=new ya(0,0),a.shaderValue.ALPHA=-1234},i.createSubmit=function(a,b,c,d,e){var f=i._cache._length?i._cache[--i._cache._length]:new i;null==c&&((c=f._selfVb||(f._selfVb=_a.create(-1))).clear(),d=0),f._ib=b,f._vb=c,f._startIdx=d*pa.BYTES_PIDX,f._numEle=0;var g=a._nBlendType;f._blendFn=a._targets?Q.targetFns[g]:Q.fns[g],f.shaderValue=e,f.shaderValue.setValue(a._shader2D);var h=a._shader2D.filters;return h&&f.shaderValue.setFilters(h),f},i.createShape=function(a,b,c,d,e,f){var g=i._cache._length?i._cache[--i._cache._length]:new i;g._ib=b,g._vb=c,g._numEle=d,g._startIdx=e,g.shaderValue=f,g.shaderValue.setValue(a._shader2D);var h=a._nBlendType;return g._blendFn=a._targets?Q.targetFns[h]:Q.fns[h],g},i.TYPE_2D=1e4,i.TYPE_CANVAS=10003,i.TYPE_CMDSETRT=10004,i.TYPE_CUSTOM=10005,i.TYPE_BLURRT=10006,i.TYPE_CMDDESTORYPRERT=10007,i.TYPE_DISABLESTENCIL=10008,i.TYPE_OTHERIBVB=10009,i.TYPE_PRIMITIVE=10010,i.TYPE_RT=10011,i.TYPE_BLUR_RT=10012,i.TYPE_TARGET=10013,i.TYPE_CHANGE_VALUE=10014,i.TYPE_SHAPE=10015,i.TYPE_TEXTURE=10016,i.TYPE_FILLTEXTURE=10017,i.RENDERBASE=null,i._cache=((i._cache=[])._length=0,i._cache),i}()),ga=function(){function d(){this.fun=null,this.args=null}m(d,"laya.webgl.submit.SubmitCMD");var a=d.prototype;return w.imps(a,{"laya.webgl.submit.ISubmit":!0}),a.renderSubmit=function(){return this.fun.apply(null,this.args),1},a.getRenderType=function(){return 0},a.releaseRender=function(){var a=d._cache;a[a._length++]=this},d.create=function(a,b){var c=d._cache._length?d._cache[--d._cache._length]:new d;return c.fun=b,c.args=a,c},d._cache=((d._cache=[])._length=0,d._cache),d}(),ha=function(){function b(){this.variables={}}m(b,"laya.webgl.submit.SubmitCMDScope");var a=b.prototype;return a.getValue=function(a){return this.variables[a]},a.addValue=function(a,b){return this.variables[a]=b},a.setValue=function(a,b){return this.variables.hasOwnProperty(a)?this.variables[a]=b:null},a.clear=function(){for(var a in this.variables)delete this.variables[a]},a.recycle=function(){this.clear(),b.POOL.push(this)},b.create=function(){var a=b.POOL.pop();return a||(a=new b),a},b.POOL=[],b}(),ia=function(){function l(){this.offset=0,this.startIndex=0,this._mat=z.create()}m(l,"laya.webgl.submit.SubmitOtherIBVB");var a=l.prototype;return w.imps(a,{"laya.webgl.submit.ISubmit":!0}),a.releaseRender=function(){var a=l._cache;(a[a._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},a.getRenderType=function(){return 10009},a.renderSubmit=function(){var a=this._shaderValue.textureHost;if(a){var b=a.source;if(!a.bitmap||!b)return 1;this._shaderValue.texture=b}this._vb.bind_upload(this._ib);var c=sa.worldMatrix4,d=z.TEMP;z.mulPre(this._mat,c[0],c[1],c[4],c[5],c[12],c[13],d);var e=sa.worldMatrix4=l.tempMatrix4;e[0]=d.a,e[1]=d.b,e[4]=d.c,e[5]=d.d,e[12]=d.tx,e[13]=d.ty,this._shader._offset=this.offset,this._shaderValue.refresh(),this._shader.upload(this._shaderValue),this._shader._offset=0;var f=ua.mainContext;return Q.activeBlendFunction!==this._blendFn&&(f.enable(3042),this._blendFn(f),Q.activeBlendFunction=this._blendFn),E.drawCall++,E.trianglesFaces+=this._numEle/3,f.drawElements(4,this._numEle,5123,this.startIndex),sa.worldMatrix4=c,Ja.activeShader=null,1},l.create=function(a,b,c,d,e,f,g,h,i){void 0===i&&(i=0);var j=l._cache._length?l._cache[--l._cache._length]:new l;j._ib=c,j._vb=b,j._numEle=d,j._shader=e,j._shaderValue=f;var k=a._nBlendType;switch(j._blendFn=a._targets?Q.targetFns[k]:Q.fns[k],i){case 0:j.offset=0,j.startIndex=h/(pa.BYTES_PE*b.vertexStride)*1.5,j.startIndex*=pa.BYTES_PIDX;break;case 1:j.startIndex=g,j.offset=h}return j},l._cache=((l._cache=[])._length=0,l._cache),l.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],l}(),ja=function(){function c(){this.submitIndex=0,this.submitLength=0,this.context=null,this.clipRect=new B,this.screenRect=new B}m(c,"laya.webgl.submit.SubmitScissor");var a=c.prototype;return w.imps(a,{"laya.webgl.submit.ISubmit":!0}),a._scissor=function(a,b,c,d){var e=sa.worldMatrix4,f=e[0],g=e[5],h=e[12],i=e[13];if(d*=g,(c*=f)<1||d<1)return!1;var j=(a=a*f+h)+c,k=(b=b*g+i)+d;a<0&&(c=j-(a=0)),b<0&&(d=k-(b=0));var l=sa.worldClipRect;if(a=Math.max(a,l.x),b=Math.max(b,l.y),c=Math.min(j,l.right)-a,d=Math.min(k,l.bottom)-b,c<1||d<1)return!1;var m=sa.worldScissorTest;return this.screenRect.copyFrom(l),l.x=a,l.y=b,l.width=c,l.height=d,sa.worldScissorTest=!0,b=sa.height-b-d,ua.mainContext.scissor(a,b,c,d),ua.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),m?(b=sa.height-this.screenRect.y-this.screenRect.height,ua.mainContext.scissor(this.screenRect.x,b,this.screenRect.width,this.screenRect.height),ua.mainContext.enable(3089)):(ua.mainContext.disable(3089),sa.worldScissorTest=!1),l.copyFrom(this.screenRect),!0},a._scissorWithTagart=function(a,b,c,d){if(c<1||d<1)return!1;var e=a+c,f=b+d;a<0&&(c=e-(a=0)),b<0&&(d=f-(b=0));var g=sa.worldClipRect;if(a=Math.max(a,g.x),b=Math.max(b,g.y),c=Math.min(e,g.right)-a,d=Math.min(f,g.bottom)-b,c<1||d<1)return!1;var h=sa.worldScissorTest;return this.screenRect.copyFrom(g),sa.worldScissorTest=!0,g.x=a,g.y=b,g.width=c,g.height=d,b=sa.height-b-d,ua.mainContext.scissor(a,b,c,d),ua.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),h?(b=sa.height-this.screenRect.y-this.screenRect.height,ua.mainContext.scissor(this.screenRect.x,b,this.screenRect.width,this.screenRect.height),ua.mainContext.enable(3089)):(ua.mainContext.disable(3089),sa.worldScissorTest=!1),g.copyFrom(this.screenRect),!0},a.renderSubmit=function(){return this.submitLength=Math.min(this.context._submits._length-1,this.submitLength),this.submitLength<1||this.clipRect.width<1||this.clipRect.height<1||(this.context._targets?this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height):this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height)),this.submitLength+1},a.getRenderType=function(){return 0},a.releaseRender=function(){var a=c._cache;(a[a._length++]=this).context=null},c.create=function(a){var b=c._cache._length?c._cache[--c._cache._length]:new c;return b.context=a,b},c._cache=((c._cache=[])._length=0,c._cache),c}(),ka=function(){function i(){this.step=0,this.blendMode=null,this.level=0}m(i,"laya.webgl.submit.SubmitStencil");var a=i.prototype;return w.imps(a,{"laya.webgl.submit.ISubmit":!0}),a.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5();break;case 6:this.do6();break;case 7:this.do7();break;case 8:this.do8()}return 1},a.getRenderType=function(){return 0},a.releaseRender=function(){var a=i._cache;a[a._length++]=this},a.do1=function(){var a=ua.mainContext;a.enable(2960),a.clear(1024),a.colorMask(!1,!1,!1,!1),a.stencilFunc(514,this.level,255),a.stencilOp(7680,7680,7682)},a.do2=function(){var a=ua.mainContext;a.stencilFunc(514,this.level+1,255),a.colorMask(!0,!0,!0,!0),a.stencilOp(7680,7680,7680)},a.do3=function(){var a=ua.mainContext;a.colorMask(!0,!0,!0,!0),a.stencilOp(7680,7680,7680),a.clear(1024),a.disable(2960)},a.do4=function(){var a=ua.mainContext;0==this.level&&(a.enable(2960),a.clear(1024)),a.colorMask(!1,!1,!1,!1),a.stencilFunc(519,0,255),a.stencilOp(7680,7680,7682)},a.do5=function(){var a=ua.mainContext;a.stencilFunc(514,this.level,255),a.colorMask(!0,!0,!0,!0),a.stencilOp(7680,7680,7680)},a.do6=function(){var a=ua.mainContext;Q.targetFns[Q.TOINT[this.blendMode]](a)},a.do7=function(){var a=ua.mainContext;a.colorMask(!1,!1,!1,!1),a.stencilOp(7680,7680,7683)},a.do8=function(){var a=ua.mainContext;a.colorMask(!0,!0,!0,!0),a.stencilFunc(514,this.level,255),a.stencilOp(7680,7680,7680)},i.restore=function(a,b,c,d,e){var f;if((a._renderKey=0)<i._mask&&i._mask--,0==i._mask)f=laya.webgl.submit.SubmitStencil.create(3),a.addRenderObject(f),a._curSubmit=fa.RENDERBASE;else{f=laya.webgl.submit.SubmitStencil.create(7),a.addRenderObject(f);var g=a._vb;g._byteLength;if(qa.fillRectImgVb(g,null,b.x,b.y,b.width,b.height,I.DEF_UV,c,d,e,0,0)){a._shader2D.glTexture=null;var h=a._curSubmit=fa.createSubmit(a,a._ib,g,(g._byteLength-64)/32*3,ya.create(2,0));h.shaderValue.ALPHA=1,a._submits[a._submits._length++]=h,a._curSubmit._numEle+=6,a._curSubmit=fa.RENDERBASE}else alert("clipRect calc stencil rect error");f=laya.webgl.submit.SubmitStencil.create(8),a.addRenderObject(f)}},i.restore2=function(a,b){var c;(a._renderKey=0)<i._mask&&i._mask--,0==i._mask?(c=laya.webgl.submit.SubmitStencil.create(3),a.addRenderObject(c),a._curSubmit=fa.RENDERBASE):(c=laya.webgl.submit.SubmitStencil.create(7),a.addRenderObject(c),a._submits[a._submits._length++]=b,c=laya.webgl.submit.SubmitStencil.create(8),a.addRenderObject(c))},i.create=function(a){var b=i._cache._length?i._cache[--i._cache._length]:new i;return 5==(b.step=a)&&++i._mask,b.level=i._mask,b},i._cache=((i._cache=[])._length=0,i._cache),i._mask=0,i}(),la=function(){function h(){this._renderType=0,this._vb=null,this._ib=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this.proName=null,this.scope=null}m(h,"laya.webgl.submit.SubmitTarget");var a=h.prototype;return w.imps(a,{"laya.webgl.submit.ISubmit":!0}),a.renderSubmit=function(){this._vb.bind_upload(this._ib);var a=this.scope.getValue(this.proName);return a&&(this.shaderValue.texture=a.source,this.shaderValue.strength&&!this.shaderValue.blurInfo&&(this.shaderValue.blurInfo=[a.width,a.height]),this.shaderValue.upload(),this.blend(),E.drawCall++,E.trianglesFaces+=this._numEle/3,ua.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},a.blend=function(){if(Q.activeBlendFunction!==Q.fns[this.blendType]){var a=ua.mainContext;a.enable(3042),Q.fns[this.blendType](a),Q.activeBlendFunction=Q.fns[this.blendType]}},a.getRenderType=function(){return 0},a.releaseRender=function(){var a=h._cache;(a[a._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},h.create=function(a,b,c,d,e,f){var g=h._cache._length?h._cache[--h._cache._length]:new h;return g._ib=b,g._vb=c,g.proName=f,g._startIdx=d*pa.BYTES_PIDX,g._numEle=0,g.blendType=a._nBlendType,g.shaderValue=e,g.shaderValue.setValue(a._shader2D),g},h._cache=((h._cache=[])._length=0,h._cache),h}(),ma=function(){function a(){this._sourceStr=null}m(a,"laya.webgl.text.CharSegment");var b=a.prototype;return w.imps(b,{"laya.webgl.text.ICharSegment":!0}),b.textToSpit=function(a){this._sourceStr=a},b.getChar=function(a){return this._sourceStr.charAt(a)},b.getCharCode=function(a){return this._sourceStr.charCodeAt(a)},b.length=function(){return this._sourceStr.length},a}(),na=function(){var a;function E(){}return m(E,"laya.webgl.text.DrawText"),E.__init__=function(){E._charsTemp=new Array,E._drawValue=new a,E._charSeg=new ma},E.customCharSeg=function(a){E._charSeg=a},E.getChar=function(a,b,c){var d=Ta.createOneChar(a,c);return-1!=b&&(E._charsCache[b]=d),d},E._drawSlow=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p,q,r=E._drawValue.value(f,h,i,j,m,n,o),s=0,t=0,u=E._charsTemp,v=0,w=NaN;if(d)for(u.length=d.length,s=0,t=d.length;s<t;s++)(q=d[s])&&(w=q.charNum+r.txtID,u[s]=p=E._charsCache[w]||E.getChar(q.char,w,r),p.active());else{var x=c instanceof laya.utils.WordText?c.toString():c;if(H.CharacterCache){E._charSeg.textToSpit(x);var y=E._charSeg.length();for(s=0,t=u.length=y;s<t;s++)w=E._charSeg.getCharCode(s)+r.txtID,u[s]=p=E._charsCache[w]||E.getChar(E._charSeg.getChar(s),w,r),p.active(),v+=p.cw}else u.length=0,(p=E.getChar(x,-1,r)).active(),v+=p.cw,u[0]=p}var z=0;null!==g&&"left"!==g&&(z=-("center"==g?v/2:v));var A,B,C=NaN,D=0;if(d)for(s=0,t=u.length;s<t;s++)p=u[s],q=d[s],p&&q&&!p.isSpace&&(C=p.borderSize,A=p.texture,b._drawText(A,k+z+q.x*m-C,l+q.y*n-C,A.width,A.height,e,0,0,0,0));else{for(s=0,t=u.length;s<t;s++)(p=u[s])&&!p.isSpace&&(C=p.borderSize,A=p.texture,b._drawText(A,k+z-C,l-C,A.width,A.height,e,0,0,0,0),a&&((B=a[D++])||(B=a[D-1]=[]),B[0]=A,B[1]=z-C,B[2]=-C)),z+=p.cw;a&&(a.length=D)}},E._drawFast=function(a,b,c,d,e){for(var f,g,h=0,i=a.length;h<i;h++)(f=(g=a[h])[0]).active(),b._drawText(f,d+g[1],e+g[2],f.width,f.height,c,0,0,0,0)},E.drawText=function(a,b,c,d,e,f,g,h,i,j,k,l){if(void 0===l&&(l=0),!(b&&0===b.length||c&&0===c.length)){var m=d.a,n=d.d;(0!==d.b||0!==d.c)&&(m=n=1);var o=1!==m||1!==n;if(o&&w.stage.transform){var p=w.stage.transform;o=p.a===m&&p.d===n}else o=!1;if(o){var q=(d=d.copyTo(xa._tmpMatrix)).tx,r=d.ty;d.scale(1/m,1/n),d._checkTransform(),j*=m,k*=n,j+=q-d.tx,k+=r-d.ty}else m=n=1;if(c)E._drawSlow(null,a,b,c,d,e,f,g,h,i,j,k,m,n,l);else{if(null===b.toUpperCase){var s=m+1e5*n,t=b;return void(t.changed||t.id!==s?(t.id=s,t.changed=!1,E._drawSlow(t.save,a,b,c,d,e,f,g,h,i,j,k,m,n,l)):E._drawFast(t.save,a,d,j,k))}var u=b+e.toString()+g+h+i+m+n+f,v=E._textsCache[u];H.CharacterCache?v?E._drawFast(v,a,d,j,k):(E._textsCache.__length||(E._textsCache.__length=0),E._textsCache.__length>x.WebGLTextCacheCount&&((E._textsCache={}).__length=0,E._curPoolIndex=0),E._textCachesPool[E._curPoolIndex]?(v=E._textsCache[u]=E._textCachesPool[E._curPoolIndex]).length=0:E._textCachesPool[E._curPoolIndex]=v=E._textsCache[u]=[],E._textsCache.__length++,E._curPoolIndex++,E._drawSlow(v,a,b,c,d,e,f,g,h,i,j,k,m,n,l)):E._drawSlow(v,a,b,c,d,e,f,g,h,i,j,k,m,n,l)}}},E._charsTemp=null,E._textCachesPool=[],E._curPoolIndex=0,E._charsCache={},E._textsCache={},E._drawValue=null,E.d=[],E._charSeg=null,E.__init$=function(){a=function(){function i(){}return m(i,""),i.prototype.value=function(a,b,c,d,e,f,g){this.font=a,this.fillColor=b,this.borderColor=c,this.lineWidth=d,this.scaleX=e,this.scaleY=f,this.underLine=g;var h=a.toString()+e+f+d+(b?b.toLowerCase():" ")+(c?c.toLowerCase():" ")+g;return this.txtID=i._keymap[h],this.txtID||(this.txtID=1e-7*++i._keymapCount,i._keymap[h]=this.txtID),this},i.clear=function(){i._keymap={},i._keymapCount=1},i._keymap={},i._keymapCount=1,i}()},E}(),oa=function(){function e(a){this._index=0,this._size=14,this._italic=-2,e._cache2=e._cache2||[],this.setFont(a||"14px Arial")}m(e,"laya.webgl.text.FontInContext");var a=e.prototype;return a.setFont=function(a){var b=e._cache2[a];if(b)this._words=b[0],this._size=b[1];else{this._words=a.split(" ");for(var c=0,d=this._words.length;c<d;c++)if(0<this._words[c].indexOf("px")){this._index=c;break}this._size=parseInt(this._words[this._index]),e._cache2[a]=[this._words,this._size]}this._text=null,this._italic=-2},a.getItalic=function(){return-2===this._italic&&(this._italic=this.hasType("italic")),this._italic},a.hasType=function(a){for(var b=0,c=this._words.length;b<c;b++)if(this._words[b]===a)return b;return-1},a.removeType=function(a){for(var b=0,c=this._words.length;b<c;b++)if(this._words[b]===a){this._words.splice(b,1),this._index>b&&this._index--;break}this._text=null,this._italic=-2},a.copyTo=function(a){return a._text=this._text,a._size=this._size,a._index=this._index,a._words=this._words.slice(),a._italic=-2,a},a.toString=function(){return this._text?this._text:this._text=this._words.join(" ")},d(0,a,"size",function(){return this._size},function(a){this._size=a,this._words[this._index]=a+"px",this._text=null}),e.create=function(a){var b=e._cache[a];return b||(b=e._cache[a]=new e(a))},e.EMPTY=new e,e._cache={},e._cache2=null,e}(),pa=function(){function a(){}return m(a,"laya.webgl.utils.CONST3D2D"),a.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],a.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],a.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],a._TMPARRAY=[],a._OFFSETX=0,a._OFFSETY=0,g(a,["BYTES_PE",function(){return this.BYTES_PE=Float32Array.BYTES_PER_ELEMENT},"BYTES_PIDX",function(){return this.BYTES_PIDX=Uint16Array.BYTES_PER_ELEMENT}]),a}(),qa=function(){function o(){}return m(o,"laya.webgl.utils.GlUtils"),o.make2DProjection=function(a,b,c){return[2/a,0,0,0,0,-2/b,0,0,0,0,2/c,0,-1,1,0,1]},o.fillIBQuadrangle=function(a,b){if(65535/4<b)throw Error("IBQuadrangle count:"+b+" must<:"+Math.floor(65535/4));b=Math.floor(b),a._resizeBuffer(6*(b+1)*2,!1),a.byteLength=a.bufferLength;for(var c=a.getUint16Array(),d=0,e=0;e<b;e++)c[d++]=4*e,c[d++]=4*e+2,c[d++]=4*e+1,c[d++]=4*e,c[d++]=4*e+3,c[d++]=4*e+2;return a.setNeedUpload(),!0},o.expandIBQuadrangle=function(a,b){a.bufferLength>=6*b*2||o.fillIBQuadrangle(a,b)},o.mathCeilPowerOfTwo=function(a){return a--,a|=a>>1,a|=a>>2,a|=a>>4,a|=a>>8,a|=a>>16,++a},o.fillQuadrangleImgVb=function(a,b,c,d,e,f,g,h){var i=16+(a._byteLength>>2);a.byteLength=i<<2;var j=a.getFloat32Array();j[(i-=16)+2]=e[0],j[i+3]=e[1],j[i+6]=e[2],j[i+7]=e[3],j[i+10]=e[4],j[i+11]=e[5],j[i+14]=e[6],j[i+15]=e[7];var k=f.a,l=f.b,m=f.c,n=f.d;if(1!==k||0!==l||0!==m||1!==n){f.bTransform=!0;var o=f.tx+g,p=f.ty+h;j[i]=(d[0]+b)*k+(d[1]+c)*m+o,j[i+1]=(d[0]+b)*l+(d[1]+c)*n+p,j[i+4]=(d[2]+b)*k+(d[3]+c)*m+o,j[i+5]=(d[2]+b)*l+(d[3]+c)*n+p,j[i+8]=(d[4]+b)*k+(d[5]+c)*m+o,j[i+9]=(d[4]+b)*l+(d[5]+c)*n+p,j[i+12]=(d[6]+b)*k+(d[7]+c)*m+o,j[i+13]=(d[6]+b)*l+(d[7]+c)*n+p}else f.bTransform=!1,b+=f.tx+g,c+=f.ty+h,j[i]=b+d[0],j[i+1]=c+d[1],j[i+4]=b+d[2],j[i+5]=c+d[3],j[i+8]=b+d[4],j[i+9]=c+d[5],j[i+12]=b+d[6],j[i+13]=c+d[7];return a._upload=!0},o.fillTranglesVB=function(a,b,c,d,e,f,g){var h=(a._byteLength>>2)+d.length;a.byteLength=h<<2;var i=a.getFloat32Array();h-=d.length;for(var j=d.length,k=e.a,l=e.b,m=e.c,n=e.d,o=0;o<j;o+=4)if(i[h+o+2]=d[o+2],i[h+o+3]=d[o+3],1!==k||0!==l||0!==m||1!==n){e.bTransform=!0;var p=e.tx+f,q=e.ty+g;i[h+o]=(d[o]+b)*k+(d[o+1]+c)*m+p,i[h+o+1]=(d[o]+b)*l+(d[o+1]+c)*n+q}else e.bTransform=!1,b+=e.tx+f,c+=e.ty+g,i[h+o]=b+d[o],i[h+o+1]=c+d[o+1];return a._upload=!0},o.copyPreImgVb=function(a,b,c){var d=a._byteLength>>2;a.byteLength=d+16<<2;for(var e=a.getFloat32Array(),f=0,g=d-16;f<4;f++)e[d]=e[g]+b,++g,e[++d]=e[g]+c,++g,e[++d]=e[g],++g,e[++d]=e[g],++d,++g;a._upload=!0},o.fillRectImgVb=function(a,b,c,d,e,f,g,h,i,j,k,l,m){void 0===m&&(m=!1);var n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=1,E=h.a,F=h.b,G=h.c,H=h.d,I=b&&b.width<99999999;if(1!==E||0!==F||0!==G||1!==H?(h.bTransform=!0,0===F&&0===G&&(D=23,v=e+c,w=f+d,n=E*c+(x=h.tx+i),p=E*v+x,o=H*d+(y=h.ty+j),q=H*w+y)):(D=23,h.bTransform=!1,p=(n=c+h.tx+i)+e,q=(o=d+h.ty+j)+f),I&&(r=b.x,s=b.y,t=b.width+r,u=b.height+s),1!==D){if(Math.min(n,p)>=t)return!1;if(Math.min(o,q)>=u)return!1;if(Math.max(p,n)<=r)return!1;if(Math.max(q,o)<=s)return!1}var J=a._byteLength>>2;a.byteLength=16+J<<2;var K=a.getFloat32Array();switch(K[2+J]=g[0],K[3+J]=g[1],K[6+J]=g[2],K[7+J]=g[3],K[10+J]=g[4],K[11+J]=g[5],K[14+J]=g[6],K[15+J]=g[7],D){case 1:x=h.tx+i,y=h.ty+j;var L=E*c,M=G*d,N=H*d,O=F*c,P=E*(v=e+c),Q=G*(w=f+d),R=H*w,S=F*v;m?(z=L+M+x,B=Math.round(z)-z,A=N+O+y,C=Math.round(A)-A,K[J]=z+B,K[1+J]=A+C,K[4+J]=P+M+x+B,K[5+J]=N+S+y+C,K[8+J]=P+Q+x+B,K[9+J]=R+S+y+C,K[12+J]=L+Q+x+B,K[13+J]=R+O+y+C):(K[J]=L+M+x,K[1+J]=N+O+y,K[4+J]=P+M+x,K[5+J]=N+S+y,K[8+J]=P+Q+x,K[9+J]=R+S+y,K[12+J]=L+Q+x,K[13+J]=R+O+y);break;case 23:m?(z=n+k,B=Math.round(z)-z,A=o,C=Math.round(A)-A,K[J]=z+B,K[1+J]=A+C,K[4+J]=p+k+B,K[5+J]=o+C,K[8+J]=p+B,K[9+J]=q+C,K[12+J]=n+B,K[13+J]=q+C):(K[J]=n+k,K[1+J]=o,K[4+J]=p+k,K[5+J]=o,K[8+J]=p,K[9+J]=q,K[12+J]=n,K[13+J]=q)}return a._upload=!0},o.fillLineVb=function(a,b,c,d,e,f,g,h){var i=.5*g,j=o._fillLineArray,k=-(d-f),l=c-e,m=Math.sqrt(k*k+l*l);k/=m,l/=m,k*=i,l*=i,j[0]=c-k,j[1]=d-l,j[4]=c+k,j[5]=d+l,j[8]=e+k,j[9]=f+l,j[12]=e-k,j[13]=f-l,h&&h.transformPointArray(j,j);var n=16+(a._byteLength>>2);return a.byteLength=n<<2,a.insertData(j,n-16),!0},o._fillLineArray=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o}(),ra=(function(){function i(){}m(i,"laya.webgl.utils.MatirxArray"),i.ArrayMul=function(a,b,c){if(a)if(b)for(var d=NaN,e=NaN,f=NaN,g=NaN,h=0;h<4;h++)d=a[h],e=a[h+4],f=a[h+8],g=a[h+12],c[h]=d*b[0]+e*b[1]+f*b[2]+g*b[3],c[h+4]=d*b[4]+e*b[5]+f*b[6]+g*b[7],c[h+8]=d*b[8]+e*b[9]+f*b[10]+g*b[11],c[h+12]=d*b[12]+e*b[13]+f*b[14]+g*b[15];else i.copyArray(a,c);else i.copyArray(b,c)},i.copyArray=function(a,b){if(a&&b)for(var c=0;c<a.length;c++)b[c]=a[c]}}(),function(){function b(a,b,c){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=a,this._vb=new _a(a,35048),b&&this._vb._resizeBuffer(b,!1),this._ib=new $a,c&&this._ib._resizeBuffer(c,!1)}m(b,"laya.webgl.utils.Mesh2D");var a=b.prototype;return a.cloneWithNewVB=function(){var a=new b(this._stride,0,0);return a._ib=this._ib,a._quadNum=this._quadNum,a._attribInfo=this._attribInfo,a},a.cloneWithNewVBIB=function(){var a=new b(this._stride,0,0);return a._attribInfo=this._attribInfo,a},a.getVBW=function(){return this._vb.setNeedUpload(),this._vb},a.getVBR=function(){return this._vb},a.getIBR=function(){return this._ib},a.getIBW=function(){return this._ib.setNeedUpload(),this._ib},a.createQuadIB=function(a){this._quadNum=a,this._ib._resizeBuffer(6*a*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var b=this._ib.getUint16Array(),c=0,d=0,e=0;e<a;e++)b[c++]=d,b[c++]=d+2,b[c++]=d+1,b[c++]=d,b[c++]=d+3,b[c++]=d+2,d+=4;this._ib.setNeedUpload()},a.setAttributes=function(a){if(this._attribInfo=a,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},a.getEleNum=function(){return this._ib.getBuffer().byteLength/2},a.releaseMesh=function(){},a.destroy=function(){},a.clearVB=function(){this._vb.clear()},b._gvaoid=0,b}()),sa=function(){function e(){}return m(e,"laya.webgl.utils.RenderState2D"),e.getMatrArray=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},e.mat2MatArray=function(a,b){var c=a,d=b;return d[0]=c.a,d[1]=c.b,d[2]=e.EMPTYMAT4_ARRAY[2],d[3]=e.EMPTYMAT4_ARRAY[3],d[4]=c.c,d[5]=c.d,d[6]=e.EMPTYMAT4_ARRAY[6],d[7]=e.EMPTYMAT4_ARRAY[7],d[8]=e.EMPTYMAT4_ARRAY[8],d[9]=e.EMPTYMAT4_ARRAY[9],d[10]=e.EMPTYMAT4_ARRAY[10],d[11]=e.EMPTYMAT4_ARRAY[11],d[12]=c.tx,d[13]=c.ty,d[14]=e.EMPTYMAT4_ARRAY[14],d[15]=e.EMPTYMAT4_ARRAY[15],b},e.restoreTempArray=function(){e.TEMPMAT4_ARRAY[0]=1,e.TEMPMAT4_ARRAY[1]=0,e.TEMPMAT4_ARRAY[4]=0,e.TEMPMAT4_ARRAY[5]=1,e.TEMPMAT4_ARRAY[12]=0,e.TEMPMAT4_ARRAY[13]=0},e.clear=function(){e.worldScissorTest=!1,e.worldShaderDefines=null,e.worldFilters=null,e.worldAlpha=1,e.worldClipRect.x=e.worldClipRect.y=0,e.worldClipRect.width=e.width,e.worldClipRect.height=e.height,e.curRenderTarget=null},e._MAXSIZE=99999999,e.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e.worldMatrix4=e.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e.worldAlpha=1,e.worldScissorTest=!1,e.worldFilters=null,e.worldShaderDefines=null,e.curRenderTarget=null,e.width=0,e.height=0,g(e,["worldMatrix",function(){return this.worldMatrix=new z},"worldClipRect",function(){return this.worldClipRect=new B(0,0,99999999,99999999)}]),e}(),ta=function(){var s,c;function t(a,b,c,d,e){var f=this;function g(a){var b=[],c=new s(b);return f._compileToTree(c,a.split("\n"),0,b,e),c}var h=n.now();this._VS=g(b),this._PS=g(c),this._nameMap=d,2<n.now()-h&&console.log("ShaderCompile use time:"+(n.now()-h)+"  size:"+b.length+"/"+c.length)}m(t,"laya.webgl.utils.ShaderCompile");var a=t.prototype;return a._compileToTree=function(a,b,c,d,e){var f,g,h,i,j,k,l,m=0,n=0,o=0,p=0;for(n=c;n<b.length;n++)if(!((h=b[n]).length<1)&&0!==(m=h.indexOf("//"))){if(0<=m&&(h=h.substr(0,m)),f=l||new s(d),l=null,f.text=h,f.noCompile=!0,0<=(m=h.indexOf("#"))){for(i="#",p=m+1,o=h.length;p<o;p++){var q=h.charAt(p);if(" "===q||"\t"===q||"\r"===q||"\n"===q||"?"===q)break;i+=q}switch(f.name=i){case"#ifdef":case"#ifndef":if(f.src=h,f.noCompile=null!=h.match(/[!&|()=<>]/),f.noCompile?console.log("function():Boolean{return "+h.substr(m+f.name.length)+"}"):(k=h.replace(/^\s*/,"").split(/\s+/),f.setCondition(k[1],"#ifdef"===i?1:2),f.text="//"+f.text),f.setParent(a),a=f,e)for(k=h.substr(p).split(t._splitToWordExps3),p=0;p<k.length;p++)(h=k[p]).length&&(e[h]=!0);continue;case"#if":if(f.src=h,f.noCompile=!0,f.setParent(a),a=f,e)for(k=h.substr(p).split(t._splitToWordExps3),p=0;p<k.length;p++)(h=k[p]).length&&"defined"!=h&&(e[h]=!0);continue;case"#else":f.src=h,g=(a=a.parent).childs[a.childs.length-1],f.noCompile=g.noCompile,f.noCompile||(f.condition=g.condition,f.conditionType=1==g.conditionType?2:1,f.text="//"+f.text+" "+g.text+" "+f.conditionType),f.setParent(a),a=f;continue;case"#endif":g=(a=a.parent).childs[a.childs.length-1],f.noCompile=g.noCompile,f.noCompile||(f.text="//"+f.text),f.setParent(a);continue;case"#include":k=t.splitToWords(h,null);var r=t.includes[k[1]];if(!r)throw"ShaderCompile error no this include file:"+k[1];if((m=k[0].indexOf("?"))<0){f.setParent(a),h=r.getWith("with"==k[2]?k[3]:null),this._compileToTree(f,h.split("\n"),0,d,e),f.text="";continue}f.setCondition(k[0].substr(m+1),1),f.text=r.getWith("with"==k[2]?k[3]:null);break;case"#import":j=(k=t.splitToWords(h,null))[1],d.push({node:f,file:t.includes[j],ofs:f.text.length});continue}}else{if((g=a.childs[a.childs.length-1])&&!g.name){0<d.length&&t.splitToWords(h,g),l=f,g.text+="\n"+h;continue}0<d.length&&t.splitToWords(h,f)}f.setParent(a)}},a.createShader=function(a,b,c){var d={},e="";if(a)for(var f in a)e+="#define "+f+"\n",d[f]=!0;var g=this._VS.toscript(d,[]),h=this._PS.toscript(d,[]);return(c||Wa.create)(e+g.join("\n"),e+h.join("\n"),b,this._nameMap)},t._parseOne=function(a,b,c,d,e,f){var g={type:t.shaderParamsMap[c[d+1]],name:c[d+2],size:isNaN(parseInt(c[d+3]))?1:parseInt(c[d+3])};return f&&("attribute"==e?a.push(g):b.push(g)),":"==c[d+3]&&(g.type=c[d+4],d+=2),d+=2},t.addInclude=function(a,b){if(!b||0===b.length)throw new Error("add shader include file err:"+a);if(t.includes[a])throw new Error("add shader include file err, has add:"+a);t.includes[a]=new c(b)},t.preGetParams=function(a,b){var c=[a,b],d={},e=[],f=[],g={},h=[];d.attributes=e,d.uniforms=f,d.defines=g;for(var i=0,j=0,k=0;k<2;k++){c[k]=c[k].replace(t._removeAnnotation,"");var l,m=c[k].match(t._reg);for(i=0,j=m.length;i<j;i++){var n=m[i];if("attribute"==n||"uniform"==n)i=t._parseOne(e,f,m,i,n,!0);else{if("#define"==n){h[n=m[++i]]=1;continue}if("#ifdef"==n){g[l=m[++i]]=g[l]||[];for(i++;i<j;i++)if("attribute"==(n=m[i])||"uniform"==n)i=t._parseOne(e,f,m,i,n,h[l]);else if("#else"==n)for(i++;i<j;i++)if("attribute"==(n=m[i])||"uniform"==n)i=t._parseOne(e,f,m,i,n,!h[l]);else if("#endif"==n)break}}}}return d},t.splitToWords=function(a,b){for(var c,d,e=[],f=-1,g=0,h=a.length;g<h;g++)if(c=a.charAt(g),0<=" \t=+-*/&%!<>()'\",;".indexOf(c)){if(0<=f&&1<g-f&&(d=a.substr(f,g-f),e.push(d)),'"'==c||"'"==c){var i=a.indexOf(c,g+1);if(i<0)throw"Sharder err:"+a;e.push(a.substr(g+1,i-g-1)),g=i,f=-1;continue}"("==c&&b&&0<e.length&&(d=e[e.length-1]+";","vec4;main;".indexOf(d)<0&&(b.useFuns+=d)),f=-1}else f<0&&(f=g);return f<h&&1<h-f&&(d=a.substr(f,h-f),e.push(d)),e},t.IFDEF_NO=0,t.IFDEF_YES=1,t.IFDEF_ELSE=2,t.IFDEF_PARENT=3,t._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),t._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),t._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),t.includes={},g(t,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),t.__init$=function(){s=function(){function c(a){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=a}m(c,"");var a=c.prototype;return a.setParent=function(a){a.childs.push(this),this.z=a.z+1,this.parent=a},a.setCondition=function(a,b){a&&(this.conditionType=b,a=a.replace(/(\s*$)/g,""),this.condition=function(){return this[a]},this.condition.__condition=a)},a.toscript=function(a,b){return this._toscript(a,b,++c.__id)},a._toscript=function(d,e,f){if(this.childs.length<1&&!this.text)return e;e.length;if(this.condition){var a=!!this.condition.call(d);if(2===this.conditionType&&(a=!a),!a)return e}if(this.text&&e.push(this.text),0<this.childs.length&&this.childs.forEach(function(a,b,c){a._toscript(d,e,f)}),0<this.includefiles.length&&0<this.useFuns.length)for(var b,c=0,g=this.includefiles.length;c<g;c++)this.includefiles[c].curUseID!=f&&0<(b=this.includefiles[c].file.getFunsScript(this.useFuns)).length&&(this.includefiles[c].curUseID=f,e[0]=b+e[0]);return e},c.__id=1,c}(),c=function(){function a(a){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=a;for(var b=0,c=0,d=0;!((b=a.indexOf("#begin",b))<0);){for(d=b+5;!((d=a.indexOf("#end",d))<0)&&"i"===a.charAt(d+4);)d+=5;if(d<0)throw"add include err,no #end:"+a;c=a.indexOf("\n",b);var e=t.splitToWords(a.substr(b,c-b),null);"code"==e[1]?this.codes[e[2]]=a.substr(c+1,d-c-1):"function"==e[1]&&(c=a.indexOf("function",b),c+="function".length,this.funs[e[3]]=a.substr(c+1,d-c-1),this.funnames+=e[3]+";"),b=d+1}}m(a,"");var b=a.prototype;return b.getWith=function(a){var b=a?this.codes[a]:this.script;if(!b)throw"get with error:"+a;return b},b.getFunsScript=function(a){var b="";for(var c in this.funs)0<=a.indexOf(c+";")&&(b+=this.funs[c]);return b},a}()},t}(),ua=function(){function g(){}return m(g,"laya.webgl.WebGL"),g._uint8ArraySlice=function(){for(var a=this.length,b=new Uint8Array(this.length),c=0;c<a;c++)b[c]=this[c];return b},g._float32ArraySlice=function(){for(var a=this.length,b=new Float32Array(this.length),c=0;c<a;c++)b[c]=this[c];return b},g._uint16ArraySlice=function(a){var b,c=arguments,d=0,e=0;if(0===c.length)for(d=this.length,b=new Uint16Array(d),e=0;e<d;e++)b[e]=this[e];else if(2===c.length){var f=c[0],g=c[1];if(f<g)for(d=g-f,b=new Uint16Array(d),e=f;e<g;e++)b[e-f]=this[e];else b=new Uint16Array(0)}return b},g.expandContext=function(){var a=e.prototype,b=CanvasRenderingContext2D.prototype;b.fillTrangles=a.fillTrangles,Xa.__int__(null),b.setIBVB=function(a,b,c,d,e,f,g,h,i,j){void 0===i&&(i=0),void 0===j&&(j=0),null===c&&(this._ib=this._ib||$a.QuadrangleIB,c=this._ib,qa.expandIBQuadrangle(c,d._byteLength/64+8)),this._setIBVB(a,b,c,d,e,f,g,h,i,j)},b.fillTrangles=function(a,b,c,d,e){this._curMat=this._curMat||z.create(),this._vb=this._vb||_a.create(),this._ib||(this._ib=$a.create(),qa.fillIBQuadrangle(this._ib,g/4));var f=this._vb,g=d.length>>4;qa.fillTranglesVB(f,b,c,d,e||this._curMat,0,0),qa.expandIBQuadrangle(this._ib,f._byteLength/64+8);var h=new ya(1,0);h.textureHost=a;var i=new Za("attribute vec2 position; attribute vec2 texcoord; uniform vec2 size; uniform mat4 mmat; varying vec2 v_texcoord; void main() { vec4 p=vec4(position.xy,0.0,1.0);vec4 pos=mmat*p; gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0); v_texcoord = texcoord; }","precision mediump float; varying vec2 v_texcoord; uniform sampler2D texture; #ifdef TXTALPHA uniform sampler2D texture1; #endif void main() {vec4 color= texture2D(texture, v_texcoord); #ifdef TXTALPHA color.a = texture2D(texture1, v_texcoord).a; #endif color.a*=1.0; gl_FragColor= color;}");f._vertType=3,this._setIBVB(b,c,this._ib,f,6*g,e,i,h,0,0)}},g.enable=function(){if(n.__init__(),r.isConchApp&&!r.isConchWebGL)return v.skinAniSprite=function(){return new aa},g.expandContext(),!1;if(v.getWebGLContext=function(a){for(var b,c=["webgl","experimental-webgl","webkit-3d","moz-webgl"],d=0;d<c.length;d++){try{b=a.getContext(c[d],{stencil:x.isStencil,alpha:x.isAlpha,antialias:x.isAntialias,premultipliedAlpha:x.premultipliedAlpha,preserveDrawingBuffer:x.preserveDrawingBuffer})}catch(a){}if(b)return b}return null},null==(g.mainContext=v.getWebGLContext(r._mainCanvas)))return!1;if(r.isWebGL)return!0;p.create=function(a,b){return new ab(a,b)},q.create=function(a,b,c,d,e,f,g){return new Va(a,b,c,d,e,f,g)},r.WebGL=g,r.isWebGL=!0,na.__init__(),v.createRenderSprite=function(a,b){return new za(a,b)},v.createWebGLContext2D=function(a){return new xa(a)},v.changeWebGLSize=function(a,b){laya.webgl.WebGL.onStageResize(a,b)},v.createGraphics=function(){return new wa};var a=v.createFilterAction;return v.createFilterAction=a||function(a){return new Aa},v.clear=function(a){sa.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var b=r.context.ctx,c=0==b._submits._length||x.preserveDrawingBuffer?o.create(a)._color:D._wgColor;c&&b.clearBG(c[0],c[1],c[2],c[3]),sa.clear()},v.addToAtlas=function(a,b){void 0===b&&(b=!1);var c=a.bitmap;r.optimizeTextureMemory(a.url,a)?w.__typeof(c,"laya.webgl.resource.IMergeAtlasBitmap")&&c.allowMerageInAtlas&&c.on("recovered",a,a.addTextureToAtlas):c.enableMerageInAtlas=!1},v.isAtlas=function(a){return a instanceof laya.webgl.atlas.AtlasWebGLCanvas},O._enable(),v.beginFlush=function(){for(var a=O.instance,b=a.getAtlaserCount(),c=0;c<b;c++){var d=a.getAtlaserByIndex(c).texture;d._flashCacheImageNeedFlush&&v.flashFlushImage(d)}},v.drawToCanvas=function(a,b,c,d,e,f){(c<=0||d<=0)&&console.log("[error] canvasWidth and canvasHeight should greater than zero"),c|=0,d|=0,e|=0,f|=0;var g=Ka.create(c,d,6408,5121,0,!1);g.start(),g.clear(0,0,0,0),r.context.clear(),s.renders[b]._fun(a,r.context,e,sa.height-d+f),r.context.flush(),g.end();var h=g.getData(0,0,c,d);if(g.recycle(),h.byteLength==c*d*4){var i=new Sa;i._canvas=n.createElement("canvas"),i.size(c,d);var j=i._canvas.getContext("2d");n.canvas.size(c,d);var k=n.context,l=k.createImageData(c,d);return l.data.set(new Uint8ClampedArray(h.buffer)),i._imgData=l,k.putImageData(l,0,0),j.save(),j.translate(0,d),j.scale(1,-1),j.drawImage(n.canvas.source,0,0),j.restore(),i}console.log("drawToCanvas error: w:"+c+",h:"+d+",datalen:"+h.byteLength)},v.createFilterAction=function(a){var b;switch(a){case 32:b=new Aa}return b},v.addTextureToAtlas=function(a){a._uvID++,O._atlasRestore++,a.bitmap.enableMerageInAtlas&&O.instance.addToAtlas(a)},v.getTexturePixels=function(a,b,c,d,e){r.context.ctx.clear();var f=new C;f.graphics.drawTexture(a,-b,-c);var g=Ka.create(d,e);g.start(),g.clear(0,0,0,0),f.render(r.context,0,0),r.context.ctx.flush(),g.end();for(var h=g.getData(0,0,d,e),i=[],j=0,k=e-1;0<=k;k--)for(var l=0;l<d;l++)j=4*(k*d+l),i.push(h[j]),i.push(h[j+1]),i.push(h[j+2]),i.push(h[j+3]);return i},v.skinAniSprite=function(){return new aa},j.create=function(a,b){var c=new Sa;return c._imgData=b,c.flipY=!1,c},y._filterStart=function(a,b,c,d,e){var f=a.getValue("bounds"),g=Ka.create(f.width,f.height);if(g.start(),g.clear(0,0,0,0),a.addValue("src",g),a.addValue("ScissorTest",sa.worldScissorTest),sa.worldScissorTest){var h=new B;h.copyFrom(c.ctx._clipRect),a.addValue("clipRect",h),sa.worldScissorTest=!1,laya.webgl.WebGL.mainContext.disable(3089)}},y._filterEnd=function(a,b,c,d,e){var f=a.getValue("bounds");a.getValue("src").end();var g=Ka.create(f.width,f.height);g.start(),g.clear(0,0,0,0),a.addValue("out",g),b._set$P("_filterCache",g),b._set$P("_isHaveGlowFilter",a.getValue("_isHaveGlowFilter"))},y._EndTarget=function(a,b){if(a.getValue("src").recycle(),a.getValue("out").end(),a.getValue("ScissorTest")){sa.worldScissorTest=!0,laya.webgl.WebGL.mainContext.enable(3089),b.ctx.save();var c=a.getValue("clipRect");b.ctx.clipRect(c.x,c.y,c.width,c.height)}},y._useSrc=function(a){var b=a.getValue("out");b.end(),(b=a.getValue("src")).start(),b.clear(0,0,0,0)},y._endSrc=function(a){a.getValue("src").end()},y._useOut=function(a){var b=a.getValue("src");b.end(),(b=a.getValue("out")).start(),b.clear(0,0,0,0)},y._endOut=function(a){a.getValue("out").end()},y._recycleScope=function(a){a.recycle()},y._filter=function(a,b,c,d){var e=this._next;if(e){var f,g,h=a.filters,i=h.length;if(1==i&&32==h[0].type)return b.ctx.save(),b.ctx.setFilters([h[0]]),e._fun.call(e,a,b,c,d),void b.ctx.restore();var j=ha.create(),k=A.TEMP,l=b.ctx._getTransformMatrix(),m=z.create();l.copyTo(m);var n=0,o=0,p=!1,q=a._$P._filterCache?a._$P._filterCache:null;if(!q||a._repaint){p=a._isHaveGlowFilter(),j.addValue("_isHaveGlowFilter",p),p&&(n=50,o=25),(g=new B).copyFrom(a.getSelfBounds()),g.x+=a.x,g.y+=a.y,g.x-=a.pivotX+4,g.y-=a.pivotY+4;var r=g.x,s=g.y;if(g.width+=n+8,g.height+=n+8,k.x=g.x*m.a+g.y*m.c,k.y=g.y*m.d+g.x*m.b,g.x=k.x,g.y=k.y,k.x=g.width*m.a+g.height*m.c,k.y=g.height*m.d+g.width*m.b,g.width=k.x,g.height=k.y,g.width<=0||g.height<=0)return;q&&q.recycle(),j.addValue("bounds",g);var t=ga.create([j,a,b,0,0],y._filterStart);b.addRenderObject(t),b.ctx._renderKey=0,b.ctx._shader2D.glTexture=null;var u=a.x-r+o,v=a.y-s+o;e._fun.call(e,a,b,u,v),t=ga.create([j,a,b,0,0],y._filterEnd),b.addRenderObject(t);for(var w=0;w<i;w++){0!=w&&(t=ga.create([j],y._useSrc),b.addRenderObject(t),f=ya.create(1,0),z.TEMP.identity(),b.ctx.drawTarget(j,0,0,g.width,g.height,z.TEMP,"out",f,null,Q.TOINT.overlay),t=ga.create([j],y._useOut),b.addRenderObject(t)),h[w].action.apply3d(j,a,b,0,0)}t=ga.create([j,b],y._EndTarget),b.addRenderObject(t)}else{if((p=!!a._$P._isHaveGlowFilter&&a._$P._isHaveGlowFilter)&&(n=50,o=25),(g=a.getBounds()).width<=0||g.height<=0)return;g.width+=n,g.height+=n,k.x=g.x*m.a+g.y*m.c,k.y=g.y*m.d+g.x*m.b,g.x=k.x,g.y=k.y,k.x=g.width*m.a+g.height*m.c,k.y=g.height*m.d+g.width*m.b,g.width=k.x,g.height=k.y,j.addValue("out",q)}c=c-o-a.x,d=d-o-a.y,k.setTo(c,d),m.transformPoint(k),c=k.x+g.x,d=k.y+g.y,f=ya.create(1,0),z.TEMP.identity(),b.ctx.drawTarget(j,c,d,g.width,g.height,z.TEMP,"out",f,null,Q.TOINT.overlay),t=ga.create([j],y._recycleScope),b.addRenderObject(t),m.destroy()}},Float32Array.prototype.slice||(Float32Array.prototype.slice=g._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=g._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=g._uint8ArraySlice),!0},g.onStageResize=function(a,b){null!=g.mainContext&&(g.mainContext.viewport(0,0,a,b),sa.width=a,sa.height=b)},g.onInvalidGLRes=function(){O.instance.freeAll(),u.releaseContentManagers(!0),g.doNodeRepaint(w.stage),g.mainContext.viewport(0,0,sa.width,sa.height),w.stage.event("devicelost")},g.doNodeRepaint=function(a){0==a.numChildren&&a.repaint();for(var b=0;b<a.numChildren;b++)g.doNodeRepaint(a.getChildAt(b))},g.init=function(a,b,c){g.mainCanvas=a,j._createContext=function(a){return new xa(a)},Sa._createContext=function(a){return new xa(a)};var d=laya.webgl.WebGL.mainContext;if(null!=d.getShaderPrecisionFormat){var e=d.getShaderPrecisionFormat(35633,36338),f=d.getShaderPrecisionFormat(35632,36338);g.shaderHighPrecision=!(!e.precision||!f.precision)}else g.shaderHighPrecision=!1;if(g.compressAstc=d.getExtension("WEBGL_compressed_texture_astc"),g.compressAtc=d.getExtension("WEBGL_compressed_texture_atc"),g.compressEtc=d.getExtension("WEBGL_compressed_texture_etc"),g.compressEtc1=d.getExtension("WEBGL_compressed_texture_etc1"),g.compressPvrtc=d.getExtension("WEBGL_compressed_texture_pvrtc"),g.compressS3tc=d.getExtension("WEBGL_compressed_texture_s3tc"),g.compressS3tc_srgb=d.getExtension("WEBGL_compressed_texture_s3tc_srgb"),g.compressAstc=g.compressAstc?g.compressAstc:{},g.compressAtc=g.compressAtc?g.compressAtc:{},g.compressEtc=g.compressEtc?g.compressEtc:{},g.compressEtc1=g.compressEtc1?g.compressEtc1:{},g.compressPvrtc=g.compressPvrtc?g.compressPvrtc:{},g.compressS3tc=g.compressS3tc?g.compressS3tc:{},g.compressS3tc_srgb=g.compressS3tc_srgb?g.compressS3tc_srgb:{},d.deleteTexture1=d.deleteTexture,d.deleteTexture=function(a){a==va.curBindTexValue&&(va.curBindTexValue=null),d.deleteTexture1(a)},g.onStageResize(b,c),null==g.mainContext)throw new Error("webGL getContext err!");G.__init__(),O.__init__(),Ca.__init__(),fa.__init__(),xa.__init__(),ya.__init__(),$.__init__(),Xa.__int__(d),Q._init_(d),r.isConchApp&&conch.setOnInvalidGLRes(g.onInvalidGLRes)},g.compressAstc={},g.compressAtc={},g.compressEtc={},g.compressEtc1={},g.compressPvrtc={},g.compressS3tc={},g.compressS3tc_srgb={},g.mainCanvas=null,g.mainContext=null,g.antialias=!0,g.shaderHighPrecision=!1,g._bg_null=[0,0,0,0],g}(),va=function(){function d(){}return m(d,"laya.webgl.WebGLContext"),d.UseProgram=function(a){return d._useProgram!==a&&(ua.mainContext.useProgram(a),d._useProgram=a,!0)},d.setDepthTest=function(a,b){b!==d._depthTest&&((d._depthTest=b)?a.enable(2929):a.disable(2929))},d.setDepthMask=function(a,b){b!==d._depthMask&&(d._depthMask=b,a.depthMask(b))},d.setDepthFunc=function(a,b){b!==d._depthFunc&&(d._depthFunc=b,a.depthFunc(b))},d.setBlend=function(a,b){b!==d._blend&&((d._blend=b)?a.enable(3042):a.disable(3042))},d.setBlendFunc=function(a,b,c){(b!==d._sFactor||c!==d._dFactor)&&(d._sFactor=b,d._dFactor=c,a.blendFunc(b,c))},d.setCullFace=function(a,b){b!==d._cullFace&&((d._cullFace=b)?a.enable(2884):a.disable(2884))},d.setFrontFace=function(a,b){b!==d._frontFace&&(d._frontFace=b,a.frontFace(b))},d.bindTexture=function(a,b,c){a.bindTexture(b,c),d.curBindTexTarget=b,d.curBindTexValue=c},d.DEPTH_BUFFER_BIT=256,d.STENCIL_BUFFER_BIT=1024,d.COLOR_BUFFER_BIT=16384,d.POINTS=0,d.LINES=1,d.LINE_LOOP=2,d.LINE_STRIP=3,d.TRIANGLES=4,d.TRIANGLE_STRIP=5,d.TRIANGLE_FAN=6,d.ZERO=0,d.ONE=1,d.SRC_COLOR=768,d.ONE_MINUS_SRC_COLOR=769,d.SRC_ALPHA=770,d.ONE_MINUS_SRC_ALPHA=771,d.DST_ALPHA=772,d.ONE_MINUS_DST_ALPHA=773,d.DST_COLOR=774,d.ONE_MINUS_DST_COLOR=775,d.SRC_ALPHA_SATURATE=776,d.FUNC_ADD=32774,d.BLEND_EQUATION=32777,d.BLEND_EQUATION_RGB=32777,d.BLEND_EQUATION_ALPHA=34877,d.FUNC_SUBTRACT=32778,d.FUNC_REVERSE_SUBTRACT=32779,d.BLEND_DST_RGB=32968,d.BLEND_SRC_RGB=32969,d.BLEND_DST_ALPHA=32970,d.BLEND_SRC_ALPHA=32971,d.CONSTANT_COLOR=32769,d.ONE_MINUS_CONSTANT_COLOR=32770,d.CONSTANT_ALPHA=32771,d.ONE_MINUS_CONSTANT_ALPHA=32772,d.BLEND_COLOR=32773,d.ARRAY_BUFFER=34962,d.ELEMENT_ARRAY_BUFFER=34963,d.ARRAY_BUFFER_BINDING=34964,d.ELEMENT_ARRAY_BUFFER_BINDING=34965,d.STREAM_DRAW=35040,d.STATIC_DRAW=35044,d.DYNAMIC_DRAW=35048,d.BUFFER_SIZE=34660,d.BUFFER_USAGE=34661,d.CURRENT_VERTEX_ATTRIB=34342,d.FRONT=1028,d.BACK=1029,d.CULL_FACE=2884,d.FRONT_AND_BACK=1032,d.BLEND=3042,d.DITHER=3024,d.STENCIL_TEST=2960,d.DEPTH_TEST=2929,d.SCISSOR_TEST=3089,d.POLYGON_OFFSET_FILL=32823,d.SAMPLE_ALPHA_TO_COVERAGE=32926,d.SAMPLE_COVERAGE=32928,d.NO_ERROR=0,d.INVALID_ENUM=1280,d.INVALID_VALUE=1281,d.INVALID_OPERATION=1282,d.OUT_OF_MEMORY=1285,d.CW=2304,d.CCW=2305,d.LINE_WIDTH=2849,d.ALIASED_POINT_SIZE_RANGE=33901,d.ALIASED_LINE_WIDTH_RANGE=33902,d.CULL_FACE_MODE=2885,d.FRONT_FACE=2886,d.DEPTH_RANGE=2928,d.DEPTH_WRITEMASK=2930,d.DEPTH_CLEAR_VALUE=2931,d.DEPTH_FUNC=2932,d.STENCIL_CLEAR_VALUE=2961,d.STENCIL_FUNC=2962,d.STENCIL_FAIL=2964,d.STENCIL_PASS_DEPTH_FAIL=2965,d.STENCIL_PASS_DEPTH_PASS=2966,d.STENCIL_REF=2967,d.STENCIL_VALUE_MASK=2963,d.STENCIL_WRITEMASK=2968,d.STENCIL_BACK_FUNC=34816,d.STENCIL_BACK_FAIL=34817,d.STENCIL_BACK_PASS_DEPTH_FAIL=34818,d.STENCIL_BACK_PASS_DEPTH_PASS=34819,d.STENCIL_BACK_REF=36003,d.STENCIL_BACK_VALUE_MASK=36004,d.STENCIL_BACK_WRITEMASK=36005,d.VIEWPORT=2978,d.SCISSOR_BOX=3088,d.COLOR_CLEAR_VALUE=3106,d.COLOR_WRITEMASK=3107,d.UNPACK_ALIGNMENT=3317,d.PACK_ALIGNMENT=3333,d.MAX_TEXTURE_SIZE=3379,d.MAX_VIEWPORT_DIMS=3386,d.SUBPIXEL_BITS=3408,d.RED_BITS=3410,d.GREEN_BITS=3411,d.BLUE_BITS=3412,d.ALPHA_BITS=3413,d.DEPTH_BITS=3414,d.STENCIL_BITS=3415,d.POLYGON_OFFSET_UNITS=10752,d.POLYGON_OFFSET_FACTOR=32824,d.TEXTURE_BINDING_2D=32873,d.SAMPLE_BUFFERS=32936,d.SAMPLES=32937,d.SAMPLE_COVERAGE_VALUE=32938,d.SAMPLE_COVERAGE_INVERT=32939,d.NUM_COMPRESSED_TEXTURE_FORMATS=34466,d.COMPRESSED_TEXTURE_FORMATS=34467,d.DONT_CARE=4352,d.FASTEST=4353,d.NICEST=4354,d.GENERATE_MIPMAP_HINT=33170,d.BYTE=5120,d.UNSIGNED_BYTE=5121,d.SHORT=5122,d.UNSIGNED_SHORT=5123,d.INT=5124,d.UNSIGNED_INT=5125,d.FLOAT=5126,d.DEPTH_COMPONENT=6402,d.ALPHA=6406,d.RGB=6407,d.RGBA=6408,d.LUMINANCE=6409,d.LUMINANCE_ALPHA=6410,d.UNSIGNED_SHORT_4_4_4_4=32819,d.UNSIGNED_SHORT_5_5_5_1=32820,d.UNSIGNED_SHORT_5_6_5=33635,d.FRAGMENT_SHADER=35632,d.VERTEX_SHADER=35633,d.MAX_VERTEX_ATTRIBS=34921,d.MAX_VERTEX_UNIFORM_VECTORS=36347,d.MAX_VARYING_VECTORS=36348,d.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,d.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,d.MAX_TEXTURE_IMAGE_UNITS=34930,d.MAX_FRAGMENT_UNIFORM_VECTORS=36349,d.SHADER_TYPE=35663,d.DELETE_STATUS=35712,d.LINK_STATUS=35714,d.VALIDATE_STATUS=35715,d.ATTACHED_SHADERS=35717,d.ACTIVE_UNIFORMS=35718,d.ACTIVE_ATTRIBUTES=35721,d.SHADING_LANGUAGE_VERSION=35724,d.CURRENT_PROGRAM=35725,d.NEVER=512,d.LESS=513,d.EQUAL=514,d.LEQUAL=515,d.GREATER=516,d.NOTEQUAL=517,d.GEQUAL=518,d.ALWAYS=519,d.KEEP=7680,d.REPLACE=7681,d.INCR=7682,d.DECR=7683,d.INVERT=5386,d.INCR_WRAP=34055,d.DECR_WRAP=34056,d.VENDOR=7936,d.RENDERER=7937,d.VERSION=7938,d.NEAREST=9728,d.LINEAR=9729,d.NEAREST_MIPMAP_NEAREST=9984,d.LINEAR_MIPMAP_NEAREST=9985,d.NEAREST_MIPMAP_LINEAR=9986,d.LINEAR_MIPMAP_LINEAR=9987,d.TEXTURE_MAG_FILTER=10240,d.TEXTURE_MIN_FILTER=10241,d.TEXTURE_WRAP_S=10242,d.TEXTURE_WRAP_T=10243,d.TEXTURE_2D=3553,d.TEXTURE=5890,d.TEXTURE_CUBE_MAP=34067,d.TEXTURE_BINDING_CUBE_MAP=34068,d.TEXTURE_CUBE_MAP_POSITIVE_X=34069,d.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,d.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,d.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,d.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,d.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,d.MAX_CUBE_MAP_TEXTURE_SIZE=34076,d.TEXTURE0=33984,d.TEXTURE1=33985,d.TEXTURE2=33986,d.TEXTURE3=33987,d.TEXTURE4=33988,d.TEXTURE5=33989,d.TEXTURE6=33990,d.TEXTURE7=33991,d.TEXTURE8=33992,d.TEXTURE9=33993,d.TEXTURE10=33994,d.TEXTURE11=33995,d.TEXTURE12=33996,d.TEXTURE13=33997,d.TEXTURE14=33998,d.TEXTURE15=33999,d.TEXTURE16=34e3,d.TEXTURE17=34001,d.TEXTURE18=34002,d.TEXTURE19=34003,d.TEXTURE20=34004,d.TEXTURE21=34005,d.TEXTURE22=34006,d.TEXTURE23=34007,d.TEXTURE24=34008,d.TEXTURE25=34009,d.TEXTURE26=34010,d.TEXTURE27=34011,d.TEXTURE28=34012,d.TEXTURE29=34013,d.TEXTURE30=34014,d.TEXTURE31=34015,d.ACTIVE_TEXTURE=34016,d.REPEAT=10497,d.CLAMP_TO_EDGE=33071,d.MIRRORED_REPEAT=33648,d.FLOAT_VEC2=35664,d.FLOAT_VEC3=35665,d.FLOAT_VEC4=35666,d.INT_VEC2=35667,d.INT_VEC3=35668,d.INT_VEC4=35669,d.BOOL=35670,d.BOOL_VEC2=35671,d.BOOL_VEC3=35672,d.BOOL_VEC4=35673,d.FLOAT_MAT2=35674,d.FLOAT_MAT3=35675,d.FLOAT_MAT4=35676,d.SAMPLER_2D=35678,d.SAMPLER_CUBE=35680,d.VERTEX_ATTRIB_ARRAY_ENABLED=34338,d.VERTEX_ATTRIB_ARRAY_SIZE=34339,d.VERTEX_ATTRIB_ARRAY_STRIDE=34340,d.VERTEX_ATTRIB_ARRAY_TYPE=34341,d.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,d.VERTEX_ATTRIB_ARRAY_POINTER=34373,d.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,d.COMPILE_STATUS=35713,d.LOW_FLOAT=36336,d.MEDIUM_FLOAT=36337,d.HIGH_FLOAT=36338,d.LOW_INT=36339,d.MEDIUM_INT=36340,d.HIGH_INT=36341,d.FRAMEBUFFER=36160,d.RENDERBUFFER=36161,d.RGBA4=32854,d.RGB5_A1=32855,d.RGB565=36194,d.DEPTH_COMPONENT16=33189,d.STENCIL_INDEX=6401,d.STENCIL_INDEX8=36168,d.DEPTH_STENCIL=34041,d.RENDERBUFFER_WIDTH=36162,d.RENDERBUFFER_HEIGHT=36163,d.RENDERBUFFER_INTERNAL_FORMAT=36164,d.RENDERBUFFER_RED_SIZE=36176,d.RENDERBUFFER_GREEN_SIZE=36177,d.RENDERBUFFER_BLUE_SIZE=36178,d.RENDERBUFFER_ALPHA_SIZE=36179,d.RENDERBUFFER_DEPTH_SIZE=36180,d.RENDERBUFFER_STENCIL_SIZE=36181,d.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,d.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,d.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,d.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,d.COLOR_ATTACHMENT0=36064,d.DEPTH_ATTACHMENT=36096,d.STENCIL_ATTACHMENT=36128,d.DEPTH_STENCIL_ATTACHMENT=33306,d.NONE=0,d.FRAMEBUFFER_COMPLETE=36053,d.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,d.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,d.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,d.FRAMEBUFFER_UNSUPPORTED=36061,d.FRAMEBUFFER_BINDING=36006,d.RENDERBUFFER_BINDING=36007,d.MAX_RENDERBUFFER_SIZE=34024,d.INVALID_FRAMEBUFFER_OPERATION=1286,d.UNPACK_FLIP_Y_WEBGL=37440,d.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,d.CONTEXT_LOST_WEBGL=37442,d.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,d.BROWSER_DEFAULT_WEBGL=37444,d._useProgram=null,d._depthTest=!0,d._depthMask=!0,d._blend=!1,d._cullFace=!1,d.curBindTexTarget=null,d.curBindTexValue=null,g(d,["_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),d}(),wa=function(a){function b(){b.__super.call(this)}m(b,"laya.webgl.display.GraphicsGL",h);var c=b.prototype;return c.setShader=function(a){this._saveToCmd(r.context._setShader,[a])},c.setIBVB=function(a,b,c,d,e,f){this._saveToCmd(r.context._setIBVB,[a,b,c,d,e,f])},c.drawParticle=function(a,b,c){var d=v.createParticleTemplate2D(c);d.x=a,d.y=b,this._saveToCmd(r.context._drawParticle,[d])},b}(),xa=function(a){var c;function N(a){this._x=0,this._y=0,this._id=++N._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._clear=!1,this._isMain=!1,this._atlasResourceChange=0,this._submits=null,this._curSubmit=null,this._ib=null,this._vb=null,this._nBlendType=0,this._saveMark=null,this._shader2D=null,this.meshlist=[],this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,this.mX=0,this.mY=0,N.__super.call(this),this._width=99999999,this._height=99999999,this._clipRect=N.MAXCLIPRECT,this.mOutPoint,this._canvas=a,this._canvas._addReference(),N._contextcount++,r.isFlash?(this._ib=$a.create(35044),qa.fillIBQuadrangle(this._ib,16)):this._ib=$a.QuadrangleIB,this.clear()}m(N,"laya.webgl.canvas.WebGLContext2D",e);var b=N.prototype;return b.setIsMainContext=function(){this._isMain=!0},b.clearBG=function(a,b,c,d){var e=ua.mainContext;e.clearColor(a,b,c,d),e.clear(16384)},b._getSubmits=function(){return this._submits},b._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null;for(var a=0,b=this._submits._length;a<b;a++)this._submits[a].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this._other&&(this._other.font=null),this._save=null,this._vb&&(this._vb.releaseResource(),this._vb.destroy(),this._vb.destory(),this._vb=null)}},b.destroy=function(){--N._contextcount,this.sprite=null,this._releaseMem(),this._targets&&this._targets.destroy(),this._targets=null,this._canvas&&this._canvas._removeReference(),this._canvas=null,this._ib&&this._ib!=$a.QuadrangleIB&&this._ib.releaseResource()},b.clear=function(){this._submits||(this._other=c.DEFAULT,this._curMat=z.create(),this._vb=_a.create(-1),this._submits=[],this._save=[W.Create(this)],this._save.length=10,this._shader2D=new $,this._triangleMesh=Ia.getAMesh()),this._vb.clear(),this._targets&&(this._targets.repaint=!0),this._other=c.DEFAULT,this._clear=!0,this._repaint=!1,this._drawCount=1,this._renderKey=0,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=N.MAXCLIPRECT,this._curSubmit=fa.RENDERBASE,this._shader2D.glTexture=null,this._shader2D.fillStyle=this._shader2D.strokeStyle=R.DEFAULT;for(var a=0,b=this._submits._length;a<b;a++)this._submits[a].releaseRender(),this._submits[a]=null;this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},b.size=function(a,b){if(this._width!=a||this._height!=b)if(0==a||0==b){0!=this._vb._byteLength&&(this._width=a,this._height=b,this._vb.clear(),this._vb.upload());for(var c=0,d=this._submits._length;c<d;c++)this._submits[c].releaseRender();this._submits.length=0,this._submits._length=0,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}else this._width=a,this._height=b,this._targets&&this._targets.size(a,b),this._canvas.memorySize-=this._canvas.memorySize;0===a&&0===b&&this._releaseMem()},b._getTransformMatrix=function(){return this._curMat},b.translate=function(a,b){0===a&&0===b||(Y.save(this),this._curMat.bTransform&&(X.save(this),this._curMat.transformPointN(A.TEMP.setTo(a,b)),a=A.TEMP.x,b=A.TEMP.y),this._x+=a,this._y+=b)},b.save=function(){this._save[this._save._length++]=W.Create(this)},b.restore=function(){var a=this._save._length;if(!(a<1))for(var b=a-1;0<=b;b--){var c=this._save[b];if(c.restore(this),c.isSaveMark())return void(this._save._length=b)}},b._fillText=function(a,b,c,d,e,f,g,h,i,j){void 0===j&&(j=0);var k=this._shader2D,l=this._curSubmit.shaderValue,m=e?oa.create(e):this._other.font;if(O.enabled)k.ALPHA!==l.ALPHA&&(k.glTexture=null),na.drawText(this,a,b,this._curMat,m,i||this._other.textAlign,f,g,h,c,d,j);else{this._shader2D.defines.getValue();var n=f?o.create(f)._color:k.colorAdd;k.ALPHA===l.ALPHA&&n===k.colorAdd&&l.colorAdd===k.colorAdd||(k.glTexture=null,k.colorAdd=n),na.drawText(this,a,b,this._curMat,m,i||this._other.textAlign,f,g,h,c,d,j)}},b.fillWords=function(a,b,c,d,e,f){this._fillText(null,a,b,c,d,e,null,-1,null,f)},b.fillBorderWords=function(a,b,c,d,e,f,g){this._fillBorderText(null,a,b,c,d,e,f,g,null)},b.fillText=function(a,b,c,d,e,f){this._fillText(a,null,b,c,d,e,null,-1,f)},b.strokeText=function(a,b,c,d,e,f,g){this._fillText(a,null,b,c,d,null,e,f||1,g)},b.fillBorderText=function(a,b,c,d,e,f,g,h){this._fillBorderText(a,null,b,c,d,e,f,g,h)},b._fillBorderText=function(a,b,c,d,e,f,g,h,i){if(!O.enabled)return this._fillText(a,b,c,d,e,null,g,h||1,i),void this._fillText(a,b,c,d,e,f,null,-1,i);var j=this._shader2D,k=this._curSubmit.shaderValue;j.ALPHA!==k.ALPHA&&(j.glTexture=null);var l=e?(N._fontTemp.setFont(e),N._fontTemp):this._other.font;na.drawText(this,a,b,this._curMat,l,i||this._other.textAlign,f,g,h||1,c,d,0)},b.fillRect=function(a,b,c,d,e){var f=this._vb;if(qa.fillRectImgVb(f,this._clipRect,a,b,c,d,I.DEF_UV,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var g=this._shader2D.fillStyle;e&&(this._shader2D.fillStyle=R.create(e));var h=this._shader2D,i=this._curSubmit.shaderValue;if(h.fillStyle!==i.fillStyle||h.ALPHA!==i.ALPHA){h.glTexture=null;var j=this._curSubmit=fa.createSubmit(this,this._ib,f,(f._byteLength-64)/32*3,ya.create(2,0));j.shaderValue.color=h.fillStyle._color._color,j.shaderValue.ALPHA=h.ALPHA,this._submits[this._submits._length++]=j}this._curSubmit._numEle+=6,this._shader2D.fillStyle=g}},b.fillTexture=function(a,b,c,d,e,f,g,h){if(a.loaded&&a.bitmap&&a.source){var i=this._vb,j=a.bitmap.width,k=a.bitmap.height,l=a.uv,m=g.x%a.width,n=g.y%a.height;if(j!=h.w||k!=h.h){if(!h.w&&!h.h)switch(h.oy=h.ox=0,f){case"repeat":h.width=d,h.height=e;break;case"repeat-x":h.width=d,n<0?a.height+n>e?h.height=e:h.height=a.height+n:(h.oy=n,a.height+n>e?h.height=e-n:h.height=a.height);break;case"repeat-y":m<0?a.width+m>d?h.width=d:h.width=a.width+m:(h.ox=m,a.width+m>d?h.width=d-m:h.width=a.width),h.height=e;break;case"no-repeat":m<0?a.width+m>d?h.width=d:h.width=a.width+m:(h.ox=m,a.width+m>d?h.width=d-m:h.width=a.width),n<0?a.height+n>e?h.height=e:h.height=a.height+n:(h.oy=n,a.height+n>e?h.height=e-n:h.height=a.height);break;default:h.width=d,h.height=e}h.w=j,h.h=k,h.uv=[0,0,h.width/j,0,h.width/j,h.height/k,0,h.height/k]}if(b+=h.ox,c+=h.oy,m-=h.ox,n-=h.oy,qa.fillRectImgVb(i,this._clipRect,b,c,h.width,h.height,h.uv,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var o=Ha.create(this,this._ib,i,(i._byteLength-64)/32*3,ya.create(256,0)),p=(this._submits[this._submits._length++]=o).shaderValue;p.textureHost=a;var q=l[0]*j,r=l[1]*k,s=(l[2]-l[0])*j,t=(l[5]-l[3])*k,u=-m/j,v=-n/k;p.u_TexRange[0]=q/j,p.u_TexRange[1]=s/j,p.u_TexRange[2]=r/k,p.u_TexRange[3]=t/k,p.u_offset[0]=u,p.u_offset[1]=v,O.enabled&&!this._isMain&&o.addTexture(a,(i._byteLength>>2)-16),(this._curSubmit=o)._renderType=10017,o._numEle+=6}}else this.sprite&&w.timer.callLater(this,this._repaintSprite)},b.setShader=function(a){T.save(this,1048576,this._shader2D,!0),this._shader2D.shader=a},b.setFilters=function(a){T.save(this,2097152,this._shader2D,!0),this._shader2D.filters=a,this._curSubmit=fa.RENDERBASE,this._renderKey=0,this._drawCount++},b.drawTexture=function(a,b,c,d,e,f,g){this._drawTextureM(a,b,c,d,e,f,g,null,1)},b.addTextureVb=function(a,b,c){var d=this._curSubmit._vb||this._vb,e=d._byteLength>>2;d.byteLength=e+16<<2;for(var f=d.getFloat32Array(),g=0;g<16;g+=4)f[e++]=a[g]+b,f[e++]=a[g+1]+c,f[e++]=a[g+2],f[e++]=a[g+3];this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),d._upload=!0},b.willDrawTexture=function(a,b){if(!(a.loaded&&a.bitmap&&a.source))return this.sprite&&w.timer.callLater(this,this._repaintSprite),0;var c=a.bitmap,d=c.id+this._shader2D.ALPHA*b+10016;if(d==this._renderKey)return d;var e=this._shader2D,f=e.ALPHA,g=this._curSubmit.shaderValue;e.ALPHA*=b,this._renderKey=d,this._drawCount++,e.glTexture=c;var h=this._vb,i=null,j=h._byteLength/32*3,k=g.textureHost&&g.textureHost==a&&g.textureHost.alphaTexture==a.alphaTexture;return i=Ha.create(this,this._ib,h,j,ya.create(1,0)),(this._submits[this._submits._length++]=i).shaderValue.textureHost=a,i._renderType=10016,i._preIsSameTextureShader=10016===this._curSubmit._renderType&&e.ALPHA===g.ALPHA&&k,this._curSubmit=i,e.ALPHA=f,d},b.drawTextures=function(a,b,c,d){if(a.loaded&&a.bitmap&&a.source){var e=this._clipRect;if(this._clipRect=N.MAXCLIPRECT,this._drawTextureM(a,b[0],b[1],a.width,a.height,c,d,null,1)){if(this._clipRect=e,E.drawCall++,!(b.length<4)){for(var f=this._curSubmit._vb||this._vb,g=this._curMat.a,h=this._curMat.d,i=2,j=b.length;i<j;i+=2)qa.copyPreImgVb(f,(b[i]-b[i-2])*g,(b[i+1]-b[i-1])*h),this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle)}}else alert("drawTextures err")}else this.sprite&&w.timer.callLater(this,this._repaintSprite)},b._drawTextureM=function(a,b,c,d,e,f,g,h,i){if(!a.loaded||!a.source)return this.sprite&&w.timer.callLater(this,this._repaintSprite),!1;var j=this._curSubmit._vb||this._vb,k=a.bitmap;b+=f,c+=g,this._drawCount++;var l=k.id+this._shader2D.ALPHA*i+10016;if(l!=this._renderKey){this._renderKey=l;var m=this._curSubmit.shaderValue,n=this._shader2D,o=n.ALPHA;n.ALPHA*=i,n.glTexture=k;var p=this._vb,q=null,r=p._byteLength/32*3,s=m.textureHost&&m.textureHost==a&&m.textureHost.alphaTexture==a.alphaTexture;q=Ha.create(this,this._ib,p,r,ya.create(1,0)),(this._submits[this._submits._length++]=q).shaderValue.textureHost=a,q._renderType=10016,q._preIsSameTextureShader=10016===this._curSubmit._renderType&&n.ALPHA===m.ALPHA&&s,this._curSubmit=q,j=this._curSubmit._vb||this._vb,n.ALPHA=o}return!!qa.fillRectImgVb(j,this._clipRect,b,c,d||a.width,e||a.height,a.uv,h||this._curMat,this._x,this._y,0,0)&&(O.enabled&&!this._isMain&&this._curSubmit.addTexture(a,(j._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0)},b._repaintSprite=function(){this.sprite&&this.sprite.repaint()},b._drawText=function(a,b,c,d,e,f,g,h,i,j){var k=a.bitmap;this._drawCount++;var l=k.id+this._shader2D.ALPHA+10016;if(l!=this._renderKey){this._renderKey=l;var m=this._curSubmit.shaderValue,n=this._shader2D;n.glTexture=k;var o=this._vb,p=null,q=o._byteLength/32*3,r=m.textureHost&&m.textureHost==a&&m.textureHost.alphaTexture==a.alphaTexture;(p=O.enabled?Ha.create(this,this._ib,o,q,ya.create(1,0)):Ha.create(this,this._ib,o,q,Ya.create()))._preIsSameTextureShader=10016===this._curSubmit._renderType&&n.ALPHA===m.ALPHA&&r,(this._submits[this._submits._length++]=p).shaderValue.textureHost=a,p._renderType=10016,this._curSubmit=p}a.active();var s=this._curSubmit._vb||this._vb;qa.fillRectImgVb(s,this._clipRect,b+g,c+h,d||a.width,e||a.height,a.uv,f||this._curMat,this._x,this._y,i,j,!0)&&(O.enabled&&!this._isMain&&this._curSubmit.addTexture(a,(s._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle))},b.drawTextureWithTransform=function(a,b,c,d,e,f,g,h,i){if(f){var j=this._curMat,k=this._x,l=this._y;(0!==g||0!==h)&&(this._x=g*j.a+h*j.c,this._y=h*j.d+g*j.b),f&&j.bTransform?(z.mul(f,j,N._tmpMatrix),(f=N._tmpMatrix)._checkTransform()):(this._x+=j.tx,this._y+=j.ty),this._drawTextureM(a,b,c,d,e,0,0,f,i),this._x=k,this._y=l}else this._drawTextureM(a,b,c,d,e,g,h,null,i)},b.fillQuadrangle=function(a,b,c,d,e){var f=this._curSubmit,g=this._vb,h=this._shader2D,i=f.shaderValue;if(this._renderKey=0,a.bitmap){var j=a.bitmap;h.glTexture==j&&h.ALPHA===i.ALPHA||(h.glTexture=j,(f=this._curSubmit=fa.createSubmit(this,this._ib,g,g._byteLength/32*3,ya.create(1,0))).shaderValue.glTexture=j,this._submits[this._submits._length++]=f),qa.fillQuadrangleImgVb(g,b,c,d,a.uv,e||this._curMat,this._x,this._y)}else f.shaderValue.fillStyle&&f.shaderValue.fillStyle.equal(a)&&h.ALPHA===i.ALPHA||(h.glTexture=null,(f=this._curSubmit=fa.createSubmit(this,this._ib,g,g._byteLength/32*3,ya.create(2,0))).shaderValue.defines.add(2),f.shaderValue.fillStyle=R.create(a),this._submits[this._submits._length++]=f),qa.fillQuadrangleImgVb(g,b,c,d,I.DEF_UV,e||this._curMat,this._x,this._y);f._numEle+=6},b.drawTexture2=function(a,b,c,d,e,f,g,h){if(0!=f){var i=this._curMat;if(this._x=a*i.a+b*i.c,this._y=b*i.d+a*i.b,e&&(e=i.bTransform||e.bTransform?(z.mul(e,i,N._tmpMatrix),N._tmpMatrix):(this._x+=e.tx+i.tx,this._y+=e.ty+i.ty,z.EMPTY)),1!==f||g){var j=this._shader2D.ALPHA,k=this._nBlendType;this._shader2D.ALPHA=f,g&&(this._nBlendType=Q.TOINT(g)),this._drawTextureM(h[0],h[1]-c,h[2]-d,h[3],h[4],0,0,e,1),this._shader2D.ALPHA=j,this._nBlendType=k}else this._drawTextureM(h[0],h[1]-c,h[2]-d,h[3],h[4],0,0,e,1);this._x=this._y=0}},b.drawCanvas=function(a,b,c,d,e){var f=a.context;if(this._renderKey=0,f._targets)this._submits[this._submits._length++]=Ga.create(f,0,null),this._curSubmit=fa.RENDERBASE,f._targets.drawTo(this,b,c,d,e);else{var g=this._submits[this._submits._length++]=Ga.create(f,this._shader2D.ALPHA,this._shader2D.filters),h=d/a.width,i=e/a.height,j=g._matrix;this._curMat.copyTo(j),1!=h&&1!=i&&j.scale(h,i);var k=j.tx,l=j.ty;j.tx=j.ty=0,j.transformPoint(A.TEMP.setTo(b,c)),j.translate(A.TEMP.x+k,A.TEMP.y+l),this._curSubmit=fa.RENDERBASE}x.showCanvasMark&&(this.save(),this.lineWidth=4,this.strokeStyle=f._targets?"yellow":"green",this.strokeRect(b-1,c-1,d+2,e+2,1),this.strokeRect(b,c,d,e,1),this.restore())},b.drawTarget=function(a,b,c,d,e,f,g,h,i,j){void 0===j&&(j=-1);var k=this._vb;if(qa.fillRectImgVb(k,this._clipRect,b,c,d,e,i||I.DEF_UV,f||this._curMat,this._x,this._y,0,0)){this._renderKey=0,this._shader2D.glTexture=null;this._curSubmit.shaderValue;var l=this._curSubmit=la.create(this,this._ib,k,(k._byteLength-64)/32*3,h,g);l.blendType=-1==j?this._nBlendType:j,l.scope=a,this._submits[this._submits._length++]=l,this._curSubmit._numEle+=6}},b.mixRGBandAlpha=function(a){return this._mixRGBandAlpha(a,this._shader2D.ALPHA)},b._mixRGBandAlpha=function(a,b){var c=(4278190080&a)>>>24;return 0!=c?c*=b:c=255*b,16777215&a|c<<24},b.drawTriangles=function(a,b,c,d,e,f,g,h,i,j){if(!a.loaded||!a.source)return this.sprite&&w.timer.callLater(this,this._repaintSprite),!1;this._drawCount++;a.bitmap;var k=this._mixRGBandAlpha(4294967295,h),l=(d.length,f.length);this._renderKey=-1;var m=this._curSubmit=Ha.create(this,this._triangleMesh.getIBR(),this._triangleMesh.getVBR(),this._triangleMesh.indexNum,ya.create(1,0));return m.shaderValue.textureHost=a,m._renderType=10016,this._submits[this._submits._length++]=m,g?(N._tmpMatrix.a=g.a,N._tmpMatrix.b=g.b,N._tmpMatrix.c=g.c,N._tmpMatrix.d=g.d,N._tmpMatrix.tx=g.tx+b,N._tmpMatrix.ty=g.ty+c,z.mul(N._tmpMatrix,this._curMat,N._tmpMatrix)):(N._tmpMatrix.a=this._curMat.a,N._tmpMatrix.b=this._curMat.b,N._tmpMatrix.c=this._curMat.c,N._tmpMatrix.d=this._curMat.d,N._tmpMatrix.tx=this._curMat.tx+b,N._tmpMatrix.ty=this._curMat.ty+c),this._triangleMesh.addData(d,e,f,N._tmpMatrix,k,this),this._curSubmit._numEle+=l,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0},b.transform=function(a,b,c,d,e,f){X.save(this),z.mul(z.TEMP.setTo(a,b,c,d,e,f),this._curMat,this._curMat),this._curMat._checkTransform()},b.setTransformByMatrix=function(a){a.copyTo(this._curMat)},b.transformByMatrix=function(a){X.save(this),z.mul(a,this._curMat,this._curMat),this._curMat._checkTransform()},b.rotate=function(a){X.save(this),this._curMat.rotateEx(a)},b.scale=function(a,b){X.save(this),this._curMat.scaleEx(a,b)},b.clipRect=function(a,b,c,d){if(0!=this._curMat.b||0!=this._curMat.c){this._renderKey=0;var e=ka.create(4);this.addRenderObject(e);var f=this._vb,g=f._byteLength>>2;if(qa.fillRectImgVb(f,null,a,b,c,d,I.DEF_UV,this._curMat,this._x,this._y,0,0)){this._shader2D.glTexture=null;var h=this._curSubmit=fa.createSubmit(this,this._ib,f,(f._byteLength-64)/32*3,ya.create(2,0));h.shaderValue.ALPHA=1,this._submits[this._submits._length++]=h,this._curSubmit._numEle+=6}else alert("clipRect calc stencil rect error");var i=ka.create(5);this.addRenderObject(i);var j=f.getFloat32Array(),k=Math.min(Math.min(Math.min(j[0+g],j[4+g]),j[8+g]),j[12+g]),l=Math.max(Math.max(Math.max(j[0+g],j[4+g]),j[8+g]),j[12+g]),m=Math.min(Math.min(Math.min(j[1+g],j[5+g]),j[9+g]),j[13+g]),n=Math.max(Math.max(Math.max(j[1+g],j[5+g]),j[9+g]),j[13+g]);V.save(this,i,a,b,c,d,k,m,l-k,n-m),this._curSubmit=fa.RENDERBASE}else{c*=this._curMat.a,d*=this._curMat.d;var o=A.TEMP;this._curMat.transformPoint(o.setTo(a,b)),c<0&&(o.x=o.x+c,c=-c),d<0&&(o.y=o.y+d,d=-d),this._renderKey=0;var p=this._curSubmit=ja.create(this);(this._submits[this._submits._length++]=p).submitIndex=this._submits._length,p.submitLength=9999999,U.save(this,p);var q=this._clipRect,r=q.x,s=q.y,t=o.x+c,u=o.y+d;r<o.x&&(q.x=o.x),s<o.y&&(q.y=o.y),q.width=Math.min(t,r+q.width)-q.x,q.height=Math.min(u,s+q.height)-q.y,this._shader2D.glTexture=null,p.clipRect.copyFrom(q),this._curSubmit=fa.RENDERBASE}},b.setIBVB=function(a,b,c,d,e,f,g,h,i,j,k){if(void 0===i&&(i=0),void 0===j&&(j=0),void 0===k&&(k=0),null===c){if(r.isFlash){var l=d;l._selfIB||(l._selfIB=$a.create(35044)),l._selfIB.clear(),c=l._selfIB}else c=this._ib;qa.expandIBQuadrangle(c,d._byteLength/(4*d.vertexStride*4))}if(!h||!g)throw Error("setIBVB must input:shader shaderValues");var m=ia.create(this,d,c,e,g,h,i,j,k);f||(f=z.EMPTY),f.translate(a,b),z.mul(f,this._curMat,m._mat),f.translate(-a,-b),this._submits[this._submits._length++]=m,this._curSubmit=fa.RENDERBASE,this._renderKey=0},b.addRenderObject=function(a){this._submits[this._submits._length++]=a},b.fillTrangles=function(a,b,c,d,e){var f=this._curSubmit,g=this._vb,h=this._shader2D,i=f.shaderValue,j=d.length>>4,k=a.bitmap;this._renderKey=0,h.glTexture==k&&h.ALPHA===i.ALPHA||((f=this._curSubmit=fa.createSubmit(this,this._ib,g,g._byteLength/32*3,ya.create(1,0))).shaderValue.textureHost=a,this._submits[this._submits._length++]=f),qa.fillTranglesVB(g,b,c,d,e||this._curMat,this._x,this._y),f._numEle+=6*j},b.submitElement=function(a,b){var c=this._submits;for(b<0&&(b=c._length);a<b;)a+=c[a].renderSubmit()},b.finish=function(){ua.mainContext.finish()},b.flush=function(){var a=Math.max(this._vb._byteLength/64,this._maxNumEle/6)+8;if(a>this._ib.bufferLength/12&&qa.expandIBQuadrangle(this._ib,a),!this._isMain&&O.enabled&&O._atlasRestore>this._atlasResourceChange){this._atlasResourceChange=O._atlasRestore;for(var b=this._submits,c=0,d=b._length;c<d;c++){var e=b[c];10016===e.getRenderType()&&e.checkTexture()}}this.submitElement(0,this._submits._length),this._path&&this._path.reset(),ba.instance&&ba.getInstance().reset();var f;for(c=0,f=this.meshlist.length;c<f;c++){var g=this.meshlist[c];g.canReuse?g.releaseMesh():g.destroy()}return this.meshlist.length=0,this._curSubmit=fa.RENDERBASE,this._renderKey=0,this._triangleMesh=Ia.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits._length},b.setPathId=function(a){if(this.mId=a,-1!=this.mId){this.mHaveKey=!1;var b=K.getInstance();b.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,b.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},b.movePath=function(a,b){var c=a,d=b;a=this._curMat.a*c+this._curMat.c*d+this._curMat.tx,b=this._curMat.b*c+this._curMat.d*d+this._curMat.ty,this.mX+=a,this.mY+=b},b.beginPath=function(){var a=this._getPath();a.tempArray.length=0,a.closePath=!1,this.mX=0,this.mY=0},b.closePath=function(){this._path.closePath=!0},b.fill=function(a){void 0===a&&(a=!1);var b=this._getPath();this.drawPoly(0,0,b.tempArray,this.fillStyle._color.numColor,0,0,a)},b.stroke=function(){var a=this._getPath();if(0<this.lineWidth){if(-1==this.mId)a.drawLine(0,0,a.tempArray,this.lineWidth,this.strokeStyle._color.numColor);else if(this.mHaveLineKey){var b=K.getInstance().shapeLineDic[this.mId];b.rebuild(a.tempArray),a.setGeomtry(b)}else K.getInstance().addLine(this.mId,a.drawLine(0,0,a.tempArray,this.lineWidth,this.strokeStyle._color.numColor));a.update();var c=[this.mX,this.mY],d=fa.createShape(this,a.ib,a.vb,a.count,a.offset,ya.create(4,0));d.shaderValue.ALPHA=this._shader2D.ALPHA,d.shaderValue.u_pos=c,d.shaderValue.u_mmat2=sa.TEMPMAT4_ARRAY,this._submits[this._submits._length++]=d,this._renderKey=-1}},b.line=function(a,b,c,d,e,f){var g=this._curSubmit,h=this._vb;if(qa.fillLineVb(h,this._clipRect,a,b,c,d,e,f)){this._renderKey=0;var i=this._shader2D,j=g.shaderValue;i.strokeStyle===j.strokeStyle&&i.ALPHA===j.ALPHA||(i.glTexture=null,(g=this._curSubmit=fa.createSubmit(this,this._ib,h,(h._byteLength-64)/32*3,ya.create(2,0))).shaderValue.strokeStyle=i.strokeStyle,g.shaderValue.mainID=2,g.shaderValue.ALPHA=i.ALPHA,this._submits[this._submits._length++]=g),g._numEle+=6}},b.moveTo=function(a,b,c){void 0===c&&(c=!0);var d=this._getPath();if(c){var e=a,f=b;a=this._curMat.a*e+this._curMat.c*f,b=this._curMat.b*e+this._curMat.d*f}d.addPoint(a,b)},b.lineTo=function(a,b,c){void 0===c&&(c=!0);var d=this._getPath();if(c){var e=a,f=b;a=this._curMat.a*e+this._curMat.c*f,b=this._curMat.b*e+this._curMat.d*f}d.addPoint(a,b)},b.drawCurves=function(a,b,c){this.setPathId(-1),this.beginPath(),this.strokeStyle=c[3],this.lineWidth=c[4];var d=c[2];a+=c[0],b+=c[1],this.movePath(a,b),this.moveTo(d[0],d[1]);for(var e=2,f=d.length;e<f;)this.quadraticCurveTo(d[e++],d[e++],d[e++],d[e++]);this.stroke()},b.arcTo=function(a,b,c,d,e){if(-1==this.mId||!this.mHaveKey){var f=0,g=0,h=0,i=this._getPath();this._curMat.copyTo(N._tmpMatrix),N._tmpMatrix.tx=N._tmpMatrix.ty=0,N._tempPoint.setTo(i.getEndPointX(),i.getEndPointY()),N._tmpMatrix.invertTransformPoint(N._tempPoint);var j=N._tempPoint.x-a,k=N._tempPoint.y-b,l=Math.sqrt(j*j+k*k);if(!(l<=1e-6)){var m=j/l,n=k/l,o=c-a,p=d-b,q=o*o+p*p,r=Math.sqrt(q);if(!(r<=1e-6)){var s=o/r,t=p/r,u=m+s,v=n+t,w=Math.sqrt(u*u+v*v);if(!(w<=1e-6)){var x=u/w,y=v/w,z=Math.acos(x*m+y*n),A=Math.PI/2-z,B=(l=e/Math.tan(A))*m+a,C=l*n+b,D=Math.sqrt(l*l+e*e),E=a+x*D,F=b+y*D,G=0,H=0;if(0<=m*t-n*s){var I=2*A/N.SEGNUM;G=Math.sin(I),H=Math.cos(I)}else I=2*-A/N.SEGNUM,G=Math.sin(I),H=Math.cos(I);g=this._curMat.a*B+this._curMat.c*C,h=this._curMat.b*B+this._curMat.d*C,g==this._path.getEndPointX()&&h==this._path.getEndPointY()||i.addPoint(g,h);var J=B-E,K=C-F;for(f=0;f<N.SEGNUM;f++){var L=J*H+K*G,M=-J*G+K*H;g=L+E,h=M+F,a=this._curMat.a*g+this._curMat.c*h,h=b=this._curMat.b*g+this._curMat.d*h,(g=a)==this._path.getEndPointX()&&h==this._path.getEndPointY()||i.addPoint(g,h),J=L,K=M}}}}}},b.arc=function(a,b,c,d,e,f,g){if(void 0===f&&(f=!1),void 0===g&&(g=!0),-1!=this.mId){var h=K.getInstance().shapeDic[this.mId];if(h&&this.mHaveKey&&!h.needUpdate(this._curMat))return;b=a=0}var i,j=0,k=0,l=0,m=0,n=0,o=0,p=0;if(k=e-d,f)if(Math.abs(k)>=2*Math.PI)k=2*-Math.PI;else for(;0<k;)k-=2*Math.PI;else if(Math.abs(k)>=2*Math.PI)k=2*Math.PI;else for(;k<0;)k+=2*Math.PI;i=k/(p=c<101?Math.max(10,k*c/5):c<201?Math.max(10,k*c/20):Math.max(10,k*c/40))/2,l=Math.abs(4/3*(1-Math.cos(i))/Math.sin(i)),f&&(l=-l);var q=this._getPath(),r=NaN,s=NaN;for(o=0;o<=p;o++)j=d+k*(o/p),m=a+Math.cos(j)*c,n=b+Math.sin(j)*c,g&&(r=m,s=n,m=this._curMat.a*r+this._curMat.c*s,n=this._curMat.b*r+this._curMat.d*s),m==this._path.getEndPointX()&&n==this._path.getEndPointY()||q.addPoint(m,n);m=a+Math.cos(e)*c,n=b+Math.sin(e)*c,g&&(r=m,s=n,m=this._curMat.a*r+this._curMat.c*s,n=this._curMat.b*r+this._curMat.d*s),m==this._path.getEndPointX()&&n==this._path.getEndPointY()||q.addPoint(m,n)},b.quadraticCurveTo=function(a,b,c,d){var e=l.I,f=c,g=d;c=this._curMat.a*f+this._curMat.c*g,d=this._curMat.b*f+this._curMat.d*g,f=a,g=b,a=this._curMat.a*f+this._curMat.c*g,b=this._curMat.b*f+this._curMat.d*g;for(var h=e.getBezierPoints([this._path.getEndPointX(),this._path.getEndPointY(),a,b,c,d],30,2),i=0,j=h.length/2;i<j;i++)this.lineTo(h[2*i],h[2*i+1],!1);this.lineTo(c,d,!1)},b.rect=function(a,b,c,d){this._other=this._other.make(),this._other.path||(this._other.path=new S),this._other.path.rect(a,b,c,d)},b.strokeRect=function(a,b,c,d,e){var f=.5*e;this.line(a-f,b,a+c+f,b,e,this._curMat),this.line(a+c,b,a+c,b+d,e,this._curMat),this.line(a,b,a,b+d,e,this._curMat),this.line(a-f,b+d,a+c+f,b+d,e,this._curMat)},b.clip=function(){},b.drawPoly=function(a,b,c,d,e,f,g){void 0===g&&(g=!1),this._renderKey=0,this._shader2D.glTexture=null;var h=this._getPath();if(-1==this.mId)h.polygon(a,b,c,d,e||1,f);else if(this.mHaveKey){var i=K.getInstance().shapeDic[this.mId];i.setMatrix(this._curMat),i.rebuild(h.tempArray),h.setGeomtry(i)}else{var j=h.polygon(a,b,c,d,e||1,f);K.getInstance().addShape(this.mId,j),j.setMatrix(this._curMat)}h.update();var k,l=[this.mX,this.mY];if((k=fa.createShape(this,h.ib,h.vb,h.count,h.offset,ya.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,k.shaderValue.u_pos=l,k.shaderValue.u_mmat2=sa.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=k,0<e){if(this.mHaveLineKey){var m=K.getInstance().shapeLineDic[this.mId];m.rebuild(h.tempArray),h.setGeomtry(m)}else K.getInstance().addShape(this.mId,h.drawLine(a,b,c,e,f));h.update(),(k=fa.createShape(this,h.ib,h.vb,h.count,h.offset,ya.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,k.shaderValue.u_mmat2=sa.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=k}},b.drawParticle=function(a,b,c){c.x=a,c.y=b,this._submits[this._submits._length++]=c},b._getPath=function(){return this._path||(this._path=new S)},d(0,b,"globalCompositeOperation",function(){return Q.NAMES[this._nBlendType]},function(a){var b=Q.TOINT[a];null==b||this._nBlendType===b||(T.save(this,65536,this,!0),this._curSubmit=fa.RENDERBASE,this._renderKey=0,this._nBlendType=b)}),d(0,b,"strokeStyle",function(){return this._shader2D.strokeStyle},function(a){this._shader2D.strokeStyle.equal(a)||(T.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=R.create(a))}),d(0,b,"globalAlpha",function(){return this._shader2D.ALPHA},function(a){(a=Math.floor(1e3*a)/1e3)!=this._shader2D.ALPHA&&(T.save(this,1,this._shader2D,!0),this._shader2D.ALPHA=a)}),d(0,b,"asBitmap",null,function(a){if(a){if(this._targets||(this._targets=new Z),this._targets.repaint=!0,!this._width||!this._height)throw Error("asBitmap no size!");this._targets.setSP(this.sprite),this._targets.size(this._width,this._height)}else this._targets=null}),d(0,b,"fillStyle",function(){return this._shader2D.fillStyle},function(a){this._shader2D.fillStyle.equal(a)||(T.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=R.create(a))}),d(0,b,"textAlign",function(){return this._other.textAlign},function(a){this._other.textAlign===a||(this._other=this._other.make(),T.save(this,32768,this._other,!1),this._other.textAlign=a)}),d(0,b,"lineWidth",function(){return this._other.lineWidth},function(a){this._other.lineWidth===a||(this._other=this._other.make(),T.save(this,256,this._other,!1),this._other.lineWidth=a)}),d(0,b,"textBaseline",function(){return this._other.textBaseline},function(a){this._other.textBaseline===a||(this._other=this._other.make(),T.save(this,16384,this._other,!1),this._other.textBaseline=a)}),d(0,b,"font",null,function(a){a!=this._other.font.toString()&&(this._other=this._other.make(),T.save(this,8,this._other,!1),this._other.font===oa.EMPTY?this._other.font=new oa(a):this._other.font.setFont(a))}),N.__init__=function(){c.DEFAULT=new c},N._tempPoint=new A,N._SUBMITVBSIZE=32e3,N._MAXSIZE=99999999,N._RECTVBSIZE=16,N.MAXCLIPRECT=new B(0,0,99999999,99999999),N._COUNT=0,N._tmpMatrix=new z,N.SEGNUM=32,N._contextcount=0,g(N,["_fontTemp",function(){return this._fontTemp=new oa},"_drawStyleTemp",function(){return this._drawStyleTemp=new R(null)}]),N.__init$=function(){c=function(){function a(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null,this.font=oa.EMPTY}m(a,"");var b=a.prototype;return b.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null,this.font=oa.EMPTY},b.make=function(){return this===a.DEFAULT?new a:this},a.DEFAULT=null,a}()},N}(),ya=function(a){function d(a,b){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this._cacheID=0,d.__super.call(this),this.defines=new Ca,this.position=d._POSITION,this.mainID=a,this.subID=b,this.textureHost=null,this.texture=null,this.texture1=null,this.fillStyle=null,this.color=null,this.strokeStyle=null,this.colorAdd=null,this.glTexture=null,this.u_mmat2=null,this._cacheID=a|b,this._inClassCache=d._cache[this._cacheID],0<a&&!this._inClassCache&&(this._inClassCache=d._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}m(d,"laya.webgl.shader.d2.value.Value2D",M);var b=d.prototype;return b.setValue=function(a){},b.refresh=function(){var a=this.size;return a[0]=sa.width,a[1]=sa.height,this.alpha=this.ALPHA*sa.worldAlpha,this.mmat=sa.worldMatrix4,this},b._ShaderWithCompile=function(){return Wa.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,Za.create)},b._withWorldShaderDefines=function(){var a=sa.worldShaderDefines,b=Wa.sharders[this.mainID|this.defines._value|a.getValue()];if(!b){var c,d={};for(c in this.defines.toNameDic())d[c]="";for(c in a.toNameDic())d[c]="";b=Wa.withCompile2D(0,this.mainID,d,this.mainID|this.defines._value|a.getValue(),Za.create)}var e=sa.worldFilters;if(!e)return b;for(var f,g=e.length,h=0;h<g;h++)(f=e[h])&&f.action.setValue(this);return b},b.upload=function(){var a=sa;this.alpha=this.ALPHA*a.worldAlpha,sa.worldMatrix4!==sa.TEMPMAT4_ARRAY&&this.defines.add(128),this.textureHost&&this.textureHost.alphaTexture?this.defines.add(2048):this.defines.remove(2048),this.textureHost&&this.textureHost.bitmap&&(37815==this.textureHost.bitmap.format||37812==this.textureHost.bitmap.format||37821==this.textureHost.bitmap.format)?this.defines.add(4096):this.defines.remove(4096),ua.shaderHighPrecision&&this.defines.add(1024);var b,c=a.worldShaderDefines?this._withWorldShaderDefines():Wa.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();this.size[0]=a.width,this.size[1]=a.height,this.mmat=a.worldMatrix4,Ja.activeShader!==c?c._shaderValueWidth!==a.width||c._shaderValueHeight!==a.height?(c._shaderValueWidth=a.width,c._shaderValueHeight=a.height):b=c._params2dQuick2||c._make2dQuick2():c._shaderValueWidth!==a.width||c._shaderValueHeight!==a.height?(c._shaderValueWidth=a.width,c._shaderValueHeight=a.height):b=c._params2dQuick1||c._make2dQuick1(),c.upload(this,b)},b.setFilters=function(a){if(this.filters=a)for(var b,c=a.length,d=0;d<c;d++)(b=a[d])&&(this.defines.add(b.type),b.action.setValue(this))},b.clear=function(){this.defines.setValue(this.subID)},b.release=function(){(this._inClassCache[this._inClassCache._length++]=this).fillStyle=null,this.strokeStyle=null,this.textureHost=null,this.mmat=null,this.clear()},d._initone=function(a,b){d._typeClass[a]=b,d._cache[a]=[],d._cache[a]._length=0},d.__init__=function(){d._POSITION=[2,5126,!1,4*pa.BYTES_PE,0],d._TEXCOORD=[2,5126,!1,4*pa.BYTES_PE,2*pa.BYTES_PE],d._initone(2,Na),d._initone(4,Qa),d._initone(256,Oa),d._initone(512,Ma),d._initone(1,Pa),d._initone(65,Ya),d._initone(9,Pa)},d.create=function(a,b){var c=d._cache[a|b];return c._length?c[--c._length]:new d._typeClass[a|b](b)},d._POSITION=null,d._TEXCOORD=null,d._cache=[],d._typeClass=[],d.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],d}(),za=function(a){function q(a,b){q.__super.call(this,a,b)}m(q,"laya.webgl.utils.RenderSprite3D",s);var b=q.prototype;return b.onCreate=function(a){switch(a){case 8:return void(this._fun=this._blend);case 4:return void(this._fun=this._transform)}},b._mask=function(a,b,c,d){var e,f,g=this._next,h=a.mask;if(h){b.ctx.save();var i=b.ctx.globalCompositeOperation,j=new B;if(j.copyFrom(h.getBounds()),j.width=Math.round(j.width),j.height=Math.round(j.height),j.x=Math.round(j.x),j.y=Math.round(j.y),0<j.width&&0<j.height){var k=a._style._tf,l=ha.create();l.addValue("bounds",j),e=ga.create([l,b],laya.webgl.utils.RenderSprite3D.tmpTarget),b.addRenderObject(e),h.render(b,-j.x,-j.y),e=ga.create([l],laya.webgl.utils.RenderSprite3D.endTmpTarget),b.addRenderObject(e),b.ctx.save(),b.clipRect(c-k.translateX+j.x,d-k.translateY+j.y,j.width,j.height),g._fun.call(g,a,b,c,d),b.ctx.restore(),f=ka.create(6),i=b.ctx.globalCompositeOperation,f.blendMode="mask",b.addRenderObject(f),z.TEMP.identity();var m=ya.create(1,0),n=I.INV_UV,o=j.width,p=j.height;(j.width<32||j.height<32)&&((n=q.tempUV)[0]=0,n[1]=0,n[2]=32<=j.width?1:j.width/32,n[3]=0,n[4]=32<=j.width?1:j.width/32,n[5]=32<=j.height?1:j.height/32,n[6]=0,n[7]=32<=j.height?1:j.height/32,j.width=32<=j.width?j.width:32,j.height=32<=j.height?j.height:32,n[1]*=-1,n[3]*=-1,n[5]*=-1,n[7]*=-1,n[1]+=1,n[3]+=1,n[5]+=1,n[7]+=1),b.ctx.drawTarget(l,c+j.x-k.translateX,d+j.y-k.translateY,o,p,z.TEMP,"tmpTarget",m,n,6),e=ga.create([l],laya.webgl.utils.RenderSprite3D.recycleTarget),b.addRenderObject(e),(f=ka.create(6)).blendMode=i,b.addRenderObject(f)}b.ctx.restore()}else g._fun.call(g,a,b,c,d)},b._blend=function(a,b,c,d){var e=a._style,f=this._next;e.blendMode?(b.ctx.save(),b.ctx.globalCompositeOperation=e.blendMode,f._fun.call(f,a,b,c,d),b.ctx.restore()):f._fun.call(f,a,b,c,d)},b._transform=function(a,b,c,d){var e=a.transform,f=this._next;if(e&&f!=s.NORENDER){var g=b.ctx;a._style;e.tx=c,e.ty=d;var h=g._getTransformMatrix(),i=h.clone();z.mul(e,h,h),h._checkTransform(),e.tx=e.ty=0,f._fun.call(f,a,b,0,0),i.copyTo(h),i.destroy()}else f._fun.call(f,a,b,c,d)},q.tmpTarget=function(a,b){var c=a.getValue("bounds"),d=Ka.create(c.width,c.height);d.start(),d.clear(0,0,0,0),a.addValue("tmpTarget",d)},q.endTmpTarget=function(a){a.getValue("tmpTarget").end()},q.recycleTarget=function(a){a.getValue("tmpTarget").recycle(),a.recycle()},g(q,["tempUV",function(){return this.tempUV=new Array(8)}]),q}(),Aa=function(a){function b(){this.data=null,b.__super.call(this)}m(b,"laya.filters.webgl.ColorFilterActionGL",L);var c=b.prototype;return w.imps(c,{"laya.filters.IFilterActionGL":!0}),c.setValue=function(a){a.colorMat=this.data._mat,a.colorAlpha=this.data._alpha},c.apply3d=function(a,b,c,d,e){var f=a.getValue("bounds"),g=ya.create(1,0);g.setFilters([this.data]);var h=z.TEMP;h.identity(),c.ctx.drawTarget(a,0,0,f.width,f.height,h,"src",g)},b}(),Ba=function(a){function f(a,b,c,d,e){this._atlasCanvas=null,this._inAtlasTextureKey=null,this._inAtlasTextureBitmapValue=null,this._inAtlasTextureOriUVValue=null,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue=null,f.__super.call(this,a,b,e),this._inAtlasTextureKey=[],this._inAtlasTextureBitmapValue=[],this._inAtlasTextureOriUVValue=[],this._InAtlasWebGLImagesKey={},this._InAtlasWebGLImagesOffsetValue=[],this._atlasCanvas=new Ra,this._atlasCanvas.uri="Atlaser.AtlasWebGLCanvas._atlasCanvas",(this._atlasCanvas._atlaser=this)._atlasCanvas.width=c,this._atlasCanvas.height=d,this._atlasCanvas.activeResource(),this._atlasCanvas.lock=!0}m(f,"laya.webgl.atlas.Atlaser",N);var b=f.prototype;return b.computeUVinAtlasTexture=function(a,b,c,d){var e=O.atlasTextureWidth,f=O.atlasTextureHeight,g=c/e,h=d/f,i=(c+a.bitmap.width)/e,j=(d+a.bitmap.height)/f,k=a.bitmap.width/e,l=a.bitmap.height/f;a.uv=[g+b[0]*k,h+b[1]*l,i-(1-b[2])*k,h+b[3]*l,i-(1-b[4])*k,j-(1-b[5])*l,g+b[6]*k,j-(1-b[7])*l]},b.findBitmapIsExist=function(a){if(a instanceof laya.webgl.resource.WebGLImage){var b=a,c=b.url,d=this._InAtlasWebGLImagesKey[c||b.id];if(d)return d.offsetInfoID}return-1},b.addToAtlasTexture=function(a,b,c){if(a instanceof laya.webgl.resource.WebGLImage){var d=a,e=d.url;this._InAtlasWebGLImagesKey[e||d.id]={bitmap:a,offsetInfoID:this._InAtlasWebGLImagesOffsetValue.length},this._InAtlasWebGLImagesOffsetValue.push([b,c])}this._atlasCanvas.texSubImage2D(b,c,a.atlasSource),a.clearAtlasSource()},b.addToAtlas=function(a,b,c){a._atlasID=this._inAtlasTextureKey.length;var d=a.uv.slice(),e=a.bitmap;this._inAtlasTextureKey.push(a),this._inAtlasTextureOriUVValue.push(d),this._inAtlasTextureBitmapValue.push(e),this.computeUVinAtlasTexture(a,d,b,c),a.bitmap=this._atlasCanvas},b.clear=function(){for(var a=0,b=this._inAtlasTextureKey.length;a<b;a++)this._inAtlasTextureKey[a].bitmap=this._inAtlasTextureBitmapValue[a],this._inAtlasTextureKey[a].uv=this._inAtlasTextureOriUVValue[a],this._inAtlasTextureKey[a]._atlasID=-1,this._inAtlasTextureKey[a].bitmap.lock=!1,this._inAtlasTextureKey[a].bitmap.releaseResource();this._inAtlasTextureKey.length=0,this._inAtlasTextureBitmapValue.length=0,this._inAtlasTextureOriUVValue.length=0,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue.length=0},b.dispose=function(){this.clear(),this._atlasCanvas.destroy()},d(0,b,"InAtlasWebGLImagesOffsetValue",function(){return this._InAtlasWebGLImagesOffsetValue}),d(0,b,"texture",function(){return this._atlasCanvas}),d(0,b,"inAtlasWebGLImagesKey",function(){return this._InAtlasWebGLImagesKey}),f}(),Ca=function(a){function c(){c.__super.call(this,c.__name2int,c.__int2name,c.__int2nameMap)}return m(c,"laya.webgl.shader.d2.ShaderDefines2D",_),c.__init__=function(){c.reg("TEXTURE2D",1),c.reg("COLOR2D",2),c.reg("PRIMITIVE",4),c.reg("GLOW_FILTER",8),c.reg("BLUR_FILTER",16),c.reg("COLOR_FILTER",32),c.reg("COLOR_ADD",64),c.reg("WORLDMAT",128),c.reg("FILLTEXTURE",256),c.reg("FSHIGHPRECISION",1024),c.reg("TXTALPHA",2048),c.reg("TXTCOMPRESS",4096)},c.reg=function(a,b){_._reg(a,b,c.__name2int,c.__int2name)},c.toText=function(a,b,c){return _._toText(a,b,c)},c.toInt=function(a){return _._toInt(a,c.__name2int)},c.TEXTURE2D=1,c.COLOR2D=2,c.PRIMITIVE=4,c.FILTERGLOW=8,c.FILTERBLUR=16,c.FILTERCOLOR=32,c.COLORADD=64,c.WORLDMAT=128,c.FILLTEXTURE=256,c.SKINMESH=512,c.SHADERDEFINE_FSHIGHPRECISION=1024,c.TXTALPHA=2048,c.TXTCOMPRESS=4096,c.__name2int={},c.__int2name=[],c.__int2nameMap=[],c}(),Da=(function(a){function h(a,b,c,d,e,f,g){h.__super.call(this,a,b,c,d,40,e,f,g)}m(h,"laya.webgl.shapes.Ellipse",ca)}(),function(a){function f(a,b,c,d,e){this._points=[],this.rebuild(c),f.__super.call(this,a,b,0,0,0,e,d,e,0)}m(f,"laya.webgl.shapes.Line",ca);var b=f.prototype;return b.rebuild=function(a){var b=a.length;b!=this._points.length&&(this.mUint16Array=new Uint16Array(6*(b/2-1)),this.mFloat32Array=new Float32Array(5*b)),this._points.length=0;for(var c=NaN,d=NaN,e=-1,f=-1,g=a.length/2,h=0;h<g;h++)c=a[2*h],d=a[2*h+1],(.01<Math.abs(e-c)||.01<Math.abs(f-d))&&this._points.push(c,d),e=c,f=d},b.getData=function(a,b,c){var d=[],e=[];0<this.borderWidth&&this.createLine2(this._points,d,this.borderWidth,c,e,this._points.length/2),this.mUint16Array.set(d,0),this.mFloat32Array.set(e,0),a.append(this.mUint16Array),b.append(this.mFloat32Array)},f}()),Ea=function(a){function l(a,b,c,d,e){this._points=[];for(var f=NaN,g=NaN,h=-1,i=-1,j=c.length/2-1,k=0;k<j;k++)f=c[2*k],g=c[2*k+1],(.01<Math.abs(h-f)||.01<Math.abs(i-g))&&this._points.push(f,g),h=f,i=g;f=c[2*j],g=c[2*j+1],h=this._points[0],i=this._points[1],(.01<Math.abs(h-f)||.01<Math.abs(i-g))&&this._points.push(f,g),l.__super.call(this,a,b,0,0,this._points.length/2,0,d,e)}m(l,"laya.webgl.shapes.LoopLine",ca);var b=l.prototype;return b.getData=function(a,b,c){if(0<this.borderWidth){for(var d=this.color,e=(d>>16&255)/255,f=(d>>8&255)/255,g=(255&d)/255,h=[],i=0,j=0,k=[],l=Math.floor(this._points.length/2),m=0;m<l;m++)i=this._points[2*m],j=this._points[2*m+1],h.push(this.x+i,this.y+j,e,f,g);this.createLoopLine(h,k,this.borderWidth,c+h.length/5),a.append(new Uint16Array(k)),b.append(new Float32Array(h))}},b.createLoopLine=function(a,b,c,d,e,f){a.length;var g=a.concat(),h=e||a,i=this.borderColor,j=(i>>16&255)/255,k=(i>>8&255)/255,l=(255&i)/255,m=[g[0],g[1]],n=[g[g.length-5],g[g.length-4]],o=n[0]+.5*(m[0]-n[0]),p=n[1]+.5*(m[1]-n[1]);g.unshift(o,p,0,0,0),g.push(o,p,0,0,0);var q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K=g.length/5,L=d,M=c/2;s=g[0],t=g[1],z=s-(u=g[5]),y=(y=-(t-(v=g[6])))/(J=Math.sqrt(y*y+z*z))*M,z=z/J*M,h.push(s-y,t-z,j,k,l,s+y,t+z,j,k,l);for(var N=1;N<K-1;N++)s=g[5*(N-1)],t=g[5*(N-1)+1],u=g[5*N],v=g[5*N+1],w=g[5*(N+1)],x=g[5*(N+1)+1],z=s-u,B=u-w,E=(-(y=(y=-(t-v))/(J=Math.sqrt(y*y+z*z))*M)+s)*(-(z=z/J*M)+v)-(-y+u)*(-z+t),H=(-(A=(A=-(v-x))/(J=Math.sqrt(A*A+B*B))*M)+w)*(-(B=B/J*M)+v)-(-A+u)*(-B+x),I=(C=-z+t-(-z+v))*(G=-A+u-(-A+w))-(F=-B+x-(-B+v))*(D=-y+u-(-y+s)),Math.abs(I)<.1?(I+=10.1,h.push(u-y,v-z,j,k,l,u+y,v+z,j,k,l)):(((q=(D*H-G*E)/I)-u)*(q-u)+((r=(F*E-C*H)/I)-v)+(r-v),h.push(q,r,j,k,l,u-(q-u),v-(r-v),j,k,l));f&&(b=f);var O=this.edges+1;for(N=1;N<O;N++)b.push(L+2*(N-1),L+2*(N-1)+1,L+2*N+1,L+2*N+1,L+2*N,L+2*(N-1));return b.push(L+2*(N-1),L+2*(N-1)+1,L+1,L+1,L,L+2*(N-1)),h},l}(),Fa=function(a){function g(a,b,c,d,e,f){this._points=null,this._start=-1,this._repaint=!1,this.earcutTriangles=null,this._mat=z.create(),this._points=c.slice(0,c.length),g.__super.call(this,a,b,0,0,this._points.length/2,d,e,f)}m(g,"laya.webgl.shapes.Polygon",ca);var b=g.prototype;return b.rebuild=function(a){this._repaint||(this._points.length=0,this._points=this._points.concat(a))},b.setMatrix=function(a){a.copyTo(this._mat)},b.needUpdate=function(a){return this._repaint=this._mat.a==a.a&&this._mat.b==a.b&&this._mat.c==a.c&&this._mat.d==a.d&&this._mat.tx==a.tx&&this._mat.ty==a.ty,!this._repaint},b.getData=function(a,b,c){var d,e=0,f=this._points,g=0;if(this.mUint16Array&&this.mFloat32Array&&this._repaint){if(this._start!=c){for(this._start=c,d=[],g=this.earcutTriangles.length,e=0;e<g;e++)d.push(this.earcutTriangles[e]+c);this.mUint16Array=new Uint16Array(d)}}else{this._start=c,d=[];var h=[],i=[],j=this.color,k=(j>>16&255)/255,l=(j>>8&255)/255,m=(255&j)/255;for(g=Math.floor(f.length/2),e=0;e<g;e++)h.push(this.x+f[2*e],this.y+f[2*e+1],k,l,m),i.push(this.x+f[2*e],this.y+f[2*e+1]);for(this.earcutTriangles=da.earcut(i,null,2),g=this.earcutTriangles.length,e=0;e<g;e++)d.push(this.earcutTriangles[e]+c);this.mUint16Array=new Uint16Array(d),this.mFloat32Array=new Float32Array(h)}a.append(this.mUint16Array),b.append(this.mFloat32Array)},g}(),Ga=function(a){function f(){this._matrix=new z,this._matrix4=pa.defaultMatrix4.concat(),f.__super.call(this,1e4),this.shaderValue=new ya(0,0)}m(f,"laya.webgl.submit.SubmitCanvas",fa);var b=f.prototype;return b.renderSubmit=function(){if(this._ctx_src._targets)return this._ctx_src._targets.flush(this._ctx_src),1;var a=sa.worldAlpha,b=sa.worldMatrix4,c=sa.worldMatrix,d=sa.worldFilters,e=sa.worldShaderDefines,f=this.shaderValue,g=this._matrix,h=this._matrix4,i=z.TEMP;return z.mul(g,c,i),h[0]=i.a,h[1]=i.b,h[4]=i.c,h[5]=i.d,h[12]=i.tx,h[13]=i.ty,sa.worldMatrix=i.clone(),sa.worldMatrix4=h,sa.worldAlpha=sa.worldAlpha*f.alpha,f.filters&&f.filters.length&&(sa.worldFilters=f.filters,sa.worldShaderDefines=f.defines),this._ctx_src.flush(),sa.worldAlpha=a,sa.worldMatrix4=b,sa.worldMatrix.destroy(),sa.worldMatrix=c,sa.worldFilters=d,sa.worldShaderDefines=e,1},b.releaseRender=function(){var a=f._cache;this._ctx_src=null,a[a._length++]=this},b.getRenderType=function(){return 10003},f.create=function(a,b,c){var d=f._cache._length?f._cache[--f._cache._length]:new f;d._ctx_src=a;var e=d.shaderValue;return e.alpha=b,e.defines.setValue(0),c&&c.length&&e.setFilters(c),d},f._cache=((f._cache=[])._length=0,f._cache),f}(),Ha=function(a){function j(a){this._preIsSameTextureShader=!1,this._isSameTexture=!0,this._texs=new Array,this._texsID=new Array,this._vbPos=new Array,void 0===a&&(a=1e4),j.__super.call(this,a)}m(j,"laya.webgl.submit.SubmitTexture",fa);var b=j.prototype;return b.releaseRender=function(){var a=j._cache;(a[a._length++]=this).shaderValue.release(),this.shaderValue=null,this._preIsSameTextureShader=!1,this._blendFn=null,this._vb=null,this._ib=null,this._texs.length=0,this._vbPos.length=0,this._texsID.length=0,this._isSameTexture=!0},b.addTexture=function(a,b){this._texsID[this._texs.length]=a._uvID,this._texs.push(a),this._vbPos.push(b)},b.checkTexture=function(){if(this._texs.length<1)this._isSameTexture=!0;else{var a=this.shaderValue.textureHost.bitmap;if(null!==a)for(var b=this._vb.getFloat32Array(),c=0,d=this._texs.length;c<d;c++){var e=this._texs[c];e.active();var f=e.uv;if(this._texsID[c]!==e._uvID){this._texsID[c]=e._uvID;var g=this._vbPos[c];b[g+2]=f[0],b[g+3]=f[1],b[g+6]=f[2],b[g+7]=f[3],b[g+10]=f[4],b[g+11]=f[5],b[g+14]=f[6],b[g+15]=f[7],this._vb.setNeedUpload()}e.bitmap!==a&&(this._isSameTexture=!1)}}},b.renderSubmit=function(){if(0===this._numEle)return j._shaderSet=!1,1;var a=this.shaderValue.textureHost;if(a){var b=a.source;if(!a.bitmap||!b)return j._shaderSet=!1,1;this.shaderValue.texture=b,a.alphaTexture&&a.alphaTexture.source&&(this.shaderValue.texture1=a.alphaTexture.source)}this._vb.bind_upload(this._ib);var c=ua.mainContext;if(Q.activeBlendFunction!==this._blendFn&&(c.enable(3042),this._blendFn(c),Q.activeBlendFunction=this._blendFn),E.drawCall++,E.trianglesFaces+=this._numEle/3,this._preIsSameTextureShader&&Ja.activeShader&&j._shaderSet?(Ja.activeShader.uploadTexture2D(this.shaderValue.texture),this.shaderValue.texture1&&Ja.activeShader.uploadTexture2D1(this.shaderValue.texture1)):this.shaderValue.upload(),j._shaderSet=!0,1<this._texs.length&&!this._isSameTexture)for(var d=a.bitmap,e=0,f=Ja.activeShader,g=0,h=this._texs.length;g<h;g++){var i=this._texs[g];i.bitmap===d&&g+1!==h||(f.uploadTexture2D(i.source),c.drawElements(4,6*(g-e+1),5123,this._startIdx+6*e*pa.BYTES_PIDX),d=i.bitmap,e=g)}else c.drawElements(4,this._numEle,5123,this._startIdx);return 1},j.create=function(a,b,c,d,e){var f=j._cache._length?j._cache[--j._cache._length]:new j;null==c&&((c=f._selfVb||(f._selfVb=_a.create(-1))).clear(),d=0),f._ib=b,f._vb=c,f._startIdx=d*pa.BYTES_PIDX,f._numEle=0;var g=a._nBlendType;f._blendFn=a._targets?Q.targetFns[g]:Q.fns[g],f.shaderValue=e,f.shaderValue.setValue(a._shader2D);var h=a._shader2D.filters;return h&&f.shaderValue.setFilters(h),f},j._cache=((j._cache=[])._length=0,j._cache),j._shaderSet=!0,j}(),Ia=function(a){function r(){r.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,0,0),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}m(r,"laya.webgl.utils.MeshTexture",ra);var b=r.prototype;return b.addData=function(a,b,c,d,e,f){for(var g=a.length/2,h=this._vb.needSize(g*r.const_stride)>>2,i=this._vb.getFloat32Array(),j=0,k=0;k<g;k++){var l=a[j],m=a[j+1],n=l*d.a+m*d.c+d.tx,o=l*d.b+m*d.d+d.ty;i[h++]=n,i[h++]=o,i[h++]=b[j],i[h++]=b[j+1],j+=2}this._vb.setNeedUpload();var p=this.vertNum;if(0<p){(g=c.length)>r.tmpIdx.length&&(r.tmpIdx=new Uint16Array(g));for(var q=0;q<g;q++)r.tmpIdx[q]=c[q]+p;this._ib.appendU16Array(r.tmpIdx,c.length)}else this._ib.append(c);this._ib.setNeedUpload(),this.vertNum+=g,this.indexNum+=c.length},b.releaseMesh=function(){this._vb._byteLength=0,this._ib._byteLength=0,this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},b.destroy=function(){this._ib.destroy(),this._vb.destroy()},r.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new r},r.const_stride=16,r._POOL=[],g(r,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5126,2,8]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),r}(),Ja=function(a){function b(){b.__super.call(this),this.lock=!0}return m(b,"laya.webgl.shader.BaseShader",t),b.activeShader=null,b.bindShader=null,b}(),Ka=function(b){function k(a,b,c,d,e,f,g,h,i){this._type=0,this._svWidth=NaN,this._svHeight=NaN,this._preRenderTarget=null,this._alreadyResolved=!1,this._looked=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._mipMap=!1,this._repeat=!1,this._minFifter=0,this._magFifter=0,this._destroy=!1,void 0===c&&(c=6408),void 0===d&&(d=5121),void 0===e&&(e=34041),void 0===f&&(f=!1),void 0===g&&(g=!1),void 0===h&&(h=-1),void 0===i&&(i=-1),this._type=1,this._w=a,this._h=b,this._surfaceFormat=c,this._surfaceType=d,this._depthStencilFormat=e,r.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=f,this._repeat=g,this._minFifter=h,this._magFifter=i,this._createWebGLRenderTarget(),this.bitmap.lock=!0,k.__super.call(this,this.bitmap,I.INV_UV)}m(k,"laya.webgl.resource.RenderTarget2D",b);var a=k.prototype;return w.imps(a,{"laya.resource.IDispose":!0}),a.getType=function(){return this._type},a.getTexture=function(){return this},a.size=function(a,b){this._w==a&&this._h==b||(this._w=a,this._h=b,this.release(),0!=this._w&&0!=this._h&&this._createWebGLRenderTarget())},a.release=function(){this.destroy()},a.recycle=function(){k.POOL.push(this)},a.start=function(){var a=ua.mainContext;return this._preRenderTarget=sa.curRenderTarget,sa.curRenderTarget=this,a.bindFramebuffer(36160,this.bitmap.frameBuffer),this._alreadyResolved=!1,1==this._type&&(a.viewport(0,0,this._w,this._h),this._svWidth=sa.width,this._svHeight=sa.height,sa.width=this._w,sa.height=this._h,Ja.activeShader=null),this},a.clear=function(a,b,c,d){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=1);var e=ua.mainContext;e.clearColor(a,b,c,d);var f=16384;switch(this._depthStencilFormat){case 33189:f|=256;break;case 36168:f|=1024;break;case 34041:f|=256,f|=1024}e.clear(f)},a.end=function(){var a=ua.mainContext;a.bindFramebuffer(36160,this._preRenderTarget?this._preRenderTarget.bitmap.frameBuffer:null),this._alreadyResolved=!0,sa.curRenderTarget=this._preRenderTarget,1==this._type?(a.viewport(0,0,this._svWidth,this._svHeight),sa.width=this._svWidth,sa.height=this._svHeight,Ja.activeShader=null):a.viewport(0,0,w.stage.width,w.stage.height)},a.getData=function(a,b,c,d){var e=ua.mainContext;if(e.bindFramebuffer(36160,this.bitmap.frameBuffer),!(36053===e.checkFramebufferStatus(36160)))return e.bindFramebuffer(36160,null),null;var f=new Uint8Array(this._w*this._h*4);return e.readPixels(a,b,c,d,this._surfaceFormat,this._surfaceType,f),e.bindFramebuffer(36160,null),f},a.destroy=function(a){void 0===a&&(a=!1),this._destroy||(this._loaded=!1,this.bitmap.offAll(),this.bitmap.disposeResource(),this.bitmap.dispose(),this.offAll(),this.bitmap=null,this._alreadyResolved=!1,this._destroy=!0,b.prototype.destroy.call(this))},a.dispose=function(){},a._createWebGLRenderTarget=function(){this.bitmap=new Ua(this.width,this.height,this._surfaceFormat,this._surfaceType,this._depthStencilFormat,this._mipMap,this._repeat,this._minFifter,this._magFifter),this.bitmap.activeResource(),this._alreadyResolved=!0,this._destroy=!1,this._loaded=!0,this.bitmap.on("recovered",this,function(a){this.event("recovered")})},d(0,a,"surfaceFormat",function(){return this._surfaceFormat}),d(0,a,"magFifter",function(){return this._magFifter}),d(0,a,"surfaceType",function(){return this._surfaceType}),d(0,a,"mipMap",function(){return this._mipMap}),d(0,a,"depthStencilFormat",function(){return this._depthStencilFormat}),d(0,a,"minFifter",function(){return this._minFifter}),d(0,a,"source",function(){return this._alreadyResolved?w.superGet(I,this,"source"):null}),k.create=function(a,b,c,d,e,f,g,h,i){void 0===c&&(c=6408),void 0===d&&(d=5121),void 0===e&&(e=34041),void 0===f&&(f=!1),void 0===g&&(g=!1),void 0===h&&(h=-1),void 0===i&&(i=-1);var j=k.POOL.pop();return j||(j=new k(a,b)),j.bitmap&&j._w==a&&j._h==b&&j._surfaceFormat==c&&j._surfaceType==d&&j._depthStencilFormat==e&&j._mipMap==f&&j._repeat==g&&j._minFifter==h&&j._magFifter==i||(j._w=a,j._h=b,j._surfaceFormat=c,j._surfaceType=d,j._depthStencilFormat=e,r.isConchWebGL&&34041===j._depthStencilFormat&&(j._depthStencilFormat=33189),j._mipMap=f,j._repeat=g,j._minFifter=h,j._magFifter=i,j.release(),j._createWebGLRenderTarget()),j},k.TYPE2D=1,k.TYPE3D=2,k.POOL=[],k}(I),La=function(a){function b(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,b.__super.call(this),b._gl=ua.mainContext}m(b,"laya.webgl.utils.Buffer",t);var c=b.prototype;return c._bind=function(){this.activeResource(),b._bindActive[this._bufferType]!==this._glBuffer&&(34962===this._bufferType&&(b._bindVertexBuffer=this._glBuffer),b._gl.bindBuffer(this._bufferType,b._bindActive[this._bufferType]=this._glBuffer),Ja.activeShader=null)},c.recreateResource=function(){this._glBuffer||(this._glBuffer=b._gl.createBuffer()),this.completeCreate()},c.disposeResource=function(){this._glBuffer&&(ua.mainContext.deleteBuffer(this._glBuffer),this._glBuffer=null),this.memorySize=0},d(0,c,"bufferUsage",function(){return this._bufferUsage}),b._gl=null,b._bindActive={},b._bindVertexBuffer=null,b._enableAtributes=[],b}(),Ma=function(a){function c(a){this.texcoord=null,this.offsetX=300,this.offsetY=0,c.__super.call(this,512,0);var b=8*pa.BYTES_PE;this.position=[2,5126,!1,b,0],this.texcoord=[2,5126,!1,b,2*pa.BYTES_PE],this.color=[4,5126,!1,b,4*pa.BYTES_PE]}return m(c,"laya.webgl.shader.d2.skinAnishader.SkinSV",ya),c}(),Na=function(a){function b(a){b.__super.call(this,2,0),this.color=[]}return m(b,"laya.webgl.shader.d2.value.Color2dSV",ya),b.prototype.setValue=function(a){a.fillStyle&&(this.color=a.fillStyle._color._color),a.strokeStyle&&(this.color=a.strokeStyle._color._color)},b}(),Oa=function(a){function b(a){this.u_colorMatrix=null,this.strength=0,this.colorMat=null,this.colorAlpha=null,this.u_TexRange=[0,1,0,1],this.u_offset=[0,0],this.texcoord=ya._TEXCOORD,b.__super.call(this,256,0)}m(b,"laya.webgl.shader.d2.value.FillTextureSV",ya);var c=b.prototype;return c.setValue=function(a){this.ALPHA=a.ALPHA,a.filters&&this.setFilters(a.filters)},c.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},b}(),Pa=function(a){function b(a){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,this.texcoord=ya._TEXCOORD,void 0===a&&(a=0),b.__super.call(this,1,a)}m(b,"laya.webgl.shader.d2.value.TextureSV",ya);var c=b.prototype;return c.setValue=function(a){this.ALPHA=a.ALPHA,a.filters&&this.setFilters(a.filters)},c.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},b}(),Qa=function(a){function b(a){this.a_color=null,this.u_pos=[0,0],b.__super.call(this,4,0),this.position=[2,5126,!1,5*pa.BYTES_PE,0],this.a_color=[3,5126,!1,5*pa.BYTES_PE,2*pa.BYTES_PE]}return m(b,"laya.webgl.shader.d2.value.PrimitiveSV",ya),b}(),Ra=function(a){function b(){this._atlaser=null,this._flashCacheImage=null,this._flashCacheImageNeedFlush=!1,b.__super.call(this)}m(b,"laya.webgl.atlas.AtlasWebGLCanvas",a);var c=b.prototype;return c.recreateResource=function(){var a=ua.mainContext,b=this._source=a.createTexture(),c=va.curBindTexTarget,d=va.curBindTexValue;va.bindTexture(a,3553,b),a.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null),a.texParameteri(3553,10241,9729),a.texParameteri(3553,10240,9729),a.texParameteri(3553,10242,33071),a.texParameteri(3553,10243,33071),c&&d&&va.bindTexture(a,c,d),this.memorySize=this._w*this._h*4,this.completeCreate()},c.disposeResource=function(){this._source&&(ua.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},c.texSubImage2D=function(a,b,c){if(r.isFlash){this._flashCacheImage||(this._flashCacheImage=p.create(""),this._flashCacheImage._image.createCanvas(this._w,this._h));var d=c.bitmapdata;this._flashCacheImage._image.copyPixels(d,0,0,d.width,d.height,a,b),this._flashCacheImageNeedFlush||(this._flashCacheImageNeedFlush=!0)}else{var e=ua.mainContext,f=va.curBindTexTarget,g=va.curBindTexValue;va.bindTexture(e,3553,this._source),e.pixelStorei(37441,!0),0<=a-1&&e.texSubImage2D(3553,0,a-1,b,6408,5121,c),a+1<=this._w&&e.texSubImage2D(3553,0,a+1,b,6408,5121,c),0<=b-1&&e.texSubImage2D(3553,0,a,b-1,6408,5121,c),b+1<=this._h&&e.texSubImage2D(3553,0,a,b+1,6408,5121,c),e.texSubImage2D(3553,0,a,b,6408,5121,c),e.pixelStorei(37441,!1),f&&g&&va.bindTexture(e,f,g)}},c.texSubImage2DPixel=function(a,b,c,d,e){var f=ua.mainContext,g=va.curBindTexTarget,h=va.curBindTexValue;va.bindTexture(f,3553,this._source);var i=new Uint8Array(e.data);f.pixelStorei(37441,!0),f.texSubImage2D(3553,0,a,b,c,d,6408,5121,i),f.pixelStorei(37441,!1),g&&h&&va.bindTexture(f,g,h)},d(0,c,"width",a.prototype._$get_width,function(a){this._w=a}),d(0,c,"height",a.prototype._$get_height,function(a){this._h=a}),b}(c),Sa=function(a){function e(){this.flipY=!0,this.alwaysChange=!1,e.__super.call(this)}m(e,"laya.webgl.resource.WebGLCanvas",c);var b=e.prototype;return b.getCanvas=function(){return this._canvas},b.clear=function(){this._ctx&&this._ctx.clear()},b.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},b._setContext=function(a){this._ctx=a},b.getContext=function(a,b){return this._ctx?this._ctx:this._ctx=e._createContext(this)},b.size=function(a,b){this._w==a&&this._h==b||(this._w=a,this._h=b,this._ctx&&this._ctx.size(a,b),this._canvas&&(this._canvas.height=b,this._canvas.width=a))},b.activeResource=function(a){void 0===a&&(a=!1),this._source||this.recreateResource()},b.recreateResource=function(){this.createWebGlTexture(),this.completeCreate()},b.disposeResource=function(){this._source&&!this.iscpuSource&&(ua.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},b.createWebGlTexture=function(){var a=ua.mainContext;this._canvas;var b=this._source=a.createTexture();this.iscpuSource=!1;var c=va.curBindTexTarget,d=va.curBindTexValue;va.bindTexture(a,3553,b),a.pixelStorei(37440,this.flipY?1:0),e.premulAlpha&&a.pixelStorei(37441,!0),a.texImage2D(3553,0,6408,6408,5121,this._imgData),e.premulAlpha&&a.pixelStorei(37441,!1),a.texParameteri(3553,10240,9729),a.texParameteri(3553,10241,9729),a.texParameteri(3553,10242,33071),a.texParameteri(3553,10243,33071),a.pixelStorei(37440,0),this.memorySize=this._w*this._h*4,c&&d&&va.bindTexture(a,c,d)},b.reloadCanvasData=function(){var a=ua.mainContext;if(!this._source)throw"reloadCanvasData error, gl texture not created!";var b=va.curBindTexTarget,c=va.curBindTexValue;va.bindTexture(a,3553,this._source),e.premulAlpha&&a.pixelStorei(37441,!0),a.texImage2D(3553,0,6408,6408,5121,this._imgData),e.premulAlpha&&a.pixelStorei(37441,!1),a.pixelStorei(37440,0),b&&c&&va.bindTexture(a,b,c)},b.texSubImage2D=function(a,b,c){var d=ua.mainContext,e=va.curBindTexTarget,f=va.curBindTexValue;va.bindTexture(d,3553,this._source),d.pixelStorei(37441,!0),d.texSubImage2D(3553,0,b,c,6408,5121,a._source),d.pixelStorei(37441,!1),e&&f&&va.bindTexture(d,e,f)},b.toBase64=function(a,b,c){var d=null;this._canvas&&(d=this._canvas.toDataURL(a,b)),c.call(this,d)},d(0,b,"context",function(){return this._ctx}),d(0,b,"source",function(){return this.alwaysChange&&this.reloadCanvasData(),this._source}),d(0,b,"asBitmap",null,function(a){this._ctx&&(this._ctx.asBitmap=a)}),e._createContext=null,e.premulAlpha=!1,e}(),Ta=function(a){function f(a,b){this.CborderSize=12,f.__super.call(this),this.char=a,this.isSpace=" "===a,this.xs=b.scaleX,this.ys=b.scaleY,this.font=b.font.toString(),this.fontSize=b.font.size,this.fillColor=b.fillColor,this.borderColor=b.borderColor,this.lineWidth=b.lineWidth,this.underLine=b.underLine;var c,d=r.isConchApp;d?((c=ConchTextCanvas)._source=ConchTextCanvas,c._source.canvas=ConchTextCanvas):c=n.canvas.source,this.canvas=c,this._enableMerageInAtlas=!0,this._ctx=d?c:this.canvas.getContext("2d",void 0);var e=J.measureText(this.char,this.font);this.cw=e.width*this.xs,this.ch=(e.height||this.fontSize)*this.ys,this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.texture=new I(this)}m(f,"laya.webgl.resource.WebGLCharImage",c);var b=f.prototype;return w.imps(b,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),b.active=function(){this.texture.active()},b.recreateResource=function(){var a=r.isConchApp;if(this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.canvas&&(this.canvas.height=this._h,this.canvas.width=this._w),a){var b=this.fontSize;1==this.xs&&1==this.ys||(b=parseInt(b*(this.xs>this.ys?this.xs:this.ys)+""));var c="normal 100 "+this.font;c=c.replace(f._fontSizeReg,b),this.borderColor&&(c+=" 1 "+this.borderColor),this._ctx.font=c,this._ctx.textBaseline="top",this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,this.CborderSize,this.CborderSize,null,null,null)}else{if(this._ctx.save(),this._ctx.lineJoin="round",this._ctx.clearRect(0,0,this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this._ctx.font=this.font,H.RightToLeft&&(this._ctx.textAlign="end"),this._ctx.textBaseline="top",this._ctx.translate(this.CborderSize,this.CborderSize),1==this.xs&&1==this.ys||this._ctx.scale(this.xs,this.ys),this.fillColor&&this.borderColor?(this._ctx.strokeStyle=this.borderColor,this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null),this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,0,0,null,null,null)):-1===this.lineWidth?(this._ctx.fillStyle=this.fillColor?this.fillColor:"white",this._ctx.fillText(this.char,0,0,null,null,null)):(this._ctx.strokeStyle=this.borderColor?this.borderColor:"white",this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null)),this.underLine){this._ctx.lineWidth=1,this._ctx.strokeStyle=this.fillColor,this._ctx.beginPath(),this._ctx.moveTo(0,this.fontSize+1);var d=this._ctx.measureText(this.char).width+1;this._ctx.lineTo(d,this.fontSize+1),this._ctx.stroke()}this._ctx.restore()}this.borderSize=this.CborderSize,this.completeCreate()},b.onresize=function(a,b){this._w=a,this._h=b,this._allowMerageInAtlas=!0},b.clearAtlasSource=function(){},d(0,b,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),d(0,b,"atlasSource",function(){return this.canvas}),d(0,b,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(a){this._enableMerageInAtlas=a}),f.createOneChar=function(a,b){return new f(a,b)},f._fontSizeReg=new RegExp("\\d+(?=px)","g"),f}(),Ua=function(a){function j(a,b,c,d,e,f,g,h,i){void 0===c&&(c=6408),void 0===d&&(d=5121),void 0===e&&(e=34041),void 0===f&&(f=!1),void 0===g&&(g=!1),void 0===h&&(h=-1),void 0===i&&(i=1),j.__super.call(this),this.uri="WebGLRenderTarget_"+this.id,this._w=a,this._h=b,this._surfaceFormat=c,this._surfaceType=d,this._depthStencilFormat=e,this._mipMap=f,this._repeat=g,this._minFifter=h,this._magFifter=i}m(j,"laya.webgl.resource.WebGLRenderTarget",c);var b=j.prototype;return b.recreateResource=function(){var a=ua.mainContext;this._frameBuffer||(this._frameBuffer=a.createFramebuffer()),this._source||(this._source=a.createTexture());var b=va.curBindTexTarget,c=va.curBindTexValue;va.bindTexture(a,3553,this._source),a.texImage2D(3553,0,6408,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null);var d=this._minFifter,e=this._magFifter,f=this._repeat?10497:33071,g=k.isPOT(this._w,this._h);if(g?(this._mipMap?-1!==d||(d=9987):-1!==d||(d=9729),-1!==e||(e=9729),a.texParameteri(3553,10241,d),a.texParameteri(3553,10240,e),a.texParameteri(3553,10242,f),a.texParameteri(3553,10243,f),this._mipMap&&a.generateMipmap(3553)):(-1!==d||(d=9729),-1!==e||(e=9729),a.texParameteri(3553,10241,d),a.texParameteri(3553,10240,e),a.texParameteri(3553,10242,33071),a.texParameteri(3553,10243,33071)),a.bindFramebuffer(36160,this._frameBuffer),a.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer||(this._depthStencilBuffer=a.createRenderbuffer()),a.bindRenderbuffer(36161,this._depthStencilBuffer),a.renderbufferStorage(36161,this._depthStencilFormat,this._w,this._h),this._depthStencilFormat){case 33189:a.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:a.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:a.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}a.bindFramebuffer(36160,null),b&&c&&va.bindTexture(a,b,c),a.bindRenderbuffer(36161,null),g&&this._mipMap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this.completeCreate()},b.disposeResource=function(){this._frameBuffer&&(ua.mainContext.deleteTexture(this._source),ua.mainContext.deleteFramebuffer(this._frameBuffer),ua.mainContext.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0)},d(0,b,"depthStencilBuffer",function(){return this._depthStencilBuffer}),d(0,b,"frameBuffer",function(){return this._frameBuffer}),j}(),Va=function(a){function h(a,b,c,d,e,f,g){this.offsetX=0,this.offsetY=0,h.__super.call(this),this.repeat=!0,this.mipmap=!1,this.minFifter=-1,this.magFifter=-1,this.atlasImage=f,this.canvas=a,this._ctx=a.getContext("2d",void 0),this._w=d,this._h=e,this.offsetX=b,this.offsetY=c,this.src=g,this._enableMerageInAtlas=!0,O.enabled&&this._w<O.atlasLimitWidth&&this._h<O.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}m(h,"laya.webgl.resource.WebGLSubImage",c);var b=h.prototype;return w.imps(b,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),b.size=function(a,b){this._w=a,this._h=b,this._ctx&&this._ctx.size(a,b),this.canvas&&(this.canvas.height=b,this.canvas.width=a)},b.recreateResource=function(){this.size(this._w,this._h),this._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h),this._allowMerageInAtlas&&this._enableMerageInAtlas?this.memorySize=0:this.createWebGlTexture(),this.completeCreate()},b.createWebGlTexture=function(){var a=ua.mainContext;if(!this.canvas)throw"create GLTextur err:no data:"+this.canvas;var b=this._source=a.createTexture(),c=va.curBindTexTarget,d=va.curBindTexValue;va.bindTexture(a,3553,b),a.pixelStorei(37441,!0),a.texImage2D(3553,0,6408,6408,5121,this.canvas),a.pixelStorei(37441,!1);var e=this.minFifter,f=this.magFifter,g=this.repeat?10497:33071,h=k.isPOT(this.width,this.height);h?(this.mipmap?-1!==e||(e=9987):-1!==e||(e=9729),-1!==f||(f=9729),a.texParameteri(3553,10240,f),a.texParameteri(3553,10241,e),a.texParameteri(3553,10242,g),a.texParameteri(3553,10243,g),this.mipmap&&a.generateMipmap(3553)):(-1!==e||(e=9729),-1!==f||(f=9729),a.texParameteri(3553,10241,e),a.texParameteri(3553,10240,f),a.texParameteri(3553,10242,33071),a.texParameteri(3553,10243,33071)),c&&d&&va.bindTexture(a,c,d),this.canvas=null,h&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4},b.disposeResource=function(){O.enabled&&this._allowMerageInAtlas||!this._source||(ua.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},b.clearAtlasSource=function(){},d(0,b,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),d(0,b,"atlasSource",function(){return this.canvas}),d(0,b,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function(a){this._allowMerageInAtlas=a}),h}(),Wa=function(a){function j(a,b,c,d){if(this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},this._offset=0,j.__super.call(this),!a||!b)throw"Shader Error";this._id=++j._count,this._vs=a,this._ps=b,this._nameMap=d||{},null!=c&&(j.sharders[c]=this)}m(j,"laya.webgl.shader.Shader",Ja);var b=j.prototype;return b.recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0},b.disposeResource=function(){ua.mainContext.deleteShader(this._vshader),ua.mainContext.deleteShader(this._pshader),ua.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this.memorySize=0,this._curActTexIndex=0},b._compile=function(){if(this._vs&&this._ps&&!this._params){this._reCompile=!0,this._params=[];var a=[this._vs,this._ps],b=ua.mainContext;if(this._program=b.createProgram(),this._vshader=j._createShader(b,a[0],35633),this._pshader=j._createShader(b,a[1],35632),b.attachShader(this._program,this._vshader),b.attachShader(this._program,this._pshader),b.linkProgram(this._program),!r.isConchApp&&!b.getProgramParameter(this._program,35714))throw b.getProgramInfoLog(this._program);var c,d,e=0,f=0;for(f=r.isConchApp?b.getProgramParameterEx(this._vs,this._ps,"",35721):b.getProgramParameter(this._program,35721),e=0;e<f;e++){var g=null;c={vartype:"attribute",glfun:null,ivartype:0,attrib:g=r.isConchApp?b.getActiveAttribEx(this._vs,this._ps,"",e):b.getActiveAttrib(this._program,e),location:b.getAttribLocation(this._program,g.name),name:g.name,type:g.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._params.push(c)}var h=0;for(h=r.isConchApp?b.getProgramParameterEx(this._vs,this._ps,"",35718):b.getProgramParameter(this._program,35718),e=0;e<h;e++){var i=null;i=r.isConchApp?b.getActiveUniformEx(this._vs,this._ps,"",e):b.getActiveUniform(this._program,e),0<(c={vartype:"uniform",glfun:null,ivartype:1,attrib:g,location:b.getUniformLocation(this._program,i.name),name:i.name,type:i.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(c.name=c.name.substr(0,c.name.length-3),c.isArray=!0,c.location=b.getUniformLocation(this._program,c.name)),this._params.push(c)}for(e=0,d=this._params.length;e<d;e++)if((c=this._params[e]).indexOfParams=e,c.index=1,c.value=[c.location,null],c.codename=c.name,c.name=this._nameMap[c.codename]?this._nameMap[c.codename]:c.codename,(this._paramsMap[c.name]=c)._this=this,c.uploadedValue=[],"attribute"!==c.vartype)switch(c.type){case 5124:c.fun=c.isArray?this._uniform1iv:this._uniform1i;break;case 5126:c.fun=c.isArray?this._uniform1fv:this._uniform1f;break;case 35664:c.fun=c.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:c.fun=c.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:c.fun=c.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:c.fun=this._uniform_sampler2D;break;case 35680:c.fun=this._uniform_samplerCube;break;case 35676:c.glfun=b.uniformMatrix4fv,c.fun=this._uniformMatrix4fv;break;case 35670:c.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!")}else c.fun=this._attribute}},b.getUniform=function(a){return this._paramsMap[a]},b._attribute=function(a,b){var c=ua.mainContext,d=La._enableAtributes,e=a.location;return d[e]||c.enableVertexAttribArray(e),c.vertexAttribPointer(e,b[0],b[1],b[2],b[3],b[4]+this._offset),d[e]=La._bindVertexBuffer,1},b._uniform1f=function(a,b){var c=a.uploadedValue;return c[0]!==b?(ua.mainContext.uniform1f(a.location,c[0]=b),1):0},b._uniform1fv=function(a,b){if(b.length<4){var c=a.uploadedValue;return c[0]!==b[0]||c[1]!==b[1]||c[2]!==b[2]||c[3]!==b[3]?(ua.mainContext.uniform1fv(a.location,b),c[0]=b[0],c[1]=b[1],c[2]=b[2],c[3]=b[3],1):0}return ua.mainContext.uniform1fv(a.location,b),1},b._uniform_vec2=function(a,b){var c=a.uploadedValue;return c[0]!==b[0]||c[1]!==b[1]?(ua.mainContext.uniform2f(a.location,c[0]=b[0],c[1]=b[1]),1):0},b._uniform_vec2v=function(a,b){if(b.length<2){var c=a.uploadedValue;return c[0]!==b[0]||c[1]!==b[1]||c[2]!==b[2]||c[3]!==b[3]?(ua.mainContext.uniform2fv(a.location,b),c[0]=b[0],c[1]=b[1],c[2]=b[2],c[3]=b[3],1):0}return ua.mainContext.uniform2fv(a.location,b),1},b._uniform_vec3=function(a,b){var c=a.uploadedValue;return c[0]!==b[0]||c[1]!==b[1]||c[2]!==b[2]?(ua.mainContext.uniform3f(a.location,c[0]=b[0],c[1]=b[1],c[2]=b[2]),1):0},b._uniform_vec3v=function(a,b){return ua.mainContext.uniform3fv(a.location,b),1},b._uniform_vec4=function(a,b){var c=a.uploadedValue;return c[0]!==b[0]||c[1]!==b[1]||c[2]!==b[2]||c[3]!==b[3]?(ua.mainContext.uniform4f(a.location,c[0]=b[0],c[1]=b[1],c[2]=b[2],c[3]=b[3]),1):0},b._uniform_vec4v=function(a,b){return ua.mainContext.uniform4fv(a.location,b),1},b._uniformMatrix2fv=function(a,b){return ua.mainContext.uniformMatrix2fv(a.location,!1,b),1},b._uniformMatrix3fv=function(a,b){return ua.mainContext.uniformMatrix3fv(a.location,!1,b),1},b._uniformMatrix4fv=function(a,b){return ua.mainContext.uniformMatrix4fv(a.location,!1,b),1},b._uniform1i=function(a,b){var c=a.uploadedValue;return c[0]!==b?(ua.mainContext.uniform1i(a.location,c[0]=b),1):0},b._uniform1iv=function(a,b){return ua.mainContext.uniform1iv(a.location,b),1},b._uniform_ivec2=function(a,b){var c=a.uploadedValue;return c[0]!==b[0]||c[1]!==b[1]?(ua.mainContext.uniform2i(a.location,c[0]=b[0],c[1]=b[1]),1):0},b._uniform_ivec2v=function(a,b){return ua.mainContext.uniform2iv(a.location,b),1},b._uniform_vec3i=function(a,b){var c=a.uploadedValue;return c[0]!==b[0]||c[1]!==b[1]||c[2]!==b[2]?(ua.mainContext.uniform3i(a.location,c[0]=b[0],c[1]=b[1],c[2]=b[2]),1):0},b._uniform_vec3vi=function(a,b){return ua.mainContext.uniform3iv(a.location,b),1},b._uniform_vec4i=function(a,b){var c=a.uploadedValue;return c[0]!==b[0]||c[1]!==b[1]||c[2]!==b[2]||c[3]!==b[3]?(ua.mainContext.uniform4i(a.location,c[0]=b[0],c[1]=b[1],c[2]=b[2],c[3]=b[3]),1):0},b._uniform_vec4vi=function(a,b){return ua.mainContext.uniform4iv(a.location,b),1},b._uniform_sampler2D=function(a,b){var c=ua.mainContext,d=a.uploadedValue;return null==d[0]?(d[0]=this._curActTexIndex,c.uniform1i(a.location,this._curActTexIndex),c.activeTexture(j._TEXTURES[this._curActTexIndex]),va.bindTexture(c,3553,b),this._curActTexIndex++,1):(c.activeTexture(j._TEXTURES[d[0]]),va.bindTexture(c,3553,b),0)},b._uniform_samplerCube=function(a,b){var c=ua.mainContext,d=a.uploadedValue;return null==d[0]?(d[0]=this._curActTexIndex,c.uniform1i(a.location,this._curActTexIndex),c.activeTexture(j._TEXTURES[this._curActTexIndex]),va.bindTexture(c,34067,b),this._curActTexIndex++,1):(c.activeTexture(j._TEXTURES[d[0]]),va.bindTexture(c,34067,b),0)},b._noSetValue=function(a){console.log("no....:"+a.name)},b.uploadOne=function(a,b){this.activeResource(),va.UseProgram(this._program);var c=this._paramsMap[a];c.fun.call(this,c,b)},b.uploadTexture2D=function(a){E.shaderCall++;var b=ua.mainContext;b.activeTexture(33984),va.bindTexture(b,3553,a)},b.uploadTexture2D1=function(a){E.shaderCall++;var b=ua.mainContext;b.activeTexture(33985),va.bindTexture(b,3553,a)},b.upload=function(a,b){Ja.activeShader=Ja.bindShader=this,this._lastUseFrameCount===E.loopCount||this.activeResource(),va.UseProgram(this._program),this._reCompile?(b=this._params,this._reCompile=!1):b=b||this._params;ua.mainContext;for(var c,d,e=b.length,f=0,g=0;g<e;g++)null!==(d=a[(c=b[g]).name])&&(f+=c.fun.call(this,c,d));E.shaderCall+=f},b.uploadArray=function(a,b,c){Ja.activeShader=this,(Ja.bindShader=this).activeResource(),va.UseProgram(this._program);this._params;for(var d,e,f=0,g=b-2;0<=g;g-=2)(e=this._paramsMap[a[g]])&&null!=(d=a[g+1])&&(c&&c[e.name]&&c[e.name].bind(),f+=e.fun.call(this,e,d));E.shaderCall+=f},b.getParams=function(){return this._params},j.getShader=function(a){return j.sharders[a]},j.create=function(a,b,c,d){return new j(a,b,c,d)},j.withCompile=function(a,b,c,d){if(c&&j.sharders[c])return j.sharders[c];var e=j._preCompileShader[2e-4*a];if(!e)throw new Error("withCompile shader err!"+a);return e.createShader(b,c,d)},j.withCompile2D=function(a,b,c,d,e){if(d&&j.sharders[d])return j.sharders[d];var f=j._preCompileShader[2e-4*a+b];if(!f)throw new Error("withCompile shader err!"+a+" "+b);return f.createShader(c,d,e)},j.addInclude=function(a,b){ta.addInclude(a,b)},j.preCompile=function(a,b,c,d){var e=2e-4*a;j._preCompileShader[e]=new ta(e,b,c,d)},j.preCompile2D=function(a,b,c,d,e){var f=2e-4*a+b;j._preCompileShader[f]=new ta(f,c,d,e)},j._createShader=function(a,b,c){var d=a.createShader(c);return a.shaderSource(d,b),a.compileShader(d),d},j._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,,33991,33992],j._count=0,j._preCompileShader={},j.SHADERNAME2ID=2e-4,j.sharders=((j.sharders=[]).length=32,j.sharders),g(j,["nameKey",function(){return this.nameKey=new F}]),j}(),Xa=function(a){function b(){this._maxsize=0,this._upload=!0,this._uploadSize=0,b.__super.call(this),this.lock=!0,this.uri="Buffer2D_"+this.id}m(b,"laya.webgl.utils.Buffer2D",a);var c=b.prototype;return c.needSize=function(a){var b=this._byteLength;if(a){var c=this._byteLength+a;c<=this._buffer.byteLength||this._resizeBuffer(c<<1,!0),this._byteLength=c}return b},c._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),E.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,La._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),La._gl.bufferSubData(this._bufferType,0,this._buffer)},c._bufferSubData=function(a,b,c){if(void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),this._maxsize=Math.max(this._maxsize,this._byteLength),E.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,La._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),b||c){var d=this._buffer.slice(b,c);La._gl.bufferSubData(this._bufferType,a,d)}else La._gl.bufferSubData(this._bufferType,a,this._buffer)},c._checkArrayUse=function(){},c._bind_upload=function(){return!!this._upload&&(this._upload=!1,this._bind(),this._bufferData(),!0)},c._bind_subUpload=function(a,b,c){return void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),!!this._upload&&(this._upload=!1,this._bind(),this._bufferSubData(a,b,c),!0)},c._resizeBuffer=function(a,b){if(a<this._buffer.byteLength)return this;if(this.memorySize=a,b&&this._buffer&&0<this._buffer.byteLength){var c=new ArrayBuffer(a);new Uint8Array(c).set(new Uint8Array(this._buffer),0),this._buffer=c}else this._buffer=new ArrayBuffer(a);return this._checkArrayUse(),this._upload=!0,this},c.append=function(a){this._upload=!0;var b,c;b=a.byteLength,a instanceof Uint8Array?(this._resizeBuffer(this._byteLength+b,!0),c=new Uint8Array(this._buffer,this._byteLength)):a instanceof Uint16Array?(this._resizeBuffer(this._byteLength+b,!0),c=new Uint16Array(this._buffer,this._byteLength)):a instanceof Float32Array&&(this._resizeBuffer(this._byteLength+b,!0),c=new Float32Array(this._buffer,this._byteLength)),c.set(a,0),this._byteLength+=b,this._checkArrayUse()},c.appendU16Array=function(a,b){this._resizeBuffer(this._byteLength+2*b,!0);for(var c=new Uint16Array(this._buffer,this._byteLength,b),d=0;d<b;d++)c[d]=a[d];this._byteLength+=2*b,this._checkArrayUse()},c.appendEx=function(a,b){this._upload=!0;var c;c=a.byteLength,this._resizeBuffer(this._byteLength+c,!0),new b(this._buffer,this._byteLength).set(a,0),this._byteLength+=c,this._checkArrayUse()},c.appendEx2=function(a,b,c,d){void 0===d&&(d=1),this._upload=!0;var e,f;e=c*d,this._resizeBuffer(this._byteLength+e,!0),f=new b(this._buffer,this._byteLength);var g=0;for(g=0;g<c;g++)f[g]=a[g];this._byteLength+=e,this._checkArrayUse()},c.getBuffer=function(){return this._buffer},c.setNeedUpload=function(){this._upload=!0},c.getNeedUpload=function(){return this._upload},c.upload=function(){var a=this._bind_upload();return La._gl.bindBuffer(this._bufferType,null),La._bindActive[this._bufferType]=null,Ja.activeShader=null,a},c.subUpload=function(a,b,c){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0);var d=this._bind_subUpload();return La._gl.bindBuffer(this._bufferType,null),La._bindActive[this._bufferType]=null,Ja.activeShader=null,d},c.disposeResource=function(){a.prototype.disposeResource.call(this),this._upload=!0,this._uploadSize=0},c.clear=function(){this._byteLength=0,this._upload=!0},d(0,c,"bufferLength",function(){return this._buffer.byteLength}),d(0,c,"byteLength",null,function(a){this._byteLength!==a&&(a<=this._buffer.byteLength||this._resizeBuffer(2*a+256,!0),this._byteLength=a)}),b.__int__=function(a){$a.QuadrangleIB=$a.create(35044),qa.fillIBQuadrangle($a.QuadrangleIB,16)},b.FLOAT32=4,b.SHORT=2,b}(La),Ya=(function(b){function c(a){this.u_blurX=!1,this.u_color=null,this.u_offset=null,this.u_strength=NaN,this.u_texW=0,this.u_texH=0,c.__super.call(this,9)}m(c,"laya.webgl.shader.d2.value.GlowSV",b);var a=c.prototype;a.setValue=function(a){b.prototype.setValue.call(this,a)},a.clear=function(){b.prototype.clear.call(this)}}(Pa),function(a){function b(a){b.__super.call(this,64),this.defines.add(64)}m(b,"laya.webgl.shader.d2.value.TextSV",a);var c=b.prototype;return c.release=function(){(b.pool[b._length++]=this).clear()},c.clear=function(){a.prototype.clear.call(this)},b.create=function(){return b._length?b.pool[--b._length]:new b(null)},b.pool=[],b._length=0,b}(Pa)),Za=function(a){function e(a,b,c,d){this._params2dQuick1=null,this._params2dQuick2=null,this._shaderValueWidth=NaN,this._shaderValueHeight=NaN,e.__super.call(this,a,b,c,d)}m(e,"laya.webgl.shader.d2.Shader2X",a);var b=e.prototype;return b.upload2dQuick1=function(a){this.upload(a,this._params2dQuick1||this._make2dQuick1())},b._make2dQuick1=function(){if(!this._params2dQuick1){this.activeResource(),this._params2dQuick1=[];for(var a,b=this._params,c=0,d=b.length;c<d;c++)a=b[c],(r.isFlash||"size"!==a.name&&"position"!==a.name&&"texcoord"!==a.name)&&this._params2dQuick1.push(a)}return this._params2dQuick1},b.disposeResource=function(){a.prototype.disposeResource.call(this),this._params2dQuick1=null,this._params2dQuick2=null},b.upload2dQuick2=function(a){this.upload(a,this._params2dQuick2||this._make2dQuick2())},b._make2dQuick2=function(){if(!this._params2dQuick2){this.activeResource(),this._params2dQuick2=[];for(var a,b=this._params,c=0,d=b.length;c<d;c++)a=b[c],(r.isFlash||"size"!==a.name)&&this._params2dQuick2.push(a)}return this._params2dQuick2},e.create=function(a,b,c,d){return new e(a,b,c,d)},e}(Wa),$a=function(a){function b(a){this._uint8Array=null,this._uint16Array=null,void 0===a&&(a=35044),b.__super.call(this),this._bufferUsage=a,this._bufferType=34963,r.isFlash||(this._buffer=new ArrayBuffer(8))}m(b,"laya.webgl.utils.IndexBuffer2D",Xa);var c=b.prototype;return c._checkArrayUse=function(){this._uint8Array&&(this._uint8Array=new Uint8Array(this._buffer)),this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},c.getUint8Array=function(){return this._uint8Array||(this._uint8Array=new Uint8Array(this._buffer))},c.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},c.destory=function(){this._uint16Array=null,this._uint8Array=null,this._buffer=null},b.QuadrangleIB=null,b.create=function(a){return void 0===a&&(a=35044),new b(a)},b}(),_a=function(a){function c(a,b){this._floatArray32=null,this._vertexStride=0,c.__super.call(this),this._vertexStride=a,this._bufferUsage=b,this._bufferType=34962,r.isFlash||(this._buffer=new ArrayBuffer(8)),this.getFloat32Array()}m(c,"laya.webgl.utils.VertexBuffer2D",a);var b=c.prototype;return b.getFloat32Array=function(){return this._floatArray32||(this._floatArray32=new Float32Array(this._buffer))},b.bind=function(a){a&&a._bind(),this._bind()},b.insertData=function(a,b){this.getFloat32Array().set(a,b),this._upload=!0},b.bind_upload=function(a){a._bind_upload()||a._bind(),this._bind_upload()||this._bind()},b._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer))},b.disposeResource=function(){a.prototype.disposeResource.call(this)},b.destory=function(){this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},d(0,b,"vertexStride",function(){return this._vertexStride}),c.create=function(a,b){return void 0===b&&(b=35048),new c(a,b)},c}(Xa),ab=function(a){function h(a,b,c,d,e,f){if(this._format=0,this._mipmap=!1,this._allowMerageInAtlas=!1,this._enableMerageInAtlas=!1,this.repeat=!1,this._image=null,this.minFifter=0,void(this.magFifter=0)===c&&(c=6408),void 0===d&&(d=!0),h.__super.call(this,a,b),a){if(this._format=c,this._mipmap=d,this.repeat=!1,this.minFifter=-1,this.magFifter=-1,"string"==typeof a)this._url=a,this._src=a,this._image=new n.window.Image,b&&(b.onload&&(this.onload=b.onload),b.onerror&&(this.onerror=b.onerror),b.onCreate&&b.onCreate(this)),this._image.crossOrigin=a&&0==a.indexOf("data:")?null:"",a&&(this._image.src=a);else if(a instanceof ArrayBuffer){this._src=b,this._url=this._src;var g=new i(a);g.readUTFBytes(4),g.readUTFBytes(2),g.getInt16();g.endian="bigEndian",this._w=g.getInt16(),this._h=g.getInt16();g.getInt16(),g.getInt16();this._image=new Uint8Array(a,g.pos),this._format=ua.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL,O.enabled&&this._w<O.atlasLimitWidth&&this._h<O.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}else{if(!(a instanceof Uint8Array))return this._src=b,this._url=this._src,this._image=a.source||a,this._$5__enableMerageInAtlas=!1,void this.onresize();this._src=b,this._url=this._src,this._w=e,this._h=f,this._image=a,this._format=0===c?a.byteLength/(e*f)==4?6408:6407:c}this._$5__enableMerageInAtlas=!0}}m(h,"laya.webgl.resource.WebGLImage",p);var b=h.prototype;return w.imps(b,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),b._init_=function(a,b){},b._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var a=ua.mainContext,b=this._source=a.createTexture(),c=va.curBindTexTarget,d=va.curBindTexValue;va.bindTexture(a,3553,b);var e=this.minFifter,f=this.magFifter,g=this.repeat?10497:33071,h=k.isPOT(this._w,this._h),i=!1;switch(h?(this.mipmap?-1!==e||(e=9987):-1!==e||(e=9729),-1!==f||(f=9729),a.texParameteri(3553,10241,e),a.texParameteri(3553,10240,f),a.texParameteri(3553,10242,g),a.texParameteri(3553,10243,g),this.mipmap&&a.generateMipmap(3553)):(-1!==e||(e=9729),-1!==f||(f=9729),a.texParameteri(3553,10241,e),a.texParameteri(3553,10240,f),a.texParameteri(3553,10242,33071),a.texParameteri(3553,10243,33071)),a.pixelStorei(37441,!0),this._format){case 6407:case 6408:this._image instanceof Uint8Array?(6407==this._format&&a.pixelStorei(a.UNPACK_ALIGNMENT,1),a.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image)):(6407==this._format&&a.pixelStorei(a.UNPACK_ALIGNMENT,1),a.texImage2D(3553,0,this._format,this._format,5121,this._image));break;case 6406:i=!0,a.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image);break;case 35840:case 35841:case 35842:case 35843:case 33779:case 37815:case 37812:case 37821:case ua.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:i=!0,a.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}a.pixelStorei(37441,!1),c&&d&&va.bindTexture(a,c,d),this.uri||(this.uri=this._url),i?this.memorySize=this._image.length:h&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this._image.onload=null,this._image=null,this._recreateLock=!1},b.recreateResource=function(){var a=this;if(this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._image){if(this._recreateLock)return;this._allowMerageInAtlas&&this._$5__enableMerageInAtlas?(this.memorySize=0,this._recreateLock=!1):this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0;var b=this;this._image=new n.window.Image,this._image.crossOrigin=0==this._src.indexOf("data:")?null:"",this._image.onload=function(){if(b._needReleaseAgain)return b._needReleaseAgain=!1,b._image.onload=null,void(b._image=null);b._allowMerageInAtlas&&b._enableMerageInAtlas?(a.memorySize=0,a._recreateLock=!1):b._createWebGlTexture(),b.completeCreate()},this._image.src=this._src}},b.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&ua.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0},b.onresize=function(){this._w=this._image.width,this._h=this._image.height,O.enabled&&this._w<O.atlasLimitWidth&&this._h<O.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1},b.clearAtlasSource=function(){this._image=null},d(0,b,"format",function(){return this._format}),d(0,b,"enableMerageInAtlas",function(){return this._$5__enableMerageInAtlas},function(a){this._$5__enableMerageInAtlas=a}),d(0,b,"mipmap",function(){return this._mipmap}),d(0,b,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),d(0,b,"atlasSource",function(){return this._image}),d(0,b,"onload",null,function(a){var b=this;this._onload=a,this._image&&(this._image.onload=null!=this._onload?function(){b.onresize(),b._onload()}:null)}),d(0,b,"onerror",null,function(a){var b=this;this._onerror=a,this._image&&(this._image.onerror=null!=this._onerror?function(){b._onerror()}:null)}),h}();w.__init([na,N,xa,ta])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(a,b){"use strict";for(var c in Object.defineProperty(b,"__esModule",{value:!0}),Laya){var d=Laya[c];d&&d.__isclass&&(b[c]=d)}}),function(a,b,d){d.un,d.uns;var e=d.static,f=d.class,g=d.getset,h=(d.__newvec,laya.utils.Browser,laya.display.css.CSSStyle),o=laya.utils.ClassUtils,l=(laya.events.Event,laya.utils.HTMLChar),i=laya.net.Loader,j=(laya.display.Node,laya.maths.Rectangle),k=laya.renders.Render,m=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.display.Sprite),n=laya.utils.Stat,J=laya.display.Text,p=laya.resource.Texture,q=laya.net.URL,r=laya.utils.Utils,s=function(){function n(){}return f(n,"laya.html.utils.HTMLParse"),n.parse=function(a,b,c){b=(b="<root>"+(b=b.replace(/<br>/g,"<br/>"))+"</root>").replace(n.spacePattern,n.char255);var d=r.parseXMLFromString(b);n._parseXML(a,d.childNodes[0].childNodes,c)},n._parseXML=function(a,b,c,d){var e=0,f=0;if(b.join||b.item)for(e=0,f=b.length;e<f;++e)n._parseXML(a,b[e],c,d);else{var g,h,i;if(3==b.nodeType)return void(a instanceof laya.html.dom.HTMLDivElement?(null==b.nodeName&&(b.nodeName="#text"),h=b.nodeName.toLowerCase(),0<(i=b.textContent.replace(/^\s+|\s+$/g,"")).length&&(g=o.getInstance(h))&&(a.addChild(g),g.innerTEXT=i.replace(n.char255AndOneSpacePattern," "))):0<(i=b.textContent.replace(/^\s+|\s+$/g,"")).length&&(a.innerTEXT=i.replace(n.char255AndOneSpacePattern," ")));if("#comment"==(h=b.nodeName.toLowerCase()))return;if(g=o.getInstance(h)){(g=a.addChild(g)).URI=c,g.href=d;var j=b.attributes;if(j&&0<j.length)for(e=0,f=j.length;e<f;++e){var k=j[e],l=k.nodeName,m=k.value;g._setAttributes(l,m)}n._parseXML(g,b.childNodes,c,g.href)}else n._parseXML(a,b.childNodes,c,d)}},n.char255=String.fromCharCode(255),n.spacePattern=/&nbsp;|&#160;/g,n.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),n}(),t=function(){function I(){}return f(I,"laya.html.utils.Layout"),I.later=function(a){null==I._will&&(I._will=[],d.stage.frameLoop(1,null,function(){if(!(I._will.length<1)){for(var a=0;a<I._will.length;a++)laya.html.utils.Layout.layout(I._will[a]);I._will.length=0}})),I._will.push(a)},I.layout=function(a){if(!a||!a._style)return null;if(0==(512&a._style._type))return null;a.getStyle()._type&=-513;var b=I._multiLineLayout(a);return k.isConchApp&&a.layaoutCallNative&&a.layaoutCallNative(),b},I._multiLineLayout=function(a){if(J.RightToLeft)return I._multiLineLayout2(a);var b=new Array;a._addChildsToLayout(b);var c,d,e,f,g,h=0,i=b.length,j=a._getCSSStyle(),k=j.letterSpacing,l=j.leading,m=j.lineHeight,n=j._widthAuto()||!j.wordWrap,o=n?999999:a.width,p=(a.height,0),q=j.italic?j.fontSize/3:0,r=j._getAlign(),s=j._getValign(),t=0!==s||0!==r||0!=m,u=0,v=0,w=0,x=0,y=new Array,z=y[0]=new K,A=!1,B=!1;z.h=0,j.italic&&(o-=j.fontSize/3);var C=0,D=!0;function E(){z.y=v,v+=z.h+l,0==z.h&&(v+=m),z.mWidth=C,C=0,z=new K,y.push(z),z.h=0,A=!(D=!(u=0))}for(h=0;h<i;h++)if(null!=(c=b[h]))if(D=!1,c instanceof laya.html.dom.HTMLBrElement)E(),z.y=v;else{if(c._isChar()){if((f=c).isWord)A=B||"\n"===f.char,z.wordStartIndex=z.elements.length;else{if(w=f.width+f.style.letterSpacin,0<y.length&&o<u+w&&0<z.wordStartIndex){var F;F=z.elements.length-z.wordStartIndex+1,z.elements.length=z.wordStartIndex,h-=F,E();continue}A=!1,C+=f.width}w=f.width+k,x=f.height,B=!1,(A=A||o<u+w)&&E(),z.minTextHeight=Math.min(z.minTextHeight,c.height)}else d=c._getCSSStyle(),g=c,e=d.padding,0===d._getCssFloat()||(t=!0),A=B||d.lineElement,w=g.width*g._style._tf.scaleX+e[1]+e[3]+k,x=g.height*g._style._tf.scaleY+e[0]+e[2],B=d.lineElement,(A=A||o<u+w&&d.wordWrap)&&E();z.elements.push(c),z.h=Math.max(z.h,x),c.x=u,c.y=v,u+=w,z.w=u-k,z.y=v,p=Math.max(u+q,p)}else D||(u+=I.DIV_ELEMENT_PADDING),z.wordStartIndex=z.elements.length;if(v=z.y+z.h,t){var G=0,H=o;for(n&&0<a.width&&(H=a.width),h=0,i=y.length;h<i;h++)y[h].updatePos(0,H,h,G,r,s,m),G+=Math.max(m,y[h].h+l);v=G}return n&&(a.width=p),v>a.height&&(a.height=v),[p,v]},I._multiLineLayout2=function(a){var b=new Array;a._addChildsToLayout(b);var c,d,e,f,g,h=0,i=b.length,j=a._getCSSStyle(),k=j.letterSpacing,l=j.leading,m=j.lineHeight,n=j._widthAuto()||!j.wordWrap,o=n?999999:a.width,p=(a.height,0),q=j.italic?j.fontSize/3:0,r=2-j._getAlign(),s=j._getValign(),t=0!==s||0!=r||0!=m,u=0,v=0,w=0,x=0,y=new Array,z=y[0]=new K,A=!1,B=!1;z.h=0,j.italic&&(o-=j.fontSize/3);var C=0,D=!0;function E(){z.y=v,v+=z.h+l,0==z.h&&(v+=m),z.mWidth=C,C=0,z=new K,y.push(z),z.h=0,A=!(D=!(u=0))}for(h=0;h<i;h++)if(null!=(c=b[h]))if(D=!1,c instanceof laya.html.dom.HTMLBrElement)E(),z.y=v;else{if(c._isChar()){if((f=c).isWord)A=B||"\n"===f.char,z.wordStartIndex=z.elements.length;else{if(0<y.length&&o<u+w&&0<z.wordStartIndex){var F;F=z.elements.length-z.wordStartIndex+1,z.elements.length=z.wordStartIndex,h-=F,E();continue}A=!1,C+=f.width}w=f.width+k,x=f.height,B=!1,(A=A||o<u+w)&&E(),z.minTextHeight=Math.min(z.minTextHeight,c.height)}else d=c._getCSSStyle(),g=c,e=d.padding,0===d._getCssFloat()||(t=!0),A=B||d.lineElement,w=g.width*g._style._tf.scaleX+e[1]+e[3]+k,x=g.height*g._style._tf.scaleY+e[0]+e[2],B=d.lineElement,(A=A||o<u+w&&d.wordWrap)&&E();z.elements.push(c),z.h=Math.max(z.h,x),c.x=u,c.y=v,u+=w,z.w=u-k,z.y=v,p=Math.max(u+q,p)}else D||(u+=I.DIV_ELEMENT_PADDING),z.wordStartIndex=z.elements.length;if(v=z.y+z.h,t){var G=0,H=o;for(h=0,i=y.length;h<i;h++)y[h].updatePos(0,H,h,G,r,s,m),G+=Math.max(m,y[h].h+l);v=G}for(n&&(a.width=p),v>a.height&&(a.height=v),h=0,i=y.length;h<i;h++)y[h].revertOrder(o);return[p,v]},I._will=null,I.DIV_ELEMENT_PADDING=0,I}(),K=function(){function a(){this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0,this.elements=new Array}f(a,"laya.html.utils.LayoutLine");var b=a.prototype;return b.updatePos=function(a,b,c,d,e,f,g){var h,i=0;0<this.elements.length&&(i=(h=this.elements[this.elements.length-1]).x+h.width-this.elements[0].x);var j=0,k=NaN;1===e&&(j=(b-i)/2),2===e&&(j=b-i),0===g||0!=f||(f=1);for(var l=0,m=this.elements.length;l<m;l++){var n=(h=this.elements[l])._getCSSStyle();switch(0!==j&&(h.x+=j),n._getValign()){case 0:h.y=d;break;case 1:var o=0;99999!=this.minTextHeight&&(o=this.minTextHeight);var p=(o+g)/2;p=Math.max(p,this.h),k=(laya.html.dom.HTMLImageElement,d+p-h.height),h.y=k;break;case 2:h.y=d+(g-h.height)}}},b.revertOrder=function(a){var b;if(0<this.elements.length){var c,d=0;for(c=this.elements.length,d=0;d<c;d++)(b=this.elements[d]).x=a-b.x-b.width}},a}(),u=function(c){function b(){this.URI=null,this._href=null,b.__super.call(this),this._text=b._EMPTYTEXT,this.setStyle(new h(this)),this._getCSSStyle().valign="middle",this.mouseEnabled=!0}f(b,"laya.html.dom.HTMLElement",c);var a=b.prototype;return a.layaoutCallNative=function(){var a=0;if(this._childs&&0<(a=this._childs.length))for(var b=0;b<a;b++)this._childs[b].layaoutCallNative&&this._childs[b].layaoutCallNative();var c=this._getWords();c?laya.html.dom.HTMLElement.fillWords(this,c,0,0,this.style.font,this.style.color,this.style.underLine):this.graphics.clear()},a.appendChild=function(a){return this.addChild(a)},a._getWords2=function(){var a=this._text.text;if(!a||0===a.length)return null;var b,c,d=0,e=0;if(this._text.drawWords)c=this._text.drawWords;else{for(e=(b=a.split(" ")).length-1,c=[],d=0;d<e;d++)c.push(b[d]," ");0<=e&&c.push(b[e]),this._text.drawWords=c}var f,g=this._text.words;if(g&&g.length===c.length)return g;null===g&&(this._text.words=g=[]),g.length=c.length;var h=this.style,i=h.font;for(d=0,e=c.length;d<e;d++){f=r.measureText(c[d],i);var j=g[d]=new l(c[d],f.width,f.height||h.fontSize,h);if(1<j.char.length&&(j.charNum=j.char),this.href){var k=new m;this.addChild(k),j.setSprite(k)}}return g},a._getWords=function(){if(!J.CharacterCache)return this._getWords2();var a=this._text.text;if(!a||0===a.length)return null;var b,c=this._text.words;if(c&&c.length===a.length)return c;null===c&&(this._text.words=c=[]),c.length=a.length;for(var d=this.style,e=d.font,f=0,g=a.length;f<g;f++)if(b=r.measureText(a.charAt(f),e)){var h=c[f]=new l(a.charAt(f),b.width,b.height||d.fontSize,d);if(this.href){var i=new m;this.addChild(i),h.setSprite(i)}}else console.warn("_getWords size is null"+a.charAt(f),e);return c},a.showLinkSprite=function(){var a=this._text.words;if(a)for(var b,c,d=[],e=0;e<a.length;e++)c=a[e],(b=new m).graphics.drawRect(0,0,c.width,c.height,"#ff0000"),b.width=c.width,b.height=c.height,this.addChild(b),d.push(b)},a._layoutLater=function(){var a=this.style;512&a._type||(a.widthed(this)&&(0<this._childs.length||null!=this._getWords())&&a.block?(t.later(this),a._type|=512):this.parent&&this.parent._layoutLater())},a._setAttributes=function(a,b){switch(a){case"style":return void this.style.cssText(b);case"class":return void(this.className=b)}c.prototype._setAttributes.call(this,a,b)},a.updateHref=function(){if(null!=this._href){var a=this._getWords();if(a)for(var b,c,d=0;d<a.length;d++)(c=(b=a[d]).getSprite())&&(c.size(b.width,b.height),c.on("click",this,this.onLinkHandler))}},a.onLinkHandler=function(a){switch(a.type){case"click":for(var b=this;b;)b.event("link",[this.href]),b=b.parent}},a.formatURL=function(a){return this.URI?q.formatURL(a,this.URI?this.URI.path:null):a},g(0,a,"href",function(){return this._href},function(a){null!=(this._href=a)&&(this._getCSSStyle().underLine=1,this.updateHref())}),g(0,a,"color",null,function(a){this.style.color=a}),g(0,a,"onClick",null,function(a){d._runScript("fn=function(event){"+a+";}"),this.on("click",this,void 0)}),g(0,a,"id",null,function(a){v.document.setElementById(a,this)}),g(0,a,"innerTEXT",function(){return this._text.text},function(a){this.text=a}),g(0,a,"style",function(){return this._style}),g(0,a,"text",function(){return this._text.text},function(a){this._text==b._EMPTYTEXT?this._text={text:a,words:null}:(this._text.text=a,this._text.words&&(this._text.words.length=0)),k.isConchApp&&this.layaoutCallNative(),this._renderType|=2048,this.repaint(),this.updateHref()}),g(0,a,"parent",c.prototype._$get_parent,function(a){if(a instanceof laya.html.dom.HTMLElement){var b=a;this.URI||(this.URI=b.URI),this.style.inherit(b.style)}d.superSet(m,this,"parent",a)}),g(0,a,"className",null,function(a){this.style.attrs(v.document.styleSheets["."+a])}),b.fillWords=function(a,b,c,d,e,f,g){a.graphics.clear();for(var h=0,i=b.length;h<i;h++){var j=b[h];a.graphics.fillText(j.char,j.x+c,j.y+d,e,f,"left",g)}},b._EMPTYTEXT={text:null,words:null},b}(m),c=(function(a){function b(){b.__super.call(this),this.style.lineElement=!0,this.style.block=!0}f(b,"laya.html.dom.HTMLBrElement",u)}(),function(a){function b(){this.contextHeight=NaN,this.contextWidth=NaN,b.__super.call(this),this.style.block=!0,this.style.lineElement=!0,this.style.width=200,this.style.height=200}f(b,"laya.html.dom.HTMLDivElement",a);var c=b.prototype;return c.appendHTML=function(a){s.parse(this,a,this.URI),this.layout()},c._addChildsToLayout=function(b){var a=this._getWords();if(null==a&&0==this._childs.length)return!1;a&&a.forEach(function(a){b.push(a)});for(var c=!0,d=0,e=this._childs.length;d<e;d++){var f=this._childs[d];c?c=!1:b.push(null),f._addToLayout(b)}return!0},c._addToLayout=function(a){this.layout()},c.layout=function(){if(this.style){this.style._type|=512;var a=t.layout(this);if(a){this._$P.mHtmlBounds||this._set$P("mHtmlBounds",new j);var b=this._$P.mHtmlBounds;b.x=b.y=0,b.width=this.contextWidth=a[0],b.height=this.contextHeight=a[1],this.setBounds(b)}}},g(0,c,"height",function(){return this._height?this._height:this.contextHeight},a.prototype._$set_height),g(0,c,"innerHTML",null,function(a){this.destroyChildren(),this.appendHTML(a)}),g(0,c,"width",function(){return this._width?this._width:this.contextWidth},function(a){var b=!1;b=0===a?a!=this._width:a!=this.width,d.superSet(u,this,"width",a),b&&this.layout()}),b}(u)),v=function(a){function b(){this.all=new Array,this.styleSheets=h.styleSheets,b.__super.call(this)}f(b,"laya.html.dom.HTMLDocument",u);var c=b.prototype;return c.getElementById=function(a){return this.all[a]},c.setElementById=function(a,b){this.all[a]=b},e(b,["document",function(){return this.document=new b}]),b}();(function(a){function b(){this._tex=null,this._url=null,this._renderArgs=[],b.__super.call(this),this.style.block=!0}f(b,"laya.html.dom.HTMLImageElement",u);var c=b.prototype;c._addToLayout=function(a){!this._style.absolute&&a.push(this)},c.render=function(a,b,c){!this._tex||!this._tex.loaded||!this._tex.loaded||this._width<1||this._height<1||(n.spriteCount++,this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,a.ctx.drawTexture2(b,c,this.style.translateX,this.style.translateY,this.transform,this.style.alpha,this.style.blendMode,this._renderArgs))},c.layaoutCallNative=function(){var a=0;if(this._childs&&0<(a=this._childs.length))for(var b=0;b<a;b++)this._childs[b].layaoutCallNative&&this._childs[b].layaoutCallNative()},g(0,c,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function(a){this._width!==a&&(this._width=a,this._style.width=a,this.repaint())}),g(0,c,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function(a){this._height!==a&&(this._height=a,this._style.height=a,this.repaint())}),c.destroy=function(){null!=this._tex&&(this._tex.off("loaded",this,this.onloaded),i.clearCache(this,this._url),this._tex=null),u.prototype.destroy.call(this)},c.onloaded=function(){var a=this._style;a.widthed(this)||this._width==this._tex.width||(this.width=this._tex.width,this.parent&&this.parent._layoutLater()),a.heighted(this)||this._height==this._tex.height||(this.height=this._tex.height,this.parent&&this.parent._layoutLater()),k.isConchApp&&(this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,this.graphics.drawTexture(this._tex,0,0,this._renderArgs[3],this._renderArgs[4])),this.repaint(),this.parentRepaint()},g(0,c,"src",null,function(a){if(a=this.formatURL(a),this._url!=a){null!=this._tex&&(i.clearCache(this,this._url),this._tex.off("loaded",this,this.onloaded)),this._url=a,i.keepCache(this,a);var b=this._tex=i.getRes(a);b||(this._tex=b=d.loader.create(a,null,null,p)),b.loaded?this.onloaded():b.once("loaded",this,this.onloaded)}})})(),function(a){function b(){this.type=null,b.__super.call(this),this.visible=!1}f(b,"laya.html.dom.HTMLLinkElement",a);var c=b.prototype;c._onload=function(a){switch(this.type){case"text/css":h.parseCSS(a,this.URI)}},g(0,c,"href",a.prototype._$get_href,function(a){var b=this;a=this.formatURL(a),this.URI=new q(a);var c=new i;c.once("complete",null,function(a){b._onload(a)}),c.load(a,"text")}),b._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g")}(u),function(a){function b(){b.__super.call(this),this.visible=!1}f(b,"laya.html.dom.HTMLStyleElement",a),g(0,b.prototype,"text",a.prototype._$get_text,function(a){h.parseCSS(a,null)})}(u),function(a){function b(){b.__super.call(this),this._getCSSStyle().valign="middle"}f(b,"laya.html.dom.HTMLIframeElement",a),g(0,b.prototype,"href",a.prototype._$get_href,function(c){var d=this;c=this.formatURL(c);var a=new i;a.once("complete",null,function(a){var b=d.URI;d.URI=new q(c),d.innerHTML=a,!b||(d.URI=b)}),a.load(c,"text")})}(c)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(a,b){"use strict";for(var c in Object.defineProperty(b,"__esModule",{value:!0}),Laya){var d=Laya[c];d&&d.__isclass&&(b[c]=d)}}),function(a,b,p){p.un,p.uns;var d=p.static,f=p.class,e=p.getset,c=(p.__newvec,laya.display.Animation),q=(laya.utils.Browser,laya.utils.ClassUtils),g=laya.filters.ColorFilter,h=laya.utils.Ease,i=laya.events.Event,j=(laya.events.EventDispatcher,laya.display.css.Font),k=laya.display.FrameAnimation,l=laya.display.Graphics,m=laya.utils.Handler,n=laya.display.Input,s=laya.net.Loader,o=(laya.display.Node,laya.maths.Point),r=laya.maths.Rectangle,t=laya.renders.Render,u=laya.display.Sprite,v=laya.display.Text,w=laya.resource.Texture,x=laya.utils.Tween,y=laya.utils.Utils,z=laya.utils.WeakObject;p.interface("laya.ui.IItem"),p.interface("laya.ui.ISelect"),p.interface("laya.ui.IRender"),p.interface("laya.ui.IComponent"),p.interface("laya.ui.IBox","IComponent");var A=function(){function a(){this.enable=!1,this.top=NaN,this.bottom=NaN,this.left=NaN,this.right=NaN,this.centerX=NaN,this.centerY=NaN,this.anchorX=NaN,this.anchorY=NaN}return f(a,"laya.ui.LayoutStyle"),d(a,["EMPTY",function(){return this.EMPTY=new a}]),a}(),B=function(){function a(){}return f(a,"laya.ui.Styles"),a.labelColor="#000000",a.buttonStateNum=3,a.scrollBarMinNum=15,a.scrollBarDelayTime=500,d(a,["defaultSizeGrid",function(){return this.defaultSizeGrid=[4,4,4,4,0]},"labelPadding",function(){return this.labelPadding=[2,2,2,2]},"inputLabelPadding",function(){return this.inputLabelPadding=[1,1,1,3]},"buttonLabelColors",function(){return this.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"]},"comboBoxItemColors",function(){return this.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"]}]),a}(),C=function(){function e(){}return f(e,"laya.ui.UIUtils"),e.fillArray=function(a,b,c){var d=a.concat();if(b)for(var e=b.split(","),f=0,g=Math.min(d.length,e.length);f<g;f++){var h=e[f];d[f]="true"==h||"false"!=h&&h,null!=c&&(d[f]=c(h))}return d},e.toColor=function(a){return y.toHexColor(a)},e.gray=function(a,b){void 0===b&&(b=!0),b?e.addFilter(a,e.grayFilter):e.clearFilter(a,g)},e.addFilter=function(a,b){var c=a.filters||[];c.push(b),a.filters=c},e.clearFilter=function(a,b){var c=a.filters;if(null!=c&&0<c.length){for(var d=c.length-1;-1<d;d--){var e=c[d];p.__typeof(e,b)&&c.splice(d,1)}a.filters=c}},e._getReplaceStr=function(a){return e.escapeSequence[a]},e.adptString=function(a){return a.replace(/\\(\w)/g,e._getReplaceStr)},e.getBindFun=function(a){var b=e._funMap.get(a);if(null==b){var c='"'+a+'"',d="(function(data){if(data==null)return;with(data){try{\nreturn "+(c=c.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"'))+"\n}catch(e){}}})";b=p._runScript(d),e._funMap.set(a,b)}return b},d(e,["grayFilter",function(){return this.grayFilter=new g([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])},"escapeSequence",function(){return this.escapeSequence={"\\n":"\n","\\t":"\t"}},"_funMap",function(){return this._funMap=new z}]),e}(),D=function(){function a(){}return f(a,"UIConfig"),a.touchScrollEnable=!0,a.mouseWheelEnable=!0,a.showButtons=!0,a.popupBgColor="#000000",a.popupBgAlpha=.5,a.closeDialogOnSide=!0,a}(),E=function(c){function r(){this.autoCacheCmd=!0,this._width=0,this._height=0,this._source=null,this._sizeGrid=null,this._isChanged=!1,this._offset=null,r.__super.call(this),this._weakKeys=[]}f(r,"laya.ui.AutoBitmap",c);var a=r.prototype;return a.destroy=function(){if(s.clearObject(this,this._weakKey),this._weakKeys){for(var a=0,b=this._weakKeys.length;a<b;++a)s.clearObject(this,this._weakKeys[a]);this._weakKeys=null}c.prototype.destroy.call(this),this._source=null,this._sizeGrid=null,this._offset=null},a._setChanged=function(){this._isChanged||(this._isChanged=!0,p.timer.callLater(this,this.changeSource))},a.changeSource=function(){this._isChanged=!1;var a=this._source;if(a&&a.bitmap){var b=this.width,c=this.height,d=this._sizeGrid,e=a.sourceWidth,f=a.sourceHeight;if(!d||e===b&&f===c)this.cleanByTexture(a,this._offset?this._offset[0]:0,this._offset?this._offset[1]:0,b,c);else{s.clearObject(this,this._weakKey),a.$_GID||(a.$_GID=y.getGID());var g=a.$_GID+"."+b+"."+c+"."+d.join("."),h=s.findObject(g);if(y.isOKCmdList(h))return this._weakKey=g,s.keepObject(this,this._weakKey),void(this.cmds=h);this.clear();var i,j,k=d[0],l=d[1],m=d[2],n=d[3],o=d[4],p=!1;if(b==e&&(n=l=0),c==f&&(k=m=0),b<n+l){var q=b;p=!0,b=n+l,this.save(),this.clipRect(0,0,q,c)}n&&k&&(i=r.getTexture(a,0,0,n,k),j=this._weakKeys[0],i?(j!=i.weakKey&&(s.clearObject(this,j),s.keepObject(this,i.weakKey),this._weakKeys[0]=i.weakKey),this.drawTexture(i,0,0,n,k)):(s.clearObject(this,j),this._weakKeys[0]="")),l&&k&&(i=r.getTexture(a,e-l,0,l,k),j=this._weakKeys[1],i?(j!=i.weakKey&&(s.clearObject(this,j),s.keepObject(this,i.weakKey),this._weakKeys[1]=i.weakKey),this.drawTexture(i,b-l,0,l,k)):(s.clearObject(this,j),this._weakKeys[1]="")),n&&m&&(i=r.getTexture(a,0,f-m,n,m),j=this._weakKeys[2],i?(j!=i.weakKey&&(s.clearObject(this,j),s.keepObject(this,i.weakKey),this._weakKeys[2]=i.weakKey),this.drawTexture(i,0,c-m,n,m)):(s.clearObject(this,j),this._weakKeys[2]="")),l&&m&&(i=r.getTexture(a,e-l,f-m,l,m),j=this._weakKeys[3],i?(j!=i.weakKey&&(s.clearObject(this,j),s.keepObject(this,i.weakKey),this._weakKeys[3]=i.weakKey),this.drawTexture(i,b-l,c-m,l,m)):(s.clearObject(this,j),this._weakKeys[3]="")),k&&(i=r.getTexture(a,n,0,e-n-l,k),j=this._weakKeys[4],i?(j!=i.weakKey&&(s.clearObject(this,j),s.keepObject(this,i.weakKey),this._weakKeys[4]=i.weakKey),this.drawBitmap(o,i,n,0,b-n-l,k)):(s.clearObject(this,j),this._weakKeys[4]="")),m&&(i=r.getTexture(a,n,f-m,e-n-l,m),j=this._weakKeys[5],i?(j!=i.weakKey&&(s.clearObject(this,j),s.keepObject(this,i.weakKey),this._weakKeys[5]=i.weakKey),this.drawBitmap(o,i,n,c-m,b-n-l,m)):(s.clearObject(this,j),this._weakKeys[5]="")),n&&(i=r.getTexture(a,0,k,n,f-k-m),j=this._weakKeys[6],i?(j!=i.weakKey&&(s.clearObject(this,j),s.keepObject(this,i.weakKey),this._weakKeys[6]=i.weakKey),this.drawBitmap(o,i,0,k,n,c-k-m)):(s.clearObject(this,j),this._weakKeys[6]="")),l&&(i=r.getTexture(a,e-l,k,l,f-k-m),j=this._weakKeys[7],i?(j!=i.weakKey&&(s.clearObject(this,j),s.keepObject(this,i.weakKey),this._weakKeys[7]=i.weakKey),this.drawBitmap(o,i,b-l,k,l,c-k-m)):(s.clearObject(this,j),this._weakKeys[7]="")),i=r.getTexture(a,n,k,e-n-l,f-k-m),j=this._weakKeys[8],i?(j!=i.weakKey&&(s.clearObject(this,j),s.keepObject(this,i.weakKey),this._weakKeys[8]=i.weakKey),this.drawBitmap(o,i,n,k,b-n-l,c-k-m)):(s.clearObject(this,j),this._weakKeys[8]=""),p&&this.restore(),this.autoCacheCmd&&!t.isConchApp&&(s.saveObject(g,this.cmds,null),this._weakKey=g,s.keepObject(this,this._weakKey))}this._repaint()}},a.drawBitmap=function(a,b,c,d,e,f){void 0===e&&(e=0),void 0===f&&(f=0),e<.1||f<.1||(!a||b.width==e&&b.height==f?this.drawTexture(b,c,d,e,f):this.fillTexture(b,c,d,e,f))},a.clear=function(a){void 0===a&&(a=!0),c.prototype.clear.call(this,!1)},e(0,a,"sizeGrid",function(){return this._sizeGrid},function(a){this._sizeGrid=a,this._setChanged()}),e(0,a,"width",function(){return this._width?this._width:this._source?this._source.sourceWidth:0},function(a){this._width!=a&&(this._width=a,this._setChanged())}),e(0,a,"height",function(){return this._height?this._height:this._source?this._source.sourceHeight:0},function(a){this._height!=a&&(this._height=a,this._setChanged())}),e(0,a,"source",function(){return this._source},function(a){a?(this._source=a,this._setChanged()):(this._source=null,this.clear())}),r.getTexture=function(a,b,c,d,e){d<=0&&(d=1),e<=0&&(e=1),a.$_GID||(a.$_GID=y.getGID());var f=a.$_GID+"."+b+"."+c+"."+d+"."+e,g=s.findObject(f);if((!g||!g.source)&&(g=w.createFromTexture(a,b,c,d,e))){if(a.alphaTexture){var h=a.width/a.alphaTexture.width;g.alphaTexture=w.createFromTexture(a.alphaTexture,b/h,c/h,d/h,e/h)}s.saveObject(f,g),g.weakKey=f}return g},r}(l),F=(function(a){function b(){b.__super.call(this)}f(b,"laya.ui.UIEvent",i),b.SHOW_TIP="showtip",b.HIDE_TIP="hidetip"}(),function(b){function a(){this._comXml=null,this._dataSource=null,this._toolTip=null,this._tag=null,this._disabled=!1,this._gray=!1,this.layoutEnabled=!0,a.__super.call(this),this._layout=A.EMPTY,this.preinitialize(),this.createChildren(),this.initialize()}f(a,"laya.ui.Component",b);var c=a.prototype;return p.imps(c,{"laya.ui.IComponent":!0}),c.destroy=function(a){void 0===a&&(a=!0),b.prototype.destroy.call(this,a),this._dataSource=this._layout=null,this._tag=null,this._toolTip=null},c.preinitialize=function(){},c.createChildren=function(){},c.initialize=function(){},c.callLater=function(a,b){p.timer.callLater(this,a,b)},c.runCallLater=function(a){p.timer.runCallLater(this,a)},c.commitMeasure=function(){},c.changeSize=function(){this.event("resize")},c.getLayout=function(){return this._layout===A.EMPTY&&(this._layout=new A),this._layout},c._setLayoutEnabled=function(a){this._layout&&this._layout.enable!=a&&(this._layout.enable=a,this.on("added",this,this.onAdded),this.on("removed",this,this.onRemoved),this.parent&&this.onAdded())},c.onRemoved=function(){this.parent.off("resize",this,this.onCompResize)},c.onAdded=function(){this.parent.on("resize",this,this.onCompResize),this.resetLayoutX(),this.resetLayoutY()},c.onCompResize=function(){this._layout&&this._layout.enable&&(this.resetLayoutX(),this.resetLayoutY())},c.resetLayoutX=function(){var a=this._layout;if(isNaN(a.anchorX)||(this.pivotX=a.anchorX*this.width),this.layoutEnabled){var b=this.parent;b&&(isNaN(a.centerX)?isNaN(a.left)?isNaN(a.right)||(this.x=Math.round(b.width-this.displayWidth-a.right+this.pivotX*this.scaleX)):(this.x=Math.round(a.left+this.pivotX*this.scaleX),isNaN(a.right)||(this.width=(b._width-a.left-a.right)/(this.scaleX||.01))):this.x=Math.round(.5*(b.width-this.displayWidth)+a.centerX+this.pivotX*this.scaleX))}},c.resetLayoutY=function(){var a=this._layout;if(isNaN(a.anchorY)||(this.pivotY=a.anchorY*this.height),this.layoutEnabled){var b=this.parent;b&&(isNaN(a.centerY)?isNaN(a.top)?isNaN(a.bottom)||(this.y=Math.round(b.height-this.displayHeight-a.bottom+this.pivotY*this.scaleY)):(this.y=Math.round(a.top+this.pivotY*this.scaleY),isNaN(a.bottom)||(this.height=(b._height-a.top-a.bottom)/(this.scaleY||.01))):this.y=Math.round(.5*(b.height-this.displayHeight)+a.centerY+this.pivotY*this.scaleY))}},c.onMouseOver=function(a){p.stage.event("showtip",this._toolTip)},c.onMouseOut=function(a){p.stage.event("hidetip",this._toolTip)},e(0,c,"displayWidth",function(){return this.width*this.scaleX}),e(0,c,"width",function(){return this._width?this._width:this.measureWidth},function(a){this._width!=a&&(this._width=a,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerX)&&isNaN(this._layout.right)&&isNaN(this._layout.anchorX)||this.resetLayoutX())}),e(0,c,"measureWidth",function(){var a=0;this.commitMeasure();for(var b=this.numChildren-1;-1<b;b--){var c=this.getChildAt(b);c.visible&&(a=Math.max(c.x+c.width*c.scaleX,a))}return a}),e(0,c,"displayHeight",function(){return this.height*this.scaleY}),e(0,c,"height",function(){return this._height?this._height:this.measureHeight},function(a){this._height!=a&&(this._height=a,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerY)&&isNaN(this._layout.bottom)&&isNaN(this._layout.anchorY)||this.resetLayoutY())}),e(0,c,"dataSource",function(){return this._dataSource},function(a){for(var b in this._dataSource=a,this._dataSource)this.hasOwnProperty(b)&&"function"!=typeof this[b]&&(this[b]=this._dataSource[b])}),e(0,c,"scaleY",b.prototype._$get_scaleY,function(a){p.superGet(u,this,"scaleY")!=a&&(p.superSet(u,this,"scaleY",a),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutY())}),e(0,c,"measureHeight",function(){var a=0;this.commitMeasure();for(var b=this.numChildren-1;-1<b;b--){var c=this.getChildAt(b);c.visible&&(a=Math.max(c.y+c.height*c.scaleY,a))}return a}),e(0,c,"scaleX",b.prototype._$get_scaleX,function(a){p.superGet(u,this,"scaleX")!=a&&(p.superSet(u,this,"scaleX",a),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutX())}),e(0,c,"top",function(){return this._layout.top},function(a){a!=this._layout.top&&(this.getLayout().top=a,this._setLayoutEnabled(!0)),this.resetLayoutY()}),e(0,c,"bottom",function(){return this._layout.bottom},function(a){a!=this._layout.bottom&&(this.getLayout().bottom=a,this._setLayoutEnabled(!0)),this.resetLayoutY()}),e(0,c,"left",function(){return this._layout.left},function(a){a!=this._layout.left&&(this.getLayout().left=a,this._setLayoutEnabled(!0)),this.resetLayoutX()}),e(0,c,"right",function(){return this._layout.right},function(a){a!=this._layout.right&&(this.getLayout().right=a,this._setLayoutEnabled(!0)),this.resetLayoutX()}),e(0,c,"centerX",function(){return this._layout.centerX},function(a){a!=this._layout.centerX&&(this.getLayout().centerX=a,this._setLayoutEnabled(!0)),this.resetLayoutX()}),e(0,c,"centerY",function(){return this._layout.centerY},function(a){a!=this._layout.centerY&&(this.getLayout().centerY=a,this._setLayoutEnabled(!0)),this.resetLayoutY()}),e(0,c,"anchorX",function(){return this._layout.anchorX},function(a){a!=this._layout.anchorX&&(this.getLayout().anchorX=a,this._setLayoutEnabled(!0)),this.resetLayoutX()}),e(0,c,"anchorY",function(){return this._layout.anchorY},function(a){a!=this._layout.anchorY&&(this.getLayout().anchorY=a,this._setLayoutEnabled(!0)),this.resetLayoutY()}),e(0,c,"tag",function(){return this._tag},function(a){this._tag=a}),e(0,c,"toolTip",function(){return this._toolTip},function(a){this._toolTip!=a&&(null!=(this._toolTip=a)?(this.on("mouseover",this,this.onMouseOver),this.on("mouseout",this,this.onMouseOut)):(this.off("mouseover",this,this.onMouseOver),this.off("mouseout",this,this.onMouseOut)))}),e(0,c,"comXml",function(){return this._comXml},function(a){this._comXml=a}),e(0,c,"gray",function(){return this._gray},function(a){a!==this._gray&&(this._gray=a,C.gray(this,a))}),e(0,c,"disabled",function(){return this._disabled},function(a){a!==this._disabled&&(this.gray=this._disabled=a,this.mouseEnabled=!a)}),a}(u)),G=function(a){function b(){this.lockLayer=null,this.popupEffect=function(a){a.scale(1,1),x.from(a,{x:p.stage.width/2,y:p.stage.height/2,scaleX:0,scaleY:0},300,h.backOut,m.create(this,this.doOpen,[a]))},this.closeEffect=function(a,b){x.to(a,{x:p.stage.width/2,y:p.stage.height/2,scaleX:0,scaleY:0},300,h.strongOut,m.create(this,this.doClose,[a,b]))},b.__super.call(this),this.maskLayer=new u,this.popupEffectHandler=m.create(this,this.popupEffect,null,!1),this.closeEffectHandler=m.create(this,this.closeEffect,null,!1),this.mouseEnabled=this.maskLayer.mouseEnabled=!0,this.zOrder=1e3,p.stage.addChild(this),p.stage.on("resize",this,this._onResize),D.closeDialogOnSide&&this.maskLayer.on("click",this,this._closeOnSide),this._onResize(null)}f(b,"laya.ui.DialogManager",u);var c=b.prototype;return c._closeOnSide=function(){var a=this.getChildAt(this.numChildren-1);a instanceof laya.ui.Dialog&&a.close("side")},c.setLockView=function(a){this.lockLayer||(this.lockLayer=new H,this.lockLayer.mouseEnabled=!0,this.lockLayer.size(p.stage.width,p.stage.height)),this.lockLayer.removeChildren(),a&&(a.centerX=a.centerY=0,this.lockLayer.addChild(a))},c._onResize=function(a){var b=this.maskLayer.width=p.stage.width,c=this.maskLayer.height=p.stage.height;this.lockLayer&&this.lockLayer.size(b,c),this.maskLayer.graphics.clear(),this.maskLayer.graphics.drawRect(0,0,b,c,D.popupBgColor),this.maskLayer.alpha=D.popupBgAlpha;for(var d=this.numChildren-1;-1<d;d--){var e=this.getChildAt(d);e.popupCenter&&this._centerDialog(e)}},c._centerDialog=function(a){a.x=Math.round((p.stage.width-a.width>>1)+a.pivotX),a.y=Math.round((p.stage.height-a.height>>1)+a.pivotY)},c.open=function(a,b,c){void 0===b&&(b=!1),void 0===c&&(c=!1),b&&this._closeAll(),a.popupCenter&&this._centerDialog(a),this.addChild(a),(a.isModal||this._$P.hasZorder)&&this.timer.callLater(this,this._checkMask),c&&null!=a.popupEffect?a.popupEffect.runWith(a):this.doOpen(a),this.event("open")},c.doOpen=function(a){a.onOpened()},c.lock=function(a){this.lockLayer&&(a?this.addChild(this.lockLayer):this.lockLayer.removeSelf())},c.close=function(a,b,c){void 0===c&&(c=!1),c&&null!=a.closeEffect?a.closeEffect.runWith([a,b]):this.doClose(a,b),this.event("close")},c.doClose=function(a,b){a.removeSelf(),a.isModal&&this._checkMask(),a.closeHandler&&a.closeHandler.runWith(b),a.onClosed(b)},c.closeAll=function(){this._closeAll(),this.event("close")},c._closeAll=function(){for(var a=this.numChildren-1;-1<a;a--){var b=this.getChildAt(a);b&&null!=b.close&&this.doClose(b)}},c.getDialogsByGroup=function(a){for(var b=[],c=this.numChildren-1;-1<c;c--){var d=this.getChildAt(c);d&&d.group===a&&b.push(d)}return b},c.closeByGroup=function(a){for(var b=[],c=this.numChildren-1;-1<c;c--){var d=this.getChildAt(c);d&&d.group===a&&(d.close(),b.push(d))}return b},c._checkMask=function(){this.maskLayer.removeSelf();for(var a=this.numChildren-1;-1<a;a--){var b=this.getChildAt(a);if(b&&b.isModal)return void this.addChildAt(this.maskLayer,a)}},b}(),H=function(a){function b(){b.__super.call(this)}f(b,"laya.ui.Box",a);var c=b.prototype;return p.imps(c,{"laya.ui.IBox":!0}),e(0,c,"dataSource",a.prototype._$get_dataSource,function(a){for(var b in this._dataSource=a){var c=this.getChildByName(b);c?c.dataSource=a[b]:this.hasOwnProperty(b)&&"function"!=typeof this[b]&&(this[b]=a[b])}}),b}(F),I=function(b){function c(a,b){this.toggle=!1,this._bitmap=null,this._text=null,this._strokeColors=null,this._state=0,this._selected=!1,this._skin=null,this._autoSize=!0,this._sources=null,this._clickHandler=null,this._stateChanged=!1,c.__super.call(this),this._labelColors=B.buttonLabelColors,this._stateNum=B.buttonStateNum,void 0===b&&(b=""),this.skin=a,this.label=b}f(c,"laya.ui.Button",b);var a=c.prototype;return p.imps(a,{"laya.ui.ISelect":!0}),a.destroy=function(a){s.clearCache(this,this._skin),s.clearObject(this,this._weakKey),void 0===a&&(a=!0),b.prototype.destroy.call(this,a),this._bitmap&&this._bitmap.destroy(),this._text&&this._text.destroy(a),this._bitmap=null,this._text=null,this._clickHandler=null,this._labelColors=this._sources=this._strokeColors=null},a.createChildren=function(){this.graphics=this._bitmap=new E},a.createText=function(){this._text||(this._text=new v,this._text.overflow=v.HIDDEN,this._text.align="center",this._text.valign="middle",this._text.width=this._width,this._text.height=this._height)},a.initialize=function(){1!==this._mouseEnableState&&(this.mouseEnabled=!0,this._setBit(2,!0)),this._createListener("mouseover",this,this.onMouse,null,!1,!1),this._createListener("mouseout",this,this.onMouse,null,!1,!1),this._createListener("mousedown",this,this.onMouse,null,!1,!1),this._createListener("mouseup",this,this.onMouse,null,!1,!1),this._createListener("click",this,this.onMouse,null,!1,!1)},a.onMouse=function(a){if(!1!==this.toggle||!this._selected)return"click"===a.type?(this.toggle&&(this.selected=!this._selected),void(this._clickHandler&&this._clickHandler.run())):void(!this._selected&&(this.state=c.stateMap[a.type]))},a.changeClips=function(){var a=s.getRes(this._skin);if(a&&this._skin&&""!=this._skin){s.clearObject(this,this._weakKey);var b=a.sourceWidth,c=a.sourceHeight/this._stateNum;a.$_GID||(a.$_GID=y.getGID());var d=a.$_GID+"-"+this._stateNum,e=s.findObject(d);if(y.isOkTextureList(e)||(e=null),e)this._weakKey=d,s.keepObject(this,this._weakKey),this._sources=e;else{if(this._sources=[],1===this._stateNum)this._sources.push(a);else for(var f=0;f<this._stateNum;f++){var g=w.createFromTexture(a,0,c*f,b,c);if(a.alphaTexture){var h=a.width/a.alphaTexture.width;g.alphaTexture=w.createFromTexture(a.alphaTexture,0/h,c*f/h,b/h,c/h)}this._sources.push(g)}s.saveObject(d,this._sources),this._weakKey=d,s.keepObject(this,this._weakKey)}this._autoSize?(this._bitmap.width=this._width||b,this._bitmap.height=this._height||c,this._text&&(this._text.width=this._bitmap.width,this._text.height=this._bitmap.height)):this._text&&(this._text.x=b)}else console.warn("lose skin ",this._skin,this.name,this.__className)},a.changeState=function(){this._stateChanged=!1,this.runCallLater(this.changeClips);var a=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[a]),this.label&&(this._text.color=this._labelColors[a],this._strokeColors&&(this._text.strokeColor=this._strokeColors[a]))},a._setStateChanged=function(){this._stateChanged||(this._stateChanged=!0,this.callLater(this.changeState))},e(0,a,"labelStrokeColor",function(){return this.createText(),this._text.strokeColor},function(a){this.createText(),this._text.strokeColor=a}),e(0,a,"measureHeight",function(){return this.runCallLater(this.changeClips),this._text?Math.max(this._bitmap.height,this._text.height):this._bitmap.height}),e(0,a,"skin",function(){return this._skin},function(a){this._skin!=a&&(s.clearCache(this,this._skin),this._skin=a,s.keepCache(this,this._skin),this.callLater(this.changeClips),this._setStateChanged())}),e(0,a,"state",function(){return this._state},function(a){this._state!=a&&(this._state=a,this._setStateChanged())}),e(0,a,"text",function(){return this.createText(),this._text}),e(0,a,"stateNum",function(){return this._stateNum},function(a){"string"==typeof a&&(a=parseInt(a)),this._stateNum!=a&&(this._stateNum=a<1?1:3<a?3:a,this.callLater(this.changeClips))}),e(0,a,"strokeColors",function(){return this._strokeColors?this._strokeColors.join(","):""},function(a){this._strokeColors=C.fillArray(B.buttonLabelColors,a,String),this._setStateChanged()}),e(0,a,"labelColors",function(){return this._labelColors.join(",")},function(a){this._labelColors=C.fillArray(B.buttonLabelColors,a,String),this._setStateChanged()}),e(0,a,"measureWidth",function(){return this.runCallLater(this.changeClips),this._autoSize?this._bitmap.width:(this.runCallLater(this.changeState),this._bitmap.width+(this._text?this._text.width:0))}),e(0,a,"label",function(){return this._text?this._text.text:null},function(a){(this._text||a)&&(this.createText(),this._text.text!=a&&(a&&!this._text.parent&&this.addChild(this._text),this._text.text=(a+"").replace(/\\n/g,"\n"),this._setStateChanged()))}),e(0,a,"selected",function(){return this._selected},function(a){this._selected!=a&&(this._selected=a,this.state=this._selected?2:0,this.event("change"))}),e(0,a,"labelPadding",function(){return this.createText(),this._text.padding.join(",")},function(a){this.createText(),this._text.padding=C.fillArray(B.labelPadding,a,Number)}),e(0,a,"labelSize",function(){return this.createText(),this._text.fontSize},function(a){this.createText(),this._text.fontSize=a}),e(0,a,"labelStroke",function(){return this.createText(),this._text.stroke},function(a){this.createText(),this._text.stroke=a}),e(0,a,"labelBold",function(){return this.createText(),this._text.bold},function(a){this.createText(),this._text.bold=a}),e(0,a,"labelFont",function(){return this.createText(),this._text.font},function(a){this.createText(),this._text.font=a}),e(0,a,"labelAlign",function(){return this.createText(),this._text.align},function(a){this.createText(),this._text.align=a}),e(0,a,"clickHandler",function(){return this._clickHandler},function(a){this._clickHandler=a}),e(0,a,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(a){this._bitmap.sizeGrid=C.fillArray(B.defaultSizeGrid,a,Number)}),e(0,a,"width",b.prototype._$get_width,function(a){p.superSet(F,this,"width",a),this._autoSize&&(this._bitmap.width=a,this._text&&(this._text.width=a))}),e(0,a,"height",b.prototype._$get_height,function(a){p.superSet(F,this,"height",a),this._autoSize&&(this._bitmap.height=a,this._text&&(this._text.height=a))}),e(0,a,"dataSource",b.prototype._$get_dataSource,function(a){"number"==typeof(this._dataSource=a)||"string"==typeof a?this.label=a+"":p.superSet(F,this,"dataSource",a)}),e(0,a,"iconOffset",function(){return this._bitmap._offset?this._bitmap._offset.join(","):null},function(a){this._bitmap._offset=a?C.fillArray([1,1],a,Number):[]}),d(c,["stateMap",function(){return this.stateMap={mouseup:0,mouseover:1,mousedown:2,mouseout:0}}]),c}(F),J=function(b){function d(a,b,c){this._sources=null,this._bitmap=null,this._skin=null,this._clipX=1,this._clipY=1,this._clipWidth=0,this._clipHeight=0,this._autoPlay=!1,this._interval=50,this._complete=null,this._isPlaying=!1,this._index=0,this._clipChanged=!1,this._group=null,this._toIndex=-1,d.__super.call(this),void 0===b&&(b=1),void 0===c&&(c=1),this._clipX=b,this._clipY=c,this.skin=a}f(d,"laya.ui.Clip",b);var a=d.prototype;return a.destroy=function(a){s.clearCache(this,this._skin),s.clearObject(this,this._weakKey),void 0===a&&(a=!0),b.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,this._sources=null},a.dispose=function(){this.destroy(!0),p.loader.clearRes(this._skin)},a.createChildren=function(){this.graphics=this._bitmap=new E},a._onDisplay=function(a){this._isPlaying?this._displayedInStage?this.play():this.stop():this._autoPlay&&this.play()},a.changeClip=function(){if(this._clipChanged=!1,this._skin){var a=s.getRes(this._skin);a?this.loadComplete(this._skin,a):p.loader.load(this._skin,m.create(this,this.loadComplete,[this._skin]))}},a.loadComplete=function(a,b){if(a===this._skin&&b){s.clearObject(this,this._weakKey);var c=this._clipWidth||Math.ceil(b.sourceWidth/this._clipX),d=this._clipHeight||Math.ceil(b.sourceHeight/this._clipY),e=this._skin+c+d,f=s.findObject(e);if(y.isOkTextureList(f)||(f=null),f)this._weakKey=e,s.keepObject(this,this._weakKey),this._sources=f;else{this._sources=[];for(var g=0;g<this._clipY;g++)for(var h=0;h<this._clipX;h++){var i=w.createFromTexture(b,c*h,d*g,c,d);if(b.alphaTexture){var j=b.width/b.alphaTexture.width;i.alphaTexture=w.createFromTexture(b.alphaTexture,c*h/j,d*g/j,c/j,d/j)}this._sources.push(i)}s.saveObject(e,this._sources),this._weakKey=e,s.keepObject(this,this._weakKey)}this.index=this._index,this.event("loaded"),this.onCompResize()}},a.play=function(a,b){void 0===a&&(a=0),void 0===b&&(b=-1),this._isPlaying=!0,this.index=a,this._toIndex=b,this._index++,p.timer.loop(this.interval,this,this._loop),this.on("display",this,this._onDisplay),this.on("undisplay",this,this._onDisplay)},a._loop=function(){this._style.visible&&this._sources&&(this._index++,-1<this._toIndex&&this._index>=this._toIndex?this.stop():this._index>=this._sources.length&&(this._index=0),this.index=this._index)},a.stop=function(){this._isPlaying=!1,p.timer.clear(this,this._loop),this.event("complete")},a._setClipChanged=function(){this._clipChanged||(this._clipChanged=!0,this.callLater(this.changeClip))},e(0,a,"interval",function(){return this._interval},function(a){this._interval!=a&&(this._interval=a,this._isPlaying&&this.play())}),e(0,a,"skin",function(){return this._skin},function(a){this._skin!=a&&(s.clearCache(this,this._skin),(this._skin=a)?(s.keepCache(this,this._skin),this._setClipChanged()):this._bitmap.source=null)}),e(0,a,"sources",function(){return this._sources},function(a){this._sources=a,this.index=this._index,this.event("loaded")}),e(0,a,"clipX",function(){return this._clipX},function(a){this._clipX=a||1,this._setClipChanged()}),e(0,a,"clipY",function(){return this._clipY},function(a){this._clipY=a||1,this._setClipChanged()}),e(0,a,"total",function(){return this.runCallLater(this.changeClip),this._sources?this._sources.length:0}),e(0,a,"clipWidth",function(){return this._clipWidth},function(a){this._clipWidth=a,this._setClipChanged()}),e(0,a,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(a){this._bitmap.sizeGrid=C.fillArray(B.defaultSizeGrid,a,Number)}),e(0,a,"group",function(){return this._group},function(a){a&&this._skin&&s.setGroup(this._skin,a),this._group=a}),e(0,a,"clipHeight",function(){return this._clipHeight},function(a){this._clipHeight=a,this._setClipChanged()}),e(0,a,"width",b.prototype._$get_width,function(a){p.superSet(F,this,"width",a),this._bitmap.width=a}),e(0,a,"height",b.prototype._$get_height,function(a){p.superSet(F,this,"height",a),this._bitmap.height=a}),e(0,a,"measureWidth",function(){return this.runCallLater(this.changeClip),this._bitmap.width}),e(0,a,"measureHeight",function(){return this.runCallLater(this.changeClip),this._bitmap.height}),e(0,a,"index",function(){return this._index},function(a){this._index=a,this._bitmap&&this._sources&&(this._bitmap.source=this._sources[a]),this.event("change")}),e(0,a,"autoPlay",function(){return this._autoPlay},function(a){this._autoPlay!=a&&((this._autoPlay=a)?this.play():this.stop())}),e(0,a,"isPlaying",function(){return this._isPlaying},function(a){this._isPlaying=a}),e(0,a,"dataSource",b.prototype._$get_dataSource,function(a){"number"==typeof(this._dataSource=a)&&Math.floor(a)==a||"string"==typeof a?this.index=parseInt(a):p.superSet(F,this,"dataSource",a)}),e(0,a,"bitmap",function(){return this._bitmap}),d}(F),K=function(b){function a(){this.changeHandler=null,this._gridSize=11,this._bgColor="#ffffff",this._borderColor="#000000",this._inputColor="#000000",this._inputBgColor="#efefef",this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=[],this._selectedColor="#000000",this._panelChanged=!1,a.__super.call(this)}f(a,"laya.ui.ColorPicker",b);var c=a.prototype;return c.destroy=function(a){void 0===a&&(a=!0),b.prototype.destroy.call(this,a),this._colorPanel&&this._colorPanel.destroy(a),this._colorButton&&this._colorButton.destroy(a),this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=null,this.changeHandler=null},c.createChildren=function(){this.addChild(this._colorButton=new I),this._colorPanel=new H,this._colorPanel.size(230,166),this._colorPanel.addChild(this._colorTiles=new u),this._colorPanel.addChild(this._colorBlock=new u),this._colorPanel.addChild(this._colorInput=new n)},c.initialize=function(){this._colorButton.on("click",this,this.onColorButtonClick),this._colorBlock.pos(5,5),this._colorInput.pos(60,5),this._colorInput.size(60,20),this._colorInput.on("change",this,this.onColorInputChange),this._colorInput.on("keydown",this,this.onColorFieldKeyDown),this._colorTiles.pos(5,30),this._colorTiles.on("mousemove",this,this.onColorTilesMouseMove),this._colorTiles.on("click",this,this.onColorTilesClick),this._colorTiles.size(20*this._gridSize,12*this._gridSize),this._colorPanel.on("mousedown",this,this.onPanelMouseDown),this.bgColor=this._bgColor},c.onPanelMouseDown=function(a){a.stopPropagation()},c.changePanel=function(){this._panelChanged=!1;var a=this._colorPanel.graphics;a.clear(),a.drawRect(0,0,230,166,this._bgColor,this._borderColor),this.drawBlock(this._selectedColor),this._colorInput.borderColor=this._borderColor,this._colorInput.bgColor=this._inputBgColor,this._colorInput.color=this._inputColor,(a=this._colorTiles.graphics).clear();for(var b=[0,3355443,6710886,10066329,13421772,16777215,16711680,65280,255,16776960,65535,16711935],c=0;c<12;c++)for(var d=0;d<20;d++){var e=0;e=0===d?b[c]:1===d?0:51*(((3*c+d/6)%3<<0)+3*(c/6<<0))<<16|d%6*51<<8|(c<<0)%6*51;var f=C.toColor(e);this._colors.push(f);var g=d*this._gridSize,h=c*this._gridSize;a.drawRect(g,h,this._gridSize,this._gridSize,f,"#000000")}},c.onColorButtonClick=function(a){this._colorPanel.parent?this.close():this.open()},c.open=function(){var a=this.localToGlobal(new o),b=a.x+this._colorPanel.width<=p.stage.width?a.x:p.stage.width-this._colorPanel.width,c=a.y+this._colorButton.height;c=c+this._colorPanel.height<=p.stage.height?c:a.y-this._colorPanel.height,this._colorPanel.pos(b,c),this._colorPanel.zOrder=1001,p._currentStage.addChild(this._colorPanel),p.stage.on("mousedown",this,this.removeColorBox)},c.close=function(){p.stage.off("mousedown",this,this.removeColorBox),this._colorPanel.removeSelf()},c.removeColorBox=function(a){this.close()},c.onColorFieldKeyDown=function(a){13==a.keyCode&&(this._colorInput.text?this.selectedColor=this._colorInput.text:this.selectedColor=null,this.close(),a.stopPropagation())},c.onColorInputChange=function(a){this._colorInput.text?this.drawBlock(this._colorInput.text):this.drawBlock("#FFFFFF")},c.onColorTilesClick=function(a){this.selectedColor=this.getColorByMouse(),this.close()},c.onColorTilesMouseMove=function(a){this._colorInput.focus=!1;var b=this.getColorByMouse();this._colorInput.text=b,this.drawBlock(b)},c.getColorByMouse=function(){var a=this._colorTiles.getMousePoint(),b=Math.floor(a.x/this._gridSize),c=Math.floor(a.y/this._gridSize);return this._colors[20*c+b]},c.drawBlock=function(a){var b=this._colorBlock.graphics;b.clear();var c=a||"#ffffff";b.drawRect(0,0,50,20,c,this._borderColor),a||b.drawLine(0,0,50,20,"#ff0000")},c.changeColor=function(){var a=this.graphics;a.clear();var b=this._selectedColor||"#000000";a.drawRect(0,0,this._colorButton.width,this._colorButton.height,b)},c._setPanelChanged=function(){this._panelChanged||(this._panelChanged=!0,this.callLater(this.changePanel))},e(0,c,"inputBgColor",function(){return this._inputBgColor},function(a){this._inputBgColor=a,this._setPanelChanged()}),e(0,c,"selectedColor",function(){return this._selectedColor},function(a){this._selectedColor!=a&&(this._selectedColor=this._colorInput.text=a,this.drawBlock(a),this.changeColor(),this.changeHandler&&this.changeHandler.runWith(this._selectedColor),this.event("change",i.EMPTY.setTo("change",this,this)))}),e(0,c,"skin",function(){return this._colorButton.skin},function(a){this._colorButton.skin=a,this.changeColor()}),e(0,c,"bgColor",function(){return this._bgColor},function(a){this._bgColor=a,this._setPanelChanged()}),e(0,c,"borderColor",function(){return this._borderColor},function(a){this._borderColor=a,this._setPanelChanged()}),e(0,c,"inputColor",function(){return this._inputColor},function(a){this._inputColor=a,this._setPanelChanged()}),a}(F),L=function(b){function c(a,b){this._visibleNum=6,this._button=null,this._list=null,this._isOpen=!1,this._itemSize=12,this._labels=[],this._selectedIndex=-1,this._selectHandler=null,this._itemHeight=NaN,this._listHeight=NaN,this._listChanged=!1,this._itemChanged=!1,this._scrollBarSkin=null,this._isCustomList=!1,this.itemRender=null,c.__super.call(this),this._itemColors=B.comboBoxItemColors,this.skin=a,this.labels=b}f(c,"laya.ui.ComboBox",b);var a=c.prototype;return a.destroy=function(a){void 0===a&&(a=!0),b.prototype.destroy.call(this,a),this._button&&this._button.destroy(a),this._list&&this._list.destroy(a),this._button=null,this._list=null,this._itemColors=null,this._labels=null,this._selectHandler=null},a.createChildren=function(){this.addChild(this._button=new I),this._button.text.align="left",this._button.labelPadding="0,0,0,5",this._button.on("mousedown",this,this.onButtonMouseDown)},a._createList=function(){this._list=new V,this._scrollBarSkin&&(this._list.vScrollBarSkin=this._scrollBarSkin),this._setListEvent(this._list)},a._setListEvent=function(a){this._list.selectEnable=!0,this._list.on("mousedown",this,this.onListDown),this._list.mouseHandler=m.create(this,this.onlistItemMouse,null,!1),this._list.scrollBar&&this._list.scrollBar.on("mousedown",this,this.onScrollBarDown)},a.onListDown=function(a){a.stopPropagation()},a.onScrollBarDown=function(a){a.stopPropagation()},a.onButtonMouseDown=function(a){this.callLater(this.switchTo,[!this._isOpen])},a.changeList=function(){this._listChanged=!1;var a=this.width-2,b=this._itemColors[2];this._itemHeight=this._itemSize+6,this._list.itemRender=this.itemRender||{type:"Box",child:[{type:"Label",props:{name:"label",x:1,padding:"3,3,3,3",width:a,height:this._itemHeight,fontSize:this._itemSize,color:b}}]},this._list.repeatY=this._visibleNum,this._list.refresh()},a.onlistItemMouse=function(a,b){var c=a.type;if("mouseover"===c||"mouseout"===c){if(this._isCustomList)return;var d=this._list.getCell(b);if(!d)return;var e=d.getChildByName("label");e&&("mouseover"===c?(e.bgColor=this._itemColors[0],e.color=this._itemColors[1]):(e.bgColor=null,e.color=this._itemColors[2]))}else"click"===c&&(this.selectedIndex=b,this.isOpen=!1)},a.switchTo=function(a){this.isOpen=a},a.changeOpen=function(){this.isOpen=!this._isOpen},a.changeItem=function(){if(this._itemChanged=!1,this._listHeight=0<this._labels.length?Math.min(this._visibleNum,this._labels.length)*this._itemHeight:this._itemHeight,!this._isCustomList){var a=this._list.graphics;a.clear(),a.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3])}for(var b=this._list.array||[],c=b.length=0,d=this._labels.length;c<d;c++)b.push({label:this._labels[c]});this._list.height=this._listHeight,this._list.array=b},a.changeSelected=function(){this._button.label=this.selectedLabel},a._onStageMouseWheel=function(a){this._list&&!this._list.contains(a.target)&&this.removeList(null)},a.removeList=function(a){p.stage.off("mousedown",this,this.removeList),p.stage.off("mousewheel",this,this._onStageMouseWheel),this.isOpen=!1},e(0,a,"selectedIndex",function(){return this._selectedIndex},function(a){this._selectedIndex!=a&&(this._selectedIndex=a,0<this._labels.length?this.changeSelected():this.callLater(this.changeSelected),this.event("change",[i.EMPTY.setTo("change",this,this)]),this._selectHandler&&this._selectHandler.runWith(this._selectedIndex))}),e(0,a,"measureHeight",function(){return this._button.height}),e(0,a,"skin",function(){return this._button.skin},function(a){this._button.skin!=a&&(this._button.skin=a,this._listChanged=!0)}),e(0,a,"measureWidth",function(){return this._button.width}),e(0,a,"width",b.prototype._$get_width,function(a){p.superSet(F,this,"width",a),this._button.width=this._width,this._itemChanged=!0,this._listChanged=!0}),e(0,a,"selectedLabel",function(){return-1<this._selectedIndex&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:null},function(a){this.selectedIndex=this._labels.indexOf(a)}),e(0,a,"labels",function(){return this._labels.join(",")},function(a){0<this._labels.length&&(this.selectedIndex=-1),a?this._labels=a.split(","):this._labels.length=0,this._itemChanged=!0}),e(0,a,"height",b.prototype._$get_height,function(a){p.superSet(F,this,"height",a),this._button.height=this._height}),e(0,a,"selectHandler",function(){return this._selectHandler},function(a){this._selectHandler=a}),e(0,a,"visibleNum",function(){return this._visibleNum},function(a){this._visibleNum=a,this._listChanged=!0}),e(0,a,"labelBold",function(){return this._button.text.bold},function(a){this._button.text.bold=a}),e(0,a,"itemColors",function(){return String(this._itemColors)},function(a){this._itemColors=C.fillArray(this._itemColors,a,String),this._listChanged=!0}),e(0,a,"itemSize",function(){return this._itemSize},function(a){this._itemSize=a,this._listChanged=!0}),e(0,a,"scrollBar",function(){return this.list.scrollBar}),e(0,a,"isOpen",function(){return this._isOpen},function(a){if(this._isOpen!=a)if(this._isOpen=a,this._button.selected=this._isOpen,this._isOpen){this._list||this._createList(),this._listChanged&&!this._isCustomList&&this.changeList(),this._itemChanged&&this.changeItem();var b=this.localToGlobal(o.TEMP.setTo(0,0)),c=b.y+this._button.height;c=c+this._listHeight<=p.stage.height?c:b.y-this._listHeight,this._list.pos(b.x,c),this._list.zOrder=1001,p._currentStage.addChild(this._list),p.stage.once("mousedown",this,this.removeList),p.stage.on("mousewheel",this,this._onStageMouseWheel),this._list.selectedIndex=this._selectedIndex}else this._list&&this._list.removeSelf()}),e(0,a,"scrollBarSkin",function(){return this._scrollBarSkin},function(a){this._scrollBarSkin=a}),e(0,a,"sizeGrid",function(){return this._button.sizeGrid},function(a){this._button.sizeGrid=a}),e(0,a,"button",function(){return this._button}),e(0,a,"list",function(){return this._list||this._createList(),this._list},function(a){a&&(a.removeSelf(),this._isCustomList=!0,this._list=a,this._setListEvent(a),this._itemHeight=a.getCell(0).height+a.spaceY)}),e(0,a,"dataSource",b.prototype._$get_dataSource,function(a){"number"==typeof(this._dataSource=a)&&Math.floor(a)==a||"string"==typeof a?this.selectedIndex=parseInt(a):a instanceof Array?this.labels=a.join(","):p.superSet(F,this,"dataSource",a)}),e(0,a,"labelColors",function(){return this._button.labelColors},function(a){this._button.labelColors!=a&&(this._button.labelColors=a)}),e(0,a,"labelPadding",function(){return this._button.text.padding.join(",")},function(a){this._button.text.padding=C.fillArray(B.labelPadding,a,Number)}),e(0,a,"labelSize",function(){return this._button.text.fontSize},function(a){this._button.text.fontSize=a}),e(0,a,"labelFont",function(){return this._button.text.font},function(a){this._button.text.font=a}),e(0,a,"stateNum",function(){return this._button.stateNum},function(a){this._button.stateNum=a}),c}(F),M=function(b){function c(a){this.rollRatio=.95,this.changeHandler=null,this.scaleBar=!0,this.autoHide=!1,this.elasticDistance=0,this.elasticBackTime=500,this.upButton=null,this.downButton=null,this.slider=null,this._scrollSize=1,this._skin=null,this._thumbPercent=1,this._target=null,this._lastPoint=null,this._lastOffset=0,this._checkElastic=!1,this._isElastic=!1,this._value=NaN,this._hide=!1,this._clickOnly=!0,this._offsets=null,c.__super.call(this),this._showButtons=D.showButtons,this._touchScrollEnable=D.touchScrollEnable,this._mouseWheelEnable=D.mouseWheelEnable,this.skin=a,this.max=1}f(c,"laya.ui.ScrollBar",b);var a=c.prototype;return a.destroy=function(a){void 0===a&&(a=!0),this.stopScroll(),this.target=null,b.prototype.destroy.call(this,a),this.upButton&&this.upButton.destroy(a),this.downButton&&this.downButton.destroy(a),this.slider&&this.slider.destroy(a),this.upButton=this.downButton=null,this.slider=null,this.changeHandler=null,this._offsets=null},a.createChildren=function(){this.addChild(this.slider=new N),this.addChild(this.upButton=new I),this.addChild(this.downButton=new I)},a.initialize=function(){this.slider.showLabel=!1,this.slider.on("change",this,this.onSliderChange),this.slider.setSlider(0,0,0),this.upButton.on("mousedown",this,this.onButtonMouseDown),this.downButton.on("mousedown",this,this.onButtonMouseDown)},a.onSliderChange=function(){this._value!=this.slider.value&&(this.value=this.slider.value)},a.onButtonMouseDown=function(a){var b=a.currentTarget===this.upButton;this.slide(b),p.timer.once(B.scrollBarDelayTime,this,this.startLoop,[b]),p.stage.once("mouseup",this,this.onStageMouseUp)},a.startLoop=function(a){p.timer.frameLoop(1,this,this.slide,[a])},a.slide=function(a){a?this.value-=this._scrollSize:this.value+=this._scrollSize},a.onStageMouseUp=function(a){p.timer.clear(this,this.startLoop),p.timer.clear(this,this.slide)},a.changeScrollBar=function(){this.upButton.visible=this._showButtons,this.downButton.visible=this._showButtons,this._showButtons&&(this.upButton.skin=this._skin.replace(".png","$up.png"),this.downButton.skin=this._skin.replace(".png","$down.png")),this.slider.isVertical?this.slider.y=this._showButtons?this.upButton.height:0:this.slider.x=this._showButtons?this.upButton.width:0,this.resetPositions(),this.repaint()},a.changeSize=function(){b.prototype.changeSize.call(this),this.repaint(),this.resetPositions(),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this.value)},a.resetPositions=function(){this.slider.isVertical?this.slider.height=this.height-(this._showButtons?this.upButton.height+this.downButton.height:0):this.slider.width=this.width-(this._showButtons?this.upButton.width+this.downButton.width:0),this.resetButtonPosition()},a.resetButtonPosition=function(){this.slider.isVertical?this.downButton.y=this.slider.y+this.slider.height:this.downButton.x=this.slider.x+this.slider.width},a.setScroll=function(a,b,c){this.runCallLater(this.changeSize),this.slider.setSlider(a,b,c),this.slider.bar.visible=0<b,!this._hide&&this.autoHide&&(this.visible=!1)},a.onTargetMouseWheel=function(a){this.value-=a.delta*this._scrollSize,this.target=this._target},a.onTargetMouseDown=function(a){this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new o),this._lastPoint.setTo(p.stage.mouseX,p.stage.mouseY),p.timer.clear(this,this.tweenMove),x.clearTween(this),p.stage.once("mouseup",this,this.onStageMouseUp2),p.stage.once("mouseout",this,this.onStageMouseUp2),p.timer.frameLoop(1,this,this.loop)},a.loop=function(){var a=p.stage.mouseY,b=p.stage.mouseX;if(this._lastOffset=this.isVertical?a-this._lastPoint.y:b-this._lastPoint.x,this._clickOnly){if(!(1<Math.abs(this._lastOffset*(this.isVertical?p.stage._canvasTransform.getScaleY():p.stage._canvasTransform.getScaleX()))))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this._target.mouseEnabled=!1,!this.hide&&this.autoHide&&(this.alpha=1,this.visible=!0),this.event("start")}this._offsets.push(this._lastOffset),this._lastPoint.x=b,this._lastPoint.y=a,0!==this._lastOffset&&(this._checkElastic||(0<this.elasticDistance?this._checkElastic||0==this._lastOffset||(0<this._lastOffset&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max?(this._isElastic=!0,this._checkElastic=!0):this._isElastic=!1):this._checkElastic=!0),this._isElastic?this._value<=this.min?this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance):this._value>=this.max&&(this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance)):this.value-=this._lastOffset)},a.onStageMouseUp2=function(a){if(p.stage.off("mouseup",this,this.onStageMouseUp2),p.stage.off("mouseout",this,this.onStageMouseUp2),p.timer.clear(this,this.loop),!(this._clickOnly&&this._value>=this.min&&this._value<=this.max))if(this._target.mouseEnabled=!0,this._isElastic)this._value<this.min?x.to(this,{value:this.min},this.elasticBackTime,h.sineOut,m.create(this,this.elasticOver)):this._value>this.max&&x.to(this,{value:this.max},this.elasticBackTime,h.sineOut,m.create(this,this.elasticOver));else{if(!this._offsets)return;this._offsets.length<1&&(this._offsets[0]=this.isVertical?p.stage.mouseY-this._lastPoint.y:p.stage.mouseX-this._lastPoint.x);for(var b=0,c=Math.min(this._offsets.length,3),d=0;d<c;d++)b+=this._offsets[this._offsets.length-1-d];if(this._lastOffset=b/c,(b=Math.abs(this._lastOffset))<2)return void this.event("end");60<b&&(this._lastOffset=0<this._lastOffset?60:-60);var e=Math.round(Math.abs(this.elasticDistance*(this._lastOffset/240)));p.timer.frameLoop(1,this,this.tweenMove,[e])}},a.elasticOver=function(){this._isElastic=!1,!this.hide&&this.autoHide&&x.to(this,{alpha:0},500),this.event("end")},a.tweenMove=function(a){this._lastOffset*=this.rollRatio;var b=NaN;if(0<a&&(0<this._lastOffset&&this.value<=this.min?(this._isElastic=!0,b=.5*-(this.min-a-this.value),this._lastOffset>b&&(this._lastOffset=b)):this._lastOffset<0&&this.value>=this.max&&(this._isElastic=!0,b=.5*-(this.max+a-this.value),this._lastOffset<b&&(this._lastOffset=b))),this.value-=this._lastOffset,Math.abs(this._lastOffset)<1){if(p.timer.clear(this,this.tweenMove),this._isElastic)return void(this._value<this.min?x.to(this,{value:this.min},this.elasticBackTime,h.sineOut,m.create(this,this.elasticOver)):this._value>this.max?x.to(this,{value:this.max},this.elasticBackTime,h.sineOut,m.create(this,this.elasticOver)):this.elasticOver());this.event("end"),!this.hide&&this.autoHide&&x.to(this,{alpha:0},500)}},a.stopScroll=function(){this.onStageMouseUp2(null),p.timer.clear(this,this.tweenMove),x.clearTween(this)},e(0,a,"measureHeight",function(){return this.slider.isVertical?100:this.slider.height}),e(0,a,"skin",function(){return this._skin},function(a){this._skin!=a&&(this._skin=a,this.slider.skin=this._skin,this.callLater(this.changeScrollBar))}),e(0,a,"max",function(){return this.slider.max},function(a){this.slider.max=a}),e(0,a,"showButtons",function(){return this._showButtons},function(a){this._showButtons=a,this.callLater(this.changeScrollBar)}),e(0,a,"measureWidth",function(){return this.slider.isVertical?this.slider.width:100}),e(0,a,"min",function(){return this.slider.min},function(a){this.slider.min=a}),e(0,a,"value",function(){return this._value},function(a){a!==this._value&&(this._value=a,this._isElastic||(this.slider._value!=a&&(this.slider._value=a,this.slider.changeValue()),this._value=this.slider._value),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this._value))}),e(0,a,"isVertical",function(){return this.slider.isVertical},function(a){this.slider.isVertical=a}),e(0,a,"sizeGrid",function(){return this.slider.sizeGrid},function(a){this.slider.sizeGrid=a}),e(0,a,"scrollSize",function(){return this._scrollSize},function(a){this._scrollSize=a}),e(0,a,"dataSource",b.prototype._$get_dataSource,function(a){"number"==typeof(this._dataSource=a)||"string"==typeof a?this.value=Number(a):p.superSet(F,this,"dataSource",a)}),e(0,a,"thumbPercent",function(){return this._thumbPercent},function(a){this.runCallLater(this.changeScrollBar),this.runCallLater(this.changeSize),a=1<=a?.99:a,this._thumbPercent=a,this.scaleBar&&(this.slider.isVertical?this.slider.bar.height=Math.max(this.slider.height*a,B.scrollBarMinNum):this.slider.bar.width=Math.max(this.slider.width*a,B.scrollBarMinNum))}),e(0,a,"target",function(){return this._target},function(a){this._target&&(this._target.off("mousewheel",this,this.onTargetMouseWheel),this._target.off("mousedown",this,this.onTargetMouseDown)),(this._target=a)&&(this._mouseWheelEnable&&this._target.on("mousewheel",this,this.onTargetMouseWheel),this._touchScrollEnable&&this._target.on("mousedown",this,this.onTargetMouseDown))}),e(0,a,"hide",function(){return this._hide},function(a){this._hide=a,this.visible=!a}),e(0,a,"touchScrollEnable",function(){return this._touchScrollEnable},function(a){this._touchScrollEnable=a,this.target=this._target}),e(0,a,"mouseWheelEnable",function(){return this._mouseWheelEnable},function(a){this._mouseWheelEnable=a,this.target=this._target}),e(0,a,"tick",function(){return this.slider.tick},function(a){this.slider.tick=a}),c}(F),N=function(b){function c(a){this.changeHandler=null,this.isVertical=!0,this.showLabel=!0,this._allowClickBack=!1,this._max=100,this._min=0,this._tick=1,this._value=0,this._skin=null,this._bg=null,this._progress=null,this._bar=null,this._tx=NaN,this._ty=NaN,this._maxMove=NaN,this._globalSacle=null,c.__super.call(this),this.skin=a}f(c,"laya.ui.Slider",b);var a=c.prototype;return a.destroy=function(a){void 0===a&&(a=!0),b.prototype.destroy.call(this,a),this._bg&&this._bg.destroy(a),this._bar&&this._bar.destroy(a),this._progress&&this._progress.destroy(a),this._bg=null,this._bar=null,this._progress=null,this.changeHandler=null},a.createChildren=function(){this.addChild(this._bg=new O),this.addChild(this._bar=new I)},a.initialize=function(){this._bar.on("mousedown",this,this.onBarMouseDown),this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0",this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid),this.allowClickBack=!0},a.onBarMouseDown=function(a){this._globalSacle||(this._globalSacle=new o),this._globalSacle.setTo(this.globalScaleX||.01,this.globalScaleY||.01),this._maxMove=this.isVertical?this.height-this._bar.height:this.width-this._bar.width,this._tx=p.stage.mouseX,this._ty=p.stage.mouseY,p.stage.on("mousemove",this,this.mouseMove),p.stage.once("mouseup",this,this.mouseUp),p.stage.once("mouseout",this,this.mouseUp),this.showValueText()},a.showValueText=function(){if(this.showLabel){var a=laya.ui.Slider.label;this.addChild(a),a.textField.changeText(this._value+""),this.isVertical?(a.x=this._bar.x+20,a.y=.5*(this._bar.height-a.height)+this._bar.y):(a.y=this._bar.y-20,a.x=.5*(this._bar.width-a.width)+this._bar.x)}},a.hideValueText=function(){laya.ui.Slider.label&&laya.ui.Slider.label.removeSelf()},a.mouseUp=function(a){p.stage.off("mousemove",this,this.mouseMove),p.stage.off("mouseup",this,this.mouseUp),p.stage.off("mouseout",this,this.mouseUp),this.sendChangeEvent("changed"),this.hideValueText()},a.mouseMove=function(a){var b=this._value;this.isVertical?(this._bar.y+=(p.stage.mouseY-this._ty)/this._globalSacle.y,this._bar.y>this._maxMove?this._bar.y=this._maxMove:this._bar.y<0&&(this._bar.y=0),this._value=this._bar.y/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x+=(p.stage.mouseX-this._tx)/this._globalSacle.x,this._bar.x>this._maxMove?this._bar.x=this._maxMove:this._bar.x<0&&(this._bar.x=0),this._value=this._bar.x/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width)),this._tx=p.stage.mouseX,this._ty=p.stage.mouseY;var c=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*c)/c,this._value!=b&&this.sendChangeEvent(),this.showValueText()},a.sendChangeEvent=function(a){void 0===a&&(a="change"),this.event(a),this.changeHandler&&this.changeHandler.runWith(this._value)},a.setBarPoint=function(){this.isVertical?this._bar.x=Math.round(.5*(this._bg.width-this._bar.width)):this._bar.y=Math.round(.5*(this._bg.height-this._bar.height))},a.changeSize=function(){b.prototype.changeSize.call(this),this.isVertical?this._bg.height=this.height:this._bg.width=this.width,this.setBarPoint(),this.changeValue()},a.setSlider=function(a,b,c){this._value=-1,this._min=a,this._max=a<b?b:a,this.value=c<a?a:b<c?b:c},a.changeValue=function(){var a=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*a)/a,this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value;var b=this._max-this._min;0===b&&(b=1),this.isVertical?(this._bar.y=(this._value-this._min)/b*(this.height-this._bar.height),this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x=(this._value-this._min)/b*(this.width-this._bar.width),this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width))},a.onBgMouseDown=function(a){var b=this._bg.getMousePoint();this.isVertical?this.value=b.y/(this.height-this._bar.height)*(this._max-this._min)+this._min:this.value=b.x/(this.width-this._bar.width)*(this._max-this._min)+this._min},e(0,a,"measureHeight",function(){return Math.max(this._bg.height,this._bar.height)}),e(0,a,"skin",function(){return this._skin},function(a){if(this._skin!=a){this._skin=a,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png");var b=this._skin.replace(".png","$progress.png");s.getRes(b)&&(this._progress||(this.addChild(this._progress=new O),this._progress.sizeGrid=this._bar.sizeGrid,this.setChildIndex(this._progress,1)),this._progress.skin=b),this.setBarPoint(),this.callLater(this.changeValue)}}),e(0,a,"allowClickBack",function(){return this._allowClickBack},function(a){this._allowClickBack!=a&&((this._allowClickBack=a)?this._bg.on("mousedown",this,this.onBgMouseDown):this._bg.off("mousedown",this,this.onBgMouseDown))}),e(0,a,"max",function(){return this._max},function(a){this._max!=a&&(this._max=a,this.callLater(this.changeValue))}),e(0,a,"measureWidth",function(){return Math.max(this._bg.width,this._bar.width)}),e(0,a,"tick",function(){return this._tick},function(a){this._tick!=a&&(this._tick=a,this.callLater(this.changeValue))}),e(0,a,"sizeGrid",function(){return this._bg.sizeGrid},function(a){this._bg.sizeGrid=a,this._bar.sizeGrid=a,this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid)}),e(0,a,"min",function(){return this._min},function(a){this._min!=a&&(this._min=a,this.callLater(this.changeValue))}),e(0,a,"value",function(){return this._value},function(a){if(this._value!=a){var b=this._value;this._value=a,this.changeValue(),this._value!=b&&this.sendChangeEvent()}}),e(0,a,"dataSource",b.prototype._$get_dataSource,function(a){"number"==typeof(this._dataSource=a)||"string"==typeof a?this.value=Number(a):p.superSet(F,this,"dataSource",a)}),e(0,a,"bar",function(){return this._bar}),d(c,["label",function(){return this.label=new P}]),c}(F),O=function(b){function c(a){this._bitmap=null,this._skin=null,this._group=null,c.__super.call(this),this.skin=a}f(c,"laya.ui.Image",b);var a=c.prototype;return a.destroy=function(a){void 0===a&&(a=!0),b.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,s.clearCache(this,this._skin)},a.dispose=function(){this.destroy(!0),s.clearCache(this,this._skin)},a.createChildren=function(){this.graphics=this._bitmap=new E},a.setSource=function(a,b){a===this._skin&&b&&(this.source=b,this.onCompResize())},e(0,a,"source",function(){return this._bitmap.source},function(a){this._bitmap&&(this._bitmap.source=a,this.event("loaded"),this.repaint())}),e(0,a,"dataSource",b.prototype._$get_dataSource,function(a){"string"==typeof(this._dataSource=a)?this.skin=a:p.superSet(F,this,"dataSource",a)}),e(0,a,"measureHeight",function(){return this._bitmap.height}),e(0,a,"skin",function(){return this._skin},function(a){if(this._skin!=a)if(s.clearCache(this,this._skin),this._skin=a){s.keepCache(this,this._skin);var b=s.getRes(a);b?(this.source=b,this.onCompResize()):p.loader.load(this._skin,m.create(this,this.setSource,[this._skin]),null,"image",1,!0,this._group)}else this.source=null}),e(0,a,"group",function(){return this._group},function(a){a&&this._skin&&s.setGroup(this._skin,a),this._group=a}),e(0,a,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(a){this._bitmap.sizeGrid=C.fillArray(B.defaultSizeGrid,a,Number)}),e(0,a,"measureWidth",function(){return this._bitmap.width}),e(0,a,"width",b.prototype._$get_width,function(a){p.superSet(F,this,"width",a),this._bitmap.width=0==a?1e-7:a}),e(0,a,"height",b.prototype._$get_height,function(a){p.superSet(F,this,"height",a),this._bitmap.height=0==a?1e-7:a}),c}(F),P=function(b){function c(a){this._tf=null,c.__super.call(this),void 0===a&&(a=""),j.defaultColor=B.labelColor,this.text=a}f(c,"laya.ui.Label",b);var a=c.prototype;return a.destroy=function(a){void 0===a&&(a=!0),b.prototype.destroy.call(this,a),this._tf=null},a.createChildren=function(){this.addChild(this._tf=new v)},a.changeText=function(a){this._tf.changeText(a)},e(0,a,"padding",function(){return this._tf.padding.join(",")},function(a){this._tf.padding=C.fillArray(B.labelPadding,a,Number)}),e(0,a,"bold",function(){return this._tf.bold},function(a){this._tf.bold=a}),e(0,a,"align",function(){return this._tf.align},function(a){this._tf.align=a}),e(0,a,"text",function(){return this._tf.text},function(a){this._tf.text!=a&&(a&&(a=C.adptString(a+"")),this._tf.text=a,this.event("change"),this._width&&this._height||this.onCompResize())}),e(0,a,"italic",function(){return this._tf.italic},function(a){this._tf.italic=a}),e(0,a,"wordWrap",function(){return this._tf.wordWrap},function(a){this._tf.wordWrap=a}),e(0,a,"font",function(){return this._tf.font},function(a){this._tf.font=a}),e(0,a,"dataSource",b.prototype._$get_dataSource,function(a){"number"==typeof(this._dataSource=a)||"string"==typeof a?this.text=a+"":p.superSet(F,this,"dataSource",a)}),e(0,a,"color",function(){return this._tf.color},function(a){this._tf.color=a}),e(0,a,"valign",function(){return this._tf.valign},function(a){this._tf.valign=a}),e(0,a,"leading",function(){return this._tf.leading},function(a){this._tf.leading=a}),e(0,a,"fontSize",function(){return this._tf.fontSize},function(a){this._tf.fontSize=a}),e(0,a,"bgColor",function(){return this._tf.bgColor},function(a){this._tf.bgColor=a}),e(0,a,"borderColor",function(){return this._tf.borderColor},function(a){this._tf.borderColor=a}),e(0,a,"stroke",function(){return this._tf.stroke},function(a){this._tf.stroke=a}),e(0,a,"strokeColor",function(){return this._tf.strokeColor},function(a){this._tf.strokeColor=a}),e(0,a,"textField",function(){return this._tf}),e(0,a,"measureWidth",function(){return this._tf.width}),e(0,a,"measureHeight",function(){return this._tf.height}),e(0,a,"width",function(){return this._width||this._tf.text?p.superGet(F,this,"width"):0},function(a){p.superSet(F,this,"width",a),this._tf.width=a}),e(0,a,"height",function(){return this._height||this._tf.text?p.superGet(F,this,"height"):0},function(a){p.superSet(F,this,"height",a),this._tf.height=a}),e(0,a,"overflow",function(){return this._tf.overflow},function(a){this._tf.overflow=a}),e(0,a,"underline",function(){return this._tf.underline},function(a){this._tf.underline=a}),e(0,a,"underlineColor",function(){return this._tf.underlineColor},function(a){this._tf.underlineColor=a}),c}(F),Q=function(b){function c(a){this.changeHandler=null,this._bg=null,this._bar=null,this._skin=null,this._value=.5,c.__super.call(this),this.skin=a}f(c,"laya.ui.ProgressBar",b);var a=c.prototype;return a.destroy=function(a){void 0===a&&(a=!0),b.prototype.destroy.call(this,a),this._bg&&this._bg.destroy(a),this._bar&&this._bar.destroy(a),this._bg=this._bar=null,this.changeHandler=null},a.createChildren=function(){this.addChild(this._bg=new O),this.addChild(this._bar=new O)},a.changeValue=function(){if(this.sizeGrid){var a=this.sizeGrid.split(","),b=Number(a[3]),c=Number(a[1]),d=(this.width-b-c)*this._value;this._bar.width=b+c+d,this._bar.visible=this._bar.width>b+c}else this._bar.width=this.width*this._value},e(0,a,"measureHeight",function(){return this._bg.height}),e(0,a,"skin",function(){return this._skin},function(a){this._skin!=a&&(this._skin=a,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png"),this.callLater(this.changeValue))}),e(0,a,"measureWidth",function(){return this._bg.width}),e(0,a,"height",b.prototype._$get_height,function(a){p.superSet(F,this,"height",a),this._bg.height=this._height,this._bar.height=this._height}),e(0,a,"bar",function(){return this._bar}),e(0,a,"value",function(){return this._value},function(a){this._value!=a&&(a=1<a?1:a<0?0:a,this._value=a,this.callLater(this.changeValue),this.event("change"),this.changeHandler&&this.changeHandler.runWith(a))}),e(0,a,"bg",function(){return this._bg}),e(0,a,"sizeGrid",function(){return this._bg.sizeGrid},function(a){this._bg.sizeGrid=this._bar.sizeGrid=a}),e(0,a,"width",b.prototype._$get_width,function(a){p.superSet(F,this,"width",a),this._bg.width=this._width,this.callLater(this.changeValue)}),e(0,a,"dataSource",b.prototype._$get_dataSource,function(a){"number"==typeof(this._dataSource=a)||"string"==typeof a?this.value=Number(a):p.superSet(F,this,"dataSource",a)}),c}(F),R=(function(a){function c(){this._tipBox=null,this._tipText=null,this._defaultTipHandler=null,c.__super.call(this),this._tipBox=new F,this._tipBox.addChild(this._tipText=new v),this._tipText.x=this._tipText.y=5,this._tipText.color=c.tipTextColor,this._defaultTipHandler=this._showDefaultTip,p.stage.on("showtip",this,this._onStageShowTip),p.stage.on("hidetip",this,this._onStageHideTip),this.zOrder=1100}f(c,"laya.ui.TipManager",F);var b=c.prototype;b._onStageHideTip=function(a){p.timer.clear(this,this._showTip),this.closeAll(),this.removeSelf()},b._onStageShowTip=function(a){p.timer.once(c.tipDelay,this,this._showTip,[a],!0)},b._showTip=function(a){if("string"==typeof a){var b=String(a);Boolean(b)&&this._defaultTipHandler(b)}else a instanceof laya.utils.Handler?a.run():"function"==typeof a&&a.apply();p.stage.on("mousemove",this,this._onStageMouseMove),p.stage.on("mousedown",this,this._onStageMouseDown),this._onStageMouseMove(null)},b._onStageMouseDown=function(a){this.closeAll()},b._onStageMouseMove=function(a){this._showToStage(this,c.offsetX,c.offsetY)},b._showToStage=function(a,b,c){void 0===b&&(b=0),void 0===c&&(c=0);var d=a.getBounds();a.x=p.stage.mouseX+b,a.y=p.stage.mouseY+c,a.x+d.width>p.stage.width&&(a.x-=d.width+b),a.y+d.height>p.stage.height&&(a.y-=d.height+c)},b.closeAll=function(){p.timer.clear(this,this._showTip),p.stage.off("mousemove",this,this._onStageMouseMove),p.stage.off("mousedown",this,this._onStageMouseDown),this.removeChildren()},b.showDislayTip=function(a){this.addChild(a),this._showToStage(this),p._currentStage.addChild(this)},b._showDefaultTip=function(a){this._tipText.text=a;var b=this._tipBox.graphics;b.clear(),b.drawRect(0,0,this._tipText.width+10,this._tipText.height+10,c.tipBackColor),this.addChild(this._tipBox),this._showToStage(this),p._currentStage.addChild(this)},e(0,b,"defaultTipHandler",function(){return this._defaultTipHandler},function(a){this._defaultTipHandler=a}),c.offsetX=10,c.offsetY=15,c.tipTextColor="#ffffff",c.tipBackColor="#111111",c.tipDelay=200}(),function(a){var n;function o(){this._idMap=null,this._aniList=null,this._watchMap={},o.__super.call(this)}f(o,"laya.ui.View",H);var b=o.prototype;return b.createView=function(a){if(a.animations&&!this._idMap&&(this._idMap={}),o.createComp(a,this,this),a.animations){var b,c,d=[],e=a.animations,f=0,g=e.length;for(f=0;f<g;f++){switch(b=new k,c=e[f],b._setUp(this._idMap,c),(this[c.name]=b)._setControlNode(this),c.action){case 1:b.play(0,!1);break;case 2:b.play(0,!0)}d.push(b)}this._aniList=d}0<this._width&&null==a.props.hitTestPrior&&!this.mouseThrough&&(this.hitTestPrior=!0)},b.onEvent=function(a,b){},b.loadUI=function(a){var b=o.uiMap[a];b&&this.createView(b)},b.destroy=function(a){void 0===a&&(a=!0),this._aniList&&(this._aniList.length=0),this._idMap=null,this._aniList=null,this._watchMap=null,laya.ui.Component.prototype.destroy.call(this,a)},b.changeData=function(a){var b=this._watchMap[a];if(b){console.log("change",a);for(var c=0,d=b.length;c<d;c++){b[c].exe(this)}}},o._regs=function(){for(var a in o.uiClassMap)q.regClass(a,o.uiClassMap[a])},o.createComp=function(a,b,c,d){if(!(b=b||o.getCompInstance(a)))return console.warn("can not create:"+a.type),null;var e=a.child;if(e)for(var f=b instanceof laya.ui.List,g=0,h=e.length;g<h;g++){var i=e[g];if(!b.hasOwnProperty("itemRender")||"render"!=i.props.name&&"render"!==i.props.renderType)if("Graphic"==i.type)q.addGraphicsToSprite(i,b);else if(q.isDrawType(i.type))q.addGraphicToSprite(i,b,!0);else{if(f){var j=[],k=o.createComp(i,null,c,j);j.length&&(k._$bindData=j)}else k=o.createComp(i,null,c,d);"Script"==i.type?"owner"in k?k.owner=b:"target"in k&&(k.target=b):"mask"==i.props.renderType||"mask"==i.props.name?b.mask=k:k instanceof laya.display.Sprite&&b.addChild(k)}else b.itemRender=i}var l=a.props;for(var m in l){var n=l[m];o.eventDic[m]?n&&c&&b.on(m,c,c.onEvent,[n]):o.setCompValue(b,m,n,c,d)}return p.__typeof(b,"laya.ui.IItem")&&b.initItems(),a.compId&&c&&c._idMap&&(c._idMap[a.compId]=b),b},o.setCompValue=function(a,b,c,d,e){if("string"==typeof c&&-1<c.indexOf("${")){if(o._sheet||(o._sheet=q.getClass("laya.data.Table")),!o._sheet)return void console.warn("Can not find class Sheet");if(e)e.push(a,b,c);else if(d){-1==c.indexOf("].")&&(c=c.replace(".","[0]."));var f,g,h=new n(a,b,c);h.exe(d);for(var i=c.replace(/\[.*?\]\./g,".");null!=(f=o._parseWatchData.exec(i));){for(var j=f[1];null!=(g=o._parseKeyWord.exec(j));){var k=g[0],l=d._watchMap[k]||(d._watchMap[k]=[]);l.push(h),o._sheet.I.notifer.on(k,d,d.changeData,[k])}(l=d._watchMap[j]||(d._watchMap[j]=[])).push(h),o._sheet.I.notifer.on(j,d,d.changeData,[j])}}}else if("var"===b&&d)d[c]=a;else if("onClick"==b){var m=p._runScript("(function(){"+c+"})");a.on("click",d,m)}else a[b]="true"===c||"false"!==c&&c},o.getCompInstance=function(a){var b,c=a.props?a.props.runtime:null;return b=c?o.viewClassMap[c]||o.uiClassMap[c]||p.__classmap[c]:o.uiClassMap[a.type],a.props&&a.props.hasOwnProperty("renderType")&&"instance"==a.props.renderType?b.instance:b?new b:null},o.regComponent=function(a,b){o.uiClassMap[a]=b,q.regClass(a,b)},o.regViewRuntime=function(a,b){o.viewClassMap[a]=b},o.uiMap={},o.viewClassMap={},o._sheet=null,d(o,["uiClassMap",function(){return this.uiClassMap={ViewStack:aa,LinkButton:I,TextArea:ja,ColorPicker:K,Box:H,Button:I,CheckBox:S,Clip:J,ComboBox:L,Component:F,HScrollBar:W,HSlider:Y,Image:O,Label:P,List:V,Panel:X,ProgressBar:Q,Radio:$,RadioGroup:ha,ScrollBar:M,Slider:N,Tab:ia,TextInput:ca,View:o,VScrollBar:ba,VSlider:da,Tree:_,HBox:fa,VBox:ga,Sprite:u,Animation:c,Text:v,FontClip:U}},"eventDic",function(){return this.eventDic={mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0,rightmousedown:!0,rightmouseup:!0,rightclick:!0}},"_parseWatchData",function(){return this._parseWatchData=/\${(.*?)}/g},"_parseKeyWord",function(){return this._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g}]),o.__init$=function(){o._regs(),n=function(){function a(a,b,c){this.comp=null,this.prop=null,this.value=null,this.comp=a,this.prop=b,this.value=c}return f(a,""),a.prototype.exe=function(a){var b=C.getBindFun(this.value);this.comp[this.prop]=b.call(this,a)},a}()},o}()),S=function(a){function c(a,b){void 0===b&&(b=""),c.__super.call(this,a,b)}f(c,"laya.ui.CheckBox",a);var b=c.prototype;return b.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!0,this._autoSize=!1},b.initialize=function(){a.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0},e(0,b,"dataSource",a.prototype._$get_dataSource,function(a){"boolean"==typeof(this._dataSource=a)?this.selected=a:"string"==typeof a?this.selected="true"===a:p.superSet(I,this,"dataSource",a)}),c}(I),T=function(a){function b(){this._space=0,this._align="none",this._itemChanged=!1,b.__super.call(this)}f(b,"laya.ui.LayoutBox",H);var c=b.prototype;return c.addChild=function(a){return a.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChild.call(this,a)},c.onResize=function(a){this._setItemChanged()},c.addChildAt=function(a,b){return a.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChildAt.call(this,a,b)},c.removeChild=function(a){return a.off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChild.call(this,a)},c.removeChildAt=function(a){return this.getChildAt(a).off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChildAt.call(this,a)},c.refresh=function(){this._setItemChanged()},c.changeItems=function(){this._itemChanged=!1},c.sortItem=function(a){a&&a.sort(function(a,b){return a.y-b.y})},c._setItemChanged=function(){this._itemChanged||(this._itemChanged=!0,this.callLater(this.changeItems))},e(0,c,"space",function(){return this._space},function(a){this._space=a,this._setItemChanged()}),e(0,c,"align",function(){return this._align},function(a){this._align=a,this._setItemChanged()}),b}(),U=function(b){function c(a,b){this._valueArr=null,this._indexMap=null,this._sheet=null,this._direction="horizontal",this._spaceX=0,this._spaceY=0,this._align="left",this._wordsW=0,this._wordsH=0,c.__super.call(this),a&&(this.skin=a),b&&(this.sheet=b)}f(c,"laya.ui.FontClip",b);var a=c.prototype;return a.createChildren=function(){this._bitmap=new E,this.on("loaded",this,this._onClipLoaded)},a._onClipLoaded=function(){this.callLater(this.changeValue)},a.changeValue=function(){var a;if(this._sources&&(this._valueArr&&(this.graphics.clear(!0),a=this._sources[0]))){var b="horizontal"===this._direction;b?(this._wordsW=this._valueArr.length*(a.sourceWidth+this.spaceX),this._wordsH=a.sourceHeight):(this._wordsW=a.sourceWidth,this._wordsH=(a.sourceHeight+this.spaceY)*this._valueArr.length);var c=0;if(this._width)switch(this._align){case"center":c=.5*(this._width-this._wordsW);break;case"right":c=this._width-this._wordsW;break;default:c=0}for(var d=0,e=this._valueArr.length;d<e;d++){var f=this._indexMap[this._valueArr.charAt(d)];this.sources[f]&&(a=this.sources[f],b?this.graphics.drawTexture(a,c+d*(a.sourceWidth+this.spaceX),0,a.sourceWidth,a.sourceHeight):this.graphics.drawTexture(a,0+c,d*(a.sourceHeight+this.spaceY),a.sourceWidth,a.sourceHeight))}this._width||(this.resetLayoutX(),this.callLater(this.changeSize)),this._height||(this.resetLayoutY(),this.callLater(this.changeSize))}},a.destroy=function(a){void 0===a&&(a=!0),this._valueArr=null,this._indexMap=null,this.graphics.clear(!0),this.removeSelf(),this.off("loaded",this,this._onClipLoaded),b.prototype.destroy.call(this,a)},e(0,a,"sheet",function(){return this._sheet},function(a){a+="";var b=(this._sheet=a).split(" ");this._clipX=String(b[0]).length,this.clipY=b.length,this._indexMap={};for(var c=0;c<this._clipY;c++)for(var d=b[c].split(""),e=0,f=d.length;e<f;e++)this._indexMap[d[e]]=c*this._clipX+e}),e(0,a,"height",b.prototype._$get_height,function(a){p.superSet(J,this,"height",a),this.callLater(this.changeValue)}),e(0,a,"direction",function(){return this._direction},function(a){this._direction=a,this.callLater(this.changeValue)}),e(0,a,"value",function(){return this._valueArr?this._valueArr:""},function(a){a+="",this._valueArr=a,this.callLater(this.changeValue)}),e(0,a,"width",b.prototype._$get_width,function(a){p.superSet(J,this,"width",a),this.callLater(this.changeValue)}),e(0,a,"spaceX",function(){return this._spaceX},function(a){this._spaceX=a,"horizontal"===this._direction&&this.callLater(this.changeValue)}),e(0,a,"spaceY",function(){return this._spaceY},function(a){this._spaceY=a,"horizontal"!==this._direction&&this.callLater(this.changeValue)}),e(0,a,"align",function(){return this._align},function(a){this._align=a,this.callLater(this.changeValue)}),e(0,a,"measureWidth",function(){return this._wordsW}),e(0,a,"measureHeight",function(){return this._wordsH}),c}(J),V=function(a){function b(){this.selectHandler=null,this.renderHandler=null,this.mouseHandler=null,this.selectEnable=!1,this.totalPage=0,this._content=null,this._scrollBar=null,this._itemRender=null,this._repeatX=0,this._repeatY=0,this._repeatX2=0,this._repeatY2=0,this._spaceX=0,this._spaceY=0,this._array=null,this._startIndex=0,this._selectedIndex=-1,this._page=0,this._isVertical=!0,this._cellSize=20,this._cellOffset=0,this._isMoved=!1,this.cacheContent=!1,this._createdLine=0,this._cellChanged=!1,this._cells=[],this._offset=new o,b.__super.call(this)}f(b,"laya.ui.List",a);var c=b.prototype;return p.imps(c,{"laya.ui.IRender":!0,"laya.ui.IItem":!0}),c.destroy=function(a){void 0===a&&(a=!0),this._content&&this._content.destroy(a),this._scrollBar&&this._scrollBar.destroy(a),laya.ui.Component.prototype.destroy.call(this,a),this._content=null,this._scrollBar=null,this._itemRender=null,this._cells=null,this._array=null,this.selectHandler=this.renderHandler=this.mouseHandler=null},c.createChildren=function(){this.addChild(this._content=new H)},c.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=p.superGet(H,this,"cacheAs")),p.superSet(H,this,"cacheAs","none"),this._scrollBar.once("end",this,this.onScrollEnd)},c.onScrollEnd=function(){p.superSet(H,this,"cacheAs",this._$P.cacheAs)},c._removePreScrollBar=function(){var a=this.removeChildByName("scrollBar");a&&a.destroy(!0)},c.changeCells=function(){if(this._cellChanged=!1,this._itemRender){this.scrollBar=this.getChildByName("scrollBar");var a=this._getOneCell(),b=a.width+this._spaceX||1,c=a.height+this._spaceY||1;0<this._width&&(this._repeatX2=this._isVertical?Math.round(this._width/b):Math.ceil(this._width/b)),0<this._height&&(this._repeatY2=this._isVertical?Math.ceil(this._height/c):Math.round(this._height/c));var d=this._width?this._width:b*this.repeatX-this._spaceX,e=this._height?this._height:c*this.repeatY-this._spaceY;this._cellSize=this._isVertical?c:b,this._cellOffset=this._isVertical?c*Math.max(this._repeatY2,this._repeatY)-e-this._spaceY:b*Math.max(this._repeatX2,this._repeatX)-d-this._spaceX,this._isVertical&&this._scrollBar?this._scrollBar.height=e:!this._isVertical&&this._scrollBar&&(this._scrollBar.width=d),this.setContentSize(d,e);var f=this._isVertical?this.repeatX:this.repeatY,g=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0);this._createItems(0,f,g),this._createdLine=g,this._array&&(this.array=this._array,this.runCallLater(this.renderItems))}},c._getOneCell=function(){if(0===this._cells.length){var a=this.createItem();if(this._offset.setTo(a.x,a.y),this.cacheContent)return a;this._cells.push(a)}return this._cells[0]},c._createItems=function(a,b,c){var d=this._content,e=this._getOneCell(),f=e.width+this._spaceX,g=e.height+this._spaceY;if(this.cacheContent){var h=new H;h.cacheAsBitmap=!0,h.pos((this._isVertical?0:a)*f,(this._isVertical?a:0)*g),this._content.addChild(h),this._content.optimizeScrollRect=!0,d=h}else{for(var i=[],j=this._cells.length-1;-1<j;j--){var k=this._cells[j];k.removeSelf(),i.push(k)}this._cells.length=0}for(var l=a;l<c;l++)for(var m=0;m<b;m++)(e=i&&i.length?i.pop():this.createItem()).x=(this._isVertical?m:l)*f-d.x,e.y=(this._isVertical?l:m)*g-d.y,e.name="item"+(l*b+m),d.addChild(e),this.addCell(e)},c.createItem=function(){var a=[];if("function"==typeof this._itemRender)var b=new this._itemRender;else b=R.createComp(this._itemRender,null,null,a);if(0==a.length&&b._watchMap){var c=b._watchMap;for(var d in c)for(var e=c[d],f=0;f<e.length;f++){var g=e[f];a.push(g.comp,g.prop,g.value)}}return a.length&&(b._$bindData=a),b},c.addCell=function(a){a.on("click",this,this.onCellMouse),a.on("rightclick",this,this.onCellMouse),a.on("mouseover",this,this.onCellMouse),a.on("mouseout",this,this.onCellMouse),a.on("mousedown",this,this.onCellMouse),a.on("mouseup",this,this.onCellMouse),this._cells.push(a)},c.initItems=function(){if(!this._itemRender&&null!=this.getChildByName("item0")){this.repeatX=1;for(var a=0,b=a=0;b<1e4;b++){var c=this.getChildByName("item"+b);if(!c)break;this.addCell(c),a++}this.repeatY=a}},c.setContentSize=function(a,b){this._content.width=a,this._content.height=b,(this._scrollBar||0!=this._offset.x||0!=this._offset.y)&&(this._content.scrollRect||(this._content.scrollRect=new r),this._content.scrollRect.setTo(-this._offset.x,-this._offset.y,a,b),this._content.scrollRect=this._content.scrollRect),this.event("resize")},c.onCellMouse=function(a){"mousedown"===a.type&&(this._isMoved=!1);var b=a.currentTarget,c=this._startIndex+this._cells.indexOf(b);c<0||("click"===a.type||"rightclick"===a.type?this.selectEnable&&!this._isMoved?this.selectedIndex=c:this.changeCellState(b,!0,0):"mouseover"!==a.type&&"mouseout"!==a.type||this._selectedIndex===c||this.changeCellState(b,"mouseover"===a.type,0),this.mouseHandler&&this.mouseHandler.runWith([a,c]))},c.changeCellState=function(a,b,c){var d=a.getChildByName("selectBox");d&&(this.selectEnable=!0,d.visible=b,d.index=c)},c.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this.width,this.height),this._scrollBar&&this.callLater(this.onScrollBarChange)},c.onScrollBarChange=function(a){this.runCallLater(this.changeCells);var b=this._scrollBar.value,c=this._isVertical?this.repeatX:this.repeatY,d=this._isVertical?this.repeatY:this.repeatX,e=Math.floor(b/this._cellSize);if(this.cacheContent)g=d+1,this._createdLine-e<g&&(this._createItems(this._createdLine,c,this._createdLine+g),this.renderItems(this._createdLine*c,0),this._createdLine+=g);else{var f=e*c,g=0;if(f>this._startIndex){g=f-this._startIndex;var h=!0,i=this._startIndex+c*(d+1);this._isMoved=!0}else f<this._startIndex&&(g=this._startIndex-f,h=!1,i=this._startIndex-1,this._isMoved=!0);for(var j=0;j<g;j++){if(h){var k=this._cells.shift();this._cells[this._cells.length]=k;var l=i+j}else k=this._cells.pop(),this._cells.unshift(k),l=i-j;var m=Math.floor(l/c)*this._cellSize;this._isVertical?k.y=m:k.x=m,this.renderItem(k,l)}this._startIndex=f,this.changeSelectStatus()}var n=this._content.scrollRect;this._isVertical?(n.y=b-this._offset.y,n.x=-this._offset.x):(n.y=-this._offset.y,n.x=b-this._offset.x),this._content.scrollRect=n},c.posCell=function(a,b){if(this._scrollBar){var c=this._isVertical?this.repeatX:this.repeatY,d=(this._isVertical?this.repeatY:this.repeatX,Math.floor(b/c)*this._cellSize);this._isVertical?a.y=d:a.x=d}},c.changeSelectStatus=function(){for(var a=0,b=this._cells.length;a<b;a++)this.changeCellState(this._cells[a],this._selectedIndex===this._startIndex+a,1)},c.renderItems=function(a,b){void 0===a&&(a=0),void 0===b&&(b=0);for(var c=a,d=b||this._cells.length;c<d;c++)this.renderItem(this._cells[c],this._startIndex+c);this.changeSelectStatus()},c.renderItem=function(a,b){this._array&&0<=b&&b<this._array.length?(a.visible=!0,a._$bindData?(a._dataSource=this._array[b],this._bindData(a,this._array[b])):a.dataSource=this._array[b],this.cacheContent||this.posCell(a,b),this.hasListener("render")&&this.event("render",[a,b]),this.renderHandler&&this.renderHandler.runWith([a,b])):(a.visible=!1,a.dataSource=null)},c._bindData=function(a,b){for(var c=a._$bindData,d=0,e=c.length;d<e;d++){var f=c[d++],g=c[d++],h=c[d],i=C.getBindFun(h);f[g]=i.call(this,b)}},c.refresh=function(){this.array=this._array},c.getItem=function(a){return-1<a&&a<this._array.length?this._array[a]:null},c.changeItem=function(a,b){-1<a&&a<this._array.length&&(this._array[a]=b,a>=this._startIndex&&a<this._startIndex+this._cells.length&&this.renderItem(this.getCell(a),a))},c.setItem=function(a,b){this.changeItem(a,b)},c.addItem=function(a){this._array.push(a),this.array=this._array},c.addItemAt=function(a,b){this._array.splice(b,0,a),this.array=this._array},c.deleteItem=function(a){this._array.splice(a,1),this.array=this._array},c.getCell=function(a){return this.runCallLater(this.changeCells),-1<a&&this._cells?this._cells[(a-this._startIndex)%this._cells.length]:null},c.scrollTo=function(a){if(this._scrollBar){var b=this._isVertical?this.repeatX:this.repeatY;this._scrollBar.value=Math.floor(a/b)*this._cellSize}else this.startIndex=a},c.tweenTo=function(a,b,c){if(void 0===b&&(b=200),this._scrollBar){var d=this._isVertical?this.repeatX:this.repeatY;x.to(this._scrollBar,{value:Math.floor(a/d)*this._cellSize},b,null,c,0,!0)}else this.startIndex=a,c&&c.run()},c._setCellChanged=function(){this._cellChanged||(this._cellChanged=!0,this.callLater(this.changeCells))},c.commitMeasure=function(){this.runCallLater(this.changeCells)},e(0,c,"cacheAs",a.prototype._$get_cacheAs,function(a){p.superSet(H,this,"cacheAs",a),this._scrollBar&&(this._$P.cacheAs=null,"none"!==a?this._scrollBar.on("start",this,this.onScrollStart):this._scrollBar.off("start",this,this.onScrollStart))}),e(0,c,"content",function(){return this._content}),e(0,c,"height",a.prototype._$get_height,function(a){a!=this._height&&(p.superSet(H,this,"height",a),this._setCellChanged())}),e(0,c,"itemRender",function(){return this._itemRender},function(a){if(this._itemRender!=a){this._itemRender=a;for(var b=this._cells.length-1;-1<b;b--)this._cells[b].destroy();this._cells.length=0,this._setCellChanged()}}),e(0,c,"vScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(a){this._removePreScrollBar();var b=new ba;b.name="scrollBar",b.right=0,a&&" "!=a&&(b.skin=a),this.scrollBar=b,this.addChild(b),this._setCellChanged()}),e(0,c,"page",function(){return this._page},function(a){this._page=a,this._array&&(this._page=0<a?a:0,this._page=this._page<this.totalPage?this._page:this.totalPage-1,this.startIndex=this._page*this.repeatX*this.repeatY)}),e(0,c,"hScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(a){this._removePreScrollBar();var b=new W;b.name="scrollBar",b.bottom=0,a&&" "!=a&&(b.skin=a),this.scrollBar=b,this.addChild(b),this._setCellChanged()}),e(0,c,"repeatX",function(){return 0<this._repeatX?this._repeatX:0<this._repeatX2?this._repeatX2:1},function(a){this._repeatX=a,this._setCellChanged()}),e(0,c,"scrollBar",function(){return this._scrollBar},function(a){this._scrollBar!=a&&(this._scrollBar=a)&&(this._isVertical=this._scrollBar.isVertical,this.addChild(this._scrollBar),this._scrollBar.on("change",this,this.onScrollBarChange))}),e(0,c,"width",a.prototype._$get_width,function(a){a!=this._width&&(p.superSet(H,this,"width",a),this._setCellChanged())}),e(0,c,"repeatY",function(){return 0<this._repeatY?this._repeatY:0<this._repeatY2?this._repeatY2:1},function(a){this._repeatY=a,this._setCellChanged()}),e(0,c,"spaceX",function(){return this._spaceX},function(a){this._spaceX=a,this._setCellChanged()}),e(0,c,"spaceY",function(){return this._spaceY},function(a){this._spaceY=a,this._setCellChanged()}),e(0,c,"selectedIndex",function(){return this._selectedIndex},function(a){this._selectedIndex!=a&&(this._selectedIndex=a,this.changeSelectStatus(),this.event("change"),this.selectHandler&&this.selectHandler.runWith(a),this.startIndex=this._startIndex)}),e(0,c,"selectedItem",function(){return-1!=this._selectedIndex?this._array[this._selectedIndex]:null},function(a){this.selectedIndex=this._array.indexOf(a)}),e(0,c,"length",function(){return this._array?this._array.length:0}),e(0,c,"selection",function(){return this.getCell(this._selectedIndex)},function(a){this.selectedIndex=this._startIndex+this._cells.indexOf(a)}),e(0,c,"startIndex",function(){return this._startIndex},function(a){this._startIndex=0<a?a:0,this.callLater(this.renderItems)}),e(0,c,"array",function(){return this._array},function(a){this.runCallLater(this.changeCells),this._array=a||[];var b=this._array.length;if(this.totalPage=Math.ceil(b/(this.repeatX*this.repeatY)),this._selectedIndex=this._selectedIndex<b?this._selectedIndex:b-1,this.startIndex=this._startIndex,this._scrollBar){this._scrollBar.stopScroll();var c=this._isVertical?this.repeatX:this.repeatY,d=this._isVertical?this.repeatY:this.repeatX,e=Math.ceil(b/c);1<(0<this._cellOffset?this.totalPage+1:this.totalPage)?(this._scrollBar.scrollSize=this._cellSize,this._scrollBar.thumbPercent=d/e,this._scrollBar.setScroll(0,(e-d)*this._cellSize+this._cellOffset,this._scrollBar.value)):this._scrollBar.setScroll(0,0,0),this._scrollBar.target=this._content}}),e(0,c,"dataSource",a.prototype._$get_dataSource,function(a){"number"==typeof(this._dataSource=a)&&Math.floor(a)==a||"string"==typeof a?this.selectedIndex=parseInt(a):a instanceof Array?this.array=a:p.superSet(H,this,"dataSource",a)}),e(0,c,"cells",function(){return this.runCallLater(this.changeCells),this._cells}),b}(H),W=function(a){function b(){b.__super.call(this)}return f(b,"laya.ui.HScrollBar",a),b.prototype.initialize=function(){a.prototype.initialize.call(this),this.slider.isVertical=!1},b}(M),X=function(a){function b(){this._content=null,this._vScrollBar=null,this._hScrollBar=null,this._scrollChanged=!1,b.__super.call(this),this.width=this.height=100}f(b,"laya.ui.Panel",a);var c=b.prototype;return c.destroy=function(a){void 0===a&&(a=!0),laya.ui.Component.prototype.destroy.call(this,a),this._content&&this._content.destroy(a),this._vScrollBar&&this._vScrollBar.destroy(a),this._hScrollBar&&this._hScrollBar.destroy(a),this._vScrollBar=null,this._hScrollBar=null,this._content=null},c.destroyChildren=function(){this._content.destroyChildren()},c.createChildren=function(){laya.display.Node.prototype.addChild.call(this,this._content=new H)},c.addChild=function(a){return a.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChild(a)},c.onResize=function(){this._setScrollChanged()},c.addChildAt=function(a,b){return a.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChildAt(a,b)},c.removeChild=function(a){return a.off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChild(a)},c.removeChildAt=function(a){return this.getChildAt(a).off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChildAt(a)},c.removeChildren=function(a,b){return void 0===a&&(a=0),void 0===b&&(b=2147483647),this._content.removeChildren(a,b),this._setScrollChanged(),this},c.getChildAt=function(a){return this._content.getChildAt(a)},c.getChildByName=function(a){return this._content.getChildByName(a)},c.getChildIndex=function(a){return this._content.getChildIndex(a)},c.changeScroll=function(){this._scrollChanged=!1;var a=this.contentWidth||1,b=this.contentHeight||1,c=this._vScrollBar,d=this._hScrollBar,e=c&&b>this._height,f=d&&a>this._width,g=e?this._width-c.width:this._width,h=f?this._height-d.height:this._height;c&&(c.x=this._width-c.width,c.y=0,c.height=this._height-(f?d.height:0),c.scrollSize=Math.max(.033*this._height,1),c.thumbPercent=h/b,c.setScroll(0,b-h,c.value)),d&&(d.x=0,d.y=this._height-d.height,d.width=this._width-(e?c.width:0),d.scrollSize=Math.max(.033*this._width,1),d.thumbPercent=g/a,d.setScroll(0,a-g,d.value))},c.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this._width,this._height)},c.setContentSize=function(a,b){var c=this._content;c.width=a,c.height=b,c.scrollRect||(c.scrollRect=new r),c.scrollRect.setTo(0,0,a,b),c.scrollRect=c.scrollRect},c.onScrollBarChange=function(a){var b=this._content.scrollRect;if(b){var c=Math.round(a.value);a.isVertical?b.y=c:b.x=c,this._content.scrollRect=b}},c.scrollTo=function(a,b){void 0===a&&(a=0),void 0===b&&(b=0),this.vScrollBar&&(this.vScrollBar.value=b),this.hScrollBar&&(this.hScrollBar.value=a)},c.refresh=function(){this.changeScroll()},c.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=p.superGet(H,this,"cacheAs")),p.superSet(H,this,"cacheAs","none"),this._hScrollBar&&this._hScrollBar.once("end",this,this.onScrollEnd),this._vScrollBar&&this._vScrollBar.once("end",this,this.onScrollEnd)},c.onScrollEnd=function(){p.superSet(H,this,"cacheAs",this._$P.cacheAs)},c._setScrollChanged=function(){this._scrollChanged||(this._scrollChanged=!0,this.callLater(this.changeScroll))},e(0,c,"numChildren",function(){return this._content.numChildren}),e(0,c,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(a){null==this._hScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._hScrollBar=new W),this._hScrollBar.on("change",this,this.onScrollBarChange,[this._hScrollBar]),this._hScrollBar.target=this._content,this._setScrollChanged()),this._hScrollBar.skin=a}),e(0,c,"contentWidth",function(){for(var a=0,b=this._content.numChildren-1;-1<b;b--){var c=this._content.getChildAt(b);a=Math.max(c.x+c.width*c.scaleX,a)}return a}),e(0,c,"contentHeight",function(){for(var a=0,b=this._content.numChildren-1;-1<b;b--){var c=this._content.getChildAt(b);a=Math.max(c.y+c.height*c.scaleY,a)}return a}),e(0,c,"width",a.prototype._$get_width,function(a){p.superSet(H,this,"width",a),this._setScrollChanged()}),e(0,c,"hScrollBar",function(){return this._hScrollBar}),e(0,c,"content",function(){return this._content}),e(0,c,"height",a.prototype._$get_height,function(a){p.superSet(H,this,"height",a),this._setScrollChanged()}),e(0,c,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(a){null==this._vScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._vScrollBar=new ba),this._vScrollBar.on("change",this,this.onScrollBarChange,[this._vScrollBar]),this._vScrollBar.target=this._content,this._setScrollChanged()),this._vScrollBar.skin=a}),e(0,c,"vScrollBar",function(){return this._vScrollBar}),e(0,c,"cacheAs",a.prototype._$get_cacheAs,function(a){p.superSet(H,this,"cacheAs",a),this._$P.cacheAs=null,"none"!==a?(this._hScrollBar&&this._hScrollBar.on("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.on("start",this,this.onScrollStart)):(this._hScrollBar&&this._hScrollBar.off("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.off("start",this,this.onScrollStart))}),b}(H),Y=function(a){function b(a){b.__super.call(this,a),this.isVertical=!1}return f(b,"laya.ui.HSlider",N),b}(),Z=function(a){function c(a,b){this.selectHandler=null,this._items=null,this._selectedIndex=-1,this._skin=null,this._direction="horizontal",this._space=0,this._labels=null,this._labelColors=null,this._labelFont=null,this._labelStrokeColor=null,this._strokeColors=null,this._labelStroke=NaN,this._labelSize=0,this._labelBold=!1,this._labelPadding=null,this._labelAlign=null,this._stateNum=0,this._labelChanged=!1,c.__super.call(this),this.skin=b,this.labels=a}f(c,"laya.ui.UIGroup",a);var b=c.prototype;return p.imps(b,{"laya.ui.IItem":!0}),b.preinitialize=function(){this.mouseEnabled=!0},b.destroy=function(a){void 0===a&&(a=!0),laya.ui.Component.prototype.destroy.call(this,a),this._items&&(this._items.length=0),this._items=null,this.selectHandler=null},b.addItem=function(a,b){void 0===b&&(b=!0);var c=a,d=this._items.length;if(c.name="item"+d,this.addChild(c),this.initItems(),b&&0<d){var e=this._items[d-1];"horizontal"==this._direction?c.x=e.x+e.width+this._space:c.y=e.y+e.height+this._space}else b&&(c.x=0,c.y=0);return d},b.delItem=function(a,b){void 0===b&&(b=!0);var c=this._items.indexOf(a);if(-1!=c){var d=a;this.removeChild(d);for(var e=c+1,f=this._items.length;e<f;e++){var g=this._items[e];g.name="item"+(e-1),b&&("horizontal"==this._direction?g.x-=d.width+this._space:g.y-=d.height+this._space)}if(this.initItems(),-1<this._selectedIndex){var h;h=this._selectedIndex<this._items.length?this._selectedIndex:this._selectedIndex-1,this._selectedIndex=-1,this.selectedIndex=h}}},b.initItems=function(){this._items||(this._items=[]);for(var a=this._items.length=0;a<1e4;a++){var b=this.getChildByName("item"+a);if(null==b)break;this._items.push(b),b.selected=a===this._selectedIndex,b.clickHandler=m.create(this,this.itemClick,[a],!1)}},b.itemClick=function(a){this.selectedIndex=a},b.setSelect=function(a,b){this._items&&-1<a&&a<this._items.length&&(this._items[a].selected=b)},b.createItem=function(a,b){return null},b.changeLabels=function(){if(this._labelChanged=!1,this._items)for(var a=0,b=0,c=this._items.length;b<c;b++){var d=this._items[b];this._skin&&(d.skin=this._skin),this._labelColors&&(d.labelColors=this._labelColors),this._labelSize&&(d.labelSize=this._labelSize),this._labelStroke&&(d.labelStroke=this._labelStroke),this._labelStrokeColor&&(d.labelStrokeColor=this._labelStrokeColor),this._strokeColors&&(d.strokeColors=this._strokeColors),this._labelBold&&(d.labelBold=this._labelBold),this._labelPadding&&(d.labelPadding=this._labelPadding),this._labelAlign&&(d.labelAlign=this._labelAlign),this._stateNum&&(d.stateNum=this._stateNum),this._labelFont&&(d.labelFont=this._labelFont),"horizontal"===this._direction?(d.y=0,d.x=a,a+=d.width+this._space):(d.x=0,d.y=a,a+=d.height+this._space)}this.changeSize()},b.commitMeasure=function(){this.runCallLater(this.changeLabels)},b._setLabelChanged=function(){this._labelChanged||(this._labelChanged=!0,this.callLater(this.changeLabels))},e(0,b,"labelStrokeColor",function(){return this._labelStrokeColor},function(a){this._labelStrokeColor!=a&&(this._labelStrokeColor=a,this._setLabelChanged())}),e(0,b,"skin",function(){return this._skin},function(a){this._skin!=a&&(this._skin=a,this._setLabelChanged())}),e(0,b,"selectedIndex",function(){return this._selectedIndex},function(a){this._selectedIndex!=a&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=a,this.setSelect(a,!0),this.event("change"),this.selectHandler&&this.selectHandler.runWith(this._selectedIndex))}),e(0,b,"labels",function(){return this._labels},function(a){if(this._labels!=a){if(this._labels=a,this.removeChildren(),this._setLabelChanged(),this._labels)for(var b=this._labels.split(","),c=0,d=b.length;c<d;c++){var e=this.createItem(this._skin,b[c]);e.name="item"+c,this.addChild(e)}this.initItems()}}),e(0,b,"strokeColors",function(){return this._strokeColors},function(a){this._strokeColors!=a&&(this._strokeColors=a,this._setLabelChanged())}),e(0,b,"labelColors",function(){return this._labelColors},function(a){this._labelColors!=a&&(this._labelColors=a,this._setLabelChanged())}),e(0,b,"labelStroke",function(){return this._labelStroke},function(a){this._labelStroke!=a&&(this._labelStroke=a,this._setLabelChanged())}),e(0,b,"labelSize",function(){return this._labelSize},function(a){this._labelSize!=a&&(this._labelSize=a,this._setLabelChanged())}),e(0,b,"stateNum",function(){return this._stateNum},function(a){this._stateNum!=a&&(this._stateNum=a,this._setLabelChanged())}),e(0,b,"labelBold",function(){return this._labelBold},function(a){this._labelBold!=a&&(this._labelBold=a,this._setLabelChanged())}),e(0,b,"labelFont",function(){return this._labelFont},function(a){this._labelFont!=a&&(this._labelFont=a,this._setLabelChanged())}),e(0,b,"labelPadding",function(){return this._labelPadding},function(a){this._labelPadding!=a&&(this._labelPadding=a,this._setLabelChanged())}),e(0,b,"direction",function(){return this._direction},function(a){this._direction=a,this._setLabelChanged()}),e(0,b,"space",function(){return this._space},function(a){this._space=a,this._setLabelChanged()}),e(0,b,"items",function(){return this._items}),e(0,b,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(a){this.selectedIndex=this._items.indexOf(a)}),e(0,b,"dataSource",a.prototype._$get_dataSource,function(a){"number"==typeof(this._dataSource=a)&&Math.floor(a)==a||"string"==typeof a?this.selectedIndex=parseInt(a):a instanceof Array?this.labels=a.join(","):p.superSet(H,this,"dataSource",a)}),c}(H),$=function(b){function c(a,b){this._value=null,void 0===b&&(b=""),c.__super.call(this,a,b)}f(c,"laya.ui.Radio",b);var a=c.prototype;return a.destroy=function(a){void 0===a&&(a=!0),b.prototype.destroy.call(this,a),this._value=null},a.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!1,this._autoSize=!1},a.initialize=function(){b.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0,this.on("click",this,this.onClick)},a.onClick=function(a){this.selected=!0},e(0,a,"value",function(){return null!=this._value?this._value:this.label},function(a){this._value=a}),c}(I),_=function(a){function b(){this._list=null,this._source=null,this._renderHandler=null,this._spaceLeft=10,this._spaceBottom=0,this._keepStatus=!0,b.__super.call(this),this.width=this.height=200}f(b,"laya.ui.Tree",a);var c=b.prototype;return p.imps(c,{"laya.ui.IRender":!0}),c.destroy=function(a){void 0===a&&(a=!0),laya.ui.Component.prototype.destroy.call(this,a),this._list&&this._list.destroy(a),this._list=null,this._source=null,this._renderHandler=null},c.createChildren=function(){this.addChild(this._list=new V),this._list.renderHandler=m.create(this,this.renderItem,null,!1),this._list.repeatX=1,this._list.on("change",this,this.onListChange)},c.onListChange=function(a){this.event("change")},c.getArray=function(){var a,b=[];for(var c in this._source)a=this._source[c],this.getParentOpenStatus(a)&&(a.x=this._spaceLeft*this.getDepth(a),b.push(a));return b},c.getDepth=function(a,b){return void 0===b&&(b=0),null==a.nodeParent?b:this.getDepth(a.nodeParent,b+1)},c.getParentOpenStatus=function(a){var b=a.nodeParent;return null==b||!!b.isOpen&&(null==b.nodeParent||this.getParentOpenStatus(b))},c.renderItem=function(a,b){var c=a.dataSource;if(c){a.left=c.x;var d=a.getChildByName("arrow");d&&(c.hasChild?(d.visible=!0,d.index=c.isOpen?1:0,d.tag=b,d.off("click",this,this.onArrowClick),d.on("click",this,this.onArrowClick)):d.visible=!1);var e=a.getChildByName("folder");e&&(2==e.clipY?e.index=c.isDirectory?0:1:e.index=c.isDirectory?c.isOpen?1:0:2),this._renderHandler&&this._renderHandler.runWith([a,b])}},c.onArrowClick=function(a){var b=a.currentTarget.tag;this._list.array[b].isOpen=!this._list.array[b].isOpen,this.event("open"),this._list.array=this.getArray()},c.setItemState=function(a,b){this._list.array[a]&&(this._list.array[a].isOpen=b,this._list.array=this.getArray())},c.fresh=function(){this._list.array=this.getArray(),this.repaint()},c.parseXml=function(a,b,c,d){var e,f=a.childNodes,g=f.length;if(!d){e={};var h,i=a.attributes;for(var j in i){var k=(h=i[j]).nodeName,l=h.nodeValue;e[k]="true"==l||"false"!=l&&l}e.nodeParent=c,0<g&&(e.isDirectory=!0),e.hasChild=0<g,b.push(e)}for(var m=0;m<g;m++){var n=f[m];this.parseXml(n,b,e,!1)}},c.parseOpenStatus=function(a,b){for(var c=0,d=b.length;c<d;c++){var e=b[c];if(e.isDirectory)for(var f=0,g=a.length;f<g;f++){var h=a[f];if(h.isDirectory&&this.isSameParent(h,e)&&e.label==h.label){e.isOpen=h.isOpen;break}}}},c.isSameParent=function(a,b){return null==a.nodeParent&&null==b.nodeParent||null!=a.nodeParent&&null!=b.nodeParent&&(a.nodeParent.label==b.nodeParent.label&&this.isSameParent(a.nodeParent,b.nodeParent))},c.filter=function(a){if(Boolean(a)){var b=[];this.getFilterSource(this._source,b,a),this._list.array=b}else this._list.array=this.getArray()},c.getFilterSource=function(a,b,c){var d;for(var e in c=c.toLocaleLowerCase(),a)!(d=a[e]).isDirectory&&-1<String(d.label).toLowerCase().indexOf(c)&&(d.x=0,b.push(d)),d.child&&0<d.child.length&&this.getFilterSource(d.child,b,c)},e(0,c,"spaceBottom",function(){return this._list.spaceY},function(a){this._list.spaceY=a}),e(0,c,"keepStatus",function(){return this._keepStatus},function(a){this._keepStatus=a}),e(0,c,"itemRender",function(){return this._list.itemRender},function(a){this._list.itemRender=a}),e(0,c,"array",function(){return this._list.array},function(a){this._keepStatus&&this._list.array&&a&&this.parseOpenStatus(this._list.array,a),this._source=a,this._list.array=this.getArray()}),e(0,c,"mouseHandler",function(){return this._list.mouseHandler},function(a){this._list.mouseHandler=a}),e(0,c,"dataSource",a.prototype._$get_dataSource,function(a){this._dataSource=a,p.superSet(H,this,"dataSource",a)}),e(0,c,"source",function(){return this._source}),e(0,c,"scrollBar",function(){return this._list.scrollBar}),e(0,c,"list",function(){return this._list}),e(0,c,"scrollBarSkin",function(){return this._list.vScrollBarSkin},function(a){this._list.vScrollBarSkin=a}),e(0,c,"renderHandler",function(){return this._renderHandler},function(a){this._renderHandler=a}),e(0,c,"selectedIndex",function(){return this._list.selectedIndex},function(a){this._list.selectedIndex=a}),e(0,c,"spaceLeft",function(){return this._spaceLeft},function(a){this._spaceLeft=a}),e(0,c,"selectedItem",function(){return this._list.selectedItem},function(a){this._list.selectedItem=a}),e(0,c,"width",a.prototype._$get_width,function(a){p.superSet(H,this,"width",a),this._list.width=a}),e(0,c,"height",a.prototype._$get_height,function(a){p.superSet(H,this,"height",a),this._list.height=a}),e(0,c,"xml",null,function(a){var b=[];this.parseXml(a.childNodes[0],b,null,!0),this.array=b}),e(0,c,"selectedPath",function(){return this._list.selectedItem?this._list.selectedItem.path:null}),b}(H),aa=function(a){function b(){this._items=null,this._selectedIndex=0,b.__super.call(this),this._setIndexHandler=m.create(this,this.setIndex,null,!1)}f(b,"laya.ui.ViewStack",a);var c=b.prototype;return p.imps(c,{"laya.ui.IItem":!0}),c.setItems=function(a){this.removeChildren();for(var b=0,c=0,d=a.length;c<d;c++){var e=a[c];e&&(e.name="item"+b,this.addChild(e),b++)}this.initItems()},c.addItem=function(a){a.name="item"+this._items.length,this.addChild(a),this.initItems()},c.initItems=function(){this._items=[];for(var a=0;a<1e4;a++){var b=this.getChildByName("item"+a);if(null==b)break;this._items.push(b),b.visible=a==this._selectedIndex}},c.setSelect=function(a,b){this._items&&-1<a&&a<this._items.length&&(this._items[a].visible=b)},c.setIndex=function(a){this.selectedIndex=a},e(0,c,"dataSource",a.prototype._$get_dataSource,function(a){if("number"==typeof(this._dataSource=a)&&Math.floor(a)==a||"string"==typeof a)this.selectedIndex=parseInt(a);else for(var b in this._dataSource)this.hasOwnProperty(b)&&(this[b]=this._dataSource[b])}),e(0,c,"selectedIndex",function(){return this._selectedIndex},function(a){this._selectedIndex!=a&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=a,this.setSelect(this._selectedIndex,!0))}),e(0,c,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(a){this.selectedIndex=this._items.indexOf(a)}),e(0,c,"items",function(){return this._items}),e(0,c,"setIndexHandler",function(){return this._setIndexHandler},function(a){this._setIndexHandler=a}),b}(H),ba=function(a){function b(){b.__super.call(this)}return f(b,"laya.ui.VScrollBar",M),b}(),ca=function(b){function c(a){this._bg=null,this._skin=null,c.__super.call(this),void 0===a&&(a=""),this.text=a,this.skin=this.skin}f(c,"laya.ui.TextInput",b);var a=c.prototype;return a.preinitialize=function(){this.mouseEnabled=!0},a.destroy=function(a){s.clearCache(this,this._skin),void 0===a&&(a=!0),b.prototype.destroy.call(this,a),this._bg&&this._bg.destroy(),this._bg=null},a.createChildren=function(){this.addChild(this._tf=new n),this._tf.padding=B.inputLabelPadding,this._tf.on("input",this,this._onInput),this._tf.on("enter",this,this._onEnter),this._tf.on("blur",this,this._onBlur),this._tf.on("focus",this,this._onFocus)},a._onFocus=function(){this.event("focus",this)},a._onBlur=function(){this.event("blur",this)},a._onInput=function(){this.event("input",this)},a._onEnter=function(){this.event("enter",this)},a.initialize=function(){this.width=128,this.height=22},a.select=function(){this._tf.select()},a.setSelection=function(a,b){this._tf.setSelection(a,b)},e(0,a,"text",b.prototype._$get_text,function(a){this._tf.text!=a&&(a+="",this._tf.text=a,this.event("change"))}),e(0,a,"bg",function(){return this._bg},function(a){this.graphics=this._bg=a}),e(0,a,"inputElementYAdjuster",function(){return this._tf.inputElementYAdjuster},function(a){this._tf.inputElementYAdjuster=a}),e(0,a,"multiline",function(){return this._tf.multiline},function(a){this._tf.multiline=a}),e(0,a,"skin",function(){return this._skin},function(a){this._skin!=a&&(s.clearCache(this,this._skin),this._skin=a,this._bg||(this.graphics=this._bg=new E),s.keepCache(this,this._skin),this._bg.source=s.getRes(this._skin),this._width&&(this._bg.width=this._width),this._height&&(this._bg.height=this._height))}),e(0,a,"sizeGrid",function(){return this._bg&&this._bg.sizeGrid?this._bg.sizeGrid.join(","):null},function(a){this._bg||(this.graphics=this._bg=new E),this._bg.sizeGrid=C.fillArray(B.defaultSizeGrid,a,Number)}),e(0,a,"inputElementXAdjuster",function(){return this._tf.inputElementXAdjuster},function(a){this._tf.inputElementXAdjuster=a}),e(0,a,"width",b.prototype._$get_width,function(a){p.superSet(P,this,"width",a),this._bg&&(this._bg.width=a)}),e(0,a,"height",b.prototype._$get_height,function(a){p.superSet(P,this,"height",a),this._bg&&(this._bg.height=a)}),e(0,a,"editable",function(){return this._tf.editable},function(a){this._tf.editable=a}),e(0,a,"restrict",function(){return this._tf.restrict},function(a){this._tf.restrict=a}),e(0,a,"prompt",function(){return this._tf.prompt},function(a){this._tf.prompt=a}),e(0,a,"promptColor",function(){return this._tf.promptColor},function(a){this._tf.promptColor=a}),e(0,a,"maxChars",function(){return this._tf.maxChars},function(a){this._tf.maxChars=a}),e(0,a,"focus",function(){return this._tf.focus},function(a){this._tf.focus=a}),e(0,a,"type",function(){return this._tf.type},function(a){this._tf.type=a}),e(0,a,"asPassword",function(){return this._tf.asPassword},function(a){this._tf.asPassword=a}),c}(P),da=function(a){function b(){b.__super.call(this)}return f(b,"laya.ui.VSlider",N),b}(),ea=function(a){function d(){this.popupCenter=!0,this.closeHandler=null,this.popupEffect=null,this.closeEffect=null,this.group=null,this.isModal=!1,this._dragArea=null,d.__super.call(this)}f(d,"laya.ui.Dialog",a);var b=d.prototype;return b.initialize=function(){this.popupEffect=d.manager.popupEffectHandler,this.closeEffect=d.manager.closeEffectHandler,this._dealDragArea(),this.on("click",this,this._onClick)},b._dealDragArea=function(){var a=this.getChildByName("drag");a&&(this.dragArea=a.x+","+a.y+","+a.width+","+a.height,a.removeSelf())},b._onClick=function(a){var b=a.target;if(b)switch(b.name){case"close":case"cancel":case"sure":case"no":case"ok":case"yes":this.close(b.name)}},b.show=function(a,b){void 0===a&&(a=!1),void 0===b&&(b=!0),this._open(!1,a,b)},b.popup=function(a,b){void 0===a&&(a=!1),void 0===b&&(b=!0),this._open(!0,a,b)},b._open=function(a,b,c){d.manager.lock(!1),this.isModal=a,d.manager.open(this,b,c)},b.onOpened=function(){},b.close=function(a,b){void 0===b&&(b=!0),d.manager.close(this,a,b)},b.onClosed=function(a){},b._onMouseDown=function(a){var b=this.getMousePoint();this._dragArea.contains(b.x,b.y)?this.startDrag():this.stopDrag()},e(0,b,"dragArea",function(){return this._dragArea?this._dragArea.toString():null},function(a){if(a){var b=C.fillArray([0,0,0,0],a,Number);this._dragArea=new r(b[0],b[1],b[2],b[3]),this.on("mousedown",this,this._onMouseDown)}else this._dragArea=null,this.off("mousedown",this,this._onMouseDown)}),e(0,b,"isPopup",function(){return null!=this.parent}),e(0,b,"zOrder",a.prototype._$get_zOrder,function(a){p.superSet(R,this,"zOrder",a),d.manager._checkMask()}),e(1,d,"manager",function(){return d._manager=d._manager||new G},function(a){d._manager=a}),d.setLockView=function(a){d.manager.setLockView(a)},d.lock=function(a){d.manager.lock(a)},d.closeAll=function(){d.manager.closeAll()},d.getDialogsByGroup=function(a){return d.manager.getDialogsByGroup(a)},d.closeByGroup=function(a){return d.manager.closeByGroup(a)},d.CLOSE="close",d.CANCEL="cancel",d.SURE="sure",d.NO="no",d.OK="ok",d.YES="yes",d._manager=null,d}(R),fa=function(a){function b(){b.__super.call(this)}f(b,"laya.ui.HBox",a);var c=b.prototype;return c.sortItem=function(a){a&&a.sort(function(a,b){return a.x-b.x})},c.changeItems=function(){this._itemChanged=!1;for(var a=[],b=0,c=0,d=this.numChildren;c<d;c++){var e=this.getChildAt(c);e&&e.layoutEnabled&&(a.push(e),b=this._height?this._height:Math.max(b,e.height*e.scaleY))}this.sortItem(a);var f=0;for(c=0,d=a.length;c<d;c++)(e=a[c]).x=f,f+=e.width*e.scaleX+this._space,"top"==this._align?e.y=0:"middle"==this._align?e.y=.5*(b-e.height*e.scaleY):"bottom"==this._align&&(e.y=b-e.height*e.scaleY);this.changeSize()},e(0,c,"height",a.prototype._$get_height,function(a){this._height!=a&&(p.superSet(T,this,"height",a),this.callLater(this.changeItems))}),b.NONE="none",b.TOP="top",b.MIDDLE="middle",b.BOTTOM="bottom",b}(T),ga=function(a){function b(){b.__super.call(this)}f(b,"laya.ui.VBox",a);var c=b.prototype;return c.changeItems=function(){this._itemChanged=!1;for(var a=[],b=0,c=0,d=this.numChildren;c<d;c++){var e=this.getChildAt(c);e&&e.layoutEnabled&&(a.push(e),b=this._width?this._width:Math.max(b,e.width*e.scaleX))}this.sortItem(a);var f=0;for(c=0,d=a.length;c<d;c++)(e=a[c]).y=f,f+=e.height*e.scaleY+this._space,"left"==this._align?e.x=0:"center"==this._align?e.x=.5*(b-e.width*e.scaleX):"right"==this._align&&(e.x=b-e.width*e.scaleX);this.changeSize()},e(0,c,"width",a.prototype._$get_width,function(a){this._width!=a&&(p.superSet(T,this,"width",a),this.callLater(this.changeItems))}),b.NONE="none",b.LEFT="left",b.CENTER="center",b.RIGHT="right",b}(T),ha=function(a){function b(){b.__super.call(this)}return f(b,"laya.ui.RadioGroup",Z),b.prototype.createItem=function(a,b){return new $(a,b)},b}(),ia=function(a){function b(){b.__super.call(this)}return f(b,"laya.ui.Tab",Z),b.prototype.createItem=function(a,b){return new I(a,b)},b}(),ja=function(b){function c(a){this._vScrollBar=null,this._hScrollBar=null,void 0===a&&(a=""),c.__super.call(this,a)}f(c,"laya.ui.TextArea",b);var a=c.prototype;return a.destroy=function(a){void 0===a&&(a=!0),b.prototype.destroy.call(this,a),this._vScrollBar&&this._vScrollBar.destroy(),this._hScrollBar&&this._hScrollBar.destroy(),this._vScrollBar=null,this._hScrollBar=null},a.initialize=function(){this.width=180,this.height=150,this._tf.wordWrap=!0,this.multiline=!0},a.onVBarChanged=function(a){this._tf.scrollY!=this._vScrollBar.value&&(this._tf.scrollY=this._vScrollBar.value)},a.onHBarChanged=function(a){this._tf.scrollX!=this._hScrollBar.value&&(this._tf.scrollX=this._hScrollBar.value)},a.changeScroll=function(){var a=this._vScrollBar&&0<this._tf.maxScrollY,b=this._hScrollBar&&0<this._tf.maxScrollX,c=a?this._width-this._vScrollBar.width:this._width,d=b?this._height-this._hScrollBar.height:this._height,e=this._tf.padding||B.labelPadding;this._tf.width=c,this._tf.height=d,this._vScrollBar&&(this._vScrollBar.x=this._width-this._vScrollBar.width-e[2],this._vScrollBar.y=e[1],this._vScrollBar.height=this._height-(b?this._hScrollBar.height:0)-e[1]-e[3],this._vScrollBar.scrollSize=1,this._vScrollBar.thumbPercent=d/Math.max(this._tf.textHeight,d),this._vScrollBar.setScroll(1,this._tf.maxScrollY,this._tf.scrollY),this._vScrollBar.visible=a),this._hScrollBar&&(this._hScrollBar.x=e[0],this._hScrollBar.y=this._height-this._hScrollBar.height-e[3],this._hScrollBar.width=this._width-(a?this._vScrollBar.width:0)-e[0]-e[2],this._hScrollBar.scrollSize=Math.max(.033*c,1),this._hScrollBar.thumbPercent=c/Math.max(this._tf.textWidth,c),this._hScrollBar.setScroll(0,this.maxScrollX,this.scrollX),this._hScrollBar.visible=b)},a.scrollTo=function(a){this.commitMeasure(),this._tf.scrollY=a},e(0,a,"scrollY",function(){return this._tf.scrollY}),e(0,a,"width",b.prototype._$get_width,function(a){p.superSet(ca,this,"width",a),this.callLater(this.changeScroll)}),e(0,a,"hScrollBar",function(){return this._hScrollBar}),e(0,a,"height",b.prototype._$get_height,function(a){p.superSet(ca,this,"height",a),this.callLater(this.changeScroll)}),e(0,a,"maxScrollX",function(){return this._tf.maxScrollX}),e(0,a,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(a){null==this._vScrollBar&&(this.addChild(this._vScrollBar=new ba),this._vScrollBar.on("change",this,this.onVBarChanged),this._vScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._vScrollBar.skin=a}),e(0,a,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(a){null==this._hScrollBar&&(this.addChild(this._hScrollBar=new W),this._hScrollBar.on("change",this,this.onHBarChanged),this._hScrollBar.mouseWheelEnable=!1,this._hScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._hScrollBar.skin=a}),e(0,a,"vScrollBar",function(){return this._vScrollBar}),e(0,a,"maxScrollY",function(){return this._tf.maxScrollY}),e(0,a,"scrollX",function(){return this._tf.scrollX}),c}(ca);!function(a){function b(){this._uiView=null,this.isCloseOther=!1,b.__super.call(this)}f(b,"laya.ui.AsynDialog",ea);var c=b.prototype;c.createView=function(a){this._uiView=a},c._open=function(a,b,c){this.isModal=a,this.isCloseOther=b,ea.manager.lock(!0),this._uiView?this.onCreated():this.onOpen()},c.onCreated=function(){this.createUI(),this.onOpen()},c.createUI=function(){laya.ui.View.prototype.createView.call(this,this._uiView),this._uiView=null,this._dealDragArea()},c.onOpen=function(){ea.manager.open(this,this.isCloseOther),ea.manager.lock(!1)},c.close=function(a,b){void 0===b&&(b=!0),ea.manager.close(this),this.onClose()},c.onClose=function(){},c.destroy=function(a){void 0===a&&(a=!0),laya.ui.View.prototype.destroy.call(this,a),this._uiView=null,this.onDestroy()},c.onDestroy=function(){}}();p.__init([R])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(a,b){"use strict";for(var c in Object.defineProperty(b,"__esModule",{value:!0}),Laya){var d=Laya[c];d&&d.__isclass&&(b[c]=d)}}),function(m,a,v){v.un,v.uns;var l=v.static,n=v.class,o=v.getset,d=v.__newvec,u=laya.maths.Arith,g=laya.webgl.atlas.AtlasResourceManager,c=laya.webgl.shader.BaseShader,F=laya.utils.Browser,h=laya.webgl.utils.Buffer,w=laya.utils.Byte,e=laya.utils.ClassUtils,i=v.Config,f=(laya.events.Event,laya.events.EventDispatcher),B=laya.utils.Handler,r=laya.net.Loader,b=laya.net.LoaderManager,j=(laya.maths.MathUtil,laya.display.Node),p=laya.renders.Render,k=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.webgl.utils.RenderState2D),q=laya.resource.Resource,s=laya.utils.RunDriver,t=(laya.webgl.shader.Shader,laya.webgl.utils.ShaderCompile),x=laya.display.Sprite,y=laya.utils.Stat,z=laya.utils.StringKey,C=(laya.display.css.Style,laya.resource.Texture,laya.net.URL),A=laya.utils.Utils,D=laya.webgl.WebGL,E=laya.webgl.WebGLContext;laya.webgl.canvas.WebGLContext2D;v.interface("laya.d3.core.IClone"),v.interface("laya.d3.graphics.IVertex"),v.interface("laya.d3.core.render.IUpdate"),v.interface("laya.d3.core.scene.ITreeNode"),v.interface("laya.d3.core.render.IRenderable");(function(){function I(){}n(I,"laya.d3.animation.AnimationClipParser01"),I.READ_DATA=function(){I._DATA.offset=I._reader.getUint32(),I._DATA.size=I._reader.getUint32()},I.READ_BLOCK=function(){for(var a=I._BLOCK.count=I._reader.getUint16(),b=I._BLOCK.blockStarts=[],c=I._BLOCK.blockLengths=[],d=0;d<a;d++)b.push(I._reader.getUint32()),c.push(I._reader.getUint32())},I.READ_STRINGS=function(){var a=I._reader.getUint32(),b=I._reader.getUint16(),c=I._reader.pos;I._reader.pos=a+I._DATA.offset;for(var d=0;d<b;d++)I._strings[d]=I._reader.readUTFString();I._reader.pos=c},I.parse=function(a,b){I._animationClip=a;(I._reader=b).__getBuffer();I.READ_DATA(),I.READ_BLOCK(),I.READ_STRINGS();for(var c=0,d=I._BLOCK.count;c<d;c++){var e=b.getUint16(),f=I._strings[e],g=I["READ_"+f];if(null==g)throw new Error("model file err,no this function:"+e+" "+f);g.call()}},I.READ_ANIMATIONS=function(){var a,b=0,c=0,d=I._reader,e=d.__getBuffer(),f=[],g=d.getUint8();for(f.length=g,b=0;b<g;b++)f[b]=d.getUint16();var h=[],i=d.getUint16();for(h.length=i,b=0;b<i;b++)h[b]=d.getFloat32();var j=I._animationClip;j.name=I._strings[d.getUint16()];var k=j._duration=d.getFloat32();j.islooping=!!d.getByte(),j._frameRate=d.getInt16();var l=d.getInt16(),m=j._nodes=new Array;m.length=l,(j._publicClipDatas=[]).length=l;var n=j._nodesMap={},o=0,p=0;for(b=0;b<l;b++){a=m[b]=new Q;var q=d.getUint16(),r=a.path=[];for(r.length=q,c=0;c<q;c++)r[c]=I._strings[d.getUint16()];var s=r.join("/"),t=n[s];t||(n[s]=t=[]),t.push(a);var u=d.getInt16();-1!==u&&(a.componentType=I._strings[u]);var v=O._propertyIndexDic[I._strings[d.getUint16()]];if(null==v)throw new Error("AnimationClipParser01:unknown property name.");var w=v<4,x=!w||w&&""===r[0];(a._cacheProperty=x)?o++:p++,a.propertyNameID=v;var y=f[d.getUint8()];a.keyFrameWidth=y/4;var z=a.keyFrames=[],A=z.length=d.getUint16(),B=null,C=NaN;for(c=0;c<A;c++){var D=z[c]=new P;C=D.startTime=h[d.getUint16()];var E=d.pos;D.inTangent=new Float32Array(e.slice(E,E+y)),d.pos+=y,E=d.pos,D.outTangent=new Float32Array(e.slice(E,E+y)),d.pos+=y,E=d.pos,D.data=new Float32Array(e.slice(E,E+y)),d.pos+=y,B&&(B.next=D,B.duration=C-B.startTime),B=D}D.next=null,D.duration=k-C}var F=j._nodeToCachePropertyMap=new Int32Array(l),G=j._cachePropertyMap=new Int32Array(o),H=j._unCachePropertyMap=new Int32Array(p);for(o=p=0,b=0;b<l;b++)(a=m[b])._cacheProperty?(F[b]=o,G[o++]=b):H[p++]=b},I._animationClip=null,I._reader=null,I._strings=[],l(I,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])})(),function(){function M(){}n(M,"laya.d3.animation.AnimationClipParser02"),M.READ_DATA=function(){M._DATA.offset=M._reader.getUint32(),M._DATA.size=M._reader.getUint32()},M.READ_BLOCK=function(){for(var a=M._BLOCK.count=M._reader.getUint16(),b=M._BLOCK.blockStarts=[],c=M._BLOCK.blockLengths=[],d=0;d<a;d++)b.push(M._reader.getUint32()),c.push(M._reader.getUint32())},M.READ_STRINGS=function(){var a=M._reader.getUint32(),b=M._reader.getUint16(),c=M._reader.pos;M._reader.pos=a+M._DATA.offset;for(var d=0;d<b;d++)M._strings[d]=M._reader.readUTFString();M._reader.pos=c},M.parse=function(a,b){M._animationClip=a;(M._reader=b).__getBuffer();M.READ_DATA(),M.READ_BLOCK(),M.READ_STRINGS();for(var c=0,d=M._BLOCK.count;c<d;c++){var e=b.getUint16(),f=M._strings[e],g=M["READ_"+f];if(null==g)throw new Error("model file err,no this function:"+e+" "+f);g.call()}},M.READ_ANIMATIONS=function(){var a,b=0,c=0,d=M._reader,e=d.__getBuffer(),f=[],g=d.getUint8();for(f.length=g,b=0;b<g;b++)f[b]=d.getUint16();var h=[],i=d.getUint16();for(h.length=i,b=0;b<i;b++)h[b]=d.getFloat32();var j=M._animationClip;j.name=M._strings[d.getUint16()];var k=j._duration=d.getFloat32();j.islooping=!!d.getByte(),j._frameRate=d.getInt16();var l=d.getInt16(),m=j._nodes=new Array;m.length=l,(j._publicClipDatas=[]).length=l;var n=j._nodesMap={},o=0,p=0;for(b=0;b<l;b++){a=m[b]=new Q;var q=d.getUint16(),r=a.path=[];for(r.length=q,c=0;c<q;c++)r[c]=M._strings[d.getUint16()];var s=r.join("/"),t=n[s];t||(n[s]=t=[]),t.push(a);var u=d.getInt16();-1!==u&&(a.componentType=M._strings[u]);var v=O._propertyIndexDic[M._strings[d.getUint16()]];if(null==v)throw new Error("AnimationClipParser02:unknown property name.");var w=v<4,x=!w||w&&""===r[0];(a._cacheProperty=x)?o++:p++,a.propertyNameID=v;var y=f[d.getUint8()];a.keyFrameWidth=y/4;var z=a.keyFrames=[],A=z.length=d.getUint16(),B=null,C=NaN;for(c=0;c<A;c++){var D=z[c]=new P;C=D.startTime=h[d.getUint16()];var E=d.pos;D.inTangent=new Float32Array(e.slice(E,E+y)),d.pos+=y,E=d.pos,D.outTangent=new Float32Array(e.slice(E,E+y)),d.pos+=y,E=d.pos,D.data=new Float32Array(e.slice(E,E+y)),d.pos+=y,B&&(B.next=D,B.duration=C-B.startTime),B=D}D.next=null,D.duration=k-C}var F=d.getUint16();for(b=0;b<F;b++){var G,H=new N;H.time=d.getFloat32(),H.eventName=M._strings[d.getUint16()];var I=d.getUint16();for(0<I&&(H.params=G=[]),c=0;c<I;c++){switch(d.getByte()){case 0:G.push(!!d.getByte());break;case 1:G.push(d.getInt32());break;case 2:G.push(d.getFloat32());break;case 3:G.push(M._strings[d.getUint16()]);break;default:throw new Error("unknown type.")}}j.addEvent(H)}var J=j._nodeToCachePropertyMap=new Int32Array(l),K=j._cachePropertyMap=new Int32Array(o),L=j._unCachePropertyMap=new Int32Array(p);for(o=p=0,b=0;b<l;b++)(a=m[b])._cacheProperty?(J[b]=o,K[o++]=b):L[p++]=b},M._animationClip=null,M._reader=null,M._strings=[],l(M,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])}();var N=function(){function a(){this.time=NaN,this.eventName=null,this.params=null}return n(a,"laya.d3.animation.AnimationEvent"),a}(),O=function(){function d(){this._childs=[],this.transform=new sb(this)}n(d,"laya.d3.animation.AnimationNode");var a=d.prototype;return v.imps(a,{"laya.d3.core.IClone":!0}),a.addChild=function(a){a._parent=this,a.transform.setParent(this.transform),this._childs.push(a)},a.removeChild=function(a){var b=this._childs.indexOf(a);-1!==b&&this._childs.splice(b,1)},a.getChildByName=function(a){for(var b=0,c=this._childs.length;b<c;b++){var d=this._childs[b];if(d.name===a)return d}return null},a.getChildByIndex=function(a){return this._childs[a]},a.getChildCount=function(){return this._childs.length},a.cloneTo=function(a){var b=a;b.name=this.name;for(var c=0,d=this._childs.length;c<d;c++){var e=this._childs[c],f=e.clone();b.addChild(f);var g=e.transform,h=f.transform;h.setLocalPosition(g.getLocalPosition()),h.setLocalRotation(g.getLocalRotation()),h.setLocalScale(g.getLocalScale()),h._localRotationEuler=g._localRotationEuler,h._setWorldMatrixIgnoreUpdate(g.getWorldMatrix())}},a.clone=function(){var a=new this.constructor;return this.cloneTo(a),a},d.__init__=function(){d.registerAnimationNodeProperty("localPosition",d._getLocalPosition,d._setLocalPosition),d.registerAnimationNodeProperty("localRotation",d._getLocalRotation,d._setLocalRotation),d.registerAnimationNodeProperty("localScale",d._getLocalScale,d._setLocalScale),d.registerAnimationNodeProperty("localRotationEuler",d._getLocalRotationEuler,d._setLocalRotationEuler),d.registerAnimationNodeProperty("particleRender.sharedMaterial.tintColor",d._getParticleRenderSharedMaterialTintColor,d._setParticleRenderSharedMaterialTintColor),d.registerAnimationNodeProperty("meshRender.sharedMaterial.tilingOffset",d._getMeshRenderSharedMaterialTilingOffset,d._setMeshRenderSharedMaterialTilingOffset),d.registerAnimationNodeProperty("meshRender.sharedMaterial.albedoColor",d._getMeshRenderSharedMaterialAlbedo,d._setMeshRenderSharedMaterialAlbedo),d.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.tilingOffset",d._getSkinnedMeshRenderSharedMaterialTilingOffset,d._setSkinnedMeshRenderSharedMaterialTilingOffset),d.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedoColor",d._getSkinnedMeshRenderSharedMaterialAlbedo,d._setSkinnedMeshRenderSharedMaterialAlbedo),d.registerAnimationNodeProperty("meshRender.sharedMaterial.albedo",d._getMeshRenderSharedMaterialAlbedo,d._setMeshRenderSharedMaterialAlbedo),d.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedo",d._getSkinnedMeshRenderSharedMaterialAlbedo,d._setSkinnedMeshRenderSharedMaterialAlbedo),d.registerAnimationNodeProperty("meshRender.sharedMaterial.intensity",d._getMeshRenderSharedMaterialIntensity,d._setMeshRenderSharedMaterialIntensity),d.registerAnimationNodeProperty("meshRender.sharedMaterial.alpha",d._getMeshRenderSharedMaterialAlpha,d._setMeshRenderSharedMaterialAlpha),d.registerAnimationNodeProperty("meshRender.sharedMaterial.alphaColor",d._getMeshRenderSharedMaterialAlphaColor,d._setMeshRenderSharedMaterialAlphaColor),d.registerAnimationNodeProperty("meshRender.sharedMaterial.baseColor",d._getMeshRenderSharedMaterialBaseColor,d._setMeshRenderSharedMaterialBaseColor),d.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolve",d._getMeshRenderSharedMaterialDissolve,d._setMeshRenderSharedMaterialDissolve),d.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveSpeed",d._getMeshRenderSharedMaterialDissolveSpeed,d._setMeshRenderSharedMaterialDissolveSpeed),d.registerAnimationNodeProperty("meshRender.sharedMaterial.mMultiplier",d._getMeshRenderSharedMaterialMMultiplier,d._setMeshRenderSharedMaterialMMultiplier),d.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedX",d._getMeshRenderSharedMaterialBaseScrollSpeedX,d._setMeshRenderSharedMaterialBaseScrollSpeedX),d.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedY",d._getMeshRenderSharedMaterialBaseScrollSpeedY,d._setMeshRenderSharedMaterialBaseScrollSpeedY),d.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedX",d._getMeshRenderSharedMaterialSecondScrollSpeedX,d._setMeshRenderSharedMaterialSecondScrollSpeedX),d.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedY",d._getMeshRenderSharedMaterialSecondScrollSpeedY,d._setMeshRenderSharedMaterialSecondScrollSpeedY),d.registerAnimationNodeProperty("meshRender.sharedMaterial.detailTilingOffset",d._getMeshRenderSharedMaterialDetailTilingOffset,d._setMeshRenderSharedMaterialDetailTilingOffset),d.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveTilingOffset",d._getMeshRenderSharedMaterialDissolveTilingOffset,d._setMeshRenderSharedMaterialDissolveTilingOffset),d.registerAnimationNodeProperty("meshRender.sharedMaterial.maskTilingOffset",d._getMeshRenderSharedMaterialMaskTilingOffset,d._setMeshRenderSharedMaterialMaskTilingOffset)},d.registerAnimationNodeProperty=function(a,b,c){if(d._propertyIndexDic[a])throw new Error("AnimationNode: this propertyName has registered.");d._propertyIndexDic[a]=d._propertyIDCounter,d._propertyGetFuncs[d._propertyIDCounter]=b,d._propertySetFuncs[d._propertyIDCounter]=c,d._propertyIDCounter++},d._getLocalPosition=function(a,b){return a?a.transform.getLocalPosition():b._transform.localPosition.elements},d._setLocalPosition=function(a,b,c){if(a)a.transform.setLocalPosition(c);else{var d=b._transform,e=d.localPosition;e.elements=c,d.localPosition=e}},d._getLocalRotation=function(a,b){return a?a.transform.getLocalRotation():b._transform.localRotation.elements},d._setLocalRotation=function(a,b,c){if(a)a.transform.setLocalRotation(c);else{var d=b._transform,e=d.localRotation;e.elements=c,d.localRotation=e}},d._getLocalScale=function(a,b){return a?a.transform.getLocalScale():b._transform.localScale.elements},d._setLocalScale=function(a,b,c){if(a)a.transform.setLocalScale(c);else{var d=b._transform,e=d.localScale;e.elements=c,d.localScale=e}},d._getLocalRotationEuler=function(a,b){return a?a.transform.getLocalRotationEuler():b._transform.localRotationEuler.elements},d._setLocalRotationEuler=function(a,b,c){if(a)a.transform.setLocalRotationEuler(c);else{var d=b._transform,e=d.localRotationEuler;e.elements=c,d.localRotationEuler=e}},d._getMeshRenderSharedMaterialTilingOffset=function(a,b){if(a){var c=a.transform._entity;return c?c.owner.meshRender.sharedMaterial.tilingOffset.elements:null}return b.meshRender.sharedMaterial.tilingOffset.elements},d._setMeshRenderSharedMaterialTilingOffset=function(a,b,c){var d,e;if(a){var f=a.transform._entity;f&&((e=(d=f.owner.meshRender.material).tilingOffset).elements=c,d.tilingOffset=e)}else(e=(d=b.meshRender.material).tilingOffset).elements=c,d.tilingOffset=e},d._getMeshRenderSharedMaterialAlbedo=function(a,b){if(a){var c=a.transform._entity;return c?c.owner.meshRender.sharedMaterial.albedoColor.elements:null}return b.meshRender.sharedMaterial.albedoColor.elements},d._setMeshRenderSharedMaterialAlbedo=function(a,b,c){var d,e;if(a){var f=a.transform._entity;f&&((e=(d=f.owner.meshRender.material).albedoColor).elements=c,d.albedoColor=e)}else(e=(d=b.meshRender.material).albedoColor).elements=c,d.albedoColor=e},d._getSkinnedMeshRenderSharedMaterialTilingOffset=function(a,b){if(a){var c=a.transform._entity;return c?c.owner.skinnedMeshRender.sharedMaterial.tilingOffset.elements:null}return b.skinnedMeshRender.sharedMaterial.tilingOffset.elements},d._setSkinnedMeshRenderSharedMaterialTilingOffset=function(a,b,c){var d,e;if(a){var f=a.transform._entity;f&&((e=(d=f.owner.skinnedMeshRender.material).tilingOffset).elements=c,d.tilingOffset=e)}else(e=(d=b.skinnedMeshRender.material).tilingOffset).elements=c,d.tilingOffset=e},d._getSkinnedMeshRenderSharedMaterialAlbedo=function(a,b){if(a){var c=a.transform._entity;return c?c.owner.skinnedMeshRender.sharedMaterial.albedoColor.elements:null}return b.skinnedMeshRender.sharedMaterial.albedoColor.elements},d._setSkinnedMeshRenderSharedMaterialAlbedo=function(a,b,c){var d,e;if(a){var f=a.transform._entity;f&&((e=(d=f.owner.skinnedMeshRender.material).albedoColor).elements=c,d.albedoColor=e)}else(e=(d=b.skinnedMeshRender.material).albedoColor).elements=c,d.albedoColor=e},d._getParticleRenderSharedMaterialTintColor=function(a,b){if(a){var c=a.transform._entity;return c?c.owner.particleRender.sharedMaterial.tintColor.elements:null}return b.particleRender.sharedMaterial.tintColor.elements},d._setParticleRenderSharedMaterialTintColor=function(a,b,c){var d,e;if(a){var f=a.transform._entity;f&&((e=(d=f.owner.particleRender.material).tintColor).elements=c,d.tintColor=e)}else(e=(d=b.particleRender.material).tintColor).elements=c,d.tintColor=e},d._getMeshRenderSharedMaterialAlphaColor=function(a,b){if(a){var c=a.transform._entity;return c?c.owner.meshRender.sharedMaterial.alphaColor.elements:null}return b.meshRender.sharedMaterial.alphaColor.elements},d._setMeshRenderSharedMaterialAlphaColor=function(a,b,c){var d,e;if(a){var f=a.transform._entity;f&&((e=(d=f.owner.meshRender.material).alphaColor).elements=c,d.alphaColor=e)}else(e=(d=b.meshRender.material).alphaColor).elements=c,d.alphaColor=e},d._getMeshRenderSharedMaterialBaseColor=function(a,b){if(a){var c=a.transform._entity;return c?c.owner.meshRender.sharedMaterial.baseColor.elements:null}return b.meshRender.sharedMaterial.baseColor.elements},d._setMeshRenderSharedMaterialBaseColor=function(a,b,c){var d,e;if(a){var f=a.transform._entity;f&&((e=(d=f.owner.meshRender.material).baseColor).elements=c,d.baseColor=e)}else(e=(d=b.meshRender.material).baseColor).elements=c,d.baseColor=e},d._getMeshRenderSharedMaterialDissolve=function(a,b){if(a){var c=a.transform._entity;return c?c.owner.meshRender.sharedMaterial.dissolve:0}return b.meshRender.sharedMaterial.dissolve},d._setMeshRenderSharedMaterialDissolve=function(a,b,c){if(a){var d=a.transform._entity;d&&(d.owner.meshRender.material.dissolve=c[0])}else b.meshRender.material.dissolve=c[0]},d._getMeshRenderSharedMaterialDissolveSpeed=function(a,b){if(a){var c=a.transform._entity;return c?c.owner.meshRender.sharedMaterial.dissolveSpeed:0}return b.meshRender.sharedMaterial.dissolveSpeed},d._setMeshRenderSharedMaterialDissolveSpeed=function(a,b,c){if(a){var d=a.transform._entity;d&&(d.owner.meshRender.material.dissolveSpeed=c[0])}else b.meshRender.material.dissolveSpeed=c[0]},d._getMeshRenderSharedMaterialMMultiplier=function(a,b){if(a){var c=a.transform._entity;return c?c.owner.meshRender.sharedMaterial.mMultiplier:0}return b.meshRender.sharedMaterial.mMultiplier},d._setMeshRenderSharedMaterialMMultiplier=function(a,b,c){if(a){var d=a.transform._entity;d&&(d.owner.meshRender.material.mMultiplier=c[0])}else b.meshRender.material.mMultiplier=c[0]},d._getMeshRenderSharedMaterialBaseScrollSpeedX=function(a,b){if(a){var c=a.transform._entity;return c?c.owner.meshRender.sharedMaterial.baseScrollSpeedX:0}return b.meshRender.sharedMaterial.baseScrollSpeedX},d._setMeshRenderSharedMaterialBaseScrollSpeedX=function(a,b,c){if(a){var d=a.transform._entity;d&&(d.owner.meshRender.material.baseScrollSpeedX=c[0])}else b.meshRender.material.baseScrollSpeedX=c[0]},d._getMeshRenderSharedMaterialBaseScrollSpeedY=function(a,b){if(a){var c=a.transform._entity;return c?c.owner.meshRender.sharedMaterial.baseScrollSpeedY:0}return b.meshRender.sharedMaterial.baseScrollSpeedY},d._setMeshRenderSharedMaterialBaseScrollSpeedY=function(a,b,c){if(a){var d=a.transform._entity;d&&(d.owner.meshRender.material.baseScrollSpeedY=c[0])}else b.meshRender.material.baseScrollSpeedY=c[0]},d._getMeshRenderSharedMaterialSecondScrollSpeedX=function(a,b){if(a){var c=a.transform._entity;return c?c.owner.meshRender.sharedMaterial.secondScrollSpeedX:0}return b.meshRender.sharedMaterial.secondScrollSpeedX},d._setMeshRenderSharedMaterialSecondScrollSpeedX=function(a,b,c){if(a){var d=a.transform._entity;d&&(d.owner.meshRender.material.secondScrollSpeedX=c[0])}else b.meshRender.material.secondScrollSpeedX=c[0]},d._getMeshRenderSharedMaterialSecondScrollSpeedY=function(a,b){if(a){var c=a.transform._entity;return c?c.owner.meshRender.sharedMaterial.secondScrollSpeedY:0}return b.meshRender.sharedMaterial.secondScrollSpeedY},d._setMeshRenderSharedMaterialSecondScrollSpeedY=function(a,b,c){if(a){var d=a.transform._entity;d&&(d.owner.meshRender.material.secondScrollSpeedY=c[0])}else b.meshRender.material.secondScrollSpeedY=c[0]},d._getMeshRenderSharedMaterialAlpha=function(a,b){if(a){var c=a.transform._entity;return c?c.owner.meshRender.sharedMaterial.alpha:0}return b.meshRender.sharedMaterial.alpha},d._setMeshRenderSharedMaterialAlpha=function(a,b,c){if(a){var d=a.transform._entity;d&&(d.owner.meshRender.material.alpha=c[0])}else b.meshRender.material.alpha=c[0]},d._getMeshRenderSharedMaterialIntensity=function(a,b){if(a){var c=a.transform._entity;return c?c.owner.meshRender.sharedMaterial.intensity:0}return b.meshRender.sharedMaterial.intensity},d._setMeshRenderSharedMaterialIntensity=function(a,b,c){if(a){var d=a.transform._entity;d&&(d.owner.meshRender.material.intensity=c[0])}else b.meshRender.material.intensity=c[0]},d._getMeshRenderSharedMaterialDetailTilingOffset=function(a,b){if(a){var c=a.transform._entity;return c?c.owner.meshRender.sharedMaterial.detailTilingOffset.elements:null}return b.meshRender.sharedMaterial.detailTilingOffset.elements},d._setMeshRenderSharedMaterialDetailTilingOffset=function(a,b,c){var d,e;if(a){var f=a.transform._entity;f&&((e=(d=f.owner.meshRender.material).detailTilingOffset).elements=c,d.detailTilingOffset=e)}else(e=(d=b.meshRender.material).detailTilingOffset).elements=c,d.detailTilingOffset=e},d._getMeshRenderSharedMaterialDissolveTilingOffset=function(a,b){if(a){var c=a.transform._entity;return c?c.owner.meshRender.sharedMaterial.dissolveTilingOffset.elements:null}return b.meshRender.sharedMaterial.dissolveTilingOffset.elements},d._setMeshRenderSharedMaterialDissolveTilingOffset=function(a,b,c){var d,e;if(a){var f=a.transform._entity;f&&((e=(d=f.owner.meshRender.material).dissolveTilingOffset).elements=c,d.dissolveTilingOffset=e)}else(e=(d=b.meshRender.material).dissolveTilingOffset).elements=c,d.dissolveTilingOffset=e},d._getMeshRenderSharedMaterialMaskTilingOffset=function(a,b){if(a){var c=a.transform._entity;return c?c.owner.meshRender.sharedMaterial.maskTilingOffset.elements:null}return b.meshRender.sharedMaterial.maskTilingOffset.elements},d._setMeshRenderSharedMaterialMaskTilingOffset=function(a,b,c){var d,e;if(a){var f=a.transform._entity;f&&((e=(d=f.owner.meshRender.material).maskTilingOffset).elements=c,d.maskTilingOffset=e)}else(e=(d=b.meshRender.material).maskTilingOffset).elements=c,d.maskTilingOffset=e},d._propertyIDCounter=0,d._propertyIndexDic={},d._propertySetFuncs=[],d._propertyGetFuncs=[],d}(),P=function(){function a(){this.startTime=NaN,this.inTangent=null,this.outTangent=null,this.data=null,this.duration=NaN,this.next=null}return n(a,"laya.d3.animation.Keyframe"),a}(),Q=function(){function a(){this._cacheProperty=!1,this.path=null,this.componentType=null,this.propertyNameID=0,this.keyFrameWidth=0,this.defaultData=null,this.keyFrames=null}return n(a,"laya.d3.animation.KeyframeNode"),a}(),G=(function(){function a(){this._tempVector30=new gb,this._tempVector31=new gb,this._tempVector32=new gb,this._a=new gb,this._b=new gb,this._c=new gb,this._d=new gb}n(a,"laya.d3.core.glitter.SplineCurvePositionVelocity");var b=a.prototype;b.Init=function(a,b,c,d){a.cloneTo(this._d),b.cloneTo(this._c),gb.scale(a,2,this._a),gb.scale(c,2,this._tempVector30),gb.subtract(this._a,this._tempVector30,this._a),gb.add(this._a,b,this._a),gb.add(this._a,d,this._a),gb.scale(c,3,this._b),gb.scale(a,3,this._tempVector30),gb.subtract(this._b,this._tempVector30,this._b),gb.subtract(this._b,d,this._b),gb.scale(b,2,this._tempVector30),gb.subtract(this._b,this._tempVector30,this._b)},b.Slerp=function(a,b){gb.scale(this._a,a*a*a,this._tempVector30),gb.scale(this._b,a*a,this._tempVector31),gb.scale(this._c,a,this._tempVector32),gb.add(this._tempVector30,this._tempVector31,b),gb.add(b,this._tempVector32,b),gb.add(b,this._d,b)}}(),function(){function K(a,b,c,d){this._datas=null,this._w=0,this._h=0,this._minHeight=NaN,this._maxHeight=NaN,this._datas=[],this._w=a,this._h=b,this._minHeight=c,this._maxHeight=d}n(K,"laya.d3.core.HeightMap");var a=K.prototype;a._inBounds=function(a,b){return 0<=a&&a<this._h&&0<=b&&b<this._w},a.getHeight=function(a,b){return this._inBounds(a,b)?this._datas[a][b]:NaN},o(0,a,"width",function(){return this._w}),o(0,a,"height",function(){return this._h}),o(0,a,"maxHeight",function(){return this._maxHeight}),o(0,a,"minHeight",function(){return this._minHeight}),K.creatFromMesh=function(a,b,c,d){for(var e=[],f=[],g=a.getSubMeshCount(),h=0;h<g;h++){for(var i=a.getSubMesh(h),j=i._getVertexBuffer(),k=j.getData(),l=[],m=0;m<k.length;m+=j.vertexDeclaration.vertexStride/4){var n=new gb(k[m+0],k[m+1],k[m+2]);l.push(n)}e.push(l);var o=i._getIndexBuffer();f.push(o.getData())}var p=a.boundingBox,q=p.min.x,r=p.min.z,s=p.max.x,t=p.max.z,u=p.min.y,v=p.max.y,w=s-q,x=t-r,y=d.elements[0]=w/(b-1),z=d.elements[1]=x/(c-1),A=new K(b,c,u,v),B=K._tempRay,C=B.direction.elements;C[0]=0,C[1]=-1,C[2]=0;var D=v+.1;B.origin.elements[1]=D;for(var E=0;E<c;E++){var F=r+E*z;A._datas[E]=[];for(var G=0;G<b;G++){var H=q+G*y,I=B.origin.elements;I[0]=H,I[2]=F;var J=K._getPosition(B,e,f);A._datas[E][G]=J===Number.MAX_VALUE?NaN:D-J}}return A},K.createFromImage=function(a,b,c){for(var d=a.width,e=a.height,f=new K(d,e,b,c),g=(c-b)/254,h=a.getPixels(),i=0,j=0;j<e;j++)for(var k=f._datas[j]=[],l=0;l<d;l++){var m=h[i++],n=h[i++],o=h[i++],p=h[i++];k[l]=255==m&&255==n&&255==o&&255==p?NaN:(m+n+o)/3*g+b}return f},K._getPosition=function(a,b,c){for(var d=Number.MAX_VALUE,e=0;e<b.length;e++)for(var f=b[e],g=c[e],h=0;h<g.length;h+=3){var i=f[g[h+0]],j=f[g[h+1]],k=f[g[h+2]],l=ob.rayIntersectsTriangle(a,i,j,k);!isNaN(l)&&l<d&&(d=l)}return d},l(K,["_tempRay",function(){return this._tempRay=new eb(new gb,new gb)}])}(),function(){function e(){this._visible=!0,this._nonRigidbodyOffset=0,this._colliders=[]}n(e,"laya.d3.core.Layer");var a=e.prototype;return a._binarySearchIndex=function(){for(var a=0,b=e._collsionTestList.length-1,c=0;a<=b;){c=Math.floor((a+b)/2);var d=e._collsionTestList[c];if(d==this._number)return c;d>this._number?b=c-1:a=c+1}return a},a._addCollider=function(a){0===this._colliders.length&&e._collsionTestList.splice(this._binarySearchIndex(),0,this._number),a._isRigidbody?(this._colliders.unshift(a),this._nonRigidbodyOffset++):this._colliders.push(a)},a._removeCollider=function(a){var b=this._colliders.indexOf(a);b<this._nonRigidbodyOffset&&this._nonRigidbodyOffset--,this._colliders.splice(b,1),0===this._colliders.length&&e._collsionTestList.splice(e._collsionTestList.indexOf(this._number),1)},o(0,a,"number",function(){return this._number}),o(0,a,"visible",function(){return this._visible},function(a){this._visible=a,e._visibleLayers=a?e._visibleLayers|this.mask:e._visibleLayers&~this.mask}),o(0,a,"mask",function(){return this._mask}),o(1,e,"visibleLayers",function(){return e._visibleLayers},function(a){e._visibleLayers=a;for(var b=0,c=e._layerList.length;b<c;b++){var d=e._layerList[b];d._visible=0!=(d._mask&e._visibleLayers)}}),e.__init__=function(){e._layerList.length=31;for(var a=0;a<31;a++){var b=new e;e._layerList[a]=b,0===a?(b.name="Default Layer",b.visible=!0):(b.name="Layer-"+a,b.visible=!1),b._number=a,b._mask=Math.pow(2,a)}e.currentCreationLayer=e._layerList[0]},e.getLayerByNumber=function(a){if(a<0||30<a)throw new Error("无法返回指定Layer，该number超出范围！");return e._layerList[a]},e.getLayerByName=function(a){for(var b=0;b<31;b++)if(e._layerList[b].name===a)return e._layerList[b];throw new Error("无法返回指定Layer,该name不存在")},e.isVisible=function(a){return 0!=(a&e._currentCameraCullingMask&e._visibleLayers)},e._layerList=[],e._visibleLayers=2147483647,e._collsionTestList=[],e._currentCameraCullingMask=2147483647,e.maxCount=31,e.currentCreationLayer=null,e}()),H=(function(){function a(a,b,c){this._time=NaN,this._minCount=0,this._maxCount=0,this._time=a,this._minCount=b,this._maxCount=c}n(a,"laya.d3.core.particleShuriKen.module.Burst");var b=a.prototype;v.imps(b,{"laya.d3.core.IClone":!0}),b.cloneTo=function(a){var b=a;b._time=this._time,b._minCount=this._minCount,b._maxCount=this._maxCount},b.clone=function(){var a=new this.constructor;return this.cloneTo(a),a},o(0,b,"time",function(){return this._time}),o(0,b,"minCount",function(){return this._minCount}),o(0,b,"maxCount",function(){return this._maxCount})}(),function(){function a(a){this._color=null,this.enbale=!1,this._color=a}n(a,"laya.d3.core.particleShuriKen.module.ColorOverLifetime");var b=a.prototype;b.cloneTo=function(a){var b=a;this._color.cloneTo(b._color),b.enbale=this.enbale},b.clone=function(){var a;switch(this._color.type){case 0:a=J.createByConstant(this._color.constant.clone());break;case 1:a=J.createByGradient(this._color.gradient.clone());break;case 2:a=J.createByRandomTwoConstant(this._color.constantMin.clone(),this._color.constantMax.clone());break;case 3:a=J.createByRandomTwoGradient(this._color.gradientMin.clone(),this._color.gradientMax.clone())}var b=new this.constructor(a);return b.enbale=this.enbale,b},o(0,b,"color",function(){return this._color})}(),function(){function a(){this._destroyed=!1,this._emissionRate=0,this._bursts=null,this.enbale=!1,this._destroyed=!1,this.emissionRate=10,this._bursts=[]}n(a,"laya.d3.core.particleShuriKen.module.Emission");var b=a.prototype;v.imps(b,{"laya.d3.core.IClone":!0,"laya.resource.IDestroy":!0}),b._destroy=function(){this._bursts=null,this._destroyed=!0},b.getBurstsCount=function(){return this._bursts.length},b.getBurstByIndex=function(a){return this._bursts[a]},b.addBurst=function(a){var b=this._bursts.length;if(0<b)for(var c=0;c<b;c++)this._bursts[c].time>a.time&&this._bursts.splice(c,0,a);this._bursts.push(a)},b.removeBurst=function(a){var b=this._bursts.indexOf(a);-1!==b&&this._bursts.splice(b,1)},b.removeBurstByIndex=function(a){this._bursts.splice(a,1)},b.clearBurst=function(){this._bursts.length=0},b.cloneTo=function(a){var b=a,c=b._bursts;c.length=this._bursts.length;for(var d=0,e=this._bursts.length;d<e;d++){var f=c[d];f?this._bursts[d].cloneTo(f):c[d]=this._bursts[d].clone()}b._emissionRate=this._emissionRate,b.enbale=this.enbale},b.clone=function(){var a=new this.constructor;return this.cloneTo(a),a},o(0,b,"destroyed",function(){return this._destroyed}),o(0,b,"emissionRate",function(){return this._emissionRate},function(a){if(a<0)throw new Error("ParticleBaseShape:emissionRate value must large or equal than 0.");this._emissionRate=a})}(),function(){function d(){this._type=0,this._constant=0,this._overTime=null,this._constantMin=0,this._constantMax=0,this._overTimeMin=null,this._overTimeMax=null}n(d,"laya.d3.core.particleShuriKen.module.FrameOverTime");var a=d.prototype;return v.imps(a,{"laya.d3.core.IClone":!0}),a.cloneTo=function(a){var b=a;b._type=this._type,b._constant=this._constant,this._overTime.cloneTo(b._overTime),b._constantMin=this._constantMin,b._constantMax=this._constantMax,this._overTimeMin.cloneTo(b._overTimeMin),this._overTimeMax.cloneTo(b._overTimeMax)},a.clone=function(){var a=new this.constructor;return this.cloneTo(a),a},o(0,a,"frameOverTimeData",function(){return this._overTime}),o(0,a,"constant",function(){return this._constant}),o(0,a,"type",function(){return this._type}),o(0,a,"frameOverTimeDataMin",function(){return this._overTimeMin}),o(0,a,"constantMin",function(){return this._constantMin}),o(0,a,"frameOverTimeDataMax",function(){return this._overTimeMax}),o(0,a,"constantMax",function(){return this._constantMax}),d.createByConstant=function(a){var b=new d;return b._type=0,b._constant=a,b},d.createByOverTime=function(a){var b=new d;return b._type=1,b._overTime=a,b},d.createByRandomTwoConstant=function(a,b){var c=new d;return c._type=2,c._constantMin=a,c._constantMax=b,c},d.createByRandomTwoOverTime=function(a,b){var c=new d;return c._type=3,c._overTimeMin=a,c._overTimeMax=b,c},d}()),I=function(){function j(){this._type=0,this._separateAxes=!1,this._constant=NaN,this._constantSeparate=null,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._gradientW=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null,this._gradientWMin=null,this._gradientWMax=null}n(j,"laya.d3.core.particleShuriKen.module.GradientAngularVelocity");var a=j.prototype;return v.imps(a,{"laya.d3.core.IClone":!0}),a.cloneTo=function(a){var b=a;b._type=this._type,b._separateAxes=this._separateAxes,b._constant=this._constant,this._constantSeparate.cloneTo(b._constantSeparate),this._gradient.cloneTo(b._gradient),this._gradientX.cloneTo(b._gradientX),this._gradientY.cloneTo(b._gradientY),this._gradientZ.cloneTo(b._gradientZ),b._constantMin=this._constantMin,b._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(b._constantMinSeparate),this._constantMaxSeparate.cloneTo(b._constantMaxSeparate),this._gradientMin.cloneTo(b._gradientMin),this._gradientMax.cloneTo(b._gradientMax),this._gradientXMin.cloneTo(b._gradientXMin),this._gradientXMax.cloneTo(b._gradientXMax),this._gradientYMin.cloneTo(b._gradientYMin),this._gradientYMax.cloneTo(b._gradientYMax),this._gradientZMin.cloneTo(b._gradientZMin),this._gradientZMax.cloneTo(b._gradientZMax)},a.clone=function(){var a=new this.constructor;return this.cloneTo(a),a},o(0,a,"gradientZ",function(){return this._gradientZ}),o(0,a,"constant",function(){return this._constant}),o(0,a,"gradient",function(){return this._gradient}),o(0,a,"separateAxes",function(){return this._separateAxes}),o(0,a,"type",function(){return this._type}),o(0,a,"constantSeparate",function(){return this._constantSeparate}),o(0,a,"gradientX",function(){return this._gradientX}),o(0,a,"gradientY",function(){return this._gradientY}),o(0,a,"gradientW",function(){return this._gradientW}),o(0,a,"gradientMin",function(){return this._gradientMin}),o(0,a,"constantMin",function(){return this._constantMin}),o(0,a,"gradientMax",function(){return this._gradientMax}),o(0,a,"constantMax",function(){return this._constantMax}),o(0,a,"gradientWMin",function(){return this._gradientWMin}),o(0,a,"constantMinSeparate",function(){return this._constantMinSeparate}),o(0,a,"constantMaxSeparate",function(){return this._constantMaxSeparate}),o(0,a,"gradientXMin",function(){return this._gradientXMin}),o(0,a,"gradientXMax",function(){return this._gradientXMax}),o(0,a,"gradientWMax",function(){return this._gradientWMax}),o(0,a,"gradientYMin",function(){return this._gradientYMin}),o(0,a,"gradientYMax",function(){return this._gradientYMax}),o(0,a,"gradientZMin",function(){return this._gradientZMin}),o(0,a,"gradientZMax",function(){return this._gradientZMax}),j.createByConstant=function(a){var b=new j;return b._type=0,b._separateAxes=!1,b._constant=a,b},j.createByConstantSeparate=function(a){var b=new j;return b._type=0,b._separateAxes=!0,b._constantSeparate=a,b},j.createByGradient=function(a){var b=new j;return b._type=1,b._separateAxes=!1,b._gradient=a,b},j.createByGradientSeparate=function(a,b,c,d){var e=new j;return e._type=1,e._separateAxes=!0,e._gradientX=a,e._gradientY=b,e._gradientZ=c,e._gradientW=d,e},j.createByRandomTwoConstant=function(a,b){var c=new j;return c._type=2,c._separateAxes=!1,c._constantMin=a,c._constantMax=b,c},j.createByRandomTwoConstantSeparate=function(a,b){var c=new j;return c._type=2,c._separateAxes=!0,c._constantMinSeparate=a,c._constantMaxSeparate=b,c},j.createByRandomTwoGradient=function(a,b){var c=new j;return c._type=3,c._separateAxes=!1,c._gradientMin=a,c._gradientMax=b,c},j.createByRandomTwoGradientSeparate=function(a,b,c,d,e,f,g,h){var i=new j;return i._type=3,i._separateAxes=!0,i._gradientXMin=a,i._gradientXMax=b,i._gradientYMin=c,i._gradientYMax=d,i._gradientZMin=e,i._gradientZMax=f,i._gradientWMin=g,i._gradientWMax=h,i},j}(),J=function(){function d(){this._type=0,this._constant=null,this._constantMin=null,this._constantMax=null,this._gradient=null,this._gradientMin=null,this._gradientMax=null}n(d,"laya.d3.core.particleShuriKen.module.GradientColor");var a=d.prototype;return v.imps(a,{"laya.d3.core.IClone":!0}),a.cloneTo=function(a){var b=a;b._type=this._type,this._constant.cloneTo(b._constant),this._constantMin.cloneTo(b._constantMin),this._constantMax.cloneTo(b._constantMax),this._gradient.cloneTo(b._gradient),this._gradientMin.cloneTo(b._gradientMin),this._gradientMax.cloneTo(b._gradientMax)},a.clone=function(){var a=new this.constructor;return this.cloneTo(a),a},o(0,a,"gradient",function(){return this._gradient}),o(0,a,"constant",function(){return this._constant}),o(0,a,"type",function(){return this._type}),o(0,a,"gradientMin",function(){return this._gradientMin}),o(0,a,"constantMin",function(){return this._constantMin}),o(0,a,"gradientMax",function(){return this._gradientMax}),o(0,a,"constantMax",function(){return this._constantMax}),d.createByConstant=function(a){var b=new d;return b._type=0,b._constant=a,b},d.createByGradient=function(a){var b=new d;return b._type=1,b._gradient=a,b},d.createByRandomTwoConstant=function(a,b){var c=new d;return c._type=2,c._constantMin=a,c._constantMax=b,c},d.createByRandomTwoGradient=function(a,b){var c=new d;return c._type=3,c._gradientMin=a,c._gradientMax=b,c},d}(),K=(function(){function a(){this._alphaCurrentLength=0,this._rgbCurrentLength=0,this._alphaElements=null,this._rgbElements=null,this._alphaElements=new Float32Array(8),this._rgbElements=new Float32Array(16)}n(a,"laya.d3.core.particleShuriKen.module.GradientDataColor");var b=a.prototype;v.imps(b,{"laya.d3.core.IClone":!0}),b.addAlpha=function(a,b){this._alphaCurrentLength<8?(6===this._alphaCurrentLength&&1!==a&&(a=1,DEBUG),this._alphaElements[this._alphaCurrentLength++]=a,this._alphaElements[this._alphaCurrentLength++]=b):DEBUG},b.addRGB=function(a,b){this._rgbCurrentLength<16?(12===this._rgbCurrentLength&&1!==a&&(a=1,DEBUG),this._rgbElements[this._rgbCurrentLength++]=a,this._rgbElements[this._rgbCurrentLength++]=b.x,this._rgbElements[this._rgbCurrentLength++]=b.y,this._rgbElements[this._rgbCurrentLength++]=b.z):DEBUG},b.cloneTo=function(a){var b=a,c=0,d=0;b._alphaCurrentLength=this._alphaCurrentLength;var e=b._alphaElements;for(e.length=this._alphaElements.length,c=0,d=this._alphaElements.length;c<d;c++)e[c]=this._alphaElements[c];b._rgbCurrentLength=this._rgbCurrentLength;var f=b._rgbElements;for(f.length=this._rgbElements.length,c=0,d=this._rgbElements.length;c<d;c++)f[c]=this._rgbElements[c]},b.clone=function(){var a=new this.constructor;return this.cloneTo(a),a},o(0,b,"alphaGradientCount",function(){return this._alphaCurrentLength/2}),o(0,b,"rgbGradientCount",function(){return this._rgbCurrentLength/4})}(),function(){function a(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}n(a,"laya.d3.core.particleShuriKen.module.GradientDataInt");var b=a.prototype;v.imps(b,{"laya.d3.core.IClone":!0}),b.add=function(a,b){this._currentLength<8?(6===this._currentLength&&1!==a&&(a=1,console.log("Warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=a,this._elements[this._currentLength++]=b):console.log("Warning:data count must lessEqual than 4")},b.cloneTo=function(a){var b=a;b._currentLength=this._currentLength;var c=b._elements;c.length=this._elements.length;for(var d=0,e=this._elements.length;d<e;d++)c[d]=this._elements[d]},b.clone=function(){var a=new this.constructor;return this.cloneTo(a),a},o(0,b,"gradientCount",function(){return this._currentLength/2})}(),function(){function a(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}n(a,"laya.d3.core.particleShuriKen.module.GradientDataNumber");var b=a.prototype;v.imps(b,{"laya.d3.core.IClone":!0}),b.add=function(a,b){this._currentLength<8?(6===this._currentLength&&1!==a&&(a=1,DEBUG),this._elements[this._currentLength++]=a,this._elements[this._currentLength++]=b):DEBUG},b.getKeyByIndex=function(a){return this._elements[2*a]},b.getValueByIndex=function(a){return this._elements[2*a+1]},b.getAverageValue=function(){for(var a=0,b=this._currentLength-2;a<b;a+=2){this._elements[a+1];this._elements[a+3],this._elements[a+2]-this._elements[a]}return 0},b.cloneTo=function(a){var b=a;b._currentLength=this._currentLength;var c=b._elements;c.length=this._elements.length;for(var d=0,e=this._elements.length;d<e;d++)c[d]=this._elements[d]},b.clone=function(){var a=new this.constructor;return this.cloneTo(a),a},o(0,b,"gradientCount",function(){return this._currentLength/2})}(),function(){function a(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(12)}n(a,"laya.d3.core.particleShuriKen.module.GradientDataVector2");var b=a.prototype;v.imps(b,{"laya.d3.core.IClone":!0}),b.add=function(a,b){this._currentLength<8?(6===this._currentLength&&1!==a&&(a=1,DEBUG&&console.log("GradientDataVector2 warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=a,this._elements[this._currentLength++]=b.x,this._elements[this._currentLength++]=b.y):DEBUG&&console.log("GradientDataVector2 warning:data count must lessEqual than 4")},b.cloneTo=function(a){var b=a;b._currentLength=this._currentLength;var c=b._elements;c.length=this._elements.length;for(var d=0,e=this._elements.length;d<e;d++)c[d]=this._elements[d]},b.clone=function(){var a=new this.constructor;return this.cloneTo(a),a},o(0,b,"gradientCount",function(){return this._currentLength/3})}(),function(){function h(){this._type=0,this._separateAxes=!1,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}n(h,"laya.d3.core.particleShuriKen.module.GradientSize");var a=h.prototype;return v.imps(a,{"laya.d3.core.IClone":!0}),a.getMaxSizeInGradient=function(){var a=0,b=0,c=-Number.MAX_VALUE;switch(this._type){case 0:if(this._separateAxes){for(a=0,b=this._gradientX.gradientCount;a<b;a++)c=Math.max(c,this._gradientX.getValueByIndex(a));for(a=0,b=this._gradientY.gradientCount;a<b;a++)c=Math.max(c,this._gradientY.getValueByIndex(a))}else for(a=0,b=this._gradient.gradientCount;a<b;a++)c=Math.max(c,this._gradient.getValueByIndex(a));break;case 1:c=this._separateAxes?(c=Math.max(this._constantMinSeparate.x,this._constantMaxSeparate.x),c=Math.max(c,this._constantMinSeparate.y),Math.max(c,this._constantMaxSeparate.y)):Math.max(this._constantMin,this._constantMax);break;case 2:if(this._separateAxes){for(a=0,b=this._gradientXMin.gradientCount;a<b;a++)c=Math.max(c,this._gradientXMin.getValueByIndex(a));for(a=0,b=this._gradientXMax.gradientCount;a<b;a++)c=Math.max(c,this._gradientXMax.getValueByIndex(a));for(a=0,b=this._gradientYMin.gradientCount;a<b;a++)c=Math.max(c,this._gradientYMin.getValueByIndex(a));for(a=0,b=this._gradientZMax.gradientCount;a<b;a++)c=Math.max(c,this._gradientZMax.getValueByIndex(a))}else{for(a=0,b=this._gradientMin.gradientCount;a<b;a++)c=Math.max(c,this._gradientMin.getValueByIndex(a));for(a=0,b=this._gradientMax.gradientCount;a<b;a++)c=Math.max(c,this._gradientMax.getValueByIndex(a))}}return c},a.cloneTo=function(a){var b=a;b._type=this._type,b._separateAxes=this._separateAxes,this._gradient.cloneTo(b._gradient),this._gradientX.cloneTo(b._gradientX),this._gradientY.cloneTo(b._gradientY),this._gradientZ.cloneTo(b._gradientZ),b._constantMin=this._constantMin,b._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(b._constantMinSeparate),this._constantMaxSeparate.cloneTo(b._constantMaxSeparate),this._gradientMin.cloneTo(b._gradientMin),this._gradientMax.cloneTo(b._gradientMax),this._gradientXMin.cloneTo(b._gradientXMin),this._gradientXMax.cloneTo(b._gradientXMax),this._gradientYMin.cloneTo(b._gradientYMin),this._gradientYMax.cloneTo(b._gradientYMax),this._gradientZMin.cloneTo(b._gradientZMin),this._gradientZMax.cloneTo(b._gradientZMax)},a.clone=function(){var a=new this.constructor;return this.cloneTo(a),a},o(0,a,"gradientZ",function(){return this._gradientZ}),o(0,a,"gradient",function(){return this._gradient}),o(0,a,"separateAxes",function(){return this._separateAxes}),o(0,a,"type",function(){return this._type}),o(0,a,"gradientMin",function(){return this._gradientMin}),o(0,a,"constantMin",function(){return this._constantMin}),o(0,a,"gradientX",function(){return this._gradientX}),o(0,a,"gradientY",function(){return this._gradientY}),o(0,a,"gradientMax",function(){return this._gradientMax}),o(0,a,"constantMax",function(){return this._constantMax}),o(0,a,"constantMinSeparate",function(){return this._constantMinSeparate}),o(0,a,"constantMaxSeparate",function(){return this._constantMaxSeparate}),o(0,a,"gradientXMin",function(){return this._gradientXMin}),o(0,a,"gradientXMax",function(){return this._gradientXMax}),o(0,a,"gradientYMin",function(){return this._gradientYMin}),o(0,a,"gradientYMax",function(){return this._gradientYMax}),o(0,a,"gradientZMin",function(){return this._gradientZMin}),o(0,a,"gradientZMax",function(){return this._gradientZMax}),h.createByGradient=function(a){var b=new h;return b._type=0,b._separateAxes=!1,b._gradient=a,b},h.createByGradientSeparate=function(a,b,c){var d=new h;return d._type=0,d._separateAxes=!0,d._gradientX=a,d._gradientY=b,d._gradientZ=c,d},h.createByRandomTwoConstant=function(a,b){var c=new h;return c._type=1,c._separateAxes=!1,c._constantMin=a,c._constantMax=b,c},h.createByRandomTwoConstantSeparate=function(a,b){var c=new h;return c._type=1,c._separateAxes=!0,c._constantMinSeparate=a,c._constantMaxSeparate=b,c},h.createByRandomTwoGradient=function(a,b){var c=new h;return c._type=2,c._separateAxes=!1,c._gradientMin=a,c._gradientMax=b,c},h.createByRandomTwoGradientSeparate=function(a,b,c,d,e,f){var g=new h;return g._type=2,g._separateAxes=!0,g._gradientXMin=a,g._gradientXMax=b,g._gradientYMin=c,g._gradientYMax=d,g._gradientZMin=e,g._gradientZMax=f,g},h}()),L=function(){function h(){this._type=0,this._constant=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=null,this._constantMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}n(h,"laya.d3.core.particleShuriKen.module.GradientVelocity");var a=h.prototype;return v.imps(a,{"laya.d3.core.IClone":!0}),a.cloneTo=function(a){var b=a;b._type=this._type,this._constant.cloneTo(b._constant),this._gradientX.cloneTo(b._gradientX),this._gradientY.cloneTo(b._gradientY),this._gradientZ.cloneTo(b._gradientZ),this._constantMin.cloneTo(b._constantMin),this._constantMax.cloneTo(b._constantMax),this._gradientXMin.cloneTo(b._gradientXMin),this._gradientXMax.cloneTo(b._gradientXMax),this._gradientYMin.cloneTo(b._gradientYMin),this._gradientYMax.cloneTo(b._gradientYMax),this._gradientZMin.cloneTo(b._gradientZMin),this._gradientZMax.cloneTo(b._gradientZMax)},a.clone=function(){var a=new this.constructor;return this.cloneTo(a),a},o(0,a,"gradientZ",function(){return this._gradientZ}),o(0,a,"constant",function(){return this._constant}),o(0,a,"type",function(){return this._type}),o(0,a,"gradientXMax",function(){return this._gradientXMax}),o(0,a,"constantMin",function(){return this._constantMin}),o(0,a,"gradientX",function(){return this._gradientX}),o(0,a,"gradientY",function(){return this._gradientY}),o(0,a,"gradientXMin",function(){return this._gradientXMin}),o(0,a,"constantMax",function(){return this._constantMax}),o(0,a,"gradientYMin",function(){return this._gradientYMin}),o(0,a,"gradientYMax",function(){return this._gradientYMax}),o(0,a,"gradientZMin",function(){return this._gradientZMin}),o(0,a,"gradientZMax",function(){return this._gradientZMax}),h.createByConstant=function(a){var b=new h;return b._type=0,b._constant=a,b},h.createByGradient=function(a,b,c){var d=new h;return d._type=1,d._gradientX=a,d._gradientY=b,d._gradientZ=c,d},h.createByRandomTwoConstant=function(a,b){var c=new h;return c._type=2,c._constantMin=a,c._constantMax=b,c},h.createByRandomTwoGradient=function(a,b,c,d,e,f){var g=new h;return g._type=3,g._gradientXMin=a,g._gradientXMax=b,g._gradientYMin=c,g._gradientYMax=d,g._gradientZMin=e,g._gradientZMax=f,g},h}(),M=(function(){function a(a){this._angularVelocity=null,this.enbale=!1,this._angularVelocity=a}n(a,"laya.d3.core.particleShuriKen.module.RotationOverLifetime");var b=a.prototype;v.imps(b,{"laya.d3.core.IClone":!0}),b.cloneTo=function(a){var b=a;this._angularVelocity.cloneTo(b._angularVelocity),b.enbale=this.enbale},b.clone=function(){var a;switch(this._angularVelocity.type){case 0:a=this._angularVelocity.separateAxes?I.createByConstantSeparate(this._angularVelocity.constantSeparate.clone()):I.createByConstant(this._angularVelocity.constant);break;case 1:a=this._angularVelocity.separateAxes?I.createByGradientSeparate(this._angularVelocity.gradientX.clone(),this._angularVelocity.gradientY.clone(),this._angularVelocity.gradientZ.clone(),this._angularVelocity.gradientW.clone()):I.createByGradient(this._angularVelocity.gradient.clone());break;case 2:a=this._angularVelocity.separateAxes?I.createByRandomTwoConstantSeparate(this._angularVelocity.constantMinSeparate.clone(),this._angularVelocity.constantMaxSeparate.clone()):I.createByRandomTwoConstant(this._angularVelocity.constantMin,this._angularVelocity.constantMax);break;case 3:a=this._angularVelocity.separateAxes?I.createByRandomTwoGradientSeparate(this._angularVelocity.gradientXMin.clone(),this._angularVelocity.gradientYMin.clone(),this._angularVelocity.gradientZMin.clone(),this._angularVelocity.gradientWMin.clone(),this._angularVelocity.gradientXMax.clone(),this._angularVelocity.gradientYMax.clone(),this._angularVelocity.gradientZMax.clone(),this._angularVelocity.gradientWMax.clone()):I.createByRandomTwoGradient(this._angularVelocity.gradientMin.clone(),this._angularVelocity.gradientMax.clone())}var b=new this.constructor(a);return b.enbale=this.enbale,b},o(0,b,"angularVelocity",function(){return this._angularVelocity})}(),function(){function a(){this.enable=!1,this.randomDirection=!1}n(a,"laya.d3.core.particleShuriKen.module.shape.BaseShape");var b=a.prototype;return v.imps(b,{"laya.d3.core.IClone":!0}),b._getShapeBoundBox=function(a){throw new Error("BaseShape: must override it.")},b._getSpeedBoundBox=function(a){throw new Error("BaseShape: must override it.")},b.generatePositionAndDirection=function(a,b,c,d){throw new Error("BaseShape: must override it.")},b._calculateProceduralBounds=function(a,b,c){this._getShapeBoundBox(a);var d=a.min,e=a.max;gb.multiply(d,b,d),gb.multiply(e,b,e);var f=new Xa(new gb,new gb);this.randomDirection?(f.min=new gb(-1,-1,-1),f.max=new gb(1,1,1)):this._getSpeedBoundBox(f);var g=new Xa(new gb,new gb),h=g.min,i=g.max;gb.scale(f.min,c.y,h),gb.scale(f.max,c.y,i),gb.add(a.min,h,h),gb.add(a.max,i,i),gb.min(a.min,h,a.min),gb.max(a.max,h,a.max);var j=new Xa(new gb,new gb),k=j.min,l=j.max;gb.scale(f.min,c.x,k),gb.scale(f.max,c.x,l),gb.min(j.min,l,h),gb.max(j.min,l,i),gb.min(a.min,h,a.min),gb.max(a.max,h,a.max)},b.cloneTo=function(a){a.enable=this.enable},b.clone=function(){var a=new this.constructor;return this.cloneTo(a),a},a}()),R=function(){function f(){}return n(f,"laya.d3.core.particleShuriKen.module.shape.ShapeUtils"),f._randomPointUnitArcCircle=function(a,b,c){var d=b.elements,e=NaN;e=c?c.getFloat()*a:Math.random()*a,d[0]=Math.cos(e),d[1]=Math.sin(e)},f._randomPointInsideUnitArcCircle=function(a,b,c){var d=b.elements;f._randomPointUnitArcCircle(a,b,c);var e=NaN;e=c?Math.pow(c.getFloat(),.5):Math.pow(Math.random(),.5),d[0]=d[0]*e,d[1]=d[1]*e},f._randomPointUnitCircle=function(a,b){var c=a.elements,d=NaN;d=b?b.getFloat()*Math.PI*2:Math.random()*Math.PI*2,c[0]=Math.cos(d),c[1]=Math.sin(d)},f._randomPointInsideUnitCircle=function(a,b){var c=a.elements;f._randomPointUnitCircle(a);var d=NaN;d=b?Math.pow(b.getFloat(),.5):Math.pow(Math.random(),.5),c[0]=c[0]*d,c[1]=c[1]*d},f._randomPointUnitSphere=function(a,b){var c=a.elements,d=NaN,e=NaN;e=b?(d=c[2]=2*b.getFloat()-1,b.getFloat()*Math.PI*2):(d=c[2]=2*Math.random()-1,Math.random()*Math.PI*2);var f=Math.sqrt(1-d*d);c[0]=f*Math.cos(e),c[1]=f*Math.sin(e)},f._randomPointInsideUnitSphere=function(a,b){var c=a.elements;f._randomPointUnitSphere(a);var d=NaN;d=b?Math.pow(b.getFloat(),1/3):Math.pow(Math.random(),1/3),c[0]=c[0]*d,c[1]=c[1]*d,c[2]=c[2]*d},f._randomPointInsideHalfUnitBox=function(a,b){var c=a.elements;b?(c[0]=b.getFloat()-.5,c[1]=b.getFloat()-.5,c[2]=b.getFloat()-.5):(c[0]=Math.random()-.5,c[1]=Math.random()-.5,c[2]=Math.random()-.5)},f}(),S=(function(){function a(a){this._size=null,this.enbale=!1,this._size=a}n(a,"laya.d3.core.particleShuriKen.module.SizeOverLifetime");var b=a.prototype;v.imps(b,{"laya.d3.core.IClone":!0}),b.cloneTo=function(a){var b=a;this._size.cloneTo(b._size),b.enbale=this.enbale},b.clone=function(){var a;switch(this._size.type){case 0:a=this._size.separateAxes?K.createByGradientSeparate(this._size.gradientX.clone(),this._size.gradientY.clone(),this._size.gradientZ.clone()):K.createByGradient(this._size.gradient.clone());break;case 1:a=this._size.separateAxes?K.createByRandomTwoConstantSeparate(this._size.constantMinSeparate.clone(),this._size.constantMaxSeparate.clone()):K.createByRandomTwoConstant(this._size.constantMin,this._size.constantMax);break;case 2:a=this._size.separateAxes?K.createByRandomTwoGradientSeparate(this._size.gradientXMin.clone(),this._size.gradientYMin.clone(),this._size.gradientZMin.clone(),this._size.gradientXMax.clone(),this._size.gradientYMax.clone(),this._size.gradientZMax.clone()):K.createByRandomTwoGradient(this._size.gradientMin.clone(),this._size.gradientMax.clone())}var b=new this.constructor(a);return b.enbale=this.enbale,b},o(0,b,"size",function(){return this._size})}(),function(){function d(){this._type=0,this._constant=NaN,this._constantMin=NaN,this._constantMax=NaN}n(d,"laya.d3.core.particleShuriKen.module.StartFrame");var a=d.prototype;return v.imps(a,{"laya.d3.core.IClone":!0}),a.cloneTo=function(a){var b=a;b._type=this._type,b._constant=this._constant,b._constantMin=this._constantMin,b._constantMax=this._constantMax},a.clone=function(){var a=new this.constructor;return this.cloneTo(a),a},o(0,a,"constant",function(){return this._constant}),o(0,a,"type",function(){return this._type}),o(0,a,"constantMin",function(){return this._constantMin}),o(0,a,"constantMax",function(){return this._constantMax}),d.createByConstant=function(a){var b=new d;return b._type=0,b._constant=a,b},d.createByRandomTwoConstant=function(a,b){var c=new d;return c._type=1,c._constantMin=a,c._constantMax=b,c},d}()),T=(function(){function a(a,b){this._frame=null,this._startFrame=null,this.tiles=null,this.type=0,this.randomRow=!1,this.rowIndex=0,this.cycles=0,this.enableUVChannels=0,this.enable=!1,this.tiles=new fb(1,1),this.type=0,this.randomRow=!0,this.rowIndex=0,this.cycles=1,this.enableUVChannels=1,this._frame=a,this._startFrame=b}n(a,"laya.d3.core.particleShuriKen.module.TextureSheetAnimation");var b=a.prototype;v.imps(b,{"laya.d3.core.IClone":!0}),b.cloneTo=function(a){var b=a;this.tiles.cloneTo(b.tiles),b.type=this.type,b.randomRow=this.randomRow,this._frame.cloneTo(b._frame),this._startFrame.cloneTo(b._startFrame),b.cycles=this.cycles,b.enableUVChannels=this.enableUVChannels,b.enable=this.enable},b.clone=function(){var a,b;switch(this._frame.type){case 0:a=H.createByConstant(this._frame.constant);break;case 1:a=H.createByOverTime(this._frame.frameOverTimeData.clone());break;case 2:a=H.createByRandomTwoConstant(this._frame.constantMin,this._frame.constantMax);break;case 3:a=H.createByRandomTwoOverTime(this._frame.frameOverTimeDataMin.clone(),this._frame.frameOverTimeDataMax.clone())}switch(this._startFrame.type){case 0:b=S.createByConstant(this._startFrame.constant);break;case 1:b=S.createByRandomTwoConstant(this._startFrame.constantMin,this._startFrame.constantMax)}var c=new this.constructor(a,b);return this.tiles.cloneTo(c.tiles),c.type=this.type,c.randomRow=this.randomRow,c.cycles=this.cycles,c.enableUVChannels=this.enableUVChannels,c.enable=this.enable,c},o(0,b,"frame",function(){return this._frame}),o(0,b,"startFrame",function(){return this._startFrame})}(),function(){function a(a){this._velocity=null,this.enbale=!1,this.space=0,this._velocity=a}n(a,"laya.d3.core.particleShuriKen.module.VelocityOverLifetime");var b=a.prototype;v.imps(b,{"laya.d3.core.IClone":!0}),b.cloneTo=function(a){var b=a;this._velocity.cloneTo(b._velocity),b.enbale=this.enbale,b.space=this.space},b.clone=function(){var a;switch(this._velocity.type){case 0:a=L.createByConstant(this._velocity.constant.clone());break;case 1:a=L.createByGradient(this._velocity.gradientX.clone(),this._velocity.gradientY.clone(),this._velocity.gradientZ.clone());break;case 2:a=L.createByRandomTwoConstant(this._velocity.constantMin.clone(),this._velocity.constantMax.clone());break;case 3:a=L.createByRandomTwoGradient(this._velocity.gradientXMin.clone(),this._velocity.gradientYMin.clone(),this._velocity.gradientZMin.clone(),this._velocity.gradientXMax.clone(),this._velocity.gradientYMax.clone(),this._velocity.gradientZMax.clone())}var b=new this.constructor(a);return b.enbale=this.enbale,b.space=this.space,b},o(0,b,"velocity",function(){return this._velocity})}(),function(){function a(){this._tempInt0=0,this._tempInt1=0,this._tempUint0=0,this._tempUint1=0,this._tempUint2=0,this._tempUint3=0,this._tempUint4=0,this._tempUint5=0,this._tempUint6=0,this._tempUint7=0,this._tempNumver0=NaN,this._tempNumver1=NaN,this._tempNumver2=NaN,this._tempNumver3=NaN,this._floatSizePerVer=7,this._defaultBufferSize=600*this._floatSizePerVer,this._vb=null,this._posInVBData=0,this._ib=null,this._posInIBData=0,this._primitiveType=NaN,this._hasBegun=!1,this._numVertsPerPrimitive=0,this._camera=null,this._sharderNameID=0,this._shader=null,this._shaderCompile=null,this._vbData=new Float32Array(this._defaultBufferSize),this._ibData=new Uint16Array(this._defaultBufferSize),this._spriteShaderValue=new mb,this._vb=Mb.create(a._vertexDeclaration,this._defaultBufferSize/this._floatSizePerVer,35048),this._ib=Lb.create("ushort",this._defaultBufferSize,35048),this._sharderNameID=Jb.nameKey.getID("LINE"),this._shaderCompile=yb._preCompileShader[this._sharderNameID]}n(a,"laya.d3.core.PhasorSpriter3D");var b=a.prototype;return b.line=function(a,b,c,d){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+2*this._floatSizePerVer>this._vbData.length||this._posInIBData+2>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(a.x,a.y,a.z,b.x,b.y,b.z,b.w),this.addVertex(c.x,c.y,c.z,d.x,d.y,d.z,d.w),this.addIndexes(this._tempUint0,this._tempUint0+1),this},b.circle=function(a,b,c,d,e,f){for(this._hasBegun&&1===this._primitiveType||this.drawLinesException(),this._tempUint0=2*b,(this._posInVBData+this._tempUint0*this._floatSizePerVer>this._vbData.length||this._posInIBData+2*this._tempUint0>this._ibData.length)&&this.flush(),this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=0,this._tempInt0=0;this._tempNumver0<6.2832;this._tempNumver0=this._tempNumver0+3.1416/b,this._tempInt0++)this.addVertex(Math.sin(this._tempNumver0)*a,Math.cos(this._tempNumver0)*a,0,c,d,e,f),0===this._tempInt0?this.addIndexes(this._tempUint1):this._tempInt0===this._tempUint0-1?(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2,this._tempUint1)):(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2));return this},b.plane=function(a,b,c,d,e,f,g,h,i){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+4*this._floatSizePerVer>this._vbData.length||this._posInIBData+6>this._ibData.length)&&this.flush(),this._tempNumver0=d/2,this._tempNumver1=e/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(a-this._tempNumver0,b+this._tempNumver1,c,f,g,h,i),this.addVertex(a+this._tempNumver0,b+this._tempNumver1,c,f,g,h,i),this.addVertex(a-this._tempNumver0,b-this._tempNumver1,c,f,g,h,i),this.addVertex(a+this._tempNumver0,b-this._tempNumver1,c,f,g,h,i),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint0+3),this},b.box=function(a,b,c,d,e,f,g,h,i,j){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+36>this._ibData.length)&&this.flush(),this._tempNumver0=d/2,this._tempNumver1=e/2,this._tempNumver2=f/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(a-this._tempNumver0,b+this._tempNumver1,c+this._tempNumver2,g,h,i,j),this.addVertex(a+this._tempNumver0,b+this._tempNumver1,c+this._tempNumver2,g,h,i,j),this.addVertex(a-this._tempNumver0,b-this._tempNumver1,c+this._tempNumver2,g,h,i,j),this.addVertex(a+this._tempNumver0,b-this._tempNumver1,c+this._tempNumver2,g,h,i,j),this.addVertex(a+this._tempNumver0,b+this._tempNumver1,c-this._tempNumver2,g,h,i,j),this.addVertex(a-this._tempNumver0,b+this._tempNumver1,c-this._tempNumver2,g,h,i,j),this.addVertex(a+this._tempNumver0,b-this._tempNumver1,c-this._tempNumver2,g,h,i,j),this.addVertex(a-this._tempNumver0,b-this._tempNumver1,c-this._tempNumver2,g,h,i,j),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint3,this._tempUint4,this._tempUint5,this._tempUint6,this._tempUint6,this._tempUint5,this._tempUint7,this._tempUint5,this._tempUint0,this._tempUint7,this._tempUint7,this._tempUint0,this._tempUint2,this._tempUint1,this._tempUint4,this._tempUint3,this._tempUint3,this._tempUint4,this._tempUint6,this._tempUint5,this._tempUint4,this._tempUint0,this._tempUint0,this._tempUint4,this._tempUint1,this._tempUint2,this._tempUint3,this._tempUint7,this._tempUint7,this._tempUint3,this._tempUint6),this},b.cone=function(a,b,c,d,e,f,g){for(this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+(2*c+2)*this._floatSizePerVer>this._vbData.length||this._posInIBData+6*c>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData,this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=2*Math.PI/c,this.addVertexIndex(0,b,0,d,e,f,g,this._tempUint0),this.addVertexIndex(0,0,0,d,e,f,g,this._tempUint0+this._floatSizePerVer),this._tempInt0=2,this._tempNumver1=0,this._tempInt1=0;this._tempInt1<c;this._tempInt1++)this._tempNumver2=Math.cos(this._tempNumver1),this._tempNumver3=Math.sin(this._tempNumver1),this.addVertexIndex(a*this._tempNumver2,0,a*this._tempNumver3,d,e,f,g,this._tempUint0+this._tempInt0*this._floatSizePerVer),this.addIndexes(this._tempUint1,this._tempUint1+this._tempInt0),this._tempInt1==c-1?this.addIndexes(this._tempUint1+2):this.addIndexes(this._tempUint1+this._tempInt0+1),this.addVertexIndex(a*this._tempNumver2,0,a*this._tempNumver3,d,e,f,g,this._tempUint0+(this._tempInt0+c)*this._floatSizePerVer),this.addIndexes(this._tempUint1+1),this._tempInt1==c-1?this.addIndexes(this._tempUint1+c+2):this.addIndexes(this._tempUint1+this._tempInt0+c+1),this.addIndexes(this._tempUint1+this._tempInt0+c),this._tempInt0++,this._tempNumver1+=this._tempNumver0;return this},b.boundingBoxLine=function(a,b,c,d,e,f,g,h,i,j){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+48>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(a,e,f,g,h,i,j),this.addVertex(d,e,f,g,h,i,j),this.addVertex(a,b,f,g,h,i,j),this.addVertex(d,b,f,g,h,i,j),this.addVertex(d,e,c,g,h,i,j),this.addVertex(a,e,c,g,h,i,j),this.addVertex(d,b,c,g,h,i,j),this.addVertex(a,b,c,g,h,i,j),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint1,this._tempUint3,this._tempUint3,this._tempUint2,this._tempUint2,this._tempUint0,this._tempUint4,this._tempUint5,this._tempUint5,this._tempUint7,this._tempUint7,this._tempUint6,this._tempUint6,this._tempUint4,this._tempUint5,this._tempUint0,this._tempUint0,this._tempUint2,this._tempUint2,this._tempUint7,this._tempUint7,this._tempUint5,this._tempUint1,this._tempUint4,this._tempUint4,this._tempUint6,this._tempUint6,this._tempUint3,this._tempUint3,this._tempUint1,this._tempUint5,this._tempUint4,this._tempUint4,this._tempUint1,this._tempUint1,this._tempUint0,this._tempUint0,this._tempUint5,this._tempUint2,this._tempUint3,this._tempUint3,this._tempUint6,this._tempUint6,this._tempUint7,this._tempUint7,this._tempUint2),this},b.addVertex=function(a,b,c,d,e,f,g){return this._hasBegun||this.addVertexIndexException(),this._vbData[this._posInVBData]=a,this._vbData[this._posInVBData+1]=b,this._vbData[this._posInVBData+2]=c,this._vbData[this._posInVBData+3]=d,this._vbData[this._posInVBData+4]=e,this._vbData[this._posInVBData+5]=f,this._vbData[this._posInVBData+6]=g,this._posInVBData+=this._floatSizePerVer,this},b.addVertexIndex=function(a,b,c,d,e,f,g,h){return this._hasBegun||this.addVertexIndexException(),this._vbData[h]=a,this._vbData[h+1]=b,this._vbData[h+2]=c,this._vbData[h+3]=d,this._vbData[h+4]=e,this._vbData[h+5]=f,this._vbData[h+6]=g,(h+=this._floatSizePerVer)>this._posInVBData&&(this._posInVBData=h),this},b.addIndexes=function(a){var b=arguments;this._hasBegun||this.addVertexIndexException();for(var c=0;c<b.length;c++)this._ibData[this._posInIBData]=b[c],this._posInIBData++;return this},b.begin=function(a,b){return this._hasBegun&&this.beginException0(),1!==a&&4!==a&&this.beginException1(),this._primitiveType=a,this._camera=b,this._hasBegun=!0,this},b.end=function(){return this._hasBegun||this.endException(),this.flush(),this._hasBegun=!1,this},b.flush=function(){0!==this._posInVBData&&(this._ib.setData(this._ibData),this._vb.setData(this._vbData),this._vb._bind(),this._ib._bind(),this._shader=this._shaderCompile.withCompile(0,0,0),this._shader.bind(),this._shader.uploadAttributes(a._vertexDeclaration.shaderValues.data,null),this._spriteShaderValue.setValue(1,this._camera.projectionViewMatrix.elements),this._shader.uploadSpriteUniforms(this._spriteShaderValue.data),y.drawCall++,D.mainContext.drawElements(this._primitiveType,this._posInIBData,5123,0),this._posInIBData=0,this._posInVBData=0)},b.addVertexIndexException=function(){throw new Error("请先调用begin()函数")},b.beginException0=function(){throw new Error("调用begin()前请确保已成功调用end()！")},b.beginException1=function(){throw new Error("只支持“LINES”和“TRIANGLES”两种基元！")},b.endException=function(){throw new Error("调用end()前请确保已成功调用begin()！")},b.drawLinesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“LINES”基元！")},b.drawTrianglesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“TRIANGLES”基元！")},l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(28,[new ga(0,"vector3",0),new ga(12,"vector4",1)])}]),a}()),U=function(){function a(){this._id=0,this._type=0,this._mainSortID=0,this._render=null,this._sprite3D=null,this._material=null,this._renderObj=null,this._staticBatch=null,this._tempBatchIndexStart=0,this._tempBatchIndexEnd=0,this._canDynamicBatch=!1,this._shaderValue=null,this._onPreRenderFunction=null,this._id=++a._uniqueIDCounter,this._canDynamicBatch=!0,this._shaderValue=new mb}n(a,"laya.d3.core.render.RenderElement");var b=a.prototype;return b.getDynamicBatchBakedVertexs=function(a){for(var b=this._renderObj._getVertexBuffer(a),c=b.getData().slice(),d=b.vertexDeclaration,e=d.getVertexElementByUsage(0).offset/4,f=d.getVertexElementByUsage(3).offset/4,g=this._sprite3D.transform,h=g.worldMatrix,i=g.rotation,j=d.vertexStride/4,k=0,l=c.length;k<l;k+=j){var m=k+e,n=k+f;qb.transformVector3ArrayToVector3ArrayCoordinate(c,m,h,c,m),qb.transformVector3ArrayByQuat(c,n,i,c,n)}return c},b.getBakedIndices=function(){return this._renderObj._getIndexBuffer().getData()},b._destroy=function(){this._staticBatch&&this._staticBatch._manager._garbageCollection(this)},o(0,b,"id",function(){return this._id}),o(0,b,"renderObj",function(){return this._renderObj},function(a){this._renderObj!==a&&(this._renderObj=a)}),a._uniqueIDCounter=0,a}(),V=function(){function b(a){this._id=0,this._needSort=!1,this._renderElements=null,this._renderableRenderObjects=null,this._dynamicBatchCombineRenderElements=null,this._finalElements=null,this._scene=null,this._id=++b._uniqueIDCounter,this._needSort=!1,this._scene=a,this._renderElements=[],this._renderableRenderObjects=[],this._dynamicBatchCombineRenderElements=[],this._errorRecord={}}n(b,"laya.d3.core.render.RenderQueue");var a=b.prototype;return a._sortOpaqueFunc=function(a,b){if(a._render&&b._render){var c=a._material.renderQueue-b._material.renderQueue;return 0==c?a._render._distanceForSort-b._render._distanceForSort:c}return 0},a._sortAlphaFunc=function(a,b){if(a._render&&b._render){var c=a._material.renderQueue-b._material.renderQueue;return 0==c?b._render._distanceForSort-a._render._distanceForSort:c}return 0},a._begainRenderElement=function(a,b,c){return!!b._beforeRender(a)},a._sortAlpha=function(a){b._cameraPosition=a,this._finalElements.sort(this._sortAlphaFunc)},a._sortOpaque=function(a){b._cameraPosition=a,this._finalElements.sort(this._sortOpaqueFunc)},a._preRender=function(a){this._finalElements=this._renderElements.concat(this._dynamicBatchCombineRenderElements)},a._render=function(a,b){for(var c,d,e,f,g,h,i=y.loopCount,j=this._scene,k=a.camera,l=(k.id,!1),m=0,n=this._finalElements.length;m<n;m++){var o,p,q,r=this._finalElements[m];if(null!=r._onPreRenderFunction&&r._onPreRenderFunction.call(r._sprite3D,a),0===r._type){if(a.owner=q=r._sprite3D,a.renderElement=r,q._preRenderUpdateComponents(a),o=r.renderObj,p=r._material,this._begainRenderElement(a,o,p)){if(c=o._getVertexBuffers(),!(e=(d=o._getVertexBuffer(0)).vertexDeclaration)){if(!this._errorRecord[d.id]){this._errorRecord[d.id]=1;var s="vertexBuffer:"+("("+d._destroyed+","+d._released+","+d._referenceCount+","+d._buffer+")")+", material:"+(p?p.__className+"("+p._destroyed+","+p._released+")":"null")+", owner:"+(q?q.__className+"("+q._destroyed+","+q._activeInHierarchy+","+q._displayedInStage+")":"null")+", renderObj:"+(o?o.__className+"("+o._destroyed+","+o._released+","+o._referenceCount+")":"")+", parent:, url:"+(q?q.url:"")+", disposeStack:"+d.disposeStack;v.recordError("报错：unknown vertexDeclaration  "+s)}continue}if(l=(f=a._shader=p._getShader(j._shaderDefineValue,e.shaderDefineValue,q._shaderDefineValue)).bind()||i!==f._uploadLoopCount,c){if(f._uploadVertexBuffer!==c||l){for(var t=0;t<c.length;t++){var u=c[t];f.uploadAttributesX(u.vertexDeclaration.shaderValues.data,u)}f._uploadVertexBuffer=c}}else(f._uploadVertexBuffer!==d||l)&&(f.uploadAttributes(e.shaderValues.data,null),f._uploadVertexBuffer=d);(f._uploadScene!==j||l)&&(f.uploadSceneUniforms(j._shaderValues.data),f._uploadScene=j),(k!==f._uploadCamera||f._uploadSprite3D!==q||l)&&(f.uploadSpriteUniforms(q._shaderValues.data),f._uploadSprite3D=q),(k!==f._uploadCamera||l)&&(f.uploadCameraUniforms(k._shaderValues.data),f._uploadCamera=k),(f._uploadMaterial!==p||l)&&(p._upload(),f._uploadMaterial=p),g!==p?(p._setRenderStateBlendDepth(),p._setRenderStateFrontFace(b,q.transform),g=p,h=q):h!==q&&(p._setRenderStateFrontFace(b,q.transform),h=q),o._render(a),f._uploadLoopCount=i}q._postRenderUpdateComponents(a)}else if(2===r._type){r.renderObj;a.owner=q=r._sprite3D,a.renderElement=r,a._batchIndexStart=r._tempBatchIndexStart,a._batchIndexEnd=r._tempBatchIndexEnd,o=r.renderObj,p=r._material,this._begainRenderElement(a,o,p)&&(e=(d=o._getVertexBuffer(0)).vertexDeclaration,l=(f=a._shader=p._getShader(j._shaderDefineValue,e.shaderDefineValue,q._shaderDefineValue)).bind()||i!==f._uploadLoopCount,(f._uploadVertexBuffer!==d||l)&&(f.uploadAttributes(e.shaderValues.data,null),f._uploadVertexBuffer=d),(f._uploadScene!==j||l)&&(f.uploadSceneUniforms(j._shaderValues.data),f._uploadScene=j),(k!==f._uploadCamera||f._uploadSprite3D!==q||l)&&(f.uploadSpriteUniforms(q._shaderValues.data),f._uploadSprite3D=q),(k!==f._uploadCamera||l)&&(f.uploadCameraUniforms(k._shaderValues.data),f._uploadCamera=k),(f._uploadMaterial!==p||l)&&(p._upload(),f._uploadMaterial=p),g!==p?(p._setRenderStateBlendDepth(),p._setRenderStateFrontFace(b,q.transform),g=p,h=q):h!==q&&(p._setRenderStateFrontFace(b,q.transform),h=q),o._render(a),f._uploadLoopCount=i)}}},a._renderShadow=function(a,b){for(var c,d,e,f,g,h=y.loopCount,i=this._scene,j=a.camera,k=!1,l=0,m=this._finalElements.length;l<m;l++){var n,o,p,q=this._finalElements[l];0===q._type&&(a.owner=p=q._sprite3D,b||p._projectionViewWorldUpdateCamera===j&&p._projectionViewWorldUpdateLoopCount===y.loopCount||(p._render._renderUpdate(a._projectionViewMatrix),p._projectionViewWorldUpdateLoopCount=y.loopCount,p._projectionViewWorldUpdateCamera=j),a.renderElement=q,p._preRenderUpdateComponents(a),n=q.renderObj,o=q._material,this._begainRenderElement(a,n,null)&&(d=(c=n._getVertexBuffer(0)).vertexDeclaration,k=(e=a._shader=o._getShader(i._shaderDefineValue,d.shaderDefineValue,p._shaderDefineValue)).bind()||h!==e._uploadLoopCount,(e._uploadVertexBuffer!==c||k)&&(e.uploadAttributes(d.shaderValues.data,null),e._uploadVertexBuffer=c),(j!==e._uploadCamera||e._uploadSprite3D!==p||k)&&(e.uploadSpriteUniforms(p._shaderValues.data),e._uploadSprite3D=p),(j!==e._uploadCamera||k)&&(e.uploadCameraUniforms(j._shaderValues.data),e._uploadCamera=j),(e._uploadMaterial!==o||k)&&(o._upload(),e._uploadMaterial=o),e._uploadRenderElement,f!==o?(o._setRenderStateFrontFace(!1,p.transform),f=o,g=p):g!==p&&(o._setRenderStateFrontFace(!1,p.transform),g=p),n._render(a),e._uploadLoopCount=h),p._postRenderUpdateComponents(a))}},a._clearRenderElements=function(){this._dynamicBatchCombineRenderElements.length=0,this._renderElements.length=0,this._needSort=!0},a._addRenderElement=function(a){this._renderElements.push(a),this._needSort=!0},a._addDynamicBatchElement=function(a){this._dynamicBatchCombineRenderElements.push(a)},o(0,a,"id",function(){return this._id}),b._uniqueIDCounter=0,b._cameraPosition=null,b}(),W=function(){function a(){this._staticBatch=null,this._batchIndexStart=0,this._batchIndexEnd=0,this._viewMatrix=null,this._projectionMatrix=null,this._projectionViewMatrix=null,this._viewport=null,this._shader=null,this.elapsedTime=NaN,this.scene=null,this.owner=null,this.renderElement=null,this.camera=null}return n(a,"laya.d3.core.render.RenderState"),a.clientWidth=0,a.clientHeight=0,a}(),X=function(){function g(a,b){this._exactBox=null,this._relaxBox=null,this._scene=null,this._parent=null,this._currentDepth=0,this._boundingSphere=new Za(new gb,0),this._corners=[new gb,new gb,new gb,new gb,new gb,new gb,new gb,new gb],this._boundingBoxCenter=new gb,this._children=d(8),this._objects=[],this._tempBoundBoxCorners=[new gb,new gb,new gb,new gb,new gb,new gb,new gb,new gb],this._scene=a,this._currentDepth=b}n(g,"laya.d3.core.scene.OctreeNode");var a=g.prototype;return v.imps(a,{"laya.d3.core.scene.ITreeNode":!0}),a.init=function(a,b){var c=new gb,d=new gb;gb.scale(b,-.5,c),gb.scale(b,.5,d),gb.add(c,a,c),gb.add(d,a,d),this.exactBox=new Xa(c,d),this.relaxBox=new Xa(c,d)},a.addTreeNode=function(a){1===Collision.boxContainsBox(this._relaxBox,a.boundingBox)?this.addNodeDown(a,0):this.addObject(a)},a.addChild=function(a){var b=this._children[a];if(null==b){b=new g(this._scene,this._currentDepth+1),(this._children[a]=b)._parent=this,gb.subtract(this._exactBox.max,this._exactBox.min,g.tempSize),gb.multiply(g.tempSize,g._octreeSplit[a],g.tempCenter),gb.add(this._exactBox.min,g.tempCenter,g.tempCenter),gb.scale(g.tempSize,.25,g.tempSize);var c=new gb,d=new gb;gb.subtract(g.tempCenter,g.tempSize,c),gb.add(g.tempCenter,g.tempSize,d),b.exactBox=new Xa(c,d),gb.scale(g.tempSize,g.relax,g.tempSize);var e=new gb,f=new gb;gb.subtract(g.tempCenter,g.tempSize,e),gb.add(g.tempCenter,g.tempSize,f),b.relaxBox=new Xa(e,f)}return b},a.addObject=function(a){(a._treeNode=this)._objects.push(a)},a.removeObject=function(a){if(a._treeNode!=this)return console.log("OctreeNode::removeObject error"),!1;var b=this._objects.indexOf(a);return-1!==b&&(this._objects.splice(b,1),!0)},a.clearObject=function(){this._objects.length=0},a.addNodeUp=function(a,b){this._parent&&1!==Collision.boxContainsBox(this._exactBox,a.boundingBox)?this._parent.addNodeUp(a,b-1):this.addNodeDown(a,b)},a.addNodeDown=function(a,b){if(b<this._scene.treeLevel){var c=this.inChildIndex(a.boundingBoxCenter),d=this.addChild(c);1===Collision.boxContainsBox(d._relaxBox,a.boundingBox)?d.addNodeDown(a,++b):this.addObject(a)}else this.addObject(a)},a.inChildIndex=function(a){return 4*(a.z<this._boundingBoxCenter.z?0:1)+2*(a.y<this._boundingBoxCenter.y?0:1)+(a.x<this._boundingBoxCenter.x?0:1)},a.updateObject=function(a){1===Collision.boxContainsBox(this._relaxBox,a.boundingBox)?(this.removeObject(a),a._treeNode=null,this.addNodeDown(a,this._currentDepth)):this._parent&&(this.removeObject(a),a._treeNode=null,this._parent.addNodeUp(a,this._currentDepth-1))},a.cullingObjects=function(a,b,c,d,e){var f,g=0,h=0,i=0,j=this._scene._dynamicBatchManager;for(g=0,f=this._objects.length;g<f;g++){var k=this._objects[g];if(G.isVisible(k._owner.layer.mask)&&k.enable){if(b&&(y.treeSpriteCollision+=1,0===a.containsBoundSphere(k.boundingSphere)))continue;k._renderUpdate(e),k._distanceForSort=gb.distance(k.boundingSphere.center,d)+k.sortingFudge;var l=k._renderElements;for(h=0,i=l.length;h<i;h++){var m=l[h],n=m._staticBatch;if(n&&n._material===m._material)n._addBatchRenderElement(m);else{var o=m.renderObj;o.triangleCount<10&&1===o._vertexBufferCount&&o._getIndexBuffer()&&m._material.renderQueue<2&&m._canDynamicBatch&&!k._owner.isStatic?j._addPrepareRenderElement(m):this._scene.getRenderQueue(m._material.renderQueue)._addRenderElement(m)}}}}for(g=0;g<8;g++){var p=this._children[g];if(null!=p){var q=b;if(b){var r=a.containsBoundBox(p._relaxBox);if(y.treeNodeCollision+=1,0===r)continue;q=2===r}p.cullingObjects(a,q,c,d,e)}}},a.cullingShadowObjects=function(a,b,c,d,e){var f,g=0,h=0,i=0;this._scene._dynamicBatchManager;for(g=0,f=this._objects.length;g<f;g++){var j=this._objects[g];if(j.castShadow&&G.isVisible(j._owner.layer.mask)&&j.enable){if(c&&0===a[0].containsBoundSphere(j.boundingSphere))continue;for(var k=1,l=a.length;k<l;k++){var m=b[k-1];if(0!==a[k].containsBoundSphere(j.boundingSphere)){var n=j._renderElements;for(h=0,i=n.length;h<i;h++)m._addRenderElement(n[h])}}}}for(g=0;g<8;g++){var o=this._children[g];if(null!=o){var p=c;if(c){var q=a[0].containsBoundBox(o._relaxBox);if(0===q)continue;p=2===q}o.cullingShadowObjects(a,b,p,d,e)}}},a.cullingShadowObjectsOnePSSM=function(a,b,c,d,e,f){var g,h=b[0],i=0,j=0,k=0;for(i=0,g=this._objects.length;i<g;i++){var l=this._objects[i];if(l.castShadow&&G.isVisible(l._owner.layer.mask)&&l.enable){if(d&&0===a.containsBoundSphere(l.boundingSphere))continue;l._renderUpdate(c);var m=l._renderElements;for(j=0,k=m.length;j<k;j++)h._addRenderElement(m[j])}}for(i=0;i<8;i++){var n=this._children[i];if(null!=n){var o=d;if(d){var p=a.containsBoundBox(n._relaxBox);if(0===p)continue;o=2===p}n.cullingShadowObjectsOnePSSM(a,b,c,o,e,f)}}},a.renderBoudingBox=function(a){this._renderBoudingBox(a);for(var b=0;b<8;++b){var c=this._children[b];c&&c.renderBoudingBox(a)}},a.buildAllChild=function(a){if(a<this._scene.treeLevel)for(var b=0;b<8;b++){this.addChild(b).buildAllChild(a+1)}},a._renderBoudingBox=function(a){},o(0,a,"exactBox",function(){return this._exactBox},function(a){this._exactBox=a,gb.add(a.min,a.max,this._boundingBoxCenter),gb.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter)}),o(0,a,"relaxBox",function(){return this._relaxBox},function(a){(this._relaxBox=a).getCorners(this._corners),Za.createfromPoints(this._corners,this._boundingSphere)}),g.debugMode=!1,g.relax=1.15,g.CHILDNUM=8,l(g,["tempVector0",function(){return this.tempVector0=new gb},"tempSize",function(){return this.tempSize=new gb},"tempCenter",function(){return this.tempCenter=new gb},"_octreeSplit",function(){return this._octreeSplit=[new gb(.25,.25,.25),new gb(.75,.25,.25),new gb(.25,.75,.25),new gb(.75,.75,.25),new gb(.25,.25,.75),new gb(.75,.25,.75),new gb(.25,.75,.75),new gb(.75,.75,.75)]}]),g}(),Y=(function(){function a(){}n(a,"laya.d3.core.scene.SceneManager")}(),function(){function a(a,b,c,d){this._r=NaN,this._g=NaN,this._b=NaN,this._a=NaN,void 0===a&&(a=1),void 0===b&&(b=1),void 0===c&&(c=1),void 0===d&&(d=1),this._r=a,this._g=b,this._b=c,this._a=d}return n(a,"laya.d3.core.trail.module.Color",null,"Color$1"),a.prototype.cloneTo=function(a){a._r=this._r,a._g=this._g,a._b=this._b,a._a=this._a},l(a,["RED",function(){return this.RED=new a(1,0,0,1)},"GREEN",function(){return this.GREEN=new a(0,1,0,1)},"BLUE",function(){return this.BLUE=new a(0,0,1,1)},"CYAN",function(){return this.CYAN=new a(0,1,1,1)},"YELLOW",function(){return this.YELLOW=new a(1,.92,.016,1)},"MAGENTA",function(){return this.MAGENTA=new a(1,0,1,1)},"GRAY",function(){return this.GRAY=new a(.5,.5,.5,1)},"WHITE",function(){return this.WHITE=new a(1,1,1,1)},"BLACK",function(){return this.BLACK=new a(0,0,0,1)}]),a}()),Z=(function(){function a(){this._mode=0,this._colorKeys=null,this._alphaKeys=null,this.index=0,this._colorKeyData=new Float32Array(40),this._alphaKeyData=new Float32Array(20),this._colorKeys=[],this._alphaKeys=[]}n(a,"laya.d3.core.trail.module.Gradient");var b=a.prototype;b.setKeys=function(a,b){var c,d;this._colorKeys=a;for(var e=this.index=0;e<a.length;e++){var f=(c=a[e]).color;this._colorKeyData[this.index++]=f._r,this._colorKeyData[this.index++]=f._g,this._colorKeyData[this.index++]=f._b,this._colorKeyData[this.index++]=c.time}this._alphaKeys=b;for(var g=this.index=0;g<b.length;g++)d=b[g],this._alphaKeyData[this.index++]=d.alpha,this._alphaKeyData[this.index++]=d.time},b.cloneTo=function(a){var b=0,c=0,d=this.colorKeys,e=[];for(b=0,c=d.length;b<c;b++){var f=new $;d[b].cloneTo(f),e.push(f)}var g=this.alphaKeys,h=[];for(b=0,c=g.length;b<c;b++){var i=new Z;g[b].cloneTo(i),h.push(i)}a.setKeys(e,h)},o(0,b,"mode",function(){return this._mode},function(a){this._mode=a}),o(0,b,"colorKeys",function(){return this._colorKeys},function(a){this._colorKeys=a;for(var b=this.index=0;b<a.length;b++){var c=a[b],d=c.color;this._colorKeyData[this.index++]=d._r,this._colorKeyData[this.index++]=d._g,this._colorKeyData[this.index++]=d._b,this._colorKeyData[this.index++]=c.time}}),o(0,b,"alphaKeys",function(){return this._alphaKeys},function(a){this._alphaKeys=a;for(var b=this.index=0;b<a.length;b++){var c=a[b];this._alphaKeyData[this.index++]=c.alpha,this._alphaKeyData[this.index++]=c.time}})}(),function(){function a(a,b){this._alpha=NaN,this._time=NaN,void 0===a&&(a=0),void 0===b&&(b=0),this._alpha=a,this._time=b}n(a,"laya.d3.core.trail.module.GradientAlphaKey");var b=a.prototype;return b.cloneTo=function(a){a.alpha=this.alpha,a.time=this.time},o(0,b,"alpha",function(){return this._alpha},function(a){this._alpha=a}),o(0,b,"time",function(){return this._time},function(a){this._time=a}),a}()),$=function(){function a(a,b){this._color=null,this._time=NaN,void 0===b&&(b=0),this._color=a||new Y,this._time=b}n(a,"laya.d3.core.trail.module.GradientColorKey");var b=a.prototype;return b.cloneTo=function(a){this.color.cloneTo(a.color),a.time=this.time},o(0,b,"color",function(){return this._color},function(a){this._color=a}),o(0,b,"time",function(){return this._time},function(a){this._time=a}),a}(),_=(function(){function a(){}n(a,"laya.d3.core.trail.module.GradientMode"),a.Blend=0,a.Fixed=1}(),function(){function a(){}n(a,"laya.d3.core.trail.module.TextureMode"),a.Stretch=0,a.Tile=1}(),function(){function a(){this.time=NaN,this.inTangent=NaN,this.outTangent=NaN,this.value=NaN}n(a,"laya.d3.core.trail.module.TrailKeyFrame"),a.prototype.cloneTo=function(a){a.time=this.time,a.inTangent=this.inTangent,a.outTangent=this.outTangent,a.value=this.value}}(),function(){function b(a){this._id=0,this._owner=null,this._camera=null,this._vertexBuffers=null,this._verticesCount=0,this._virtualVerticesCount=0,this._maxVerticesCount=256,this._vertices1=null,this._vertexBuffer1=null,this._floatCountPerVertices1=8,this._verticesIndex1=0,this._everyAddVerticeCount1=0,this._delLength=0,this._vertices2=null,this._vertexBuffer2=null,this._floatCountPerVertices2=1,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._pointe=null,this._pointAtoBVector3e=null,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._curtime=NaN,this._curDisappearIndex=0,this._lastPosition=new gb,this._curPosition=new gb,this._delVector3=new gb,this._lastFixedVertexPosition=new gb,this._pointAtoBVector3=new gb,this._pointA=new gb,this._pointB=new gb,this._owner=a,this._id=b.renderElementCount++,0==this._id?a._owner.transform.position.cloneTo(this._lastPosition):a._curSubTrailFinishPosition.cloneTo(this._lastPosition),this._everyGroupVertexBirthTime=[],this._VerticesToTailLength=new Float32Array(this._maxVerticesCount),this._everyVertexToPreVertexDistance=new Float32Array(this._maxVerticesCount),this._vertices1=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices1),this._vertices2=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices2),this._vertexBuffer1=new Mb(_.vertexDeclaration1,this._maxVerticesCount,35044,!0),this._vertexBuffer2=new Mb(_.vertexDeclaration2,this._maxVerticesCount,35044,!0),this._vertexBuffers=[],this._vertexBuffers.push(this._vertexBuffer1),this._vertexBuffers.push(this._vertexBuffer2)}n(b,"laya.d3.core.trail.TrailRenderElement");var a=b.prototype;v.imps(a,{"laya.d3.core.render.IRenderable":!0}),a._updateTrail=function(){this._everyAddVerticeCount1=0,this._isStart||this._addTrailByFirstPosition(this._lastPosition,this._curPosition),this._addTrailByNextPosition(this._curPosition),this._vertexBuffer1.setData(this._vertices1,this._verticesIndex1,this._verticesIndex1,this._everyAddVerticeCount1),this._verticesIndex1+=this._everyAddVerticeCount1,this._curPosition.cloneTo(this._lastPosition),2==this._virtualVerticesCount&&(this._verticesIndex1-=2*this._floatCountPerVertices1)},a._addTrailByFirstPosition=function(a,b){gb.subtract(b,a,this._delVector3),gb.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),gb.normalize(this._pointAtoBVector3,this._pointAtoBVector3),gb.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._updateVerticesByPosition(a),a.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._curtime=this._owner._hasLifeSubTrail?this._owner._curSubTrailFinishCurTime:this._owner._curtime,this._everyGroupVertexBirthTime.push(this._curtime),this._isStart=!0,this._owner._hasLifeSubTrail=!0},a._addTrailByNextPosition=function(a){gb.subtract(a,this._lastFixedVertexPosition,this._delVector3),gb.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),gb.normalize(this._pointAtoBVector3,this._pointAtoBVector3),gb.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._delLength=gb.scalarLength(this._delVector3),this._delLength-this._owner.minVertexDistance>=$a.zeroTolerance?(this._owner._trailTotalLength+=this._delLength,this._owner._trailSupplementLength=0,this._updateVerticesByPosition(a),a.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._virtualVerticesCount=0,this._everyGroupVertexBirthTime.push(this._owner._curtime),this._verticesCount==this._maxVerticesCount&&this._onTrailRenderElementFinish()):(this._owner._trailSupplementLength=this._delLength,this._updateVerticesByPosition(a),this._virtualVerticesCount=2)},a._updateVerticesByPosition=function(a){this._pointe=a.elements,this._pointAtoBVector3e=this._pointAtoBVector3.elements,this._curtime=this._owner._curtime,this._owner._hasLifeSubTrail&&0==this._isStart&&(this._pointe=this._owner._curSubTrailFinishPosition.elements,this._pointAtoBVector3e=this._owner._curSubTrailFinishDirection.elements,this._curtime=this._owner._curSubTrailFinishCurTime),this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=1,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=0,this._VerticesToTailLength[this._verticesCount/2]=this._owner._trailTotalLength+this._owner._trailSupplementLength,0==this._owner._trailSupplementLength?this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._delLength:this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._isStart?this._owner._trailSupplementLength:0},a._updateVertexBuffer2=function(){var a,b=0,c=0,d=0;for(d=0,a=(this._verticesCount+this._virtualVerticesCount)/2;d<a;d++)c=0==this._owner.textureMode?(this._VerticesToTailLength[d]-this._owner._trailDeadLength)/(this._owner._trailTotalLength+this._owner._trailSupplementLength-this._owner._trailDeadLength):this._owner._trailTotalLength+this._owner._trailSupplementLength-this._VerticesToTailLength[d],this._vertices2[b++]=1-c,this._vertices2[b++]=1-c;this._vertexBuffer2.setData(this._vertices2,0,0,this._verticesCount+this._virtualVerticesCount)},a._onTrailRenderElementFinish=function(){this._lastFixedVertexPosition.cloneTo(this._owner._curSubTrailFinishPosition),this._pointAtoBVector3.cloneTo(this._owner._curSubTrailFinishDirection),this._owner._curSubTrailFinishCurTime=this._owner._curtime,this._isFinish=!0},a._updateDisappear=function(){var a,b=0;for(b=this._curDisappearIndex,a=(this._verticesCount+this._virtualVerticesCount)/2;b<a;b++)this._owner._curtime-this._everyGroupVertexBirthTime[b]>=this._owner.time+$a.zeroTolerance&&(this._curDisappearIndex++,this._owner._trailDeadLength+=this._everyVertexToPreVertexDistance[this._curDisappearIndex],this._curDisappearIndex>=(this._verticesCount+this._virtualVerticesCount)/2&&(this._isDead=!0))},a._beforeRender=function(a){return this._camera=a.camera,null!=this._camera&&(this._owner._owner.transform.position.cloneTo(this._curPosition),!this._isDead&&(this._verticesCount<this._maxVerticesCount?(this._owner._isStart||(this._owner._owner.transform.position.cloneTo(this._lastPosition),this._owner._isStart=!0),gb.equals(this._lastPosition,this._curPosition)||this._updateTrail()):this._isFinish&&(this._isFinish=!1,this._owner._curSubTrailFinished=!0),0<this._verticesCount)&&(this._updateVertexBuffer2(),this._updateDisappear(),!0))},a._render=function(a){this._isDead||(D.mainContext.drawArrays(5,2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),console.log(2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),y.drawCall++,y.trianglesFaces+=this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex-2)},a._getVertexBuffer=function(a){return void 0===a&&(a=0),0===a?this._vertexBuffer1:1===a?this._vertexBuffer2:null},a._getVertexBuffers=function(){return this._vertexBuffers},a._getIndexBuffer=function(){return null},a.reActivate=function(){this._id=laya.d3.core.trail.TrailRenderElement.renderElementCount++,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._verticesCount=0,this._virtualVerticesCount=0,this._verticesIndex1=0,this._delLength=0,this._curDisappearIndex=0,this._everyGroupVertexBirthTime=[],this._owner._curSubTrailFinishPosition.cloneTo(this._lastPosition)},a._destroy=function(){this._vertexBuffer1.dispose(),this._vertexBuffer2.dispose(),this._vertices1=null,this._vertexBuffer1=null,this._vertices2=null,this._vertexBuffer2=null,this._vertexBuffers=null,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._lastPosition=null,this._curPosition=null,this._delVector3=null,this._lastFixedVertexPosition=null,this._pointAtoBVector3=null,this._pointe=null,this._pointAtoBVector3e=null,this._pointA=null,this._pointB=null},o(0,a,"_vertexBufferCount",function(){return this._vertexBuffers.length}),o(0,a,"triangleCount",function(){return 0}),b.renderElementCount=0}(),function(){function a(){}n(a,"laya.d3.core.trail.VertexTrail");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration1}),o(1,a,"vertexDeclaration1",function(){return a._vertexDeclaration1}),o(1,a,"vertexDeclaration2",function(){return a._vertexDeclaration2}),l(a,["_vertexDeclaration1",function(){return this._vertexDeclaration1=new fa(32,[new ga(0,"vector3",0),new ga(12,"vector3",41),new ga(24,"single",33),new ga(28,"single",40)])},"_vertexDeclaration2",function(){return this._vertexDeclaration2=new fa(4,[new ga(0,"single",38)])}]),a}()),aa=function(){function u(a){this._vertexDeclaration=null,this._vertexDatas=null,this._indexDatas=null,this._vertexBuffer=null,this._indexBuffer=null,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=null,this._materials=null,this._materialToRenderElementsOffsets=null,this._merageElements=null,this._combineRenderElementPool=null,this._combineRenderElementPoolIndex=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=[],this._materialToRenderElementsOffsets=[],this._materials=[],this._merageElements=[],this._combineRenderElementPool=[],this._combineRenderElementPoolIndex=0,this._vertexDeclaration=a}n(u,"laya.d3.graphics.DynamicBatch");var a=u.prototype;return v.imps(a,{"laya.d3.core.render.IRenderable":!0}),a._getVertexBuffer=function(a){return void 0===a&&(a=0),0===a?this._vertexBuffer:null},a._getIndexBuffer=function(){return this._indexBuffer},a._getCombineRenderElementFromPool=function(a,b,c){var d=this._combineRenderElementPool[this._combineRenderElementPoolIndex++];return d||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=d=new U,d._sprite3D=new Vb),d._sprite3D._render._renderUpdate(c),d},a._getRenderElement=function(a,b,c){this._vertexDatas||(this._vertexDatas=new Float32Array(this._vertexDeclaration.vertexStride/4*u.maxVertexCount),this._indexDatas=new Uint16Array(u.maxIndexCount),this._vertexBuffer=Mb.create(this._vertexDeclaration,u.maxVertexCount,35048),this._indexBuffer=Lb.create("ushort",u.maxIndexCount,35048));for(var d=this._merageElements.length=0,e=0,f=0,g=this._combineRenderElements.length;f<g;f++){var h=this._combineRenderElements[f],i=h.getDynamicBatchBakedVertexs(0),j=h.getBakedIndices(),k=h._sprite3D.transform._isFrontFaceInvert,l=d/(this._vertexDeclaration.vertexStride/4),m=e,n=m+j.length;h._tempBatchIndexStart=m,h._tempBatchIndexEnd=n,this._indexDatas.set(j,e);var o=0;if(k)for(o=m;o<n;o+=3){this._indexDatas[o]=l+this._indexDatas[o];var p=this._indexDatas[o+1],q=this._indexDatas[o+2];this._indexDatas[o+1]=l+q,this._indexDatas[o+2]=l+p}else for(o=m;o<n;o+=3)this._indexDatas[o]=l+this._indexDatas[o],this._indexDatas[o+1]=l+this._indexDatas[o+1],this._indexDatas[o+2]=l+this._indexDatas[o+2];e+=j.length,this._vertexDatas.set(i,d),d+=i.length}for(this._vertexBuffer.setData(this._vertexDatas),this._indexBuffer.setData(this._indexDatas),f=this._combineRenderElementPoolIndex=0,g=this._materials.length;f<g;f++){var r=this._getCombineRenderElementFromPool(a,b,c);r._type=2,r._staticBatch=null;var s=(r.renderObj=this)._combineRenderElements[this._materialToRenderElementsOffsets[f]]._tempBatchIndexStart,t=f+1===this._materialToRenderElementsOffsets.length?e:this._combineRenderElements[this._materialToRenderElementsOffsets[f+1]]._tempBatchIndexStart;r._tempBatchIndexStart=s,r._tempBatchIndexEnd=t,r._material=this._materials[f],this._merageElements.push(r)}},a._addCombineRenderObjTest=function(a){var b=a.renderObj,c=this._currentCombineIndexCount+b._getIndexBuffer().indexCount,d=this._currentCombineVertexCount+b._getVertexBuffer().vertexCount;return!(u.maxVertexCount<d||u.maxIndexCount<c)},a._addCombineRenderObj=function(a){var b=a.renderObj;this._combineRenderElements.push(a),this._currentCombineIndexCount=this._currentCombineIndexCount+b._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+b._getVertexBuffer().vertexCount},a._addCombineMaterial=function(a){this._materials.push(a)},a._addMaterialToRenderElementOffset=function(a){this._materialToRenderElementsOffsets.push(a)},a._clearRenderElements=function(){this._combineRenderElements.length=0,this._materials.length=0,this._materialToRenderElementsOffsets.length=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0},a._addToRenderQueue=function(a,b,c,d){this._getRenderElement(b,c,d);for(var e=0,f=this._materials.length;e<f;e++)a.getRenderQueue(this._materials[e].renderQueue)._addDynamicBatchElement(this._merageElements[e])},a._beforeRender=function(a){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},a._render=function(a){var b=a._batchIndexEnd-a._batchIndexStart;D.mainContext.drawElements(4,b,5123,2*a._batchIndexStart),y.drawCall++,y.trianglesFaces+=b/3},a._getVertexBuffers=function(){return null},o(0,a,"_vertexBufferCount",function(){return 1}),o(0,a,"triangleCount",function(){return this._indexBuffer.indexCount/3}),o(0,a,"combineRenderElementsCount",function(){return this._combineRenderElements.length}),u.maxVertexCount=2e4,u.maxIndexCount=4e4,u.maxCombineTriangleCount=10,u}(),ba=function(){function u(){this._dynamicBatches=null,this._prepareDynamicBatchCombineElements=null,this._dynamicBatches={},this._prepareDynamicBatchCombineElements=[]}n(u,"laya.d3.graphics.DynamicBatchManager");var a=u.prototype;return a.getDynamicBatch=function(a,b){var c,d=a.id.toString()+b;return this._dynamicBatches[d]?c=this._dynamicBatches[d]:this._dynamicBatches[d]=c=new aa(a),c},a._garbageCollection=function(){for(var a in this._dynamicBatches)0===this._dynamicBatches[a].combineRenderElementsCount&&delete this._dynamicBatches[a]},a._addPrepareRenderElement=function(a){this._prepareDynamicBatchCombineElements.push(a)},a._finishCombineDynamicBatch=function(a){var b,c,d;this._prepareDynamicBatchCombineElements.sort(u._sortPrepareDynamicBatch);for(var e,f,g,h,i,j=-1,k=!0,l=0,m=-1,n=0,o=this._prepareDynamicBatchCombineElements.length;n<o;n++){var p=(f=this._prepareDynamicBatchCombineElements[n]).renderObj._getVertexBuffer(0).vertexDeclaration,q=c!==p;q&&(l=0,c=p);var r=l!==j;if(r&&(j=l),(q||r)&&(g=this.getDynamicBatch(p,l),b=null),k)if(g._addCombineRenderObjTest(f)){if(b!==(e=f._material))h&&(a.getRenderQueue(i._material.renderQueue)._addRenderElement(i),i=h=null,m=-1),h=e,m=g.combineRenderElementsCount,i=f,b=e;else if(h){var s=i.renderObj,t=f.renderObj;s._getVertexBuffer().vertexCount+t._getVertexBuffer().vertexCount>aa.maxVertexCount||s._getIndexBuffer().indexCount+t._getIndexBuffer().indexCount>aa.maxIndexCount?(a.getRenderQueue(i._material.renderQueue)._addRenderElement(i),h=e,m=g.combineRenderElementsCount,i=f):(g._addCombineMaterial(h),g._addMaterialToRenderElementOffset(m),g._addCombineRenderObj(i),i=h=null,m=-1,g._addCombineRenderObj(f))}else g._addCombineRenderObj(f);k=!0}else h&&(a.getRenderQueue(i._material.renderQueue)._addRenderElement(i),i=h=null,m=-1),l++,k=!1;else d=this._prepareDynamicBatchCombineElements[n-1],g._addMaterialToRenderElementOffset(g.combineRenderElementsCount),b=d._material,g._addCombineMaterial(b),g._addCombineRenderObj(d),k=!0,b!==(e=f._material)?(h=e,m=g.combineRenderElementsCount,i=f):g._addCombineRenderObj(f),b=e}h&&(a.getRenderQueue(i._material.renderQueue)._addRenderElement(i),i=h=null,m=-1),this._prepareDynamicBatchCombineElements.length=0},a._clearRenderElements=function(){for(var a in this._dynamicBatches)this._dynamicBatches[a]._clearRenderElements()},a._addToRenderQueue=function(a,b,c,d){for(var e in this._dynamicBatches){var f=this._dynamicBatches[e];0<f.combineRenderElementsCount&&f._addToRenderQueue(a,b,c,d)}},a.dispose=function(){this._dynamicBatches=null},u._sortPrepareDynamicBatch=function(a,b){return a._mainSortID-b._mainSortID},u}(),ca=function(){function a(){}return n(a,"laya.d3.graphics.FrustumCulling"),a.renderShadowObjectCulling=function(a,b,c,d,e){var f=0,g=0,h=0,i=0;for(f=0,h=c.length;f<h;f++){var j=c[f];j&&j._clearRenderElements()}var k,l,m,n=a._cullingRenders;if(1<e){for(f=0,h=a._cullingRendersLength;f<h;f++)if((k=n[f]).castShadow&&G.isVisible(k._owner.layer.mask)&&k.enable)for(var o=1,p=b.length;o<p;o++)if(l=c[o-1],0!==b[o].containsBoundSphere(k.boundingSphere))for(g=0,i=(m=k._renderElements).length;g<i;g++)l._addRenderElement(m[g])}else for(f=0,h=a._cullingRendersLength;f<h;f++)if((k=n[f]).castShadow&&G.isVisible(k._owner.layer.mask)&&k.enable&&0!==b[0].containsBoundSphere(k.boundingSphere))for(k._renderUpdate(d),l=c[0],g=0,i=(m=k._renderElements).length;g<i;g++)l._addRenderElement(m[g])},a.renderShadowObjectCullingOctree=function(a,b,c,d,e){for(var f=0,g=c.length;f<g;f++){var h=c[f];h&&h._clearRenderElements()}1<e?a.treeRoot.cullingShadowObjects(b,c,!0,0,a):a.treeRoot.cullingShadowObjectsOnePSSM(b[0],c,d,!0,0,a)},a.renderObjectCulling=function(a,b,c,d,e,f){var g=0,h=0,i=0,j=0,k=b._quenes,l=b._dynamicBatchManager,m=b._cullingRenders;for(g=0,h=k.length;g<h;g++){var n=k[g];n&&n._clearRenderElements()}var o=da._staticBatchManagers;for(g=0,h=o.length;g<h;g++)o[g]._clearRenderElements();l._clearRenderElements();var p=c.transform.position;for(g=0,h=b._cullingRendersLength;g<h;g++){var q=m[g];if(G.isVisible(q._owner.layer.mask)&&q.enable&&0!==a.containsBoundSphere(q.boundingSphere)&&q._renderUpdate(f)){q._distanceForSort=gb.distance(q.boundingSphere.center,p)+q.sortingFudge;var r=q._renderElements;for(i=0,j=r.length;i<j;i++){var s=r[i],t=s._staticBatch;if(t&&t._material===s._material)t._addBatchRenderElement(s);else{var u=s.renderObj;u.triangleCount<10&&1===u._vertexBufferCount&&u._getIndexBuffer()&&s._material.renderQueue<2&&s._canDynamicBatch&&!q._owner.isStatic?l._addPrepareRenderElement(s):b.getRenderQueue(s._material.renderQueue)._addRenderElement(s)}}}}for(g=0,h=o.length;g<h;g++)o[g]._addToRenderQueue(b,d,e,f);l._finishCombineDynamicBatch(b),l._addToRenderQueue(b,d,e,f)},a.renderObjectCullingOctree=function(a,b,c,d,e,f){var g=0,h=0,i=b._quenes,j=b._dynamicBatchManager;for(g=0,h=i.length;g<h;g++){var k=i[g];k&&k._clearRenderElements()}var l=da._staticBatchManagers;for(g=0,h=l.length;g<h;g++)l[g]._clearRenderElements();for(j._clearRenderElements(),b._cullingRenders.length=0,b.treeRoot.cullingObjects(a,!0,0,c.transform.position,f),g=0,h=l.length;g<h;g++)l[g]._addToRenderQueue(b,d,e,f);j._finishCombineDynamicBatch(b),j._addToRenderQueue(b,d,e,f)},a.renderObjectCullingNoBoundFrustum=function(a,b,c,d,e){var f=0,g=0,h=0,i=0,j=a._quenes,k=a._dynamicBatchManager,l=a._cullingRenders;for(f=0,g=j.length;f<g;f++){var m=j[f];m&&m._clearRenderElements()}var n=da._staticBatchManagers;for(f=0,g=n.length;f<g;f++)n[f]._clearRenderElements();k._clearRenderElements();var o=b.transform.position;for(f=0,g=a._cullingRendersLength;f<g;f++){var p=l[f];if(G.isVisible(p._owner.layer.mask)&&p.enable){p._renderUpdate(e),p._distanceForSort=gb.distance(p.boundingSphere.center,o)+p.sortingFudge;var q=p._renderElements;for(h=0,i=q.length;h<i;h++){var r=q[h],s=r._staticBatch;if(s&&s._material===r._material)s._addBatchRenderElement(r);else{var t=r.renderObj;t.triangleCount<10&&1===t._vertexBufferCount&&t._getIndexBuffer()&&r._material.renderQueue<2&&r._canDynamicBatch&&!p._owner.isStatic?k._addPrepareRenderElement(r):a.getRenderQueue(r._material.renderQueue)._addRenderElement(r)}}}}for(f=0,g=n.length;f<g;f++)n[f]._addToRenderQueue(a,c,d,e);k._finishCombineDynamicBatch(a),k._addToRenderQueue(a,c,d,e)},a}(),da=function(){function f(){this._initBatchRenderElements=null,this._staticBatches=null,this._initBatchRenderElements=[],this._staticBatches={}}n(f,"laya.d3.graphics.StaticBatchManager");var a=f.prototype;return a._finishInit=function(){for(var a in this._staticBatches)this._staticBatches[a]._finishInit();this._initBatchRenderElements.length=0},a._initStaticBatchs=function(a){throw new Error("StaticBatchManager:must override this function.")},a._addInitBatchSprite=function(a){for(var b=a._render._renderElements,c=0,d=b.length;c<d;c++)this._initBatchRenderElements.push(b[c])},a._clearRenderElements=function(){for(var a in this._staticBatches)this._staticBatches[a]._clearRenderElements()},a._garbageCollection=function(a){var b=a._staticBatch,c=b._initBatchRenderElements,d=c.indexOf(a);c.splice(d,1),0===c.length&&(b.dispose(),delete this._staticBatches[b._key])},a._addToRenderQueue=function(a,b,c,d){for(var e in this._staticBatches){var f=this._staticBatches[e];0<f._batchRenderElements.length&&f._updateToRenderQueue(a,d)}},a.dispose=function(){this._staticBatches=null},f._addToStaticBatchQueue=function(a){a instanceof laya.d3.core.RenderableSprite3D&&a._addToInitStaticBatchManager();for(var b=0,c=a.numChildren;b<c;b++)f._addToStaticBatchQueue(a._childs[b])},f.combine=function(a,b){var c,d=0,e=0;if(b)for(d=0,e=b.length;d<e;d++){b[d]._addToInitStaticBatchManager()}else a&&f._addToStaticBatchQueue(a);for(d=0,e=f._staticBatchManagers.length;d<e;d++)(c=f._staticBatchManagers[d])._initStaticBatchs(a),c._finishInit()},f._staticBatchManagers=[],f}(),ea=function(){function a(a,b,c){this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=null,this._initBatchRenderElements=null,this._batchRenderElements=null,this._material=null,this._rootOwner=null,this._key=null,this._manager=null,this._key=a,this._manager=b,this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=[],this._initBatchRenderElements=[],this._batchRenderElements=[],this._rootOwner=c}n(a,"laya.d3.graphics.StaticBatch");var b=a.prototype;return v.imps(b,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),b._binarySearch=function(a){for(var b=0,c=this._batchRenderElements.length-1,d=0;b<=c;)d=Math.floor((b+c)/2),this._compareBatchRenderElement(this._batchRenderElements[d],a)?c=d-1:b=d+1;return b},b._compareBatchRenderElement=function(a,b){throw new Error("StaticBatch:must override this function.")},b._getVertexDecLightMap=function(a){return a===La.vertexDeclaration?Ga.vertexDeclaration:a===Ka.vertexDeclaration?Fa.vertexDeclaration:a===za.vertexDeclaration?ua.vertexDeclaration:a===Pa.vertexDeclaration?null:a===pa.vertexDeclaration?qa.vertexDeclaration:a===Na.vertexDeclaration?Ia.vertexDeclaration:a===Da.vertexDeclaration?Ea.vertexDeclaration:a===Ma.vertexDeclaration?Ha.vertexDeclaration:a===Ka.vertexDeclaration?Fa.vertexDeclaration:a===Aa.vertexDeclaration?va.vertexDeclaration:a===Pa.vertexDeclaration?null:a===pa.vertexDeclaration?qa.vertexDeclaration:a===Oa.vertexDeclaration?Ja.vertexDeclaration:a===Da.vertexDeclaration?Ea.vertexDeclaration:a},b._getCombineRenderElementFromPool=function(){throw new Error("StaticBatch:must override this function.")},b._addBatchRenderElement=function(a){this._batchRenderElements.splice(this._binarySearch(a),0,a)},b._updateToRenderQueue=function(a,b){this._combineRenderElementPoolIndex=0,this._getRenderElement(a.getRenderQueue(this._material.renderQueue)._renderElements,a,b)},b._getRenderElement=function(a,b,c){throw new Error("StaticBatch:must override this function.")},b._finishInit=function(){throw new Error("StaticBatch:must override this function.")},b._clearRenderElements=function(){this._batchRenderElements.length=0},b.dispose=function(){},b._getVertexBuffer=function(a){return void 0===a&&(a=0),null},b._getIndexBuffer=function(){return null},b._beforeRender=function(a){return!0},b._render=function(a){},b._getVertexBuffers=function(){return null},o(0,b,"_vertexBufferCount",function(){return 1}),o(0,b,"triangleCount",function(){return 0}),a.combine=function(a){console.log("StaticBatch: discard property,please use StaticBatchManager.combine() function instead."),da.combine(a)},a.maxBatchVertexCount=65535,a}(),fa=function(){function g(a,b){if(this._id=0,this._shaderValues=null,this._shaderDefineValue=0,this._vertexStride=0,this._vertexElements=null,this._vertexElementsDic=null,this._id=++g._uniqueIDCounter,this._id>g.maxVertexDeclaration)throw new Error("VertexDeclaration: VertexDeclaration count should not large than ",g.maxVertexDeclaration);this._shaderValues=new mb,this._vertexElementsDic={},this._vertexStride=a,this._vertexElements=b;for(var c=0;c<b.length;c++){var d=b[c],e=d.elementUsage;this._vertexElementsDic[e]=d;var f=[g._getTypeSize(d.elementFormat)/4,5126,!1,this._vertexStride,d.offset];switch(this._shaderValues.setValue(e,f),e){case 1:this._addShaderDefine(yb.SHADERDEFINE_COLOR);break;case 2:this._addShaderDefine(yb.SHADERDEFINE_UV0);break;case 15:this._addShaderDefine(yb.SHADERDEFINE_UV1)}}}n(g,"laya.d3.graphics.VertexDeclaration");var a=g.prototype;return a._addShaderDefine=function(a){this._shaderDefineValue|=a},a._removeShaderDefine=function(a){this._shaderDefineValue&=~a},a.getVertexElements=function(){return this._vertexElements.slice()},a.getVertexElementByUsage=function(a){return this._vertexElementsDic[a]},a.unBinding=function(){},o(0,a,"shaderDefineValue",function(){return this._shaderDefineValue}),o(0,a,"id",function(){return this._id}),o(0,a,"vertexStride",function(){return this._vertexStride}),o(0,a,"shaderValues",function(){return this._shaderValues}),g._getTypeSize=function(a){switch(a){case"single":return 4;case"vector2":return 8;case"vector3":return 12;case"vector4":return 16;case"color":case"byte4":case"short2":return 4;case"short4":return 8;case"normalizedshort2":return 4;case"normalizedshort4":return 8;case"halfvector2":return 4;case"halfvector4":return 8}return 0},g.getVertexStride=function(a){for(var b=0,c=0;c<a.Length;c++){var d=a[c],e=d.offset+g._getTypeSize(d.elementFormat);b<e&&(b=e)}return b},g._maxVertexDeclarationBit=1e3,g._uniqueIDCounter=1,l(g,["maxVertexDeclaration",function(){return this.maxVertexDeclaration=2147483647-1e3*Math.floor(2147483.647)}]),g}(),ga=function(){function a(a,b,c){this.offset=0,this.elementFormat=null,this.elementUsage=0,this.offset=a,this.elementFormat=b,this.elementUsage=c}return n(a,"laya.d3.graphics.VertexElement"),a}(),ha=(function(){function a(){}n(a,"laya.d3.graphics.VertexElementFormat"),a.Single="single",a.Vector2="vector2",a.Vector3="vector3",a.Vector4="vector4",a.Color="color",a.Byte4="byte4",a.Short2="short2",a.Short4="short4",a.NormalizedShort2="normalizedshort2",a.NormalizedShort4="normalizedshort4",a.HalfVector2="halfvector2",a.HalfVector4="halfvector4"}(),function(){function a(){}n(a,"laya.d3.graphics.VertexElementUsage"),a.POSITION0=0,a.COLOR0=1,a.TEXTURECOORDINATE0=2,a.NORMAL0=3,a.BINORMAL0=4,a.TANGENT0=5,a.BLENDINDICES0=6,a.BLENDWEIGHT0=7,a.DEPTH0=8,a.FOG0=9,a.POINTSIZE0=10,a.SAMPLE0=11,a.TESSELLATEFACTOR0=12,a.COLOR1=13,a.NEXTTEXTURECOORDINATE0=14,a.TEXTURECOORDINATE1=15,a.NEXTTEXTURECOORDINATE1=16,a.CORNERTEXTURECOORDINATE0=17,a.VELOCITY0=18,a.STARTCOLOR0=19,a.STARTSIZE=20,a.AGEADDSCALE0=21,a.STARTROTATION=22,a.ENDCOLOR0=23,a.STARTLIFETIME=24,a.TIME0=33,a.SHAPEPOSITIONSTARTLIFETIME=30,a.DIRECTIONTIME=32,a.SIZEROTATION0=27,a.RADIUS0=28,a.RADIAN0=29,a.STARTSPEED=31,a.RANDOM0=34,a.RANDOM1=35,a.SIMULATIONWORLDPOSTION=36,a.SIMULATIONWORLDROTATION=37,a.TEXTURECOORDINATE0X=38,a.TEXTURECOORDINATE0X1=39,a.TEXTURECOORDINATE0Y=40,a.OFFSETVECTOR=41}(),function(){function a(a,b,c){this._position=null,this._textureCoordinate0=null,this._time=NaN,this._position=a,this._textureCoordinate0=b,this._time=c}n(a,"laya.d3.graphics.VertexGlitter");var b=a.prototype;v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"textureCoordinate",function(){return this._textureCoordinate0}),o(0,b,"position",function(){return this._position}),o(0,b,"time",function(){return this._time}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(24,[new ga(0,"vector3",0),new ga(12,"vector2",2),new ga(20,"single",33)])}])}(),function(){function a(a,b,c,d,e,f,g,h,i,j){this._cornerTextureCoordinate=null,this._position=null,this._velocity=null,this._startColor=null,this._endColor=null,this._sizeRotation=null,this._radius=null,this._radian=null,this._ageAddScale=NaN,this._time=NaN,this._cornerTextureCoordinate=a,this._position=b,this._velocity=c,this._startColor=d,this._endColor=e,this._sizeRotation=f,this._radius=g,this._radian=h,this._ageAddScale=i,this._time=j}n(a,"laya.d3.graphics.VertexParticle");var b=a.prototype;v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"endColor",function(){return this._endColor}),o(0,b,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),o(0,b,"sizeRotation",function(){return this._sizeRotation}),o(0,b,"velocity",function(){return this._velocity}),o(0,b,"position",function(){return this._position}),o(0,b,"startColor",function(){return this._startColor}),o(0,b,"radius",function(){return this._radius}),o(0,b,"radian",function(){return this._radian}),o(0,b,"ageAddScale",function(){return this._ageAddScale}),o(0,b,"time",function(){return this._time}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(116,[new ga(0,"vector4",17),new ga(16,"vector3",0),new ga(28,"vector3",18),new ga(40,"vector4",19),new ga(56,"vector4",23),new ga(72,"vector3",27),new ga(84,"vector2",28),new ga(92,"vector4",29),new ga(108,"single",24),new ga(112,"single",33)])}])}(),function(){function a(a){this._position=null,this._position=a}n(a,"laya.d3.graphics.VertexPosition");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"position",function(){return this._position}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(12,[new ga(0,"vector3",0)])}]),a}()),ia=function(){function a(a,b){this._position=null,this._normal=null,this._position=a,this._normal=b}n(a,"laya.d3.graphics.VertexPositionNormal");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(24,[new ga(0,"vector3",0),new ga(12,"vector3",3)])}]),a}(),ja=function(){function a(a,b,c){this._position=null,this._normal=null,this._color=null,this._position=a,this._normal=b,this._color=c}n(a,"laya.d3.graphics.VertexPositionNormalColor");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"color",function(){return this._color}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(40,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector4",1)])}]),a}(),ka=function(){function a(a,b,c,d,e){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._position=a,this._normal=b,this._color=c,this._blendIndex=d,this._blendWeight=e}n(a,"laya.d3.graphics.VertexPositionNormalColorSkin");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"blendWeight",function(){return this._blendWeight}),o(0,b,"color",function(){return this._color}),o(0,b,"blendIndex",function(){return this._blendIndex}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(72,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector4",1),new ga(40,"vector4",7),new ga(56,"vector4",6)])}]),a}(),la=function(){function a(a,b,c,d,e,f){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=a,this._normal=b,this._color=c,this._tangent=d,this._blendIndex=e,this._blendWeight=f}n(a,"laya.d3.graphics.VertexPositionNormalColorSkinSTangent");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"tangent",function(){return this._tangent}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"blendWeight",function(){return this._blendWeight}),o(0,b,"color",function(){return this._color}),o(0,b,"blendIndex",function(){return this._blendIndex}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(88,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector4",1),new ga(40,"vector4",7),new ga(56,"vector4",6),new ga(72,"vector4",5)])}]),a}(),ma=function(){function a(a,b,c,d,e,f){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=a,this._normal=b,this._color=c,this._tangent=d,this._blendIndex=e,this._blendWeight=f}n(a,"laya.d3.graphics.VertexPositionNormalColorSkinTangent");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"tangent",function(){return this._tangent}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"blendWeight",function(){return this._blendWeight}),o(0,b,"color",function(){return this._color}),o(0,b,"blendIndex",function(){return this._blendIndex}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(84,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector4",1),new ga(40,"vector4",7),new ga(56,"vector4",6),new ga(72,"vector3",5)])}]),a}(),na=function(){function a(a,b,c,d){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=a,this._normal=b,this._color=c,this._tangent=d}n(a,"laya.d3.graphics.VertexPositionNormalColorSTangent");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"tangent",function(){return this._tangent}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"color",function(){return this._color}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(56,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector4",1),new ga(40,"vector4",5)])}]),a}(),oa=function(){function a(a,b,c,d){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=a,this._normal=b,this._color=c,this._tangent=d}n(a,"laya.d3.graphics.VertexPositionNormalColorTangent");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"tangent",function(){return this._tangent}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"color",function(){return this._color}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(52,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector4",1),new ga(40,"vector3",5)])}]),a}(),pa=function(){function a(a,b,c,d){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._position=a,this._normal=b,this._color=c,this._textureCoordinate=d}n(a,"laya.d3.graphics.VertexPositionNormalColorTexture");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"textureCoordinate",function(){return this._textureCoordinate}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"color",function(){return this._color}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(48,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector4",1),new ga(40,"vector2",2)])}]),a}(),qa=function(){function a(a,b,c,d,e){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=a,this._normal=b,this._color=c,this._textureCoordinate0=d,this._textureCoordinate1=e}n(a,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"color",function(){return this._color}),o(0,b,"textureCoordinate0",function(){return this._textureCoordinate0}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(0,b,"textureCoordinate1",function(){return this._textureCoordinate1}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(56,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector4",1),new ga(40,"vector2",2),new ga(48,"vector2",15)])}]),a}(),ra=function(){function a(a,b,c,d,e,f,g){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=a,this._normal=b,this._color=c,this._textureCoordinate0=d,this._textureCoordinate1=e,this._blendIndex=f,this._blendWeight=g}n(a,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Skin");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"blendWeight",function(){return this._blendWeight}),o(0,b,"color",function(){return this._color}),o(0,b,"textureCoordinate0",function(){return this._textureCoordinate0}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(0,b,"textureCoordinate1",function(){return this._textureCoordinate1}),o(0,b,"blendIndex",function(){return this._blendIndex}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(88,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector4",1),new ga(40,"vector2",2),new ga(48,"vector2",15),new ga(56,"vector4",7),new ga(72,"vector4",6)])}]),a}(),sa=function(){function a(a,b,c,d,e,f,g,h){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=a,this._normal=b,this._color=c,this._textureCoordinate0=d,this._textureCoordinate1=e,this._tangent=f,this._blendIndex=g,this._blendWeight=h}n(a,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinSTangent");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"tangent",function(){return this._tangent}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"blendWeight",function(){return this._blendWeight}),o(0,b,"color",function(){return this._color}),o(0,b,"textureCoordinate0",function(){return this._textureCoordinate0}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(0,b,"textureCoordinate1",function(){return this._textureCoordinate1}),o(0,b,"blendIndex",function(){return this._blendIndex}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(104,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector4",1),new ga(40,"vector2",2),new ga(48,"vector2",15),new ga(56,"vector4",7),new ga(72,"vector4",6),new ga(88,"vector4",5)])}]),a}(),ta=function(){function a(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}n(a,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinTangent");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),b.VertexPositionNormalColorTexture0SkinTangent=function(a,b,c,d,e,f,g,h){this._position=a,this._normal=b,this._color=c,this._textureCoordinate0=d,this._textureCoordinate1=e,this._tangent=f,this._blendIndex=g,this._blendWeight=h},o(0,b,"tangent",function(){return this._tangent}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"blendWeight",function(){return this._blendWeight}),o(0,b,"color",function(){return this._color}),o(0,b,"textureCoordinate0",function(){return this._textureCoordinate0}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(0,b,"textureCoordinate1",function(){return this._textureCoordinate1}),o(0,b,"blendIndex",function(){return this._blendIndex}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(100,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector4",1),new ga(40,"vector2",2),new ga(48,"vector2",15),new ga(56,"vector4",7),new ga(72,"vector4",6),new ga(88,"vector3",5)])}]),a}(),ua=function(){function a(a,b,c,d,e,f){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=a,this._normal=b,this._color=c,this._textureCoordinate0=d,this._textureCoordinate1=e,this._tangent=f}n(a,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1STangent");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"tangent",function(){return this._tangent}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"color",function(){return this._color}),o(0,b,"textureCoordinate0",function(){return this._textureCoordinate0}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(0,b,"textureCoordinate1",function(){return this._textureCoordinate1}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(72,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector4",1),new ga(40,"vector2",2),new ga(48,"vector2",15),new ga(56,"vector4",5)])}]),a}(),va=function(){function a(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}n(a,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Tangent");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),b.VertexPositionNormalColorTexture0Tangent=function(a,b,c,d,e,f){this._position=a,this._normal=b,this._color=c,this._textureCoordinate0=d,this._textureCoordinate1=e,this._tangent=f},o(0,b,"tangent",function(){return this._tangent}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"color",function(){return this._color}),o(0,b,"textureCoordinate0",function(){return this._textureCoordinate0}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(0,b,"textureCoordinate1",function(){return this._textureCoordinate1}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(68,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector4",1),new ga(40,"vector2",2),new ga(48,"vector2",15),new ga(56,"vector3",5)])}]),a}(),wa=function(){function a(a,b,c,d,e,f){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=a,this._normal=b,this._color=c,this._textureCoordinate=d,this._blendIndex=e,this._blendWeight=f}n(a,"laya.d3.graphics.VertexPositionNormalColorTextureSkin");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"textureCoordinate",function(){return this._textureCoordinate}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"blendWeight",function(){return this._blendWeight}),o(0,b,"color",function(){return this._color}),o(0,b,"blendIndex",function(){return this._blendIndex}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(80,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector4",1),new ga(40,"vector2",2),new ga(48,"vector4",7),new ga(64,"vector4",6)])}]),a}(),xa=function(){function a(a,b,c,d,e,f,g){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=a,this._normal=b,this._color=c,this._textureCoordinate=d,this._tangent=e,this._blendIndex=f,this._blendWeight=g}n(a,"laya.d3.graphics.VertexPositionNormalColorTextureSkinSTangent");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"tangent",function(){return this._tangent}),o(0,b,"textureCoordinate",function(){return this._textureCoordinate}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"blendWeight",function(){return this._blendWeight}),o(0,b,"color",function(){return this._color}),o(0,b,"blendIndex",function(){return this._blendIndex}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(96,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector4",1),new ga(40,"vector2",2),new ga(48,"vector4",7),new ga(64,"vector4",6),new ga(80,"vector4",5)])}]),a}(),ya=function(){function a(a,b,c,d,e,f,g){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=a,this._normal=b,this._color=c,this._textureCoordinate=d,this._tangent=e,this._blendIndex=f,this._blendWeight=g}n(a,"laya.d3.graphics.VertexPositionNormalColorTextureSkinTangent");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"tangent",function(){return this._tangent}),o(0,b,"textureCoordinate",function(){return this._textureCoordinate}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"blendWeight",function(){return this._blendWeight}),o(0,b,"color",function(){return this._color}),o(0,b,"blendIndex",function(){return this._blendIndex}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(92,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector4",1),new ga(40,"vector2",2),new ga(48,"vector4",7),new ga(64,"vector4",6),new ga(80,"vector3",5)])}]),a}(),za=function(){function a(a,b,c,d,e){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=a,this._normal=b,this._color=c,this._textureCoordinate=d,this._tangent=e}n(a,"laya.d3.graphics.VertexPositionNormalColorTextureSTangent");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"tangent",function(){return this._tangent}),o(0,b,"textureCoordinate",function(){return this._textureCoordinate}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"color",function(){return this._color}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(64,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector4",1),new ga(40,"vector2",2),new ga(48,"vector4",5)])}]),a}(),Aa=function(){function a(a,b,c,d,e){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=a,this._normal=b,this._color=c,this._textureCoordinate=d,this._tangent=e}n(a,"laya.d3.graphics.VertexPositionNormalColorTextureTangent");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"tangent",function(){return this._tangent}),o(0,b,"textureCoordinate",function(){return this._textureCoordinate}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"color",function(){return this._color}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(60,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector4",1),new ga(40,"vector2",2),new ga(48,"vector3",5)])}]),a}(),Ba=function(){function a(a,b,c){this._position=null,this._normal=null,this._tangent=null,this._position=a,this._normal=b,this._tangent=c}n(a,"laya.d3.graphics.VertexPositionNormalSTangent");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"tangent",function(){return this._tangent}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(40,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector4",5)])}]),a}(),Ca=function(){function a(a,b,c){this._position=null,this._normal=null,this._tangent=null,this._position=a,this._normal=b,this._tangent=c}n(a,"laya.d3.graphics.VertexPositionNormalTangent");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"tangent",function(){return this._tangent}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(36,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector3",5)])}]),a}(),Da=function(){function a(a,b,c){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=a,this._normal=b,this._textureCoordinate=c}n(a,"laya.d3.graphics.VertexPositionNormalTexture");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"textureCoordinate",function(){return this._textureCoordinate}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(32,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector2",2)])}]),a}(),Ea=function(){function a(a,b,c,d){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=a,this._normal=b,this._textureCoordinate0=c,this._textureCoordinate1=d}n(a,"laya.d3.graphics.VertexPositionNormalTexture0Texture1");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"textureCoordinate0",function(){return this._textureCoordinate0}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(0,b,"textureCoordinate1",function(){return this._textureCoordinate1}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(40,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector2",2),new ga(32,"vector2",15)])}]),a}(),Fa=function(){function a(a,b,c,d,e,f){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=a,this._normal=b,this._textureCoordinate0=c,this._textureCoordinate1=d,this._blendIndex=e,this._blendWeight=f}n(a,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Skin");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"textureCoordinate0",function(){return this._textureCoordinate0}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(0,b,"textureCoordinate1",function(){return this._textureCoordinate1}),o(0,b,"blendIndex",function(){return this._blendIndex}),o(0,b,"blendWeight",function(){return this._blendWeight}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(72,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector2",2),new ga(32,"vector2",15),new ga(40,"vector4",7),new ga(56,"vector4",6)])}]),a}(),Ga=function(){function a(a,b,c,d,e,f,g){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=a,this._normal=b,this._textureCoordinate0=c,this._textureCoordinate1=d,this._tangent=e,this._blendIndex=f,this._blendWeight=g}n(a,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinSTangent");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"tangent",function(){return this._tangent}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"textureCoordinate0",function(){return this._textureCoordinate0}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(0,b,"textureCoordinate1",function(){return this._textureCoordinate1}),o(0,b,"blendIndex",function(){return this._blendIndex}),o(0,b,"blendWeight",function(){return this._blendWeight}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(88,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector2",2),new ga(32,"vector2",15),new ga(40,"vector4",7),new ga(56,"vector4",6),new ga(72,"vector4",5)])}]),a}(),Ha=function(){function a(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}n(a,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinTangent");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),b.VertexPositionNormalTexture0SkinTangent=function(a,b,c,d,e,f,g){this._position=a,this._normal=b,this._textureCoordinate0=c,this._textureCoordinate1=d,this._tangent=e,this._blendIndex=f,this._blendWeight=g},o(0,b,"tangent",function(){return this._tangent}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"textureCoordinate0",function(){return this._textureCoordinate0}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(0,b,"textureCoordinate1",function(){return this._textureCoordinate1}),o(0,b,"blendIndex",function(){return this._blendIndex}),o(0,b,"blendWeight",function(){return this._blendWeight}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(84,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector2",2),new ga(32,"vector2",15),new ga(40,"vector4",7),new ga(56,"vector4",6),new ga(72,"vector3",5)])}]),a}(),Ia=function(){function a(a,b,c,d,e){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=a,this._normal=b,this._textureCoordinate0=c,this._textureCoordinate1=d,this._tangent=e}n(a,"laya.d3.graphics.VertexPositionNormalTexture0Texture1STangent");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"tangent",function(){return this._tangent}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"textureCoordinate0",function(){return this._textureCoordinate0}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(0,b,"textureCoordinate1",function(){return this._textureCoordinate1}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(56,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector2",2),new ga(32,"vector2",15),new ga(40,"vector4",5)])}]),a}(),Ja=function(){function a(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}n(a,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Tangent");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),b.VertexPositionNormalTexture0Tangent=function(a,b,c,d,e){this._position=a,this._normal=b,this._textureCoordinate0=c,this._textureCoordinate1=d,this._tangent=e},o(0,b,"tangent",function(){return this._tangent}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"textureCoordinate0",function(){return this._textureCoordinate0}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(0,b,"textureCoordinate1",function(){return this._textureCoordinate1}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(52,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector2",2),new ga(32,"vector2",15),new ga(40,"vector3",5)])}]),a}(),Ka=function(){function a(a,b,c,d,e){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=a,this._normal=b,this._textureCoordinate=c,this._blendIndex=d,this._blendWeight=e}n(a,"laya.d3.graphics.VertexPositionNormalTextureSkin");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"textureCoordinate",function(){return this._textureCoordinate}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"blendIndex",function(){return this._blendIndex}),o(0,b,"blendWeight",function(){return this._blendWeight}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(64,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector2",2),new ga(32,"vector4",7),new ga(48,"vector4",6)])}]),a}(),La=function(){function a(a,b,c,d,e,f){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=a,this._normal=b,this._textureCoordinate=c,this._tangent=d,this._blendIndex=e,this._blendWeight=f}n(a,"laya.d3.graphics.VertexPositionNormalTextureSkinSTangent");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"tangent",function(){return this._tangent}),o(0,b,"textureCoordinate",function(){return this._textureCoordinate}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"blendIndex",function(){return this._blendIndex}),o(0,b,"blendWeight",function(){return this._blendWeight}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(80,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector2",2),new ga(32,"vector4",7),new ga(48,"vector4",6),new ga(64,"vector4",5)])}]),a}(),Ma=function(){function a(a,b,c,d,e,f){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=a,this._normal=b,this._textureCoordinate=c,this._tangent=d,this._blendIndex=e,this._blendWeight=f}n(a,"laya.d3.graphics.VertexPositionNormalTextureSkinTangent");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"tangent",function(){return this._tangent}),o(0,b,"textureCoordinate",function(){return this._textureCoordinate}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"blendIndex",function(){return this._blendIndex}),o(0,b,"blendWeight",function(){return this._blendWeight}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(76,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector2",2),new ga(32,"vector4",7),new ga(48,"vector4",6),new ga(64,"vector3",5)])}]),a}(),Na=function(){function a(a,b,c,d){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=a,this._normal=b,this._textureCoordinate=c,this._tangent=d}n(a,"laya.d3.graphics.VertexPositionNormalTextureSTangent");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"tangent",function(){return this._tangent}),o(0,b,"textureCoordinate",function(){return this._textureCoordinate}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(48,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector2",2),new ga(32,"vector4",5)])}]),a}(),Oa=function(){function a(a,b,c,d){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=a,this._normal=b,this._textureCoordinate=c,this._tangent=d}n(a,"laya.d3.graphics.VertexPositionNormalTextureTangent");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"tangent",function(){return this._tangent}),o(0,b,"textureCoordinate",function(){return this._textureCoordinate}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(44,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector2",2),new ga(32,"vector3",5)])}]),a}(),Pa=function(){function a(a,b,c){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=a,this._normal=b,this._textureCoordinate=c}n(a,"laya.d3.graphics.VertexPositionNTBTexture");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"textureCoordinate",function(){return this._textureCoordinate}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(56,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector3",5),new ga(36,"vector3",4),new ga(48,"vector2",2)])}]),a}(),Qa=function(){function a(a,b,c,d,e,f,g,h){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this.binormal=null,this._position=a,this._normal=b,this._textureCoordinate0=d,this._textureCoordinate1=e,this._tangent=f,c=c,this._blendIndex=g,this._blendWeight=h}n(a,"laya.d3.graphics.VertexPositionNTBTexture0Texture1Skin");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"tangent",function(){return this._tangent}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"textureCoordinate0",function(){return this._textureCoordinate0}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(0,b,"textureCoordinate1",function(){return this._textureCoordinate1}),o(0,b,"blendIndex",function(){return this._blendIndex}),o(0,b,"blendWeight",function(){return this._blendWeight}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(96,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector3",5),new ga(36,"vector3",4),new ga(48,"vector2",2),new ga(56,"vector2",15),new ga(64,"vector4",7),new ga(80,"vector4",6)])}]),a}(),Ra=function(){function a(a,b,c){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=a,this._normal=b,this._textureCoordinate=c}n(a,"laya.d3.graphics.VertexPositionNTBTextureSkin");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"textureCoordinate",function(){return this._textureCoordinate}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(88,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector3",5),new ga(36,"vector3",4),new ga(48,"vector2",2),new ga(56,"vector4",7),new ga(72,"vector4",6)])}]),a}(),Sa=(function(){function a(a,b,c,d){this._position=null,this._normal=null,this._textureCoord0=null,this._textureCoord1=null,this._position=a,this._normal=b,this._textureCoord0=c,this._textureCoord1=d}n(a,"laya.d3.graphics.VertexPositionTerrain");var b=a.prototype;v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"normal",function(){return this._normal}),o(0,b,"position",function(){return this._position}),o(0,b,"textureCoord0",function(){return this._textureCoord0}),o(0,b,"textureCoord1",function(){return this._textureCoord1}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(40,[new ga(0,"vector3",0),new ga(12,"vector3",3),new ga(24,"vector2",2),new ga(32,"vector2",15)])}])}(),function(){function a(a,b){this._position=null,this._textureCoordinate0=null,this._position=a,this._textureCoordinate0=b}n(a,"laya.d3.graphics.VertexPositionTexture0");var b=a.prototype;return v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"position",function(){return this._position}),o(0,b,"textureCoordinate0",function(){return this._textureCoordinate0}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(20,[new ga(0,"vector3",0),new ga(12,"vector2",2)])}]),a}()),Ta=(function(){function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=a,this._positionStartLifeTime=b,this._velocity=c,this._startColor=d,this._startSize=e,this._startRotation0=f,this._startRotation1=g,this._startRotation2=h,this._startLifeTime=i,this._time=j,this._startSpeed=k,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=n}n(a,"laya.d3.graphics.VertexShurikenParticleBillboard");var b=a.prototype;v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),o(0,b,"random1",function(){return this._randoms1}),o(0,b,"startRotation2",function(){return this._startRotation2}),o(0,b,"positionStartLifeTime",function(){return this._positionStartLifeTime}),o(0,b,"velocity",function(){return this._velocity}),o(0,b,"random0",function(){return this._randoms0}),o(0,b,"startSize",function(){return this._startSize}),o(0,b,"startColor",function(){return this._startColor}),o(0,b,"startRotation0",function(){return this._startRotation0}),o(0,b,"startRotation1",function(){return this._startRotation1}),o(0,b,"startLifeTime",function(){return this._startLifeTime}),o(0,b,"time",function(){return this._time}),o(0,b,"startSpeed",function(){return this._startSpeed}),o(0,b,"simulationWorldPostion",function(){return this._simulationWorldPostion}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(152,[new ga(0,"vector4",17),new ga(16,"vector4",30),new ga(32,"vector4",32),new ga(48,"vector4",19),new ga(64,"vector3",20),new ga(76,"vector3",22),new ga(88,"single",31),new ga(92,"vector4",34),new ga(108,"vector4",35),new ga(124,"vector3",36),new ga(136,"vector4",37)])}])}(),function(){function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=a,this._positionStartLifeTime=b,this._velocity=c,this._startColor=d,this._startSize=e,this._startRotation0=f,this._startRotation1=g,this._startRotation2=h,this._startLifeTime=i,this._time=j,this._startSpeed=k,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=n}n(a,"laya.d3.graphics.VertexShurikenParticleMesh");var b=a.prototype;v.imps(b,{"laya.d3.graphics.IVertex":!0}),o(0,b,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),o(0,b,"velocity",function(){return this._velocity}),o(0,b,"position",function(){return this._positionStartLifeTime}),o(0,b,"random0",function(){return this._randoms0}),o(0,b,"startSize",function(){return this._startSize}),o(0,b,"startColor",function(){return this._startColor}),o(0,b,"startRotation0",function(){return this._startRotation0}),o(0,b,"startRotation1",function(){return this._startRotation1}),o(0,b,"random1",function(){return this._randoms1}),o(0,b,"startRotation2",function(){return this._startRotation2}),o(0,b,"startLifeTime",function(){return this._startLifeTime}),o(0,b,"time",function(){return this._time}),o(0,b,"startSpeed",function(){return this._startSpeed}),o(0,b,"simulationWorldPostion",function(){return this._simulationWorldPostion}),o(0,b,"vertexDeclaration",function(){return a._vertexDeclaration}),o(1,a,"vertexDeclaration",function(){return a._vertexDeclaration}),l(a,["_vertexDeclaration",function(){return this._vertexDeclaration=new fa(172,[new ga(0,"vector3",0),new ga(12,"vector4",1),new ga(28,"vector2",2),new ga(36,"vector4",30),new ga(52,"vector4",32),new ga(68,"vector4",19),new ga(84,"vector3",20),new ga(96,"vector3",22),new ga(108,"single",31),new ga(112,"vector4",34),new ga(128,"vector4",35),new ga(144,"vector3",36),new ga(156,"vector4",37)])}])}(),function(){function t(a,b,c,d,e,f){this._version=null,this._strings=["BLOCK","DATA","STRINGS"],this._materials=null,this._subMeshes=null,this._materialMap=null,this._readData=null,this._mesh=null,this._BLOCK={count:0},this._DATA={offset:0,size:0},this._STRINGS={offset:0,size:0},this._shaderAttributes=null,this._mesh=c,this._materials=d,this._subMeshes=e,this._materialMap=f,this._version=b,this._onLoaded(a)}n(t,"laya.d3.loaders.LoadModelV01");var a=t.prototype;return a._onLoaded=function(a){this._readData=a,this.READ_BLOCK();for(var b=0;b<this._BLOCK.count;b++){var c=this._readData.getUint16(),d=this._strings[c],e=this["READ_"+d];if(null==e)throw new Error("model file err,no this function:"+c+" "+d);if(!e.call(this))break}return this._mesh},a.onError=function(){},a._readString=function(){return this._strings[this._readData.getUint16()]},a.READ_BLOCK=function(){this._readData.getUint16();return this._BLOCK.count=this._readData.getUint16(),!0},a.READ_DATA=function(){return this._DATA.offset=this._readData.getUint32(),this._DATA.size=this._readData.getUint32(),!0},a.READ_STRINGS=function(){this._STRINGS.offset=this._readData.getUint16(),this._STRINGS.size=this._readData.getUint16();var a=this._readData.pos;this._readData.pos=this._STRINGS.offset+this._DATA.offset;for(var b=0;b<this._STRINGS.size;b++)this._strings[b]=this._readData.readUTFString();return this._readData.pos=a,!0},a.READ_MATERIAL=function(){var a=this._readData.getUint16(),b=(this._readString(),this._readString());return this._materials[a]="null"!==b?r.getRes(this._materialMap[b]):new Cb,!0},a.READ_MESH=function(){this._readString();switch(this._version){case"LAYAMODEL:01":console.log("Warning: The (.lm) file is converted by old fbxTools,please reConverted it use  lastest fbxTools version,later we will remove the  support of old version (.lm) support.");break;case"LAYASKINANI:01":case"LAYAMODEL:02":var a,b=this._readData.__getBuffer(),c=0,d=this._readData.getUint32(),e=this._readData.getUint32(),f=(new Float32Array(b.slice(d+this._DATA.offset,d+this._DATA.offset+e)),this._readData.getUint32()),g=this._readData.getUint32(),h=new Float32Array(b.slice(f+this._DATA.offset,f+this._DATA.offset+g));for(this.mesh._inverseBindPoses=[],c=0,a=h.length;c<a;c+=16){var i=new ab(h[c+0],h[c+1],h[c+2],h[c+3],h[c+4],h[c+5],h[c+6],h[c+7],h[c+8],h[c+9],h[c+10],h[c+11],h[c+12],h[c+13],h[c+14],h[c+15]);this.mesh._inverseBindPoses.push(i)}break;default:throw new Error("LoadModel:unknown version.")}return!0},a.READ_SUBMESH=function(){this._readString(),this._readData.getUint8();var a=this._readString();this._shaderAttributes=a.match(t._attrReg);var b=this._readData.getUint32(),c=this._readData.getUint32(),d=(this._readData.getUint32(),this._readData.getUint32(),this._readData.getUint32()),e=this._readData.getUint32(),f=this._readData.getUint32(),g=this._readData.getUint32(),h=this._readData.__getBuffer(),i=new jb(this._mesh),j=this._getVertexDeclaration(),k=Mb.create(j,e/j.vertexStride,35044,!0),l=d+this._DATA.offset,m=h.slice(l,l+e);k.setData(new Float32Array(m));for(var n=(i._vertexBuffer=k).vertexDeclaration.getVertexElements(),o=0;o<n.length;o++)i._bufferUsage[n[o].elementUsage]=k;var p=Lb.create("ushort",c/2,35044,!0),q=b+this._DATA.offset,r=h.slice(q,q+c);p.setData(new Uint16Array(r)),i._indexBuffer=p;var s=h.slice(f+this._DATA.offset,f+this._DATA.offset+g);return i._boneIndicesList[0]=new Uint8Array(s),this._subMeshes.push(i),!0},a.READ_DATAAREA=function(){return!1},a._getVertexDeclaration=function(){for(var a,b=!1,c=!1,d=!1,e=!1,f=!1,g=!1,h=!1,i=!1,j=!1,k=0;k<this._shaderAttributes.length;k+=8)switch(this._shaderAttributes[k]){case"POSITION":b=!0;break;case"NORMAL":c=!0;break;case"COLOR":d=!0;break;case"UV":e=!0;break;case"UV1":f=!0;break;case"BLENDWEIGHT":h=!0;break;case"BLENDINDICES":i=!0;break;case"TANGENT":g=!0;break;case"BINORMAL":j=!0}return b&&c&&d&&e&&f&&h&&i&&g?a=ta.vertexDeclaration:b&&c&&d&&e&&f&&h&&i?a=ra.vertexDeclaration:b&&c&&e&&f&&h&&i&&g?a=Ha.vertexDeclaration:b&&c&&e&&f&&h&&i?a=Fa.vertexDeclaration:b&&c&&d&&e&&h&&i&&g?a=ya.vertexDeclaration:b&&c&&d&&e&&h&&i?a=wa.vertexDeclaration:b&&c&&g&&j&&e&&h&&i?a=Ra.vertexDeclaration:b&&c&&e&&h&&i&&g?a=Ma.vertexDeclaration:b&&c&&e&&h&&i?a=Ka.vertexDeclaration:b&&c&&d&&h&&i&&g?a=ma.vertexDeclaration:b&&c&&d&&h&&i?a=ka.vertexDeclaration:b&&c&&d&&e&&f&&g?a=va.vertexDeclaration:b&&c&&d&&e&&f?a=qa.vertexDeclaration:b&&c&&e&&f&&g?a=Ja.vertexDeclaration:b&&c&&e&&f?a=Ea.vertexDeclaration:b&&c&&d&&e&&g?a=Aa.vertexDeclaration:b&&c&&e&&g&&j?a=Pa.vertexDeclaration:b&&c&&d&&e?a=pa.vertexDeclaration:b&&c&&e&&g?a=Oa.vertexDeclaration:b&&c&&e?a=Da.vertexDeclaration:b&&c&&d&&g?a=oa.vertexDeclaration:b&&c&&d&&(a=ja.vertexDeclaration),a},o(0,a,"mesh",function(){return this._mesh}),t._attrReg=new RegExp("(\\w+)|([:,;])","g"),t}()),Ua=function(){function x(){}return n(x,"laya.d3.loaders.LoadModelV02"),x.parse=function(a,b,c,d,e,f){x._mesh=c,x._materials=d,x._subMeshes=e,x._materialMap=f,x._version=b,x._readData=a,x.READ_DATA(),x.READ_BLOCK(),x.READ_STRINGS();for(var g=0,h=x._BLOCK.count;g<h;g++){x._readData.pos=x._BLOCK.blockStarts[g];var i=x._readData.getUint16(),j=x._strings[i],k=x["READ_"+j];if(null==k)throw new Error("model file err,no this function:"+i+" "+j);k.call()}x._strings.length=0,x._readData=null,x._version=null,x._mesh=null,x._materials=null,x._subMeshes=null,x._materialMap=null},x._readString=function(){return x._strings[x._readData.getUint16()]},x.READ_DATA=function(){x._DATA.offset=x._readData.getUint32(),x._DATA.size=x._readData.getUint32()},x.READ_BLOCK=function(){for(var a=x._BLOCK.count=x._readData.getUint16(),b=x._BLOCK.blockStarts=[],c=x._BLOCK.blockLengths=[],d=0;d<a;d++)b.push(x._readData.getUint32()),c.push(x._readData.getUint32())},x.READ_STRINGS=function(){var a=x._readData.getUint32(),b=x._readData.getUint16(),c=x._readData.pos;x._readData.pos=a+x._DATA.offset;for(var d=0;d<b;d++)x._strings[d]=x._readData.readUTFString();x._readData.pos=c},x.READ_MATERIAL=function(){x._readString(),x._readString();var a=x._readString();return""!==a&&x._materials.push(r.getRes(x._materialMap[a])),!0},x.READ_MESH=function(){x._readString();var a,b=x._readData.__getBuffer(),c=0,d=x._readData.getInt16(),e=x._DATA.offset;for(c=0;c<d;c++){var f=e+x._readData.getUint32(),g=x._readData.getUint32(),h=new Float32Array(b.slice(f,f+g)),i=x._readString().match(x._attrReg),j=x._getVertexDeclaration(i),k=Mb.create(j,4*h.length/j.vertexStride,35044,!0);k.setData(h),x._mesh._vertexBuffers.push(k)}var l=e+x._readData.getUint32(),m=x._readData.getUint32(),n=new Uint16Array(b.slice(l,l+m)),o=Lb.create("ushort",m/2,35044,!0);o.setData(n),x._mesh._indexBuffer=o;var p=x._mesh._boneNames=[],q=x._readData.getUint16();for(p.length=q,c=0;c<q;c++)p[c]=x._strings[x._readData.getUint16()];var r=x._readData.getUint32(),s=x._readData.getUint32(),t=(new Float32Array(b.slice(e+r,e+r+s)),x._readData.getUint32()),u=x._readData.getUint32(),v=new Float32Array(b.slice(e+t,e+t+u));for(x._mesh._inverseBindPoses=[],c=0,a=v.length;c<a;c+=16){var w=new ab(v[c+0],v[c+1],v[c+2],v[c+3],v[c+4],v[c+5],v[c+6],v[c+7],v[c+8],v[c+9],v[c+10],v[c+11],v[c+12],v[c+13],v[c+14],v[c+15]);x._mesh._inverseBindPoses.push(w)}return x._mesh._skinnedDatas=new Float32Array(16*v.length),!0},x.READ_SUBMESH=function(){var a=x._readData.__getBuffer(),b=new jb(x._mesh),c=x._readData.getInt16(),d=x._readData.getUint32(),e=x._readData.getUint32();b._vertexBuffer=x._mesh._vertexBuffers[c],b._vertexStart=d,b._vertexCount=e;var f=x._readData.getUint32(),g=x._readData.getUint32(),h=x._mesh._indexBuffer;b._indexBuffer=h,b._indexStart=f,b._indexCount=g,b._indices=new Uint16Array(h.getData().buffer,2*f,g);var i=x._DATA.offset,j=b._subIndexBufferStart,k=b._subIndexBufferCount,l=b._boneIndicesList,m=x._readData.getUint16();j.length=m,k.length=m,l.length=m;for(var n=0;n<m;n++){j[n]=x._readData.getUint32(),k[n]=x._readData.getUint32();var o=x._readData.getUint32(),p=x._readData.getUint32();b._boneIndicesList[n]=new Uint8Array(a.slice(i+o,i+o+p))}return x._subMeshes.push(b),!0},x._getVertexDeclaration=function(a){for(var b,c=!1,d=!1,e=!1,f=!1,g=!1,h=!1,i=!1,j=!1,k=!1,l=0;l<a.length;l++)switch(a[l]){case"POSITION":c=!0;break;case"NORMAL":d=!0;break;case"COLOR":e=!0;break;case"UV":f=!0;break;case"UV1":g=!0;break;case"BLENDWEIGHT":i=!0;break;case"BLENDINDICES":j=!0;break;case"TANGENT":h=!0;break;case"BINORMAL":k=!0}return c&&d&&e&&f&&g&&i&&j&&h?b=ta.vertexDeclaration:c&&d&&e&&f&&g&&i&&j?b=ra.vertexDeclaration:c&&d&&f&&g&&i&&j&&h?b=Ha.vertexDeclaration:c&&d&&f&&g&&i&&j?b=Fa.vertexDeclaration:c&&d&&e&&f&&i&&j&&h?b=ya.vertexDeclaration:c&&d&&e&&f&&i&&j?b=wa.vertexDeclaration:c&&d&&f&&i&&j&&h?b=Ma.vertexDeclaration:c&&d&&f&&i&&j?b=Ka.vertexDeclaration:c&&d&&e&&i&&j&&h?b=ma.vertexDeclaration:c&&d&&e&&i&&j?b=ka.vertexDeclaration:c&&d&&e&&f&&g&&h?b=va.vertexDeclaration:c&&d&&e&&f&&g?b=qa.vertexDeclaration:c&&d&&f&&g&&h?b=Ja.vertexDeclaration:c&&d&&f&&g?b=Ea.vertexDeclaration:c&&d&&e&&f&&h?b=Aa.vertexDeclaration:c&&d&&f&&h&&k?b=Pa.vertexDeclaration:c&&d&&e&&f?b=pa.vertexDeclaration:c&&d&&f&&h?b=Oa.vertexDeclaration:c&&d&&f?b=Da.vertexDeclaration:c&&d&&e&&h?b=oa.vertexDeclaration:c&&d&&e&&(b=ja.vertexDeclaration),b},x._attrReg=new RegExp("(\\w+)|([:,;])","g"),x._strings=[],x._readData=null,x._version=null,x._mesh=null,x._materials=null,x._subMeshes=null,x._materialMap=null,l(x,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),x}(),Va=function(){function w(){}return n(w,"laya.d3.loaders.LoadModelV03"),w.parse=function(a,b,c,d,e){w._mesh=c,w._subMeshes=d,w._materialMap=e,w._version=b,w._readData=a,w.READ_DATA(),w.READ_BLOCK(),w.READ_STRINGS();for(var f=0,g=w._BLOCK.count;f<g;f++){w._readData.pos=w._BLOCK.blockStarts[f];var h=w._readData.getUint16(),i=w._strings[h],j=w["READ_"+i];if(null==j)throw new Error("model file err,no this function:"+h+" "+i);j.call()}w._strings.length=0,w._readData=null,w._version=null,w._mesh=null,w._subMeshes=null,w._materialMap=null},w._readString=function(){return w._strings[w._readData.getUint16()]},w.READ_DATA=function(){w._DATA.offset=w._readData.getUint32(),w._DATA.size=w._readData.getUint32()},w.READ_BLOCK=function(){for(var a=w._BLOCK.count=w._readData.getUint16(),b=w._BLOCK.blockStarts=[],c=w._BLOCK.blockLengths=[],d=0;d<a;d++)b.push(w._readData.getUint32()),c.push(w._readData.getUint32())},w.READ_STRINGS=function(){var a=w._readData.getUint32(),b=w._readData.getUint16(),c=w._readData.pos;w._readData.pos=a+w._DATA.offset;for(var d=0;d<b;d++)w._strings[d]=w._readData.readUTFString();w._readData.pos=c},w.READ_MESH=function(){var a,b=w._readString(),c=w._readData.__getBuffer(),d=0,e=w._readData.getInt16(),f=w._DATA.offset;for(d=0;d<e;d++){var g,h=f+w._readData.getUint32(),i=w._readData.getUint32(),j=new Float32Array(c.slice(h,h+i)),k=w._readString();switch(w._version){case"LAYAMODEL:03":g=w._vertexDeclarationMap_Discard[k];break;case"LAYAMODEL:0301":g=w._vertexDeclarationMap[k];break;default:throw new Error("LoadModelV03: unknown version.")}if(!g)throw new Error("LoadModelV03: unknown vertexDeclaration.  version="+w._version+"  bufferAttribute="+k+"  name="+b+"  url="+(w._mesh?w._mesh.url:"null"));var l=Mb.create(g,4*j.length/g.vertexStride,35044,!0,w._mesh._url+"_"+d);l.setData(j),w._mesh._vertexBuffers.push(l)}var m=f+w._readData.getUint32(),n=w._readData.getUint32(),o=new Uint16Array(c.slice(m,m+n)),p=Lb.create("ushort",n/2,35044,!0,w._mesh._url);p.setData(o),w._mesh._indexBuffer=p;var q=w._mesh._boneNames=[],r=w._readData.getUint16();for(q.length=r,d=0;d<r;d++)q[d]=w._strings[w._readData.getUint16()];w._readData.pos+=8;var s=w._readData.getUint32(),t=w._readData.getUint32(),u=new Float32Array(c.slice(f+s,f+s+t));for(w._mesh._inverseBindPoses=[],d=0,a=u.length;d<a;d+=16){var v=new ab(u[d+0],u[d+1],u[d+2],u[d+3],u[d+4],u[d+5],u[d+6],u[d+7],u[d+8],u[d+9],u[d+10],u[d+11],u[d+12],u[d+13],u[d+14],u[d+15]);w._mesh._inverseBindPoses.push(v)}return w._mesh._skinnedDatas=new Float32Array(16*u.length),!0},w.READ_SUBMESH=function(){var a=w._readData.__getBuffer(),b=new jb(w._mesh),c=w._readData.getInt16(),d=w._readData.getUint32(),e=w._readData.getUint32();b._vertexBuffer=w._mesh._vertexBuffers[c],b._vertexStart=d,b._vertexCount=e;var f=w._readData.getUint32(),g=w._readData.getUint32(),h=w._mesh._indexBuffer;b._indexBuffer=h,b._indexStart=f,b._indexCount=g,b._indices=new Uint16Array(h.getData().buffer,2*f,g);var i=w._DATA.offset,j=b._subIndexBufferStart,k=b._subIndexBufferCount,l=b._boneIndicesList,m=w._readData.getUint16();j.length=m,k.length=m,l.length=m;for(var n=0;n<m;n++){j[n]=w._readData.getUint32(),k[n]=w._readData.getUint32();var o=w._readData.getUint32(),p=w._readData.getUint32();l[n]=new Uint8Array(a.slice(i+o,i+o+p))}return w._subMeshes.push(b),!0},w._strings=[],w._readData=null,w._version=null,w._mesh=null,w._subMeshes=null,w._materialMap=null,l(w,["_vertexDeclarationMap_Discard",function(){return this._vertexDeclarationMap_Discard={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":ta.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":ra.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":Qa.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":Ha.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":Fa.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":ya.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":wa.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":Ma.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":Ka.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":ma.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":ka.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":va.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":qa.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":Ja.vertexDeclaration,"POSITION,NORMAL,UV,UV1":Ea.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":Aa.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":Pa.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":pa.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":Oa.vertexDeclaration,"POSITION,NORMAL,UV":Da.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":oa.vertexDeclaration,"POSITION,NORMAL,COLOR":ja.vertexDeclaration,"POSITION,NORMAL,TANGENT":Ca.vertexDeclaration,"POSITION,NORMAL":ia.vertexDeclaration,"POSITION,UV":Sa.vertexDeclaration,POSITION:ha.vertexDeclaration}},"_vertexDeclarationMap",function(){return this._vertexDeclarationMap={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":sa.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":ra.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":Qa.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":Ga.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":Fa.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":xa.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":wa.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":La.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":Ka.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":la.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":ka.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":ua.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":qa.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":Ia.vertexDeclaration,"POSITION,NORMAL,UV,UV1":Ea.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":za.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":Pa.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":pa.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":Na.vertexDeclaration,"POSITION,NORMAL,UV":Da.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":na.vertexDeclaration,"POSITION,NORMAL,COLOR":ja.vertexDeclaration,"POSITION,NORMAL,TANGENT":Ba.vertexDeclaration,"POSITION,NORMAL":ia.vertexDeclaration,"POSITION,UV":Sa.vertexDeclaration,POSITION:ha.vertexDeclaration}},"_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),w}(),Wa=function(){function h(){}return n(h,"laya.d3.loaders.MeshReader"),h.read=function(a,b,c,d,e){var f=new w(a);f.pos=0;var g=f.readUTFString();switch(g){case"LAYAMODEL:01":case"LAYASKINANI:01":h._readVersion01(f,g,b,c,d,e);break;case"LAYAMODEL:02":Ua.parse(f,g,b,c,d,e);break;case"LAYAMODEL:03":case"LAYAMODEL:0301":Va.parse(f,g,b,d,e);break;default:throw new Error("MeshReader: unknown mesh version.")}b._setSubMeshes(d)},h._readVersion01=function(a,b,c,d,e,f){new Ta(a,b,c,d,e,f)},h}(),Xa=function(){function a(a,b){this.min=null,this.max=null,this.min=a,this.max=b}n(a,"laya.d3.math.BoundBox");var b=a.prototype;return v.imps(b,{"laya.d3.core.IClone":!0}),b.getCorners=function(a){a.length=8;var b=this.min.elements,c=this.max.elements,d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2];a[0]=new gb(d,h,i),a[1]=new gb(g,h,i),a[2]=new gb(g,e,i),a[3]=new gb(d,e,i),a[4]=new gb(d,h,f),a[5]=new gb(g,h,f),a[6]=new gb(g,e,f),a[7]=new gb(d,e,f)},b.toDefault=function(){this.min.toDefault(),this.max.toDefault()},b.cloneTo=function(a){var b=a;this.min.cloneTo(b.min),this.max.cloneTo(b.max)},b.clone=function(){var a=new this.constructor(new gb,new gb);return this.cloneTo(a),a},a.createfromPoints=function(a,b){if(null==a)throw new Error("points");var c=b.min,d=b.max,e=c.elements;e[0]=Number.MAX_VALUE,e[1]=Number.MAX_VALUE,e[2]=Number.MAX_VALUE;var f=d.elements;f[0]=-Number.MAX_VALUE,f[1]=-Number.MAX_VALUE,f[2]=-Number.MAX_VALUE;for(var g=0,h=a.length;g<h;++g)gb.min(c,a[g],c),gb.max(d,a[g],d)},a.merge=function(a,b,c){gb.min(a.min,b.min,c.min),gb.max(a.max,b.max,c.max)},a}(),Ya=function(){function j(a){this._matrix=null,this._near=null,this._far=null,this._left=null,this._right=null,this._top=null,this._bottom=null,this._matrix=a,this._near=new bb(new gb),this._far=new bb(new gb),this._left=new bb(new gb),this._right=new bb(new gb),this._top=new bb(new gb),this._bottom=new bb(new gb),j._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}n(j,"laya.d3.math.BoundFrustum");var a=j.prototype;return a.equalsBoundFrustum=function(a){return this._matrix.equalsOtherMatrix(a.matrix)},a.equalsObj=function(a){if(a instanceof laya.d3.math.BoundFrustum){var b=a;return this.equalsBoundFrustum(b)}return!1},a.getPlane=function(a){switch(a){case 0:return this._near;case 1:return this._far;case 2:return this._left;case 3:return this._right;case 4:return this._top;case 5:return this._bottom;default:return null}},a.getCorners=function(a){j._get3PlaneInterPoint(this._near,this._bottom,this._right).cloneTo(a[0]),j._get3PlaneInterPoint(this._near,this._top,this._right).cloneTo(a[1]),j._get3PlaneInterPoint(this._near,this._top,this._left).cloneTo(a[2]),j._get3PlaneInterPoint(this._near,this._bottom,this._left).cloneTo(a[3]),j._get3PlaneInterPoint(this._far,this._bottom,this._right).cloneTo(a[4]),j._get3PlaneInterPoint(this._far,this._top,this._right).cloneTo(a[5]),j._get3PlaneInterPoint(this._far,this._top,this._left).cloneTo(a[6]),j._get3PlaneInterPoint(this._far,this._bottom,this._left).cloneTo(a[7])},a.containsPoint=function(a){for(var b=bb.PlaneIntersectionType_Front,c=bb.PlaneIntersectionType_Front,d=0;d<6;d++){switch(d){case 0:c=Collision.intersectsPlaneAndPoint(this._near,a);break;case 1:c=Collision.intersectsPlaneAndPoint(this._far,a);break;case 2:c=Collision.intersectsPlaneAndPoint(this._left,a);break;case 3:c=Collision.intersectsPlaneAndPoint(this._right,a);break;case 4:c=Collision.intersectsPlaneAndPoint(this._top,a);break;case 5:c=Collision.intersectsPlaneAndPoint(this._bottom,a)}switch(c){case bb.PlaneIntersectionType_Back:return 0;case bb.PlaneIntersectionType_Intersecting:b=bb.PlaneIntersectionType_Intersecting}}switch(b){case bb.PlaneIntersectionType_Intersecting:return 2;default:return 1}},a.containsBoundBox=function(a){for(var b,c=j._tempV30,d=j._tempV31,e=1,f=0;f<6;f++){if(b=this.getPlane(f),this._getBoxToPlanePVertexNVertex(a,b.normal,c,d),Collision.intersectsPlaneAndPoint(b,c)===bb.PlaneIntersectionType_Back)return 0;Collision.intersectsPlaneAndPoint(b,d)===bb.PlaneIntersectionType_Back&&(e=2)}return e},a.containsBoundSphere=function(a){for(var b=bb.PlaneIntersectionType_Front,c=bb.PlaneIntersectionType_Front,d=0;d<6;d++){switch(d){case 0:c=Collision.intersectsPlaneAndSphere(this._near,a);break;case 1:c=Collision.intersectsPlaneAndSphere(this._far,a);break;case 2:c=Collision.intersectsPlaneAndSphere(this._left,a);break;case 3:c=Collision.intersectsPlaneAndSphere(this._right,a);break;case 4:c=Collision.intersectsPlaneAndSphere(this._top,a);break;case 5:c=Collision.intersectsPlaneAndSphere(this._bottom,a)}switch(c){case bb.PlaneIntersectionType_Back:return 0;case bb.PlaneIntersectionType_Intersecting:b=bb.PlaneIntersectionType_Intersecting}}switch(b){case bb.PlaneIntersectionType_Intersecting:return 2;default:return 1}},a._getBoxToPlanePVertexNVertex=function(a,b,c,d){var e=a.min,f=e.elements,g=a.max,h=g.elements,i=b.elements,j=i[0],k=i[1],l=i[2];e.cloneTo(c);var m=c.elements;0<=j&&(m[0]=h[0]),0<=k&&(m[1]=h[1]),0<=l&&(m[2]=h[2]),g.cloneTo(d);var n=d.elements;0<=j&&(n[0]=f[0]),0<=k&&(n[1]=f[1]),0<=l&&(n[2]=f[2])},o(0,a,"top",function(){return this._top}),o(0,a,"matrix",function(){return this._matrix},function(a){this._matrix=a,j._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}),o(0,a,"near",function(){return this._near}),o(0,a,"far",function(){return this._far}),o(0,a,"left",function(){return this._left}),o(0,a,"right",function(){return this._right}),o(0,a,"bottom",function(){return this._bottom}),j._getPlanesFromMatrix=function(a,b,c,d,e,f,g){var h=a.elements,i=h[0],j=h[1],k=h[2],l=h[3],m=h[4],n=h[5],o=h[6],p=h[7],q=h[8],r=h[9],s=h[10],t=h[11],u=h[12],v=h[13],w=h[14],x=h[15],y=b.normal.elements;y[0]=l+k,y[1]=p+o,y[2]=t+s,b.distance=x+w,b.normalize();var z=c.normal.elements;z[0]=l-k,z[1]=p-o,z[2]=t-s,c.distance=x-w,c.normalize();var A=d.normal.elements;A[0]=l+i,A[1]=p+m,A[2]=t+q,d.distance=x+u,d.normalize();var B=e.normal.elements;B[0]=l-i,B[1]=p-m,B[2]=t-q,e.distance=x-u,e.normalize();var C=f.normal.elements;C[0]=l-j,C[1]=p-n,C[2]=t-r,f.distance=x-v,f.normalize();var D=g.normal.elements;D[0]=l+j,D[1]=p+n,D[2]=t+r,g.distance=x+v,g.normalize()},j._get3PlaneInterPoint=function(a,b,c){var d=a.normal,e=b.normal,f=c.normal;gb.cross(e,f,j._tempV30),gb.cross(f,d,j._tempV31),gb.cross(d,e,j._tempV32);var g=gb.dot(d,j._tempV30),h=gb.dot(e,j._tempV31),i=gb.dot(f,j._tempV32);return gb.scale(j._tempV30,-a.distance/g,j._tempV33),gb.scale(j._tempV31,-b.distance/h,j._tempV34),gb.scale(j._tempV32,-c.distance/i,j._tempV35),gb.add(j._tempV33,j._tempV34,j._tempV36),gb.add(j._tempV35,j._tempV36,j._tempV37),j._tempV37},l(j,["_tempV30",function(){return this._tempV30=new gb},"_tempV31",function(){return this._tempV31=new gb},"_tempV32",function(){return this._tempV32=new gb},"_tempV33",function(){return this._tempV33=new gb},"_tempV34",function(){return this._tempV34=new gb},"_tempV35",function(){return this._tempV35=new gb},"_tempV36",function(){return this._tempV36=new gb},"_tempV37",function(){return this._tempV37=new gb}]),j}(),Za=function(){function k(a,b){this.center=null,this.radius=NaN,this.center=a,this.radius=b}n(k,"laya.d3.math.BoundSphere");var a=k.prototype;return v.imps(a,{"laya.d3.core.IClone":!0}),a.toDefault=function(){this.center.toDefault(),this.radius=0},a.intersectsRayDistance=function(a){return Collision.intersectsRayAndSphereRD(a,this)},a.intersectsRayPoint=function(a,b){return Collision.intersectsRayAndSphereRP(a,this,b)},a.cloneTo=function(a){var b=a;this.center.cloneTo(b.center),b.radius=this.radius},a.clone=function(){var a=new this.constructor(new gb,new gb);return this.cloneTo(a),a},k.createFromSubPoints=function(a,b,c,d){if(null==a)throw new Error("points");if(b<0||b>=a.length)throw new Error("start"+b+"Must be in the range [0, "+(a.length-1)+"]");if(c<0||b+c>a.length)throw new Error("count"+c+"Must be in the range <= "+a.length+"}");var e=b+c,f=k._tempVector3;f.elements[0]=0,f.elements[1]=0,f.elements[2]=0;for(var g=b;g<e;++g)gb.add(a[g],f,f);var h=d.center;gb.scale(f,1/c,h);var i=0;for(g=b;g<e;++g){var j=gb.distanceSquared(h,a[g]);i<j&&(i=j)}d.radius=Math.sqrt(i)},k.createfromPoints=function(a,b){if(null==a)throw new Error("points");k.createFromSubPoints(a,0,a.length,b)},l(k,["_tempVector3",function(){return this._tempVector3=new gb}]),k}(),$a=(function(){function a(){}n(a,"laya.d3.math.ContainmentType"),a.Disjoint=0,a.Contains=1,a.Intersects=2}(),function(){function c(){}return n(c,"laya.d3.math.MathUtils3D"),c.isZero=function(a){return Math.abs(a)<c.zeroTolerance},c.nearEqual=function(a,b){return!!c.isZero(a-b)},c.fastInvSqrt=function(a){return c.isZero(a)?a:1/Math.sqrt(a)},l(c,["zeroTolerance",function(){return this.zeroTolerance=1e-6},"MaxValue",function(){return this.MaxValue=340282347e30},"MinValue",function(){return this.MinValue=-340282347e30}]),c}()),_a=function(){function i(){var a=this.elements=new Float32Array(9);a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1}n(i,"laya.d3.math.Matrix3x3");var a=i.prototype;return v.imps(a,{"laya.d3.core.IClone":!0}),a.determinant=function(){var a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*(j*f-g*i)+c*(-j*e+g*h)+d*(i*e-f*h)},a.translate=function(a,b){var c=b.elements,d=this.elements,e=a.elements,f=d[0],g=d[1],h=d[2],i=d[3],j=d[4],k=d[5],l=d[6],m=d[7],n=d[8],o=e[0],p=e[1];c[0]=f,c[1]=g,c[2]=h,c[3]=i,c[4]=j,c[5]=k,c[6]=o*f+p*i+l,c[7]=o*g+p*j+m,c[8]=o*h+p*k+n},a.rotate=function(a,b){var c=b.elements,d=this.elements,e=d[0],f=d[1],g=d[2],h=d[3],i=d[4],j=d[5],k=d[6],l=d[7],m=d[8],n=Math.sin(a),o=Math.cos(a);c[0]=o*e+n*h,c[1]=o*f+n*i,c[2]=o*g+n*j,c[3]=o*h-n*e,c[4]=o*i-n*f,c[5]=o*j-n*g,c[6]=k,c[7]=l,c[8]=m},a.scale=function(a,b){var c=b.elements,d=this.elements,e=a.elements,f=e[0],g=e[1];c[0]=f*d[0],c[1]=f*d[1],c[2]=f*d[2],c[3]=g*d[3],c[4]=g*d[4],c[5]=g*d[5],c[6]=d[6],c[7]=d[7],c[8]=d[8]},a.invert=function(a){var b=a.elements,c=this.elements,d=c[0],e=c[1],f=c[2],g=c[3],h=c[4],i=c[5],j=c[6],k=c[7],l=c[8],m=l*h-i*k,n=-l*g+i*j,o=k*g-h*j,p=d*m+e*n+f*o;p||(a=null),p=1/p,b[0]=m*p,b[1]=(-l*e+f*k)*p,b[2]=(i*e-f*h)*p,b[3]=n*p,b[4]=(l*d-f*j)*p,b[5]=(-i*d+f*g)*p,b[6]=o*p,b[7]=(-k*d+e*j)*p,b[8]=(h*d-e*g)*p},a.transpose=function(a){var b=a.elements,c=this.elements;if(a===this){var d=c[1],e=c[2],f=c[5];b[1]=c[3],b[2]=c[6],b[3]=d,b[5]=c[7],b[6]=e,b[7]=f}else b[0]=c[0],b[1]=c[3],b[2]=c[6],b[3]=c[1],b[4]=c[4],b[5]=c[7],b[6]=c[2],b[7]=c[5],b[8]=c[8]},a.identity=function(){var a=this.elements;a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1},a.cloneTo=function(a){var b,c,d;if((c=this.elements)!==(d=a.elements))for(b=0;b<9;++b)d[b]=c[b]},a.clone=function(){var a=new this.constructor;return this.cloneTo(a),a},i.createFromTranslation=function(a,b){b.elements;var c=a.elements;b[0]=1,b[1]=0,b[2]=0,b[3]=0,b[4]=1,b[5]=0,b[6]=c[0],b[7]=c[1],b[8]=1},i.createFromRotation=function(a,b){var c=b.elements,d=Math.sin(a),e=Math.cos(a);c[0]=e,c[1]=d,c[2]=0,c[3]=-d,c[4]=e,c[5]=0,c[6]=0,c[7]=0,c[8]=1},i.createFromScaling=function(a,b){var c=b.elements,d=a.elements;c[0]=d[0],c[1]=0,c[2]=0,c[3]=0,c[4]=d[1],c[5]=0,c[6]=0,c[7]=0,c[8]=1},i.createFromMatrix4x4=function(a,b){b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[4],b[4]=a[5],b[5]=a[6],b[6]=a[8],b[7]=a[9],b[8]=a[10]},i.multiply=function(a,b,c){var d=c.elements,e=a.elements,f=b.elements,g=e[0],h=e[1],i=e[2],j=e[3],k=e[4],l=e[5],m=e[6],n=e[7],o=e[8],p=f[0],q=f[1],r=f[2],s=f[3],t=f[4],u=f[5],v=f[6],w=f[7],x=f[8];d[0]=p*g+q*j+r*m,d[1]=p*h+q*k+r*n,d[2]=p*i+q*l+r*o,d[3]=s*g+t*j+u*m,d[4]=s*h+t*k+u*n,d[5]=s*i+t*l+u*o,d[6]=v*g+w*j+x*m,d[7]=v*h+w*k+x*n,d[8]=v*i+w*l+x*o},i.lookAt=function(a,b,c,d){gb.subtract(a,b,i._tempV30),gb.normalize(i._tempV30,i._tempV30),gb.cross(c,i._tempV30,i._tempV31),gb.normalize(i._tempV31,i._tempV31),gb.cross(i._tempV30,i._tempV31,i._tempV32);var e=i._tempV30.elements,f=i._tempV31.elements,g=i._tempV32.elements,h=d.elements;h[0]=f[0],h[3]=f[1],h[6]=f[2],h[1]=g[0],h[4]=g[1],h[7]=g[2],h[2]=e[0],h[5]=e[1],h[8]=e[2]},i.DEFAULT=new i,l(i,["_tempV30",function(){return this._tempV30=new gb},"_tempV31",function(){return this._tempV31=new gb},"_tempV32",function(){return this._tempV32=new gb}]),i}(),ab=function(){function z(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){void 0===a&&(a=1),void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=0),void 0===e&&(e=0),void 0===f&&(f=1),void 0===g&&(g=0),void 0===h&&(h=0),void 0===i&&(i=0),void 0===j&&(j=0),void 0===k&&(k=1),void 0===l&&(l=0),void 0===m&&(m=0),void 0===n&&(n=0),void 0===o&&(o=0),void 0===p&&(p=1);var q=this.elements=new Float32Array(16);q[0]=a,q[1]=b,q[2]=c,q[3]=d,q[4]=e,q[5]=f,q[6]=g,q[7]=h,q[8]=i,q[9]=j,q[10]=k,q[11]=l,q[12]=m,q[13]=n,q[14]=o,q[15]=p}n(z,"laya.d3.math.Matrix4x4");var a=z.prototype;return v.imps(a,{"laya.d3.core.IClone":!0}),a.getElementByRowColumn=function(a,b){if(a<0||3<a)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(b<0||3<b)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");return this.elements[4*a+b]},a.setElementByRowColumn=function(a,b,c){if(a<0||3<a)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(b<0||3<b)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");this.elements[4*a+b]=c},a.equalsOtherMatrix=function(a){var b=this.elements,c=a.elements;return $a.nearEqual(b[0],c[0])&&$a.nearEqual(b[1],c[1])&&$a.nearEqual(b[2],c[2])&&$a.nearEqual(b[3],c[3])&&$a.nearEqual(b[4],c[4])&&$a.nearEqual(b[5],c[5])&&$a.nearEqual(b[6],c[6])&&$a.nearEqual(b[7],c[7])&&$a.nearEqual(b[8],c[8])&&$a.nearEqual(b[9],c[9])&&$a.nearEqual(b[10],c[10])&&$a.nearEqual(b[11],c[11])&&$a.nearEqual(b[12],c[12])&&$a.nearEqual(b[13],c[13])&&$a.nearEqual(b[14],c[14])&&$a.nearEqual(b[15],c[15])},a.decomposeTransRotScale=function(a,b,c){var d=z._tempMatrix4x4;return this.decomposeTransRotMatScale(a,d,c)?(cb.createFromMatrix4x4(d,b),!0):(b.identity(),!1)},a.decomposeTransRotMatScale=function(a,b,c){var d=this.elements,e=a.elements,f=b.elements,g=c.elements;e[0]=d[12],e[1]=d[13],e[2]=d[14];var h=d[0],i=d[1],j=d[2],k=d[4],l=d[5],m=d[6],n=d[8],o=d[9],p=d[10],q=g[0]=Math.sqrt(h*h+i*i+j*j),r=g[1]=Math.sqrt(k*k+l*l+m*m),s=g[2]=Math.sqrt(n*n+o*o+p*p);if($a.isZero(q)||$a.isZero(r)||$a.isZero(s))return f[1]=f[2]=f[3]=f[4]=f[6]=f[7]=f[8]=f[9]=f[11]=f[12]=f[13]=f[14]=0,f[0]=f[5]=f[10]=f[15]=1,!1;var t=z._tempVector0,u=t.elements;u[0]=n/s,u[1]=o/s,u[2]=p/s;var v=z._tempVector1,w=v.elements;w[0]=h/q,w[1]=i/q,w[2]=j/q;var x=z._tempVector2;gb.cross(t,v,x);var y=z._tempVector1;return gb.cross(x,t,y),f[3]=f[7]=f[11]=f[12]=f[13]=f[14]=0,f[15]=1,f[0]=y.x,f[1]=y.y,f[2]=y.z,f[4]=x.x,f[5]=x.y,f[6]=x.z,f[8]=t.x,f[9]=t.y,f[10]=t.z,f[0]*h+f[1]*i+f[2]*j<0&&(g[0]=-q),f[4]*k+f[5]*l+f[6]*m<0&&(g[1]=-r),f[8]*n+f[9]*o+f[10]*p<0&&(g[2]=-s),!0},a.decomposeYawPitchRoll=function(a){var b=a.elements,c=Math.asin(-this.elements[9]);b[1]=c,Math.cos(c)>$a.zeroTolerance?(b[2]=Math.atan2(this.elements[1],this.elements[5]),b[0]=Math.atan2(this.elements[8],this.elements[10])):(b[2]=Math.atan2(-this.elements[4],this.elements[0]),b[0]=0)},a.normalize=function(){var a=this.elements,b=a[0],c=a[1],d=a[2],e=Math.sqrt(b*b+c*c+d*d);if(!e)return a[0]=0,a[1]=0,void(a[2]=0);1!=e&&(e=1/e,a[0]=b*e,a[1]=c*e,a[2]=d*e)},a.transpose=function(){var a,b;return b=(a=this.elements)[1],a[1]=a[4],a[4]=b,b=a[2],a[2]=a[8],a[8]=b,b=a[3],a[3]=a[12],a[12]=b,b=a[6],a[6]=a[9],a[9]=b,b=a[7],a[7]=a[13],a[13]=b,b=a[11],a[11]=a[14],a[14]=b,this},a.invert=function(a){var b=this.elements,c=a.elements,d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14],s=b[15],t=d*i-e*h,u=d*j-f*h,v=d*k-g*h,w=e*j-f*i,x=e*k-g*i,y=f*k-g*j,z=l*q-m*p,A=l*r-n*p,B=l*s-o*p,C=m*r-n*q,D=m*s-o*q,E=n*s-o*r,F=t*E-u*D+v*C+w*B-x*A+y*z;0!==Math.abs(F)&&(F=1/F,c[0]=(i*E-j*D+k*C)*F,c[1]=(f*D-e*E-g*C)*F,c[2]=(q*y-r*x+s*w)*F,c[3]=(n*x-m*y-o*w)*F,c[4]=(j*B-h*E-k*A)*F,c[5]=(d*E-f*B+g*A)*F,c[6]=(r*v-p*y-s*u)*F,c[7]=(l*y-n*v+o*u)*F,c[8]=(h*D-i*B+k*z)*F,c[9]=(e*B-d*D-g*z)*F,c[10]=(p*x-q*v+s*t)*F,c[11]=(m*v-l*x-o*t)*F,c[12]=(i*A-h*C-j*z)*F,c[13]=(d*C-e*A+f*z)*F,c[14]=(q*u-p*w-r*t)*F,c[15]=(l*w-m*u+n*t)*F)},a.identity=function(){var a=this.elements;a[1]=a[2]=a[3]=a[4]=a[6]=a[7]=a[8]=a[9]=a[11]=a[12]=a[13]=a[14]=0,a[0]=a[5]=a[10]=a[15]=1},a.cloneTo=function(a){var b,c,d;if((c=this.elements)!==(d=a.elements))for(b=0;b<16;++b)d[b]=c[b]},a.clone=function(){var a=new this.constructor;return this.cloneTo(a),a},a.getTranslationVector=function(a){var b=this.elements,c=a.elements;c[0]=b[12],c[1]=b[13],c[2]=b[14]},a.setTranslationVector=function(a){var b=this.elements,c=a.elements;b[12]=c[0],b[13]=c[1],b[14]=c[2]},a.getForward=function(a){var b=this.elements,c=a.elements;c[0]=-b[8],c[1]=-b[9],c[2]=-b[10]},a.setForward=function(a){var b=this.elements,c=a.elements;b[8]=-c[0],b[9]=-c[1],b[10]=-c[2]},z.createRotationX=function(a,b){var c=b.elements,d=Math.sin(a),e=Math.cos(a);c[1]=c[2]=c[3]=c[4]=c[7]=c[8]=c[11]=c[12]=c[13]=c[14]=0,c[0]=c[15]=1,c[5]=c[10]=e,c[6]=d,c[9]=-d},z.createRotationY=function(a,b){var c=b.elements,d=Math.sin(a),e=Math.cos(a);c[1]=c[3]=c[4]=c[6]=c[7]=c[9]=c[11]=c[12]=c[13]=c[14]=0,c[5]=c[15]=1,c[0]=c[10]=e,c[2]=-d,c[8]=d},z.createRotationZ=function(a,b){var c=b.elements,d=Math.sin(a),e=Math.cos(a);c[2]=c[3]=c[6]=c[7]=c[8]=c[9]=c[11]=c[12]=c[13]=c[14]=0,c[10]=c[15]=1,c[0]=c[5]=e,c[1]=d,c[4]=-d},z.createRotationYawPitchRoll=function(a,b,c,d){cb.createFromYawPitchRoll(a,b,c,z._tempQuaternion),z.createRotationQuaternion(z._tempQuaternion,d)},z.createRotationAxis=function(a,b,c){var d=a.elements,e=d[0],f=d[1],g=d[2],h=Math.cos(b),i=Math.sin(b),j=e*e,k=f*f,l=g*g,m=e*f,n=e*g,o=f*g,p=c.elements;p[3]=p[7]=p[11]=p[12]=p[13]=p[14]=0,p[15]=1,p[0]=j+h*(1-j),p[1]=m-h*m+i*g,p[2]=n-h*n-i*f,p[4]=m-h*m-i*g,p[5]=k+h*(1-k),p[6]=o-h*o+i*e,p[8]=n-h*n+i*f,p[9]=o-h*o-i*e,p[10]=l+h*(1-l)},z.createRotationQuaternion=function(a,b){var c=a.elements,d=b.elements,e=c[0],f=c[1],g=c[2],h=c[3],i=e*e,j=f*f,k=g*g,l=e*f,m=g*h,n=g*e,o=f*h,p=f*g,q=e*h;d[3]=d[7]=d[11]=d[12]=d[13]=d[14]=0,d[15]=1,d[0]=1-2*(j+k),d[1]=2*(l+m),d[2]=2*(n-o),d[4]=2*(l-m),d[5]=1-2*(k+i),d[6]=2*(p+q),d[8]=2*(n+o),d[9]=2*(p-q),d[10]=1-2*(j+i)},z.createTranslate=function(a,b){var c=a.elements,d=b.elements;d[4]=d[8]=d[1]=d[9]=d[2]=d[6]=d[3]=d[7]=d[11]=0,d[0]=d[5]=d[10]=d[15]=1,d[12]=c[0],d[13]=c[1],d[14]=c[2]},z.createScaling=function(a,b){var c=a.elements,d=b.elements;d[0]=c[0],d[5]=c[1],d[10]=c[2],d[1]=d[4]=d[8]=d[12]=d[9]=d[13]=d[2]=d[6]=d[14]=d[3]=d[7]=d[11]=0,d[15]=1},z.multiply=function(a,b,c){var d,e,f,g,h,i,j,k;for(e=c.elements,f=a.elements,e===(g=b.elements)&&(g=g.slice()),d=0;d<4;d++)h=f[d],i=f[d+4],j=f[d+8],k=f[d+12],e[d]=h*g[0]+i*g[1]+j*g[2]+k*g[3],e[d+4]=h*g[4]+i*g[5]+j*g[6]+k*g[7],e[d+8]=h*g[8]+i*g[9]+j*g[10]+k*g[11],e[d+12]=h*g[12]+i*g[13]+j*g[14]+k*g[15]},z.createFromQuaternion=function(a,b){var c=b.elements,d=a.elements,e=d[0],f=d[1],g=d[2],h=d[3],i=e+e,j=f+f,k=g+g,l=e*i,m=f*i,n=f*j,o=g*i,p=g*j,q=g*k,r=h*i,s=h*j,t=h*k;c[0]=1-n-q,c[1]=m+t,c[2]=o-s,c[3]=0,c[4]=m-t,c[5]=1-l-q,c[6]=p+r,c[7]=0,c[8]=o+s,c[9]=p-r,c[10]=1-l-n,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1},z.createAffineTransformation=function(a,b,c,d){var e=a.elements,f=b.elements,g=c.elements,h=d.elements,i=f[0],j=f[1],k=f[2],l=f[3],m=i+i,n=j+j,o=k+k,p=i*m,q=i*n,r=i*o,s=j*n,t=j*o,u=k*o,v=l*m,w=l*n,x=l*o,y=g[0],z=g[1],A=g[2];h[0]=(1-(s+u))*y,h[1]=(q+x)*y,h[2]=(r-w)*y,h[3]=0,h[4]=(q-x)*z,h[5]=(1-(p+u))*z,h[6]=(t+v)*z,h[7]=0,h[8]=(r+w)*A,h[9]=(t-v)*A,h[10]=(1-(p+s))*A,h[11]=0,h[12]=e[0],h[13]=e[1],h[14]=e[2],h[15]=1},z.createLookAt=function(a,b,c,d){var e=d.elements,f=z._tempVector0,g=z._tempVector1,h=z._tempVector2;gb.subtract(a,b,h),gb.normalize(h,h),gb.cross(c,h,f),gb.normalize(f,f),gb.cross(h,f,g),d.identity(),e[0]=f.x,e[4]=f.y,e[8]=f.z,e[1]=g.x,e[5]=g.y,e[9]=g.z,e[2]=h.x,e[6]=h.y,e[10]=h.z,e[12]=-gb.dot(f,a),e[13]=-gb.dot(g,a),e[14]=-gb.dot(h,a)},z.createPerspective=function(a,b,c,d,e){var f=e.elements,g=1/Math.tan(a/2),h=1/(c-d);f[0]=g/b,f[5]=g,f[10]=(d+c)*h,f[11]=-1,f[14]=2*d*c*h,f[1]=f[2]=f[3]=f[4]=f[6]=f[7]=f[8]=f[9]=f[12]=f[13]=f[15]=0},z.createOrthoOffCenterRH=function(a,b,c,d,e,f,g){var h=g.elements,i=1/(a-b),j=1/(c-d),k=1/(e-f);h[1]=h[2]=h[3]=h[4]=h[6]=h[7]=h[8]=h[9]=h[11]=0,h[15]=1,h[0]=-2*i,h[5]=-2*j,h[10]=2*k,h[12]=(a+b)*i,h[13]=(d+c)*j,h[14]=(f+e)*k},z.translation=function(a,b){var c=a.elements,d=b.elements;d[0]=d[5]=d[10]=d[15]=1,d[12]=c[0],d[13]=c[1],d[14]=c[2]},l(z,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new z},"_tempVector0",function(){return this._tempVector0=new gb},"_tempVector1",function(){return this._tempVector1=new gb},"_tempVector2",function(){return this._tempVector2=new gb},"_tempQuaternion",function(){return this._tempQuaternion=new cb},"DEFAULT",function(){return this.DEFAULT=new z},"ZERO",function(){return this.ZERO=new z(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}]),z}(),bb=(function(){function t(a,b){this.extents=null,this.transformation=null,this.extents=a,this.transformation=b}n(t,"laya.d3.math.OrientedBoundBox");var a=t.prototype;a.getCorners=function(a){var b=t._tempV30.elements,c=t._tempV31.elements,d=t._tempV32.elements,e=this.extents.elements;b[0]=e[0],b[1]=b[2]=0,c[1]=e[1],c[0]=c[2]=0,d[2]=e[2],d[0]=d[1]=0,gb.TransformNormal(t._tempV30,this.transformation,t._tempV30),gb.TransformNormal(t._tempV31,this.transformation,t._tempV31),gb.TransformNormal(t._tempV32,this.transformation,t._tempV32);var f=t._tempV33;this.transformation.getTranslationVector(f),a.length=8,gb.add(f,t._tempV30,t._tempV34),gb.add(t._tempV34,t._tempV31,t._tempV34),gb.add(t._tempV34,t._tempV32,a[0]),gb.add(f,t._tempV30,t._tempV34),gb.add(t._tempV34,t._tempV31,t._tempV34),gb.subtract(t._tempV34,t._tempV32,a[1]),gb.subtract(f,t._tempV30,t._tempV34),gb.add(t._tempV34,t._tempV31,t._tempV34),gb.subtract(t._tempV34,t._tempV32,a[2]),gb.subtract(f,t._tempV30,t._tempV34),gb.add(t._tempV34,t._tempV31,t._tempV34),gb.add(t._tempV34,t._tempV32,a[3]),gb.add(f,t._tempV30,t._tempV34),gb.subtract(t._tempV34,t._tempV31,t._tempV34),gb.add(t._tempV34,t._tempV32,a[4]),gb.add(f,t._tempV30,t._tempV34),gb.subtract(t._tempV34,t._tempV31,t._tempV34),gb.subtract(t._tempV34,t._tempV32,a[5]),gb.subtract(f,t._tempV30,t._tempV34),gb.subtract(t._tempV34,t._tempV31,t._tempV34),gb.subtract(t._tempV34,t._tempV32,a[6]),gb.subtract(f,t._tempV30,t._tempV34),gb.subtract(t._tempV34,t._tempV31,t._tempV34),gb.add(t._tempV34,t._tempV32,a[7])},a.transform=function(a){ab.multiply(this.transformation,a,this.transformation)},a.scale=function(a){gb.multiply(this.extents,a,this.extents)},a.translate=function(a){this.transformation.getTranslationVector(t._tempV30),gb.add(t._tempV30,a,t._tempV31),this.transformation.setTranslationVector(t._tempV31)},a.Size=function(a){gb.scale(this.extents,2,a)},a.getSize=function(a){var b=this.extents.elements;t._tempV30.x=b[0],t._tempV31.y=b[1],t._tempV32.z=b[2],gb.TransformNormal(t._tempV30,this.transformation,t._tempV30),gb.TransformNormal(t._tempV31,this.transformation,t._tempV31),gb.TransformNormal(t._tempV31,this.transformation,t._tempV32);var c=a.elements;c[0]=gb.scalarLength(t._tempV30),c[1]=gb.scalarLength(t._tempV31),c[2]=gb.scalarLength(t._tempV32)},a.getSizeSquared=function(a){var b=this.extents.elements;t._tempV30.x=b[0],t._tempV31.y=b[1],t._tempV32.z=b[2],gb.TransformNormal(t._tempV30,this.transformation,t._tempV30),gb.TransformNormal(t._tempV31,this.transformation,t._tempV31),gb.TransformNormal(t._tempV31,this.transformation,t._tempV32);var c=a.elements;c[0]=gb.scalarLengthSquared(t._tempV30),c[1]=gb.scalarLengthSquared(t._tempV31),c[2]=gb.scalarLengthSquared(t._tempV32)},a.getCenter=function(a){this.transformation.getTranslationVector(a)},a.containsPoint=function(a){var b=this.extents.elements,c=b[0],d=b[1],e=b[2];this.transformation.invert(t._tempM0),gb.transformCoordinate(a,t._tempM0,t._tempV30);var f=t._tempV30.elements,g=Math.abs(f[0]),h=Math.abs(f[1]),i=Math.abs(f[2]);return $a.nearEqual(g,c)&&$a.nearEqual(h,d)&&$a.nearEqual(i,e)?2:g<c&&h<d&&i<e?1:0},a.containsPoints=function(a){var b=this.extents.elements,c=b[0],d=b[1],e=b[2];this.transformation.invert(t._tempM0);for(var f=!0,g=!1,h=0;h<a.length;h++){gb.transformCoordinate(a[h],t._tempM0,t._tempV30);var i=t._tempV30.elements,j=Math.abs(i[0]),k=Math.abs(i[1]),l=Math.abs(i[2]);$a.nearEqual(j,c)&&$a.nearEqual(k,d)&&$a.nearEqual(l,e)&&(g=!0),j<c&&k<d&&l<e?g=!0:f=!1}return f?1:g?2:0},a.containsSphere=function(a,b){void 0===b&&(b=!1);var c=this.extents.elements,d=c[0],e=c[1],f=c[2],g=a.radius;this.transformation.invert(t._tempM0),gb.transformCoordinate(a.center,t._tempM0,t._tempV30);var h=NaN;if(h=b?g:(gb.scale(gb.UnitX,g,t._tempV31),gb.TransformNormal(t._tempV31,t._tempM0,t._tempV31),gb.scalarLength(t._tempV31)),gb.scale(this.extents,-1,t._tempV32),gb.Clamp(t._tempV30,t._tempV32,this.extents,t._tempV33),h*h<gb.distanceSquared(t._tempV30,t._tempV33))return 0;var i=t._tempV30.elements,j=i[0],k=i[1],l=i[2],m=t._tempV32.elements,n=m[0],o=m[1],p=m[2];return n+h<=j&&j<=d-h&&h<d-n&&o+h<=k&&k<=e-h&&h<e-o&&p+h<=l&&l<=f-h&&h<f-p?1:2},a.containsOrientedBoundBox=function(a){var b=0,c=0;a.getCorners(t._corners);var d=this.containsPoints(t._corners);if(0!=d)return d;var e=this.extents.elements;a.extents.cloneTo(t._tempV35);var f=t._tempV35.elements;t._getRows(this.transformation,t._rows1),t._getRows(a.transformation,t._rows2);var g=NaN;for(b=0;b<4;b++)for(c=0;c<4;c++)3==b||3==c?(t._tempM0.setElementByRowColumn(b,c,0),t._tempM1.setElementByRowColumn(b,c,0)):(g=gb.dot(t._rows1[b],t._rows2[c]),t._tempM0.setElementByRowColumn(b,c,g),t._tempM1.setElementByRowColumn(b,c,Math.abs(g)));a.getCenter(t._tempV34),this.getCenter(t._tempV36),gb.subtract(t._tempV34,t._tempV36,t._tempV30);var h=t._tempV31.elements;h[0]=gb.dot(t._tempV30,t._rows1[0]),h[1]=gb.dot(t._tempV30,t._rows1[1]),h[2]=gb.dot(t._tempV30,t._rows1[2]);var i=t._tempV32.elements,j=t._tempV33.elements;for(b=0;b<3;b++)if(i[0]=t._tempM1.getElementByRowColumn(b,0),i[1]=t._tempM1.getElementByRowColumn(b,1),i[2]=t._tempM1.getElementByRowColumn(b,2),e[b]+gb.dot(t._tempV35,t._tempV32)<Math.abs(h[b]))return 0;for(c=0;c<3;c++)if(i[0]=t._tempM1.getElementByRowColumn(0,c),i[1]=t._tempM1.getElementByRowColumn(1,c),i[2]=t._tempM1.getElementByRowColumn(2,c),j[0]=t._tempM0.getElementByRowColumn(0,c),j[1]=t._tempM0.getElementByRowColumn(1,c),j[2]=t._tempM0.getElementByRowColumn(2,c),gb.dot(this.extents,t._tempV32)+f[c]<Math.abs(gb.dot(t._tempV31,t._tempV33)))return 0;for(b=0;b<3;b++)for(c=0;c<3;c++){var k=(b+1)%3,l=(b+2)%3,m=(c+1)%3,n=(c+2)%3;if(e[k]*t._tempM1.getElementByRowColumn(l,c)+e[l]*t._tempM1.getElementByRowColumn(k,c)+(f[m]*t._tempM1.getElementByRowColumn(b,n)+f[n]*t._tempM1.getElementByRowColumn(b,m))<Math.abs(h[l]*t._tempM0.getElementByRowColumn(k,c)-h[k]*t._tempM0.getElementByRowColumn(l,c)))return 0}return 2},a.containsLine=function(a,b){t._corners[0]=a,t._corners[1]=b;var c=this.containsPoints(t._corners);if(0!=c)return c;var d=this.extents.elements,e=d[0],f=d[1],g=d[2];this.transformation.invert(t._tempM0),gb.transformCoordinate(a,t._tempM0,t._tempV30),gb.transformCoordinate(b,t._tempM0,t._tempV31),gb.add(t._tempV30,t._tempV31,t._tempV32),gb.scale(t._tempV32,.5,t._tempV32),gb.subtract(t._tempV30,t._tempV32,t._tempV33);var h=t._tempV33.elements,i=h[0],j=h[1],k=h[2],l=t._tempV34.elements,m=l[0]=Math.abs(h[0]),n=l[1]=Math.abs(h[1]),o=l[2]=Math.abs(h[2]),p=t._tempV32.elements,q=p[0],r=p[1],s=p[2];return Math.abs(q)>e+m?0:Math.abs(r)>f+n?0:Math.abs(s)>g+o?0:Math.abs(r*k-s*j)>f*o+g*n?0:Math.abs(q*k-s*i)>e*o+g*m?0:Math.abs(q*j-r*i)>e*n+f*m?0:2},a.containsBoundBox=function(a){var b=0,c=0,d=a.min,e=a.max;a.getCorners(t._corners);var f=this.containsPoints(t._corners);if(0!=f)return f;gb.subtract(e,d,t._tempV30),gb.scale(t._tempV30,.5,t._tempV30),gb.add(d,t._tempV30,t._tempV30),gb.subtract(e,t._tempV30,t._tempV31);var g=this.extents.elements,h=t._tempV31.elements;t._getRows(this.transformation,t._rows1),this.transformation.invert(t._tempM0);for(b=0;b<3;b++)for(c=0;c<3;c++)t._tempM1.setElementByRowColumn(b,c,Math.abs(t._tempM0.getElementByRowColumn(b,c)));this.getCenter(t._tempV35),gb.subtract(t._tempV30,t._tempV35,t._tempV32);var i=t._tempV31.elements;i[0]=gb.dot(t._tempV32,t._rows1[0]),i[1]=gb.dot(t._tempV32,t._rows1[1]),i[2]=gb.dot(t._tempV32,t._rows1[2]);var j=t._tempV33.elements,k=t._tempV34.elements;for(b=0;b<3;b++)if(j[0]=t._tempM1.getElementByRowColumn(b,0),j[1]=t._tempM1.getElementByRowColumn(b,1),j[2]=t._tempM1.getElementByRowColumn(b,2),g[b]+gb.dot(t._tempV31,t._tempV33)<Math.abs(i[b]))return 0;for(c=0;c<3;c++)if(j[0]=t._tempM1.getElementByRowColumn(0,c),j[1]=t._tempM1.getElementByRowColumn(1,c),j[2]=t._tempM1.getElementByRowColumn(2,c),k[0]=t._tempM0.getElementByRowColumn(0,c),k[1]=t._tempM0.getElementByRowColumn(1,c),k[2]=t._tempM0.getElementByRowColumn(2,c),gb.dot(this.extents,t._tempV33)+h[c]<Math.abs(gb.dot(t._tempV31,t._tempV34)))return 0;for(b=0;b<3;b++)for(c=0;c<3;c++){var l=(b+1)%3,m=(b+2)%3,n=(c+1)%3,o=(c+2)%3;if(g[l]*t._tempM1.getElementByRowColumn(m,c)+g[m]*t._tempM1.getElementByRowColumn(l,c)+(h[n]*t._tempM1.getElementByRowColumn(b,o)+h[o]*t._tempM1.getElementByRowColumn(b,n))<Math.abs(i[m]*t._tempM0.getElementByRowColumn(l,c)-i[l]*t._tempM0.getElementByRowColumn(m,c)))return 0}return 2},a.intersectsRay=function(a,b){gb.scale(this.extents,-1,t._tempV30),this.transformation.invert(t._tempM0),gb.TransformNormal(a.direction,t._tempM0,t._ray.direction),gb.transformCoordinate(a.origin,t._tempM0,t._ray.origin),t._boxBound1.min=t._tempV30,t._boxBound1.max=this.extents;var c=Collision.intersectsRayAndBoxRP(t._ray,t._boxBound1,b);return-1!==c&&gb.transformCoordinate(b,this.transformation,b),c},a._getLocalCorners=function(a){a.length=8;var b=this.extents.elements;t._tempV30.x=b[0],t._tempV31.y=b[1],t._tempV32.z=b[2],gb.add(t._tempV30,t._tempV31,t._tempV33),gb.add(t._tempV33,t._tempV32,a[0]),gb.add(t._tempV30,t._tempV31,t._tempV33),gb.subtract(t._tempV33,t._tempV32,a[1]),gb.subtract(t._tempV31,t._tempV30,t._tempV33),gb.subtract(t._tempV33,t._tempV30,a[2]),gb.subtract(t._tempV31,t._tempV30,t._tempV33),gb.add(t._tempV33,t._tempV32,a[3]),gb.subtract(t._tempV30,t._tempV31,t._tempV33),gb.add(t._tempV33,t._tempV32,a[4]),gb.subtract(t._tempV30,t._tempV31,t._tempV33),gb.subtract(t._tempV33,t._tempV32,a[5]),gb.scale(a[0],-1,a[6]),gb.subtract(t._tempV32,t._tempV30,t._tempV33),gb.subtract(t._tempV33,t._tempV31,a[7])},a.equals=function(a){return this.extents==a.extents&&this.transformation==a.transformation},a.cloneTo=function(a){var b=a;this.extents.cloneTo(b.extents),this.transformation.cloneTo(b.transformation)},t.createByBoundBox=function(a,b){var c=a.min,d=a.max;gb.subtract(d,c,t._tempV30),gb.scale(t._tempV30,.5,t._tempV30),gb.add(c,t._tempV30,t._tempV31),gb.subtract(d,t._tempV31,t._tempV32),ab.translation(t._tempV31,t._tempM0);var e=t._tempV32.clone(),f=t._tempM0.clone();b.extents=e,b.transformation=f},t.createByMinAndMaxVertex=function(a,b){return gb.subtract(b,a,t._tempV30),gb.scale(t._tempV30,.5,t._tempV30),gb.add(a,t._tempV30,t._tempV31),gb.subtract(b,t._tempV31,t._tempV32),ab.translation(t._tempV31,t._tempM0),new t(t._tempV32,t._tempM0)},t._getRows=function(a,b){b.length=3;var c=a.elements,d=b[0].elements;d[0]=c[0],d[1]=c[1],d[2]=c[2];var e=b[1].elements;e[0]=c[4],e[1]=c[5],e[2]=c[6];var f=b[2].elements;f[0]=c[8],f[1]=c[9],f[2]=c[10]},t.getObbtoObbMatrix4x4=function(a,b,c,d){var e=a.transformation,f=b.transformation;if(c){t._getRows(e,t._rows1),t._getRows(f,t._rows2);for(var g=0;g<3;g++)for(var h=0;h<3;h++)d.setElementByRowColumn(g,h,gb.dot(t._rows2[g],t._rows1[h]));b.getCenter(t._tempV30),a.getCenter(t._tempV31),gb.subtract(t._tempV30,t._tempV31,t._tempV32);var i=d.elements;i[12]=gb.dot(t._tempV32,t._rows1[0]),i[13]=gb.dot(t._tempV32,t._rows1[1]),i[14]=gb.dot(t._tempV32,t._rows1[2]),i[15]=1}else e.invert(t._tempM0),ab.multiply(f,t._tempM0,d)},t.merge=function(a,b,c){var d=a.extents,e=a.transformation;t.getObbtoObbMatrix4x4(a,b,c,t._tempM0),b._getLocalCorners(t._corners),gb.transformCoordinate(t._corners[0],t._tempM0,t._corners[0]),gb.transformCoordinate(t._corners[1],t._tempM0,t._corners[1]),gb.transformCoordinate(t._corners[2],t._tempM0,t._corners[2]),gb.transformCoordinate(t._corners[3],t._tempM0,t._corners[3]),gb.transformCoordinate(t._corners[4],t._tempM0,t._corners[4]),gb.transformCoordinate(t._corners[5],t._tempM0,t._corners[5]),gb.transformCoordinate(t._corners[6],t._tempM0,t._corners[6]),gb.transformCoordinate(t._corners[7],t._tempM0,t._corners[7]),gb.scale(d,-1,t._boxBound1.min),d.cloneTo(t._boxBound1.max),Xa.createfromPoints(t._corners,t._boxBound2),Xa.merge(t._boxBound2,t._boxBound1,t._boxBound3);var f=t._boxBound3.min,g=t._boxBound3.max;gb.subtract(g,f,t._tempV30),gb.scale(t._tempV30,.5,t._tempV30),gb.add(f,t._tempV30,t._tempV32),gb.subtract(g,t._tempV32,d),gb.transformCoordinate(t._tempV32,e,t._tempV33)},l(t,["_tempV30",function(){return this._tempV30=new gb},"_tempV31",function(){return this._tempV31=new gb},"_tempV32",function(){return this._tempV32=new gb},"_tempV33",function(){return this._tempV33=new gb},"_tempV34",function(){return this._tempV34=new gb},"_tempV35",function(){return this._tempV35=new gb},"_tempV36",function(){return this._tempV36=new gb},"_tempM0",function(){return this._tempM0=new ab},"_tempM1",function(){return this._tempM1=new ab},"_corners",function(){return this._corners=[new gb,new gb,new gb,new gb,new gb,new gb,new gb,new gb]},"_rows1",function(){return this._rows1=[new gb,new gb,new gb]},"_rows2",function(){return this._rows2=[new gb,new gb,new gb]},"_ray",function(){return this._ray=new eb(new gb,new gb)},"_boxBound1",function(){return this._boxBound1=new Xa(new gb,new gb)},"_boxBound2",function(){return this._boxBound2=new Xa(new gb,new gb)},"_boxBound3",function(){return this._boxBound3=new Xa(new gb,new gb)}])}(),function(){function v(a,b){this.normal=null,this.distance=NaN,void 0===b&&(b=0),this.normal=a,this.distance=b}return n(v,"laya.d3.math.Plane"),v.prototype.normalize=function(){var a=this.normal.elements,b=a[0],c=a[1],d=a[2],e=1/Math.sqrt(b*b+c*c+d*d);a[0]=b*e,a[1]=c*e,a[2]=d*e,this.distance*=e},v.createPlaneBy3P=function(a,b,c){var d=a.elements,e=b.elements,f=c.elements,g=e[0]-d[0],h=e[1]-d[1],i=e[2]-d[2],j=f[0]-d[0],k=f[1]-d[1],l=f[2]-d[2],m=h*l-i*k,n=i*j-g*l,o=g*k-h*j,p=1/Math.sqrt(m*m+n*n+o*o),q=m*p,r=n*p,s=o*p,t=v._TEMPVec3.elements;t[0]=q,t[1]=r,t[2]=s;var u=-(q*d[0]+r*d[1]+s*d[2]);return new v(v._TEMPVec3,u)},v.PlaneIntersectionType_Back=0,v.PlaneIntersectionType_Front=1,v.PlaneIntersectionType_Intersecting=2,l(v,["_TEMPVec3",function(){return this._TEMPVec3=new gb}]),v}()),cb=function(){function e(a,b,c,d){this.elements=new Float32Array(4),void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=1),this.elements[0]=a,this.elements[1]=b,this.elements[2]=c,this.elements[3]=d}n(e,"laya.d3.math.Quaternion");var a=e.prototype;return v.imps(a,{"laya.d3.core.IClone":!0}),a.scaling=function(a,b){var c=b.elements,d=this.elements;c[0]=d[0]*a,c[1]=d[1]*a,c[2]=d[2]*a,c[3]=d[3]*a},a.normalize=function(a){var b=a.elements,c=this.elements,d=c[0],e=c[1],f=c[2],g=c[3],h=d*d+e*e+f*f+g*g;0<h&&(h=1/Math.sqrt(h),b[0]=d*h,b[1]=e*h,b[2]=f*h,b[3]=g*h)},a.length=function(){var a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3];return Math.sqrt(b*b+c*c+d*d+e*e)},a.rotateX=function(a,b){var c=b.elements,d=this.elements;a*=.5;var e=d[0],f=d[1],g=d[2],h=d[3],i=Math.sin(a),j=Math.cos(a);c[0]=e*j+h*i,c[1]=f*j+g*i,c[2]=g*j-f*i,c[3]=h*j-e*i},a.rotateY=function(a,b){var c=b.elements,d=this.elements;a*=.5;var e=d[0],f=d[1],g=d[2],h=d[3],i=Math.sin(a),j=Math.cos(a);c[0]=e*j-g*i,c[1]=f*j+h*i,c[2]=g*j+e*i,c[3]=h*j-f*i},a.rotateZ=function(a,b){var c=b.elements,d=this.elements;a*=.5;var e=d[0],f=d[1],g=d[2],h=d[3],i=Math.sin(a),j=Math.cos(a);c[0]=e*j+f*i,c[1]=f*j-e*i,c[2]=g*j+h*i,c[3]=h*j-g*i},a.getYawPitchRoll=function(a){gb.transformQuat(gb.ForwardRH,this,e.TEMPVector31),gb.transformQuat(gb.Up,this,e.TEMPVector32);var b=e.TEMPVector32.elements;e.angleTo(gb.ZERO,e.TEMPVector31,e.TEMPVector33);var c=e.TEMPVector33.elements;c[0]==Math.PI/2?(c[1]=e.arcTanAngle(b[2],b[0]),c[2]=0):c[0]==-Math.PI/2?(c[1]=e.arcTanAngle(-b[2],-b[0]),c[2]=0):(ab.createRotationY(-c[1],e.TEMPMatrix0),ab.createRotationX(-c[0],e.TEMPMatrix1),gb.transformCoordinate(e.TEMPVector32,e.TEMPMatrix0,e.TEMPVector32),gb.transformCoordinate(e.TEMPVector32,e.TEMPMatrix1,e.TEMPVector32),c[2]=e.arcTanAngle(b[1],-b[0])),c[1]<=-Math.PI&&(c[1]=Math.PI),c[2]<=-Math.PI&&(c[2]=Math.PI),c[1]>=Math.PI&&c[2]>=Math.PI&&(c[1]=0,c[2]=0,c[0]=Math.PI-c[0]);var d=a.elements;d[0]=c[1],d[1]=c[0],d[2]=c[2]},a.invert=function(a){var b=a.elements,c=this.elements,d=c[0],e=c[1],f=c[2],g=c[3],h=d*d+e*e+f*f+g*g,i=h?1/h:0;b[0]=-d*i,b[1]=-e*i,b[2]=-f*i,b[3]=g*i},a.identity=function(){var a=this.elements;a[0]=0,a[1]=0,a[2]=0,a[3]=1},a.fromArray=function(a,b){void 0===b&&(b=0),this.elements[0]=a[b+0],this.elements[1]=a[b+1],this.elements[2]=a[b+2],this.elements[3]=a[b+3]},a.cloneTo=function(a){var b,c,d;if((c=this.elements)!==(d=a.elements))for(b=0;b<4;++b)d[b]=c[b]},a.clone=function(){var a=new this.constructor;return this.cloneTo(a),a},a.equals=function(a){var b=this.elements,c=a.elements;return $a.nearEqual(b[0],c[0])&&$a.nearEqual(b[1],c[1])&&$a.nearEqual(b[2],c[2])&&$a.nearEqual(b[3],c[3])},a.lengthSquared=function(){var a=this.elements[0],b=this.elements[1],c=this.elements[2],d=this.elements[3];return a*a+b*b+c*c+d*d},o(0,a,"x",function(){return this.elements[0]}),o(0,a,"y",function(){return this.elements[1]}),o(0,a,"z",function(){return this.elements[2]}),o(0,a,"w",function(){return this.elements[3]}),e.createFromYawPitchRoll=function(a,b,c,d){var e=.5*c,f=.5*b,g=.5*a,h=Math.sin(e),i=Math.cos(e),j=Math.sin(f),k=Math.cos(f),l=Math.sin(g),m=Math.cos(g),n=d.elements;n[0]=m*j*i+l*k*h,n[1]=l*k*i-m*j*h,n[2]=m*k*h-l*j*i,n[3]=m*k*i+l*j*h},e.multiply=function(a,b,c){var d=a.elements,e=b.elements,f=c.elements,g=d[0],h=d[1],i=d[2],j=d[3],k=e[0],l=e[1],m=e[2],n=e[3],o=h*m-i*l,p=i*k-g*m,q=g*l-h*k,r=g*k+h*l+i*m;f[0]=g*n+k*j+o,f[1]=h*n+l*j+p,f[2]=i*n+m*j+q,f[3]=j*n-r},e.arcTanAngle=function(a,b){return 0==a?1==b?Math.PI/2:-Math.PI/2:0<a?Math.atan(b/a):a<0?0<b?Math.atan(b/a)+Math.PI:Math.atan(b/a)-Math.PI:0},e.angleTo=function(a,b,c){gb.subtract(b,a,e.TEMPVector30),gb.normalize(e.TEMPVector30,e.TEMPVector30),c.elements[0]=Math.asin(e.TEMPVector30.y),c.elements[1]=e.arcTanAngle(-e.TEMPVector30.z,-e.TEMPVector30.x)},e.createFromAxisAngle=function(a,b,c){var d=c.elements,e=a.elements;b*=.5;var f=Math.sin(b);d[0]=f*e[0],d[1]=f*e[1],d[2]=f*e[2],d[3]=Math.cos(b)},e.createFromMatrix3x3=function(a,b){var c,d=b.elements,e=a.elements,f=e[0]+e[4]+e[8];if(0<f)c=Math.sqrt(f+1),d[3]=.5*c,c=.5/c,d[0]=(e[5]-e[7])*c,d[1]=(e[6]-e[2])*c,d[2]=(e[1]-e[3])*c;else{var g=0;e[4]>e[0]&&(g=1),e[8]>e[3*g+g]&&(g=2);var h=(g+1)%3,i=(g+2)%3;c=Math.sqrt(e[3*g+g]-e[3*h+h]-e[3*i+i]+1),d[g]=.5*c,c=.5/c,d[3]=(e[3*h+i]-e[3*i+h])*c,d[h]=(e[3*h+g]+e[3*g+h])*c,d[i]=(e[3*i+g]+e[3*g+i])*c}},e.createFromMatrix4x4=function(a,b){var c,d,e=a.elements,f=b.elements,g=e[0]+e[5]+e[10];0<g?(c=Math.sqrt(g+1),f[3]=.5*c,c=.5/c,f[0]=(e[6]-e[9])*c,f[1]=(e[8]-e[2])*c,f[2]=(e[1]-e[4])*c):e[0]>=e[5]&&e[0]>=e[10]?(d=.5/(c=Math.sqrt(1+e[0]-e[5]-e[10])),f[0]=.5*c,f[1]=(e[1]+e[4])*d,f[2]=(e[2]+e[8])*d,f[3]=(e[6]-e[9])*d):e[5]>e[10]?(d=.5/(c=Math.sqrt(1+e[5]-e[0]-e[10])),f[0]=(e[4]+e[1])*d,f[1]=.5*c,f[2]=(e[9]+e[6])*d,f[3]=(e[8]-e[2])*d):(d=.5/(c=Math.sqrt(1+e[10]-e[0]-e[5])),f[0]=(e[8]+e[2])*d,f[1]=(e[9]+e[6])*d,f[2]=.5*c,f[3]=(e[1]-e[4])*d)},e.slerp=function(a,b,c,d){var e,f,g,h,i,j=a.elements,k=b.elements,l=d.elements,m=j[0],n=j[1],o=j[2],p=j[3],q=k[0],r=k[1],s=k[2],t=k[3];return(f=m*q+n*r+o*s+p*t)<0&&(f=-f,q=-q,r=-r,s=-s,t=-t),i=1e-6<1-f?(e=Math.acos(f),g=Math.sin(e),h=Math.sin((1-c)*e)/g,Math.sin(c*e)/g):(h=1-c,c),l[0]=h*m+i*q,l[1]=h*n+i*r,l[2]=h*o+i*s,l[3]=h*p+i*t,l},e.lerp=function(a,b,c,d){var e=d.elements,f=a.elements,g=b.elements,h=f[0],i=f[1],j=f[2],k=f[3];e[0]=h+c*(g[0]-h),e[1]=i+c*(g[1]-i),e[2]=j+c*(g[2]-j),e[3]=k+c*(g[3]-k)},e.add=function(a,b,c){var d=c.elements,e=a.elements,f=b.elements;d[0]=e[0]+f[0],d[1]=e[1]+f[1],d[2]=e[2]+f[2],d[3]=e[3]+f[3]},e.dot=function(a,b){var c=a.elements,d=b.elements;return c[0]*d[0]+c[1]*d[1]+c[2]*d[2]+c[3]*d[3]},e.rotationLookAt=function(a,b,c){e.lookAt(gb.ZERO,a,b,c)},e.lookAt=function(a,b,c,d){_a.lookAt(a,b,c,e._tempMatrix3x3),e.rotationMatrix(e._tempMatrix3x3,d)},e.invert=function(a,b){var c=a.elements,d=b.elements,e=a.lengthSquared();$a.isZero(e)||(e=1/e,d[0]=-c[0]*e,d[1]=-c[1]*e,d[2]=-c[2]*e,d[3]=c[3]*e)},e.rotationMatrix=function(a,b){var c=a.elements,d=c[0],e=c[1],f=c[2],g=c[3],h=c[4],i=c[5],j=c[6],k=c[7],l=c[8],m=b.elements,n=NaN,o=NaN,p=d+h+l;0<p?(n=Math.sqrt(p+1),m[3]=.5*n,n=.5/n,m[0]=(i-k)*n,m[1]=(j-f)*n,m[2]=(e-g)*n):h<=d&&l<=d?(o=.5/(n=Math.sqrt(1+d-h-l)),m[0]=.5*n,m[1]=(e+g)*o,m[2]=(f+j)*o,m[3]=(i-k)*o):l<h?(o=.5/(n=Math.sqrt(1+h-d-l)),m[0]=(g+e)*o,m[1]=.5*n,m[2]=(k+i)*o,m[3]=(j-f)*o):(o=.5/(n=Math.sqrt(1+l-d-h)),m[0]=(j+f)*o,m[1]=(k+i)*o,m[2]=.5*n,m[3]=(e-g)*o)},e.DEFAULT=new e,l(e,["TEMPVector30",function(){return this.TEMPVector30=new gb},"TEMPVector31",function(){return this.TEMPVector31=new gb},"TEMPVector32",function(){return this.TEMPVector32=new gb},"TEMPVector33",function(){return this.TEMPVector33=new gb},"TEMPMatrix0",function(){return this.TEMPMatrix0=new ab},"TEMPMatrix1",function(){return this.TEMPMatrix1=new ab},"_tempMatrix3x3",function(){return this._tempMatrix3x3=new _a},"NAN",function(){return this.NAN=new e(NaN,NaN,NaN,NaN)}]),e}(),db=function(){function a(a){this._temp=new Uint32Array(1),this.seeds=new Uint32Array(4),this.seeds[0]=a,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}n(a,"laya.d3.math.Rand");var b=a.prototype;return b.getUint=function(){return this._temp[0]=this.seeds[0]^this.seeds[0]<<11,this.seeds[0]=this.seeds[1],this.seeds[1]=this.seeds[2],this.seeds[2]=this.seeds[3],this.seeds[3]=this.seeds[3]^this.seeds[3]>>>19^this._temp[0]^this._temp[0]>>>8,this.seeds[3]},b.getFloat=function(){return this.getUint(),(8388607&this.seeds[3])*(1/8388607)},b.getSignedFloat=function(){return 2*this.getFloat()-1},o(0,b,"seed",function(){return this.seeds[0]},function(a){this.seeds[0]=a,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}),a.getFloatFromInt=function(a){return 1/8388607*(8388607&a)},a.getByteFromInt=function(a){return(8388607&a)>>>15},a}(),eb=(function(){function e(a){if(this._state0U=NaN,this._state0L=NaN,this._state1U=NaN,this._state1L=NaN,!(a instanceof Array)||4!==a.length)throw new Error("Rand:Seed must be an array with 4 numbers");this._state0U=0|a[0],this._state0L=0|a[1],this._state1U=0|a[2],this._state1L=0|a[3]}n(e,"laya.d3.math.RandX");var a=e.prototype;a.randomint=function(){var a=this._state0U,b=this._state0L,c=this._state1U,d=this._state1L,e=(d>>>0)+(b>>>0),f=c+a+(e/2>>>31)>>>0,g=e>>>0,h=0,i=0;h=(a^=h=a<<23|(-512&b)>>>9)^(this._state0U=c),i=(b^=i=b<<23)^(this._state0L=d);h^=a>>>18,i^=b>>>18|(262143&a)<<14;return h^=c>>>5,i^=d>>>5|(31&c)<<27,this._state1U=h,this._state1L=i,[f,g]},a.random=function(){var a=this.randomint(),b=a[0],c=1023<<20|b>>>12,d=0|(a[1]>>>12|(4095&b)<<20);return e._CONVERTION_BUFFER.setUint32(0,c,!1),e._CONVERTION_BUFFER.setUint32(4,d,!1),db._CONVERTION_BUFFER.getFloat64(0,!1)-1},l(e,["_CONVERTION_BUFFER",function(){return this._CONVERTION_BUFFER=new DataView(new ArrayBuffer(8))},"defaultRand",function(){return this.defaultRand=new db([0,Date.now()/65536,0,Date.now()%65536])}])}(),function(){function a(a,b){this.origin=null,this.direction=null,this.origin=a,this.direction=b}return n(a,"laya.d3.math.Ray"),a}()),fb=function(){function a(a,b){this.elements=new Float32Array(2),void 0===a&&(a=0),void 0===b&&(b=0);var c=this.elements;c[0]=a,c[1]=b}n(a,"laya.d3.math.Vector2");var b=a.prototype;return v.imps(b,{"laya.d3.core.IClone":!0}),b.fromArray=function(a,b){void 0===b&&(b=0),this.elements[0]=a[b+0],this.elements[1]=a[b+1]},b.cloneTo=function(a){var b=a.elements,c=this.elements;b[0]=c[0],b[1]=c[1]},b.clone=function(){var a=new this.constructor;return this.cloneTo(a),a},o(0,b,"x",function(){return this.elements[0]},function(a){this.elements[0]=a}),o(0,b,"y",function(){return this.elements[1]},function(a){this.elements[1]=a}),a.scale=function(a,b,c){var d=c.elements,e=a.elements;d[0]=e[0]*b,d[1]=e[1]*b},l(a,["ZERO",function(){return this.ZERO=new a(0,0)},"ONE",function(){return this.ONE=new a(1,1)}]),a}(),gb=function(){function k(a,b,c){this.elements=new Float32Array(3),void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0);var d=this.elements;d[0]=a,d[1]=b,d[2]=c}n(k,"laya.d3.math.Vector3");var a=k.prototype;return v.imps(a,{"laya.d3.core.IClone":!0}),a.fromArray=function(a,b){void 0===b&&(b=0),this.elements[0]=a[b+0],this.elements[1]=a[b+1],this.elements[2]=a[b+2]},a.cloneTo=function(a){var b=a.elements,c=this.elements;b[0]=c[0],b[1]=c[1],b[2]=c[2]},a.clone=function(){var a=new this.constructor;return this.cloneTo(a),a},a.toDefault=function(){this.elements[0]=0,this.elements[1]=0,this.elements[2]=0},a.reset=function(a,b,c){this.elements[0]=a,this.elements[1]=b,this.elements[2]=c},o(0,a,"x",function(){return this.elements[0]},function(a){this.elements[0]=a}),o(0,a,"y",function(){return this.elements[1]},function(a){this.elements[1]=a}),o(0,a,"z",function(){return this.elements[2]},function(a){this.elements[2]=a}),k.distanceSquared=function(a,b){var c=a.elements,d=b.elements,e=c[0]-d[0],f=c[1]-d[1],g=c[2]-d[2];return e*e+f*f+g*g},k.distance=function(a,b){var c=a.elements,d=b.elements,e=c[0]-d[0],f=c[1]-d[1],g=c[2]-d[2];return Math.sqrt(e*e+f*f+g*g)},k.min=function(a,b,c){var d=c.elements,e=a.elements,f=b.elements;d[0]=Math.min(e[0],f[0]),d[1]=Math.min(e[1],f[1]),d[2]=Math.min(e[2],f[2])},k.max=function(a,b,c){var d=c.elements,e=a.elements,f=b.elements;d[0]=Math.max(e[0],f[0]),d[1]=Math.max(e[1],f[1]),d[2]=Math.max(e[2],f[2])},k.transformQuat=function(a,b,c){var d=c.elements,e=a.elements,f=b.elements,g=e[0],h=e[1],i=e[2],j=f[0],k=f[1],l=f[2],m=f[3],n=m*g+k*i-l*h,o=m*h+l*g-j*i,p=m*i+j*h-k*g,q=-j*g-k*h-l*i;d[0]=n*m+q*-j+o*-l-p*-k,d[1]=o*m+q*-k+p*-j-n*-l,d[2]=p*m+q*-l+n*-k-o*-j},k.scalarLength=function(a){var b=a.elements,c=b[0],d=b[1],e=b[2];return Math.sqrt(c*c+d*d+e*e)},k.scalarLengthSquared=function(a){var b=a.elements,c=b[0],d=b[1],e=b[2];return c*c+d*d+e*e},k.normalize=function(a,b){var c=a.elements,d=b.elements,e=c[0],f=c[1],g=c[2],h=e*e+f*f+g*g;0<h&&(h=1/Math.sqrt(h),d[0]=c[0]*h,d[1]=c[1]*h,d[2]=c[2]*h)},k.multiply=function(a,b,c){var d=c.elements,e=a.elements,f=b.elements;d[0]=e[0]*f[0],d[1]=e[1]*f[1],d[2]=e[2]*f[2]},k.scale=function(a,b,c){var d=c.elements,e=a.elements;d[0]=e[0]*b,d[1]=e[1]*b,d[2]=e[2]*b},k.lerp=function(a,b,c,d){var e=d.elements,f=a.elements,g=b.elements,h=f[0],i=f[1],j=f[2];e[0]=h+c*(g[0]-h),e[1]=i+c*(g[1]-i),e[2]=j+c*(g[2]-j)},k.transformV3ToV3=function(a,b,c){var d=k._tempVector4;k.transformV3ToV4(a,b,d);var e=d.elements,f=c.elements;f[0]=e[0],f[1]=e[1],f[2]=e[2]},k.transformV3ToV4=function(a,b,c){var d=a.elements,e=d[0],f=d[1],g=d[2],h=b.elements,i=c.elements;i[0]=e*h[0]+f*h[4]+g*h[8]+h[12],i[1]=e*h[1]+f*h[5]+g*h[9]+h[13],i[2]=e*h[2]+f*h[6]+g*h[10]+h[14],i[3]=e*h[3]+f*h[7]+g*h[11]+h[15]},k.TransformNormal=function(a,b,c){var d=a.elements,e=d[0],f=d[1],g=d[2],h=b.elements,i=c.elements;i[0]=e*h[0]+f*h[4]+g*h[8],i[1]=e*h[1]+f*h[5]+g*h[9],i[2]=e*h[2]+f*h[6]+g*h[10]},k.transformCoordinate=function(a,b,c){var d=k._tempVector4.elements,e=a.elements,f=e[0],g=e[1],h=e[2],i=b.elements;d[0]=f*i[0]+g*i[4]+h*i[8]+i[12],d[1]=f*i[1]+g*i[5]+h*i[9]+i[13],d[2]=f*i[2]+g*i[6]+h*i[10]+i[14],d[3]=1/(f*i[3]+g*i[7]+h*i[11]+i[15]);var j=c.elements;j[0]=d[0]*d[3],j[1]=d[1]*d[3],j[2]=d[2]*d[3]},k.Clamp=function(a,b,c,d){var e=a.elements,f=e[0],g=e[1],h=e[2],i=b.elements,j=i[0],k=i[1],l=i[2],m=c.elements,n=m[0],o=m[1],p=m[2],q=d.elements;f=(f=n<f?n:f)<j?j:f,g=(g=o<g?o:g)<k?k:g,h=(h=p<h?p:h)<l?l:h,q[0]=f,q[1]=g,q[2]=h},k.add=function(a,b,c){var d=c.elements,e=a.elements,f=b.elements;d[0]=e[0]+f[0],d[1]=e[1]+f[1],d[2]=e[2]+f[2]},k.subtract=function(a,b,c){var d=c.elements,e=a.elements,f=b.elements;d[0]=e[0]-f[0],d[1]=e[1]-f[1],d[2]=e[2]-f[2]},k.cross=function(a,b,c){var d=a.elements,e=b.elements,f=c.elements,g=d[0],h=d[1],i=d[2],j=e[0],k=e[1],l=e[2];f[0]=h*l-i*k,f[1]=i*j-g*l,f[2]=g*k-h*j},k.dot=function(a,b){var c=a.elements,d=b.elements;return c[0]*d[0]+c[1]*d[1]+c[2]*d[2]},k.equals=function(a,b){var c=a.elements,d=b.elements;return $a.nearEqual(Math.abs(c[0]),Math.abs(d[0]))&&$a.nearEqual(Math.abs(c[1]),Math.abs(d[1]))&&$a.nearEqual(Math.abs(c[2]),Math.abs(d[2]))},k.ZERO=new k(0,0,0),k.ONE=new k(1,1,1),k.NegativeUnitX=new k(-1,0,0),k.UnitX=new k(1,0,0),k.UnitY=new k(0,1,0),k.UnitZ=new k(0,0,1),k.ForwardRH=new k(0,0,-1),k.ForwardLH=new k(0,0,1),k.Up=new k(0,1,0),k.NAN=new k(NaN,NaN,NaN),l(k,["_tempVector4",function(){return this._tempVector4=new hb}]),k}(),hb=function(){function a(a,b,c,d){this.elements=new Float32Array(4),void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=0);var e=this.elements;e[0]=a,e[1]=b,e[2]=c,e[3]=d}n(a,"laya.d3.math.Vector4");var b=a.prototype;return v.imps(b,{"laya.d3.core.IClone":!0}),b.fromArray=function(a,b){void 0===b&&(b=0),this.elements[0]=a[b+0],this.elements[1]=a[b+1],this.elements[2]=a[b+2],this.elements[3]=a[b+3]},b.cloneTo=function(a){var b=a.elements,c=this.elements;b[0]=c[0],b[1]=c[1],b[2]=c[2],b[3]=c[3]},b.clone=function(){var a=new this.constructor;return this.cloneTo(a),a},b.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},b.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},o(0,b,"x",function(){return this.elements[0]},function(a){this.elements[0]=a}),o(0,b,"y",function(){return this.elements[1]},function(a){this.elements[1]=a}),o(0,b,"z",function(){return this.elements[2]},function(a){this.elements[2]=a}),o(0,b,"w",function(){return this.elements[3]},function(a){this.elements[3]=a}),a.lerp=function(a,b,c,d){var e=d.elements,f=a.elements,g=b.elements,h=f[0],i=f[1],j=f[2],k=f[3];e[0]=h+c*(g[0]-h),e[1]=i+c*(g[1]-i),e[2]=j+c*(g[2]-j),e[3]=k+c*(g[3]-k)},a.transformByM4x4=function(a,b,c){var d=a.elements,e=d[0],f=d[1],g=d[2],h=d[3],i=b.elements,j=c.elements;j[0]=e*i[0]+f*i[4]+g*i[8]+h*i[12],j[1]=e*i[1]+f*i[5]+g*i[9]+h*i[13],j[2]=e*i[2]+f*i[6]+g*i[10]+h*i[14],j[3]=e*i[3]+f*i[7]+g*i[11]+h*i[15]},a.equals=function(a,b){var c=a.elements,d=b.elements;return $a.nearEqual(Math.abs(c[0]),Math.abs(d[0]))&&$a.nearEqual(Math.abs(c[1]),Math.abs(d[1]))&&$a.nearEqual(Math.abs(c[2]),Math.abs(d[2]))&&$a.nearEqual(Math.abs(c[3]),Math.abs(d[3]))},a.normalize=function(a,b){var c=a.elements,d=b.elements,e=a.length();0<e&&(d[0]=c[0]*e,d[1]=c[1]*e,d[2]=c[2]*e,d[3]=c[3]*e)},a.add=function(a,b,c){var d=c.elements,e=a.elements,f=b.elements;d[0]=e[0]+f[0],d[1]=e[1]+f[1],d[2]=e[2]+f[2],d[3]=e[3]+f[3]},a.subtract=function(a,b,c){var d=c.elements,e=a.elements,f=b.elements;d[0]=e[0]-f[0],d[1]=e[1]-f[1],d[2]=e[2]-f[2],d[3]=e[3]-f[3]},a.multiply=function(a,b,c){var d=c.elements,e=a.elements,f=b.elements;d[0]=e[0]*f[0],d[1]=e[1]*f[1],d[2]=e[2]*f[2],d[3]=e[3]*f[3]},a.scale=function(a,b,c){var d=c.elements,e=a.elements;d[0]=e[0]*b,d[1]=e[1]*b,d[2]=e[2]*b,d[3]=e[3]*b},a.Clamp=function(a,b,c,d){var e=a.elements,f=e[0],g=e[1],h=e[2],i=e[3],j=b.elements,k=j[0],l=j[1],m=j[2],n=j[3],o=c.elements,p=o[0],q=o[1],r=o[2],s=o[3],t=d.elements;f=(f=p<f?p:f)<k?k:f,g=(g=q<g?q:g)<l?l:g,h=(h=r<h?r:h)<m?m:h,i=(i=s<i?s:i)<n?n:i,t[0]=f,t[1]=g,t[2]=h,t[3]=i},a.distanceSquared=function(a,b){var c=a.elements,d=b.elements,e=c[0]-d[0],f=c[1]-d[1],g=c[2]-d[2],h=c[3]-d[3];return e*e+f*f+g*g+h*h},a.distance=function(a,b){var c=a.elements,d=b.elements,e=c[0]-d[0],f=c[1]-d[1],g=c[2]-d[2],h=c[3]-d[3];return Math.sqrt(e*e+f*f+g*g+h*h)},a.dot=function(a,b){var c=a.elements,d=b.elements;return c[0]*d[0]+c[1]*d[1]+c[2]*d[2]+c[3]*d[3]},a.min=function(a,b,c){var d=c.elements,e=a.elements,f=b.elements;d[0]=Math.min(e[0],f[0]),d[1]=Math.min(e[1],f[1]),d[2]=Math.min(e[2],f[2]),d[3]=Math.min(e[3],f[3])},a.max=function(a,b,c){var d=c.elements,e=a.elements,f=b.elements;d[0]=Math.max(e[0],f[0]),d[1]=Math.max(e[1],f[1]),d[2]=Math.max(e[2],f[2]),d[3]=Math.max(e[3],f[3])},l(a,["ZERO",function(){return this.ZERO=new a},"ONE",function(){return this.ONE=new a(1,1,1,1)},"UnitX",function(){return this.UnitX=new a(1,0,0,0)},"UnitY",function(){return this.UnitY=new a(0,1,0,0)},"UnitZ",function(){return this.UnitZ=new a(0,0,1,0)},"UnitW",function(){return this.UnitW=new a(0,0,0,1)}]),a}(),ib=function(){function f(a,b,c,d){this.minDepth=0,this.maxDepth=1,this.x=a,this.y=b,this.width=c,this.height=d}n(f,"laya.d3.math.Viewport");var a=f.prototype;return a.project=function(a,b,c){gb.transformV3ToV3(a,b,c);var d=a.elements,e=b.elements,f=c.elements,g=d[0]*e[3]+d[1]*e[7]+d[2]*e[11]+e[15];1!==g&&(f[0]=f[0]/g,f[1]=f[1]/g,f[2]=f[2]/g),f[0]=.5*(f[0]+1)*this.width+this.x,f[1]=.5*(1-f[1])*this.height+this.y,f[2]=f[2]*(this.maxDepth-this.minDepth)+this.minDepth},a.unprojectFromMat=function(a,b,c){var d=a.elements,e=b.elements,f=c.elements;f[0]=(d[0]-this.x)/this.width*2-1,f[1]=-((d[1]-this.y)/this.height*2-1);var g=(this.maxDepth-this.minDepth)/2;f[2]=(d[2]-this.minDepth-g)/g;var h=f[0]*e[3]+f[1]*e[7]+f[2]*e[11]+e[15];gb.transformV3ToV3(c,b,c),1!==h&&(f[0]=f[0]/h,f[1]=f[1]/h,f[2]=f[2]/h)},a.unprojectFromWVP=function(a,b,c,d,e){ab.multiply(b,c,f._tempMatrix4x4),d&&ab.multiply(f._tempMatrix4x4,d,f._tempMatrix4x4),f._tempMatrix4x4.invert(f._tempMatrix4x4),this.unprojectFromMat(a,f._tempMatrix4x4,e)},l(f,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new ab}]),f}(),jb=function(){function C(a){this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._indexInMesh=0,this._vertexBuffer=null,this._vertexStart=0,this._vertexCount=0,this._indexBuffer=null,this._indexStart=0,this._indexCount=0,this._indices=null,this._bufferUsage={},this._mesh=a,this._boneIndicesList=[],this._subIndexBufferStart=[],this._subIndexBufferCount=[]}n(C,"laya.d3.resource.models.SubMesh");var a=C.prototype;return v.imps(a,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),a._getVertexBuffer=function(a){return void 0===a&&(a=0),0===a?this._vertexBuffer:null},a._getIndexBuffer=function(){return this._indexBuffer},a._getStaticBatchBakedVertexs=function(a,b){var c,d,e=this._vertexBuffer,f=e.vertexDeclaration,g=f.getVertexElementByUsage(0).offset/4,h=f.getVertexElementByUsage(3).offset/4,i=b.meshRender.lightmapScaleOffset,j=0,k=0,l=0,m=0,n=0,o=0;if(i)if(d=f.getVertexElementByUsage(15))l=f.vertexStride/4,c=0<this._vertexCount?e.getData().slice(this._vertexStart*l,(this._vertexStart+this._vertexCount)*l):e.getData().slice(),m=d.offset/4;else{l=(o=f.vertexStride/4)+2,c=this._vertexCount?new Float32Array(this._vertexCount*(e.vertexDeclaration.vertexStride/4+2)):new Float32Array(e.vertexCount*(e.vertexDeclaration.vertexStride/4+2)),m=(n=f.getVertexElementByUsage(2).offset/4)+2;var p=e.getData();for(j=0,k=p.length/o;j<k;j++){var q=0;q=0<this._vertexCount?(this._vertexStart+j)*o:j*o;var r=j*l,s=0;for(s=0;s<m;s++)c[r+s]=p[q+s];for(s=m;s<o;s++)c[r+s+2]=p[q+s]}}else l=f.vertexStride/4,c=this._vertexCount?e.getData().slice(this._vertexStart*l,(this._vertexStart+this._vertexCount)*l):e.getData().slice();if(a){var t=a.worldMatrix,u=C._tempMatrix4x40;t.invert(u);var v=C._tempMatrix4x41,w=b.transform.worldMatrix;ab.multiply(u,w,v)}else v=b.transform.worldMatrix;var x=C._tempQuaternion0;for(v.decomposeTransRotScale(C._tempVector30,x,C._tempVector31),j=0,k=c.length/l;j<k;j++){var y=j*l+g,z=j*l+h;if(qb.transformVector3ArrayToVector3ArrayCoordinate(c,y,v,c,y),qb.transformVector3ArrayByQuat(c,z,x,c,z),i){var A=j*l+m;if(d)qb.transformLightingMapTexcoordByUV1Array(c,A,i,c,A);else{var B=j*o+n;qb.transformLightingMapTexcoordByUV0Array(p,B,i,c,A)}}}return c},a._getVertexBuffers=function(){return null},a._beforeRender=function(a){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},a._render=function(a){var b,c=0,d=a.renderElement;if(1<this._indexCount){var e=this._boneIndicesList.length;if(1<e){for(var f=0;f<e;f++)(b=d._skinAnimationDatas||this._skinAnimationDatas)&&(d._shaderValue.setValue(0,b[f]),a._shader.uploadRenderElementUniforms(d._shaderValue.data)),D.mainContext.drawElements(4,this._subIndexBufferCount[f],5123,2*this._subIndexBufferStart[f]);y.drawCall+=e}else(b=d._skinAnimationDatas||this._skinAnimationDatas)&&(d._shaderValue.setValue(0,b[0]),a._shader.uploadRenderElementUniforms(d._shaderValue.data)),D.mainContext.drawElements(4,this._indexCount,5123,2*this._indexStart),y.drawCall++;c=this._indexCount}else c=this._indexBuffer.indexCount,(b=d._skinAnimationDatas||this._skinAnimationDatas)&&(d._shaderValue.setValue(0,b[0]),a._shader.uploadRenderElementUniforms(d._shaderValue.data)),D.mainContext.drawElements(4,c,5123,0),y.drawCall++;y.trianglesFaces+=c/3},a.getIndices=function(){return 0<this._indexCount?this._indices:this._indexBuffer.getData()},a.dispose=function(){this._indexBuffer.destroy(),this._vertexBuffer.destroy(),this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._vertexBuffer=null,this._indexBuffer=null},o(0,a,"_vertexBufferCount",function(){return 1}),o(0,a,"triangleCount",function(){return this._indexBuffer.indexCount/3}),l(C,["_tempVector30",function(){return this._tempVector30=new gb},"_tempVector31",function(){return this._tempVector31=new gb},"_tempQuaternion0",function(){return this._tempQuaternion0=new cb},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new ab},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new ab}]),C}(),kb=function(){function a(a){this.defineCounter=0,this.defines=null,a?(this.defineCounter=a.defineCounter,this.defines=a.defines.slice()):(this.defineCounter=0,this.defines=[])}return n(a,"laya.d3.shader.ShaderDefines",null,"ShaderDefines$1"),a.prototype.registerDefine=function(a){var b=Math.pow(2,this.defineCounter++);return this.defines[b]=a,b},a}(),lb=function(){function a(){}return n(a,"laya.d3.shader.ShaderInit3D"),a.__init__=function(){var a,b;yb._globalRegDefine("HIGHPRECISION",yb.SHADERDEFINE_HIGHPRECISION),yb._globalRegDefine("FOG",yb.SHADERDEFINE_FOG),yb._globalRegDefine("DIRECTIONLIGHT",yb.SHADERDEFINE_DIRECTIONLIGHT),yb._globalRegDefine("POINTLIGHT",yb.SHADERDEFINE_POINTLIGHT),yb._globalRegDefine("SPOTLIGHT",yb.SHADERDEFINE_SPOTLIGHT),yb._globalRegDefine("UV",yb.SHADERDEFINE_UV0),yb._globalRegDefine("COLOR",yb.SHADERDEFINE_COLOR),yb._globalRegDefine("UV1",yb.SHADERDEFINE_UV1),yb._globalRegDefine("CASTSHADOW",nb.SHADERDEFINE_CAST_SHADOW),yb._globalRegDefine("SHADOWMAP_PSSM1",nb.SHADERDEFINE_SHADOW_PSSM1),yb._globalRegDefine("SHADOWMAP_PSSM2",nb.SHADERDEFINE_SHADOW_PSSM2),yb._globalRegDefine("SHADOWMAP_PSSM3",nb.SHADERDEFINE_SHADOW_PSSM3),yb._globalRegDefine("SHADOWMAP_PCF_NO",nb.SHADERDEFINE_SHADOW_PCF_NO),yb._globalRegDefine("SHADOWMAP_PCF1",nb.SHADERDEFINE_SHADOW_PCF1),yb._globalRegDefine("SHADOWMAP_PCF2",nb.SHADERDEFINE_SHADOW_PCF2),yb._globalRegDefine("SHADOWMAP_PCF3",nb.SHADERDEFINE_SHADOW_PCF3),yb._globalRegDefine("DEPTHFOG",yb.SAHDERDEFINE_DEPTHFOG),Jb.addInclude("LightHelper.glsl","\nstruct DirectionLight\n{\n vec3 Direction;\n vec3 Diffuse;\n};\n\nstruct PointLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n float Range;\n};\n\nstruct SpotLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n vec3 Direction;\n float Spot;\n float Range;\n};\n\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent)\n{\n\tvec3 normalT = 2.0*normalMapSample - 1.0;\n\n\t// Build orthonormal basis.\n\tvec3 N = normalize(unitNormal);\n\tvec3 T = normalize(tangent- dot(tangent, N)*N);\n\tvec3 B = cross(T, N);\n\n\tmat3 TBN = mat3(T, B, N);\n\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN*normalT;\n\n\treturn bumpedNormal;\n}\n\n\nvoid  computeDirectionLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in DirectionLight dirLight,in vec3 ambinentColor,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);//不初始化在IOS中闪烁，PC中不会闪烁\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec=-normalize(dirLight.Direction);\n\t\n\tamb=matAmb*ambinentColor;\n\t\n\tfloat  diffuseFactor=dot(lightVec, normal);\n\t\n\tif(diffuseFactor>0.0)\n\t{\n\t   vec3 v = reflect(-lightVec, normal);\n\t   float specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t   \n\t   dif = diffuseFactor * matDif * dirLight.Diffuse;\n\t   spec = specFactor * matSpe.rgb;\n\t}\n\t\n}\n\nvoid computePointLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in PointLight poiLight,in vec3 ambinentColor, in vec3 pos,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec = poiLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > poiLight.Range )\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif( diffuseFactor > 0.0 )\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * poiLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\n\tfloat attenuate = 1.0 / dot(poiLight.Attenuation, vec3(1.0, d, d*d));\n\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\nvoid ComputeSpotLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in SpotLight spoLight,in vec3 ambinentColor,in vec3 pos, in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tamb = vec3(0.0);\n\tdif =vec3(0.0);\n\tspec= vec3(0.0);\n\tvec3 lightVec = spoLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > spoLight.Range)\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif(diffuseFactor > 0.0)\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * spoLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\t\n\tfloat spot = pow(max(dot(-lightVec, normalize(spoLight.Direction)), 0.0), spoLight.Spot);\n\n\tfloat attenuate = spot/dot(spoLight.Attenuation, vec3(1.0, d, d*d));\n\n\tamb *= spot;\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\n"),Jb.addInclude("ShadowHelper.glsl","uniform sampler2D u_shadowMap1;\nuniform sampler2D u_shadowMap2;\nuniform sampler2D u_shadowMap3;\nuniform vec2\t  u_shadowPCFoffset;\nuniform vec4     u_shadowPSSMDistance;\nvec4 packDepth(const in float depth)\n{\n\tconst vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n\tconst vec4 bitMask\t= vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n\tvec4 res = mod(depth*bitShift*vec4(255), vec4(256))/vec4(255);\n\tres -= res.xxyz * bitMask;\n\treturn res;\n}\nfloat unpackDepth(const in vec4 rgbaDepth)\n{\n\tconst vec4 bitShift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n\tfloat depth = dot(rgbaDepth, bitShift);\n\treturn depth;\n}\nfloat tex2DPCF( sampler2D shadowMap,vec2 texcoord,vec2 invsize,float zRef )\n{\n\tvec2 texelpos =texcoord / invsize;\n\tvec2 lerps = fract( texelpos );\n\tfloat sourcevals[4];\n\tsourcevals[0] = float( unpackDepth(texture2D(shadowMap,texcoord)) > zRef );\n\tsourcevals[1] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x,0))) > zRef );\n\tsourcevals[2] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(0,invsize.y))) > zRef );\n\tsourcevals[3] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x, invsize.y) )) > zRef );\n\treturn mix( mix(sourcevals[0],sourcevals[2],lerps.y),mix(sourcevals[1],sourcevals[3],lerps.y),lerps.x );\n}\nfloat getShadowPSSM3( sampler2D shadowMap1,sampler2D shadowMap2,sampler2D shadowMap3,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\tnPSNum += int(posViewZ>pssmDistance.z);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\telse if( nPSNum == 2 )\n\t{\n\t\tlightVP = lightShadowVP[3];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t} \n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap3,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM2( sampler2D shadowMap1,sampler2D shadowMap2,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM1( sampler2D shadowMap1,vec4 lightMVPPos,vec4 pssmDistance,vec2 shadowPCFOffset,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tif( posViewZ < pssmDistance.x )\n\t{\n\t\tvec3 vText = lightMVPPos.xyz / lightMVPPos.w;\n\t\tfloat fMyZ = vText.z - zBias;\n\t\t/*\n\t\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\t\tbool bInFrustum = all( bInFrustumVec );\n\t\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\t\tbool bFrustumTest = all( bFrustumTestVec );\n\t\t*/\n\t\tif ( fMyZ <= 1.0 ) \n\t\t{\n\t\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,fMyZ );\n\t\t\tvalue = value/4.0;\n#endif\n#ifdef SHADOWMAP_PCF2\t\t\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF_NO\t\t\n\t\t\tvec4 color = texture2D( shadowMap1,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t\t}\n\t}\n\treturn value;\n}"),a={a_Position:0,a_Color:1,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15,a_TexcoordNext0:14,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},b={u_Bones:[0,0],u_DiffuseTexture:[1,1],u_SpecularTexture:[3,1],u_NormalTexture:[2,1],u_AmbientTexture:[5,1],u_ReflectTexture:[6,1],u_AlphaTestValue:[0,1],u_Albedo:[7,1],u_UVMatrix:[13,1],u_UVAge:[14,1],u_UVAniAge:[8,1],u_MaterialDiffuse:[10,1],u_MaterialAmbient:[9,1],u_MaterialSpecular:[11,1],u_MaterialReflect:[12,1],u_TilingOffset:[15,1],u_WorldMat:[0,2],u_MvpMatrix:[1,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var c=Jb.nameKey.add("SIMPLE");shaderCompile=yb.add(c,"attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\nattribute vec2 a_Texcoord0;\nvarying vec2 v_Texcoord0;\n  #ifdef UVTRANSFORM \n  uniform mat4 u_UVMatrix;\n  #endif\n#endif\n\n#if defined(AMBIENTMAP)||(defined(LIGHTMAP)&&defined(UV1))\nattribute vec2 a_Texcoord1;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec4 u_LightmapScaleOffset;\nvarying vec2 v_LightMapUV;\n#endif\n\n\n#ifdef COLOR\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\nattribute vec4 a_BoneIndices;\nattribute vec4 a_BoneWeights;\nconst int c_MaxBoneCount = 24;\nuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nattribute vec3 a_Normal;\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP))&&defined(NORMALMAP)\nattribute vec3 a_Tangent0;\nvarying vec3 v_Tangent0;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\nuniform mat4 u_WorldMat;\nvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n \n//TODO没考虑UV动画呢\n#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\tv_Texcoord0=a_Texcoord0;\n#endif\n\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t#else\n\t\tworldMat=mat3(u_WorldMat);\n\t#endif  \n\tv_Normal=worldMat*a_Normal;\n\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tv_Tangent0=worldMat*a_Tangent0;\n\t#endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\t#ifdef BONE\n\t\tv_PositionWorld=(u_WorldMat*position).xyz;\n\t#else\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t#endif\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\n\tv_Texcoord0=a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,v_Texcoord0.y+1.0);\n\t#endif\n\t#ifdef UVTRANSFORM\n\t\tv_Texcoord0=(u_UVMatrix*vec4(v_Texcoord0,0.0,1.0)).xy;\n\t#endif\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\n\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=vec2(a_Texcoord1.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,1.0+a_Texcoord1.y*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t\t#else\n\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,a_Texcoord0.y-1.0)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t#endif \n\t#else\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t#else\n\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t#endif \n\t#endif \n#endif\n\n#ifdef COLOR\n\tv_Color=a_Color;\n#endif\n\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.w;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t#endif\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\n\tmain_castShadow();\n#else\n\tmain_normal();\n#endif\n}",'#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\nuniform vec4 u_Albedo;\n\n#ifdef ALPHATEST\nuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\nuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\nuniform samplerCube u_ReflectTexture;\nuniform vec3 u_MaterialReflect;\n#endif\n\n#if   defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\nvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nvarying vec2 v_LightMapUV;\n#endif\n#ifdef AMBIENTMAP\nuniform sampler2D u_AmbientTexture;\n#endif\n#ifdef LIGHTMAP\nuniform sampler2D u_LightMap;\n#endif\n\n#ifdef COLOR\nvarying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\nuniform vec3 u_MaterialDiffuse;\nuniform vec4 u_MaterialSpecular;\n  #if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP) \n  uniform sampler2D u_SpecularTexture;\n  #endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec3 u_MaterialAmbient;\n#endif\n\n#if defined(FOG)||defined(DEPTHFOG)\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\nuniform sampler2D u_NormalTexture;\nvarying vec3 v_Tangent0;\n#endif\n\n#ifdef DIRECTIONLIGHT\nuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\nuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\nuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||(defined(RECEIVESHADOW)&&(defined(SHADOWMAP_PSM2)||defined(SHADOWMAP_PSM3)))\nuniform vec3 u_CameraPos;\n#endif\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)\nvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n#if defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n#endif \n  \n#if defined(COLOR)&&!defined(DIFFUSEMAP)\n\tgl_FragColor=v_Color;\n#endif \n  \n#if defined(DIFFUSEMAP)&&defined(COLOR)\n\tvec4 texColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\tgl_FragColor=texColor*v_Color;\n#endif\n  \n#if !defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=vec4(1.0,1.0,1.0,1.0);\n#endif \n    \n#ifdef ALPHATEST\n\tif(gl_FragColor.a-u_AlphaTestValue<0.0)\n\t\tdiscard;\n#endif\n  \n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvec3 normal;\n    #if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent0));\n\t#else\n\t\tnormal = normalize(v_Normal);\n    #endif\n#endif\n\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(REFLECTMAP)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\t\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef AMBIENTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\ngl_FragColor=gl_FragColor*u_Albedo;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP)\n\t\tspecular =specular*texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n    #endif\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular*shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular,gl_FragColor.a);\n\t#endif\n#endif\n  \n#ifdef REFLECTMAP\n\tvec3 incident = -toEye;\n\tvec3 reflectionVector = reflect(incident,normal);\n\tvec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n\tgl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n#endif\n  \n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\t#ifdef ADDTIVEFOG\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t#else\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t#endif\n#endif\n#ifdef DEPTHFOG\n\tfloat lerpFact = (-v_PositionWorld.y-u_FogStart)/u_FogRange;\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\t\t\n\tmain_castShadow();\n#else\n  main_normal();\n#endif  \n}\n\n',a,b),Kb.SHADERDEFINE_DIFFUSEMAP=shaderCompile.registerMaterialDefine("DIFFUSEMAP"),Kb.SHADERDEFINE_NORMALMAP=shaderCompile.registerMaterialDefine("NORMALMAP"),Kb.SHADERDEFINE_SPECULARMAP=shaderCompile.registerMaterialDefine("SPECULARMAP"),Kb.SHADERDEFINE_EMISSIVEMAP=shaderCompile.registerMaterialDefine("EMISSIVEMAP"),Kb.SHADERDEFINE_AMBIENTMAP=shaderCompile.registerMaterialDefine("AMBIENTMAP"),Kb.SHADERDEFINE_REFLECTMAP=shaderCompile.registerMaterialDefine("REFLECTMAP"),Kb.SHADERDEFINE_UVTRANSFORM=shaderCompile.registerMaterialDefine("UVTRANSFORM"),Kb.SHADERDEFINE_TILINGOFFSET=shaderCompile.registerMaterialDefine("TILINGOFFSET"),Kb.SHADERDEFINE_ADDTIVEFOG=shaderCompile.registerMaterialDefine("ADDTIVEFOG")},a}(),mb=function(){function a(){this._data=null,this._data=[]}n(a,"laya.d3.shader.ValusArray");var b=a.prototype;return b.setValue=function(a,b){this._data[a]=b},o(0,b,"data",function(){return this._data}),a}(),nb=function(){function a(){}return a.SHADERDEFINE_RECEIVE_SHADOW=1,a.SHADERDEFINE_CAST_SHADOW=512,a.SHADERDEFINE_SHADOW_PSSM1=1024,a.SHADERDEFINE_SHADOW_PSSM2=2048,a.SHADERDEFINE_SHADOW_PSSM3=4096,a.SHADERDEFINE_SHADOW_PCF_NO=8192,a.SHADERDEFINE_SHADOW_PCF1=16384,a.SHADERDEFINE_SHADOW_PCF2=32768,a.SHADERDEFINE_SHADOW_PCF3=65536,a.MAX_PSSM_COUNT=3,a}(),ob=function(){function V(){}return n(V,"laya.d3.utils.Picker"),V.calculateCursorRay=function(a,b,c,d,e,f){var g=a.elements[0],h=a.elements[1],i=V._tempVector30,j=i.elements;j[0]=g,j[1]=h,j[2]=b.minDepth;var k=V._tempVector31,l=k.elements;l[0]=g,l[1]=h,l[2]=b.maxDepth;var m=f.origin,n=V._tempVector32;b.unprojectFromWVP(i,c,d,e,m),b.unprojectFromWVP(k,c,d,e,n);var o=f.direction.elements;o[0]=n.x-m.x,o[1]=n.y-m.y,o[2]=n.z-m.z,gb.normalize(f.direction,f.direction)},V.rayIntersectsPositionsAndIndices=function(a,b,c,d,e){for(var f=c.vertexStride/4,g=c.getVertexElementByUsage(0).offset/4,h=Number.MAX_VALUE,i=-1,j=-1,k=-1,l=0;l<d.length;l+=3){var m=V._tempVector35,n=m.elements,o=d[l]*f,p=o+g;n[0]=b[p],n[1]=b[1+p],n[2]=b[2+p];var q=V._tempVector36,r=q.elements,s=d[l+1]*f,t=s+g;r[0]=b[t],r[1]=b[1+t],r[2]=b[2+t];var u=V._tempVector37,v=u.elements,w=d[l+2]*f,x=w+g;v[0]=b[x],v[1]=b[1+x],v[2]=b[2+x];var y=laya.d3.utils.Picker.rayIntersectsTriangle(a,m,q,u);!isNaN(y)&&y<h&&(h=y,i=o,j=s,k=w)}if(h===Number.MAX_VALUE)return e.position.toDefault(),e.distance=Number.MAX_VALUE,e.trianglePositions[0].toDefault(),e.trianglePositions[1].toDefault(),e.trianglePositions[2].toDefault(),e.triangleNormals[0].toDefault(),e.triangleNormals[1].toDefault(),e.triangleNormals[2].toDefault(),!1;e.distance=h,gb.scale(a.direction,h,e.position),gb.add(a.origin,e.position,e.position);var z=e.trianglePositions,A=z[0],B=z[1],C=z[2],D=A.elements,E=B.elements,F=C.elements,G=i+g;D[0]=b[G],D[1]=b[G+1],D[2]=b[G+2];var H=j+g;E[0]=b[H],E[1]=b[H+1],E[2]=b[H+2];var I=k+g;F[0]=b[I],F[1]=b[I+1],F[2]=b[I+2];var J=c.getVertexElementByUsage(3);if(J){var K=J.offset/4,L=e.triangleNormals,M=L[0],N=L[1],O=L[2],P=M.elements,Q=N.elements,R=O.elements,S=i+K;P[0]=b[S],P[1]=b[S+1],P[2]=b[S+2];var T=j+K;Q[0]=b[T],Q[1]=b[T+1],Q[2]=b[T+2];var U=k+K;R[0]=b[U],R[1]=b[U+1],R[2]=b[U+2]}return!0},V.rayIntersectsTriangle=function(a,b,c,d){var e=V._tempVector30,f=V._tempVector31;gb.subtract(c,b,e),gb.subtract(d,b,f);var g,h=V._tempVector32;if(gb.cross(a.direction,f,h),(g=gb.dot(e,h))>-Number.MIN_VALUE&&g<Number.MIN_VALUE)return Number.NaN;var i,j=1/g,k=V._tempVector33;if(gb.subtract(a.origin,b,k),i=gb.dot(k,h),(i*=j)<0||1<i)return Number.NaN;var l,m,n=V._tempVector34;return gb.cross(k,e,n),l=gb.dot(a.direction,n),(l*=j)<0||1<i+l?Number.NaN:(m=gb.dot(f,n),(m*=j)<0?Number.NaN:m)},l(V,["_tempVector30",function(){return this._tempVector30=new gb},"_tempVector31",function(){return this._tempVector31=new gb},"_tempVector32",function(){return this._tempVector32=new gb},"_tempVector33",function(){return this._tempVector33=new gb},"_tempVector34",function(){return this._tempVector34=new gb},"_tempVector35",function(){return this._tempVector35=new gb},"_tempVector36",function(){return this._tempVector36=new gb},"_tempVector37",function(){return this._tempVector37=new gb}]),V}(),pb=(function(){function a(){this.distance=NaN,this.trianglePositions=null,this.triangleNormals=null,this.position=null,this.sprite3D=null,this.distance=-1,this.trianglePositions=[new gb,new gb,new gb],this.trianglePositions.length=3,this.triangleNormals=[new gb,new gb,new gb],this.triangleNormals.length=3,this.position=new gb}n(a,"laya.d3.utils.RaycastHit"),a.prototype.cloneTo=function(a){a.distance=this.distance,this.trianglePositions[0].cloneTo(a.trianglePositions[0]),this.trianglePositions[1].cloneTo(a.trianglePositions[1]),this.trianglePositions[2].cloneTo(a.trianglePositions[2]),this.triangleNormals[0].cloneTo(a.triangleNormals[0]),this.triangleNormals[1].cloneTo(a.triangleNormals[1]),this.triangleNormals[2].cloneTo(a.triangleNormals[2]),this.position.cloneTo(a.position),a.sprite3D=this.sprite3D}}(),function(){function a(a,b){this._width=0,this._height=0,this._width=a,this._height=b}n(a,"laya.d3.utils.Size");var b=a.prototype;return o(0,b,"width",function(){return-1===this._width?W.clientWidth:this._width}),o(0,b,"height",function(){return-1===this._height?W.clientHeight:this._height}),o(1,a,"fullScreen",function(){return new a(-1,-1)}),a}()),qb=function(){function G(){}return n(G,"laya.d3.utils.Utils3D"),G._rotationTransformScaleSkinAnimation=function(a,b,c,d,e,f,g,h,i,j,k,l){var m,n,o,p,q,r=G._tempArray16_0,s=G._tempArray16_1,t=G._tempArray16_2,u=d+d,v=e+e,w=f+f,x=d*u,y=e*u,z=e*v,A=f*u,B=f*v,C=f*w,D=g*u,E=g*v,F=g*w;for(r[15]=1,r[0]=1-z-C,r[1]=y+F,r[2]=A-E,r[4]=y-F,r[5]=1-x-C,r[6]=B+D,r[8]=A+E,r[9]=B-D,r[10]=1-x-z,s[15]=1,s[0]=h,s[5]=i,s[10]=j,m=0;m<4;m++)n=r[m],o=r[m+4],p=r[m+8],q=r[m+12],t[m]=n,t[m+4]=o,t[m+8]=p,t[m+12]=n*a+o*b+p*c+q;for(m=0;m<4;m++)n=t[m],o=t[m+4],p=t[m+8],q=t[m+12],k[m+l]=n*s[0]+o*s[1]+p*s[2]+q*s[3],k[m+l+4]=n*s[4]+o*s[5]+p*s[6]+q*s[7],k[m+l+8]=n*s[8]+o*s[9]+p*s[10]+q*s[11],k[m+l+12]=n*s[12]+o*s[13]+p*s[14]+q*s[15]},G._createNodeByJson=function(a,b,c,d){if(!c)switch(b.type){case"Sprite3D":c=new Ib;break;case"MeshSprite3D":c=new Vb;break;case"SkinnedMeshSprite3D":c=new SkinnedMeshSprite3D;break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":c=new ShuriKenParticle3D;break;case"TrailSprite3D":c=new TrailSprite3D;break;case"Terrain":c=new Terrain;break;case"Camera":c=new Ub;break;case"DirectionLight":c=new DirectionLight;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var e=b.props;if(e)for(var f in e)c[f]=e[f];var g=b.customProps;g&&(c instanceof laya.d3.core.Sprite3D?(c._parseBaseCustomProps(g),c._parseCustomProps(a,d,g,b),c._parseCustomComponent(a,d,b.components)):c._parseCustomProps(a,d,g,b));var h=b.child;if(h)for(var i=0,j=h.length;i<j;i++){var k=G._createNodeByJson(a,h[i],null,d);c.addChild(k)}return c},G._computeBoneAndAnimationDatasByBindPoseMatrxix=function(a,b,c,d,e,f){var g,h,i=0,j=0,k=a.length;for(g=0;g<k;i+=a[g].keyframeWidth,j+=16,g++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(b[i+0],b[i+1],b[i+2],b[i+3],b[i+4],b[i+5],b[i+6],b[i+7],b[i+8],b[i+9],d,j),0!=g&&(h=16*a[g].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(d,h,d,j,d,j));var l=c.length;for(g=0;g<l;g++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(d,16*f[g],c[g],e,16*g)},G._computeAnimationDatasByArrayAndMatrixFast=function(a,b,c,d){for(var e=0,f=a.length;e<f;e++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(b,16*d[e],a[e],c,16*e)},G._computeBoneAndAnimationDatasByBindPoseMatrxixOld=function(a,b,c,d,e){var f,g,h=0,i=0,j=a.length;for(f=0;f<j;h+=a[f].keyframeWidth,i+=16,f++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(b[h+7],b[h+8],b[h+9],b[h+3],b[h+4],b[h+5],b[h+6],b[h+0],b[h+1],b[h+2],d,i),0!=f&&(g=16*a[f].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(d,g,d,i,d,i));var k=c.length;for(f=0;f<k;f++){var l=16*f;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(d,l,c[f],e,l)}},G._computeAnimationDatasByArrayAndMatrixFastOld=function(a,b,c){for(var d=a.length,e=0;e<d;e++){var f=16*e;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(b,f,a[e],c,f)}},G._computeRootAnimationData=function(a,b,c){for(var d=0,e=0,f=0,g=a.length;d<g;e+=a[d].keyframeWidth,f+=16,d++)laya.d3.utils.Utils3D.createAffineTransformationArray(b[e+0],b[e+1],b[e+2],b[e+3],b[e+4],b[e+5],b[e+6],b[e+7],b[e+8],b[e+9],c,f)},G.transformVector3ArrayByQuat=function(a,b,c,d,e){var f=c.elements,g=a[b],h=a[b+1],i=a[b+2],j=f[0],k=f[1],l=f[2],m=f[3],n=m*g+k*i-l*h,o=m*h+l*g-j*i,p=m*i+j*h-k*g,q=-j*g-k*h-l*i;d[e]=n*m+q*-j+o*-l-p*-k,d[e+1]=o*m+q*-k+p*-j-n*-l,d[e+2]=p*m+q*-l+n*-k-o*-j},G.mulMatrixByArray=function(a,b,c,d,e,f){var g,h,i,j,k;if(e===c){for(c=G._tempArray16_3,g=0;g<16;++g)c[g]=e[f+g];d=0}for(g=0;g<4;g++)h=a[b+g],i=a[b+g+4],j=a[b+g+8],k=a[b+g+12],e[f+g]=h*c[d+0]+i*c[d+1]+j*c[d+2]+k*c[d+3],e[f+g+4]=h*c[d+4]+i*c[d+5]+j*c[d+6]+k*c[d+7],e[f+g+8]=h*c[d+8]+i*c[d+9]+j*c[d+10]+k*c[d+11],e[f+g+12]=h*c[d+12]+i*c[d+13]+j*c[d+14]+k*c[d+15]},G.mulMatrixByArrayFast=function(a,b,c,d,e,f){var g,h,i,j,k;for(g=0;g<4;g++)h=a[b+g],i=a[b+g+4],j=a[b+g+8],k=a[b+g+12],e[f+g]=h*c[d+0]+i*c[d+1]+j*c[d+2]+k*c[d+3],e[f+g+4]=h*c[d+4]+i*c[d+5]+j*c[d+6]+k*c[d+7],e[f+g+8]=h*c[d+8]+i*c[d+9]+j*c[d+10]+k*c[d+11],e[f+g+12]=h*c[d+12]+i*c[d+13]+j*c[d+14]+k*c[d+15]},G.mulMatrixByArrayAndMatrixFast=function(a,b,c,d,e){var f,g,h,i,j,k=c.elements,l=k[0],m=k[1],n=k[2],o=k[3],p=k[4],q=k[5],r=k[6],s=k[7],t=k[8],u=k[9],v=k[10],w=k[11],x=k[12],y=k[13],z=k[14],A=k[15],B=b,C=b+4,D=b+8,E=b+12,F=e,G=e+4,H=e+8,I=e+12;for(f=0;f<4;f++)g=a[B+f],h=a[C+f],i=a[D+f],j=a[E+f],d[F+f]=g*l+h*m+i*n+j*o,d[G+f]=g*p+h*q+i*r+j*s,d[H+f]=g*t+h*u+i*v+j*w,d[I+f]=g*x+h*y+i*z+j*A},G.createAffineTransformationArray=function(a,b,c,d,e,f,g,h,i,j,k,l){var m=d+d,n=e+e,o=f+f,p=d*m,q=d*n,r=d*o,s=e*n,t=e*o,u=f*o,v=g*m,w=g*n,x=g*o;k[l+0]=(1-(s+u))*h,k[l+1]=(q+x)*h,k[l+2]=(r-w)*h,k[l+3]=0,k[l+4]=(q-x)*i,k[l+5]=(1-(p+u))*i,k[l+6]=(t+v)*i,k[l+7]=0,k[l+8]=(r+w)*j,k[l+9]=(t-v)*j,k[l+10]=(1-(p+s))*j,k[l+11]=0,k[l+12]=a,k[l+13]=b,k[l+14]=c,k[l+15]=1},G.transformVector3ArrayToVector3ArrayCoordinate=function(a,b,c,d,e){var f=G._tempArray4_0,g=a[b+0],h=a[b+1],i=a[b+2],j=c.elements;f[0]=g*j[0]+h*j[4]+i*j[8]+j[12],f[1]=g*j[1]+h*j[5]+i*j[9]+j[13],f[2]=g*j[2]+h*j[6]+i*j[10]+j[14],f[3]=1/(g*j[3]+h*j[7]+i*j[11]+j[15]),d[e+0]=f[0]*f[3],d[e+1]=f[1]*f[3],d[e+2]=f[2]*f[3]},G.transformLightingMapTexcoordByUV0Array=function(a,b,c,d,e){var f=c.elements;d[e+0]=a[b+0]*f[0]+f[2],d[e+1]=(a[b+1]-1)*f[1]+f[3]},G.transformLightingMapTexcoordByUV1Array=function(a,b,c,d,e){var f=c.elements;d[e+0]=a[b+0]*f[0]+f[2],d[e+1]=1+a[b+1]*f[1]+f[3]},G.getURLVerion=function(a){var b=a.indexOf("?");return 0<=b?a.substr(b):null},G._quaternionCreateFromYawPitchRollArray=function(a,b,c,d){var e=.5*c,f=.5*b,g=.5*a,h=Math.sin(e),i=Math.cos(e),j=Math.sin(f),k=Math.cos(f),l=Math.sin(g),m=Math.cos(g);d[0]=m*j*i+l*k*h,d[1]=l*k*i-m*j*h,d[2]=m*k*h-l*j*i,d[3]=m*k*i+l*j*h},G._createAffineTransformationArray=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3],i=e+e,j=f+f,k=g+g,l=e*i,m=e*j,n=e*k,o=f*j,p=f*k,q=g*k,r=h*i,s=h*j,t=h*k,u=c[0],v=c[1],w=c[2];d[0]=(1-(o+q))*u,d[1]=(m+t)*u,d[2]=(n-s)*u,d[3]=0,d[4]=(m-t)*v,d[5]=(1-(l+q))*v,d[6]=(p+r)*v,d[7]=0,d[8]=(n+s)*w,d[9]=(p-r)*w,d[10]=(1-(l+o))*w,d[11]=0,d[12]=a[0],d[13]=a[1],d[14]=a[2],d[15]=1},G._mulMatrixArray=function(a,b,c,d){var e,f,g,h,i,j=b.elements,k=j[0],l=j[1],m=j[2],n=j[3],o=j[4],p=j[5],q=j[6],r=j[7],s=j[8],t=j[9],u=j[10],v=j[11],w=j[12],x=j[13],y=j[14],z=j[15],A=d,B=d+4,C=d+8,D=d+12;for(e=0;e<4;e++)f=a[e],g=a[e+4],h=a[e+8],i=a[e+12],c[A+e]=f*k+g*l+h*m+i*n,c[B+e]=f*o+g*p+h*q+i*r,c[C+e]=f*s+g*t+h*u+i*v,c[D+e]=f*w+g*x+h*y+i*z},G.getYawPitchRoll=function(a,b){G.transformQuat(gb.ForwardRH,a,cb.TEMPVector31),G.transformQuat(gb.Up,a,cb.TEMPVector32);var c=cb.TEMPVector32.elements;G.angleTo(gb.ZERO,cb.TEMPVector31,cb.TEMPVector33);var d=cb.TEMPVector33.elements;d[0]==Math.PI/2?(d[1]=G.arcTanAngle(c[2],c[0]),d[2]=0):d[0]==-Math.PI/2?(d[1]=G.arcTanAngle(-c[2],-c[0]),d[2]=0):(ab.createRotationY(-d[1],cb.TEMPMatrix0),ab.createRotationX(-d[0],cb.TEMPMatrix1),gb.transformCoordinate(cb.TEMPVector32,cb.TEMPMatrix0,cb.TEMPVector32),gb.transformCoordinate(cb.TEMPVector32,cb.TEMPMatrix1,cb.TEMPVector32),d[2]=G.arcTanAngle(c[1],-c[0])),d[1]<=-Math.PI&&(d[1]=Math.PI),d[2]<=-Math.PI&&(d[2]=Math.PI),d[1]>=Math.PI&&d[2]>=Math.PI&&(d[1]=0,d[2]=0,d[0]=Math.PI-d[0]),b[0]=d[1],b[1]=d[0],b[2]=d[2]},G.arcTanAngle=function(a,b){return 0==a?1==b?Math.PI/2:-Math.PI/2:0<a?Math.atan(b/a):a<0?0<b?Math.atan(b/a)+Math.PI:Math.atan(b/a)-Math.PI:0},G.angleTo=function(a,b,c){gb.subtract(b,a,cb.TEMPVector30),gb.normalize(cb.TEMPVector30,cb.TEMPVector30),c.elements[0]=Math.asin(cb.TEMPVector30.y),c.elements[1]=G.arcTanAngle(-cb.TEMPVector30.z,-cb.TEMPVector30.x)},G.transformQuat=function(a,b,c){var d=c.elements,e=a.elements,f=b,g=e[0],h=e[1],i=e[2],j=f[0],k=f[1],l=f[2],m=f[3],n=m*g+k*i-l*h,o=m*h+l*g-j*i,p=m*i+j*h-k*g,q=-j*g-k*h-l*i;d[0]=n*m+q*-j+o*-l-p*-k,d[1]=o*m+q*-k+p*-j-n*-l,d[2]=p*m+q*-l+n*-k-o*-j},G.quaterionNormalize=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=c*c+d*d+e*e+f*f;0<g&&(g=1/Math.sqrt(g),b[0]=c*g,b[1]=d*g,b[2]=e*g,b[3]=f*g)},G.matrix4x4MultiplyFFF=function(a,b,c){var d,e,f,g,h;if(c===b)for(b=new Float32Array(16),d=0;d<16;++d)b[d]=c[d];for(d=0;d<4;d++)e=a[d],f=a[d+4],g=a[d+8],h=a[d+12],c[d]=e*b[0]+f*b[1]+g*b[2]+h*b[3],c[d+4]=e*b[4]+f*b[5]+g*b[6]+h*b[7],c[d+8]=e*b[8]+f*b[9]+g*b[10]+h*b[11],c[d+12]=e*b[12]+f*b[13]+g*b[14]+h*b[15]},G.matrix4x4MultiplyMFM=function(a,b,c){G.matrix4x4MultiplyFFF(a.elements,b,c.elements)},l(G,["_typeToFunO",function(){return this._typeToFunO={INT16:"writeInt16",SHORT:"writeInt16",UINT16:"writeUint16",UINT32:"writeUint32",FLOAT32:"writeFloat32",INT:"writeInt32",UINT:"writeUint32",BYTE:"writeByte",STRING:"writeUTFString"}},"_tempVector3_0",function(){return this._tempVector3_0=new gb},"_tempVector3_1",function(){return this._tempVector3_1=new gb},"_tempVector3_2",function(){return this._tempVector3_2=new gb},"_tempVector3_3",function(){return this._tempVector3_3=new gb},"_tempVector3_4",function(){return this._tempVector3_4=new gb},"_tempVector3_5",function(){return this._tempVector3_5=new gb},"_tempVector3_6",function(){return this._tempVector3_6=new gb},"_tempArray4_0",function(){return this._tempArray4_0=new Float32Array(4)},"_tempArray16_0",function(){return this._tempArray16_0=new Float32Array(16)},"_tempArray16_1",function(){return this._tempArray16_1=new Float32Array(16)},"_tempArray16_2",function(){return this._tempArray16_2=new Float32Array(16)},"_tempArray16_3",function(){return this._tempArray16_3=new Float32Array(16)}]),G}(),rb=function(){function E(){}return n(E,"Laya3D"),E._cancelLoadByUrl=function(a){v.loader.cancelLoadByUrl(a),E._innerFirstLevelLoaderManager.cancelLoadByUrl(a),E._innerSecondLevelLoaderManager.cancelLoadByUrl(a),E._innerThirdLevelLoaderManager.cancelLoadByUrl(a),E._innerFourthLevelLoaderManager.cancelLoadByUrl(a)},E._changeWebGLSize=function(a,b){D.onStageResize(a,b),W.clientWidth=a,W.clientHeight=b},E.__init__=function(){var a=b.createMap;a.lh=[Ib,"SPRITE3DHIERARCHY"],a.ls=[Hb,"SPRITE3DHIERARCHY"],a.lm=[Pb,"MESH"],a.lmat=[Kb,"MATERIAL"],a.jpg=[Rb,"nativeimage"],a.jpeg=[Rb,"nativeimage"],a.png=[Rb,"nativeimage"],a.pkm=[Rb,"arraybuffer"],a.raw=[Nb,"arraybuffer"],a.mipmaps=[Nb,"arraybuffer"],r.parserMap.SPRITE3DHIERARCHY=E._loadHierarchy,r.parserMap.MESH=E._loadMesh,r.parserMap.MATERIAL=E._loadMaterial,r.parserMap.TEXTURECUBE=E._loadTextureCube,r.parserMap.TERRAIN=E._loadTerrain,E._innerFirstLevelLoaderManager.on("error",null,E._eventLoadManagerError),E._innerSecondLevelLoaderManager.on("error",null,E._eventLoadManagerError),E._innerThirdLevelLoaderManager.on("error",null,E._eventLoadManagerError),E._innerFourthLevelLoaderManager.on("error",null,E._eventLoadManagerError)},E.READ_BLOCK=function(){return E._readData.pos+=4,!0},E.READ_DATA=function(){return E._DATA.offset=E._readData.getUint32(),E._DATA.size=E._readData.getUint32(),!0},E.READ_STRINGS=function(){var a=[],b={offset:0,size:0};b.offset=E._readData.getUint16(),b.size=E._readData.getUint16();E._readData.pos;E._readData.pos=b.offset+E._DATA.offset;for(var c=0;c<b.size;c++){var d=E._readData.readUTFString();-1===d.lastIndexOf(".lmat")&&-1===d.lastIndexOf(".lpbr")||a.push(d)}return a},E.formatRelativePath=function(a,b){var c;if("."===b.charAt(0)){for(var d=(a+b).split("/"),e=0,f=d.length;e<f;e++)if(".."==d[e]){var g=e-1;0<g&&".."!==d[g]&&(d.splice(g,2),e-=2)}c=d.join("/")}else c=a+b;return null!=C.customFormat&&(c=C.customFormat(c,null)),c},E._eventLoadManagerError=function(a){v.loader.event("error",a)},E._addHierarchyInnerUrls=function(a,b,c,d,e,f){var g=E.formatRelativePath(d,e);c&&(g+=c),a.push({url:g,clas:f}),b[e]=g},E._getSprite3DHierarchyInnerUrls=function(a,b,c,d,e,f,g){var h,i=0,j=0;switch(a.type){case"Scene":var k=a.customProps.lightmaps;for(i=0,j=k.length;i<j;i++){var l=k[i].replace(".exr",".png");E._addHierarchyInnerUrls(d,e,f,g,l,Rb)}break;case"MeshSprite3D":case"TrailSprite3D":case"LineSprite3D":case"SkinnedMeshSprite3D":var m;if(a.instanceParams)(m=a.instanceParams.loadPath)&&E._addHierarchyInnerUrls(b,e,f,g,m,Pb);else{(m=(h=a.customProps).meshPath)&&E._addHierarchyInnerUrls(b,e,f,g,m,Pb);var n=h.materials;if(n)for(i=0,j=n.length;i<j;i++){for(var o=n[i],p=o.type.split("."),q=F.window,r=0,s=p.length;r<s;++r){q=q[this.clasPaths[r]]}if("function"!=typeof q)throw"_getSprite3DHierarchyInnerUrls 错误: "+o.type+" 不是类";E._addHierarchyInnerUrls(c,e,f,g,o.path,q)}}break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":var t=(h=a.customProps).meshPath;t&&E._addHierarchyInnerUrls(b,e,f,g,t,Pb);var u=h.material;if(u){p=u.type.split("."),q=F.window;for(r=0,s=p.length;r<s;++r){q=q[this.clasPaths[r]]}E._addHierarchyInnerUrls(c,e,f,g,u.path,q)}else{var v=h.materialPath;if(v)E._addHierarchyInnerUrls(c,e,f,g,v,ShurikenParticleMaterial);else{var w=h.texturePath;w&&E._addHierarchyInnerUrls(d,e,f,g,w,Rb)}}break;case"Terrain":E._addHierarchyInnerUrls(d,e,f,g,a.customProps.dataPath,TerrainRes)}var x=a.components;for(var y in x){var z=x[y];switch(y){case"Animator":var A=z.avatarPath;if(A)E._addHierarchyInnerUrls(d,e,f,g,A,Avatar);else{var B=z.avatar;B&&E._addHierarchyInnerUrls(d,e,f,g,B.path,Avatar)}var C=z.clipPaths;for(i=0,j=C.length;i<j;i++)E._addHierarchyInnerUrls(d,e,f,g,C[i],AnimationClip)}}var D=a.child;for(i=0,j=D.length;i<j;i++)E._getSprite3DHierarchyInnerUrls(D[i],b,c,d,e,f,g)},E._loadHierarchy=function(a){a.on("loaded",null,E._onHierarchylhLoaded,[a,a._class._getGroup()]),a.load(a.url,"json",!1,null,!0)},E._onHierarchylhLoaded=function(a,b,c){if(a._class.destroyed)a.endLoad();else{var d=a.url,e=qb.getURLVerion(d),f=C.getPath(d),g=[],h=[],i=[],j={};E._getSprite3DHierarchyInnerUrls(c,g,h,i,j,e,f);var k=g.length+h.length+i.length,l=k+1,m=1/l;if(E._onProcessChange(a,0,m,1),0<i.length){var n=k/l,o=B.create(null,E._onProcessChange,[a,m,n],!1);E._innerFourthLevelLoaderManager.create(i,B.create(null,E._onHierarchyInnerForthLevResouLoaded,[a,b,o,c,j,g,h,m+n*i.length,n]),o,null,null,1,!0,b)}else E._onHierarchyInnerForthLevResouLoaded(a,b,null,c,j,g,h,m,n)}},E._onHierarchyInnerForthLevResouLoaded=function(a,b,c,d,e,f,g,h,i){if(a._class.destroyed)a.endLoad();else if(c&&c.recover(),0<g.length){var j=B.create(null,E._onProcessChange,[a,h,i],!1);E._innerSecondLevelLoaderManager.create(g,B.create(null,E._onHierarchyInnerSecondLevResouLoaded,[a,b,j,d,e,f,h+i*g.length,i]),c,null,null,1,!0,b)}else E._onHierarchyInnerSecondLevResouLoaded(a,b,null,d,e,f,h,i)},E._onHierarchyInnerSecondLevResouLoaded=function(a,b,c,d,e,f,g,h){if(a._class.destroyed)a.endLoad();else if(c&&c.recover(),0<f.length){var i=B.create(null,E._onProcessChange,[a,g,h],!1);E._innerFirstLevelLoaderManager.create(f,B.create(null,E._onHierarchyInnerFirstLevResouLoaded,[a,i,d,e]),c,null,null,1,!0,b)}else E._onHierarchyInnerFirstLevResouLoaded(a,null,d,e)},E._onHierarchyInnerFirstLevResouLoaded=function(a,b,c,d){b&&b.recover(),a.endLoad([c,d])},E._loadTerrain=function(a){a.on("loaded",null,E._onTerrainLtLoaded,[a,a._class._getGroup()]),a.load(a.url,"json",!1,null,!0)},E._onTerrainLtLoaded=function(a,b,c){if(a._class.destroyed)a.endLoad();else{var d,e,f=a.url,g=qb.getURLVerion(f),h=C.getPath(f),i=[],j={},k=0,l=0,m=c.heightData;d=m.url,e=E.formatRelativePath(h,d),g&&(e+=g),d=j[d]=e;var n=c.detailTexture;for(k=0,l=n.length;k<l;k++)i.push({url:n[k].diffuse});var o=c.normalMap;for(k=0,l=o.length;k<l;k++)i.push({url:o[k]});var p=c.alphaMap;for(k=0,l=p.length;k<l;k++)i.push({url:p[k],params:[!1,!1,6408,!0]});for(k=0,l=i.length;k<l;k++){var q=i[k].url;e=E.formatRelativePath(h,q),g&&(e+=g),i[k].url=e,j[q]=e}var r=i.length,s=r+2,t=1/s;E._onProcessChange(a,0,t,1);var u={heightMapLoaded:!1,texturesLoaded:!1},v=B.create(null,E._onProcessChange,[a,t,t],!1);E._innerFourthLevelLoaderManager.create(d,B.create(null,E._onTerrainHeightMapLoaded,[a,v,c,j,u]),v,null,[m.numX,m.numZ,m.bitType,m.value],1,!0,b);var w=B.create(null,E._onProcessChange,[a,2*t,r/s],!1);E._innerFourthLevelLoaderManager.create(i,B.create(null,E._onTerrainTexturesLoaded,[a,w,c,j,u]),w,null,null,1,!0,b)}},E._onTerrainHeightMapLoaded=function(a,b,c,d,e){e.heightMapLoaded=!0,e.texturesLoaded&&(a.endLoad([c,d]),b.recover())},E._onTerrainTexturesLoaded=function(a,b,c,d,e){e.texturesLoaded=!0,e.heightMapLoaded&&(a.endLoad([c,d]),b.recover())},E._loadMesh=function(a){a.on("loaded",null,E._onMeshLmLoaded,[a,a._class._getGroup()]),a.load(a.url,"arraybuffer",!1,null,!0)},E._onMeshLmLoaded=function(a,b,c){if(a._class.destroyed)a.endLoad();else{var d,e,f,g=a.url,h=qb.getURLVerion(g),i=C.getPath(g),j={},k=0,l=0;switch((E._readData=new w(c)).pos=0,E._readData.readUTFString()){case"LAYAMODEL:02":case"LAYAMODEL:03":case"LAYAMODEL:0301":var m=E._readData.getUint32();E._readData.pos=E._readData.pos+4,l=E._readData.getUint16(),E._readData.pos=E._readData.pos+8*l;var n=E._readData.getUint32();for(l=E._readData.getUint16(),E._readData.pos=m+n,d=[],k=0;k<l;k++){var o=E._readData.readUTFString();-1!==o.lastIndexOf(".lmat")&&d.push(o)}break;default:for(E.READ_BLOCK(),k=0;k<2;k++){var p=E._readData.getUint16(),q=E._strings[p],r=E["READ_"+q];if(null==r)throw new Error("model file err,no this function:"+p+" "+q);1===k?d=r.call():r.call()}}for(k=0,f=d.length;k<f;k++){var s=d[k];e=E.formatRelativePath(i,s),h&&(e+=h),d[k]=e,j[s]=e}if(0<d.length){E._onProcessChange(a,0,.5,1);var t=B.create(null,E._onProcessChange,[a,.5,.5],!1);E._innerSecondLevelLoaderManager.create(d,B.create(null,E._onMeshMateialLoaded,[a,t,c,j]),t,null,null,1,!0,b)}else a.endLoad([c,j])}},E._onMeshMateialLoaded=function(a,b,c,d){a.endLoad([c,d]),b.recover()},E._getMaterialTexturePath=function(a,b,c){var d=a.length-4;return a.indexOf(".dds")!=d&&a.indexOf(".tga")!=d&&a.indexOf(".exr")!=d&&a.indexOf(".DDS")!=d&&a.indexOf(".TGA")!=d&&a.indexOf(".EXR")!=d||(a=a.substr(0,d)+".png"),a=E.formatRelativePath(c,a),b&&(a+=b),a},E._loadMaterial=function(a){a.on("loaded",null,E._onMaterilLmatLoaded,[a,a._class._getGroup()]),a.load(a.url,"json",!1,null,!0)},E._onMaterilLmatLoaded=function(a,b,c){if(a._class.destroyed)a.endLoad();else{var d,e=a.url,f=qb.getURLVerion(e),g=C.getPath(e),h=[],i={},j=c.customProps,k=c.version;if(k)switch(k){case"LAYAMATERIAL:01":case"LAYAMATERIAL:02":for(var l=c.props.textures,m=0,n=l.length;m<n;m++){var o=l[m],p=o.path;if(p){var q=p.length-4;p.indexOf(".exr")!=q&&p.indexOf(".EXR")!=q||(p=p.substr(0,q)+".png"),d=E.formatRelativePath(g,p),f&&(d+=f),h.push({url:d,params:o.params}),i[p]=d}}break;default:throw new Error("Laya3D:unkonwn version.")}else{var r=j.diffuseTexture.texture2D;if(r&&(d=E._getMaterialTexturePath(r,f,g),h.push(d),i[r]=d),j.normalTexture){var s=j.normalTexture.texture2D;s&&(d=E._getMaterialTexturePath(s,f,g),h.push(d),i[s]=d)}if(j.specularTexture){var t=j.specularTexture.texture2D;t&&(d=E._getMaterialTexturePath(t,f,g),h.push(d),i[t]=d)}if(j.emissiveTexture){var u=j.emissiveTexture.texture2D;u&&(d=E._getMaterialTexturePath(u,f,g),h.push(d),i[u]=d)}if(j.ambientTexture){var v=j.ambientTexture.texture2D;v&&(d=E._getMaterialTexturePath(v,f,g),h.push(d),i[v]=d)}if(j.reflectTexture){var w=j.reflectTexture.texture2D;w&&(d=E._getMaterialTexturePath(w,f,g),h.push(d),i[w]=d)}}var x=h.length,y=x+1,z=1/y;if(E._onProcessChange(a,0,z,1),0<x){var A=B.create(null,E._onProcessChange,[a,z,x/y],!1);E._innerFourthLevelLoaderManager.create(h,B.create(null,E._onMateialTexturesLoaded,[a,A,c,i]),A,Rb,null,1,!0,b)}else E._onMateialTexturesLoaded(a,null,c,null)}},E._onMateialTexturesLoaded=function(a,b,c,d){a.endLoad([c,d]),b&&b.recover()},E._loadTextureCube=function(a){a.on("loaded",null,E._onTextureCubeLtcLoaded,[a]),a.load(a.url,"json",!1,null,!0)},E._onTextureCubeLtcLoaded=function(a,b){if(a._class.destroyed)a.endLoad();else{var c=C.getPath(a.url),d=[E.formatRelativePath(c,b.px),E.formatRelativePath(c,b.nx),E.formatRelativePath(c,b.py),E.formatRelativePath(c,b.ny),E.formatRelativePath(c,b.pz),E.formatRelativePath(c,b.nz)];E._onProcessChange(a,0,1/7,1);var e=B.create(null,E._onProcessChange,[a,1/7,6/7],!1);E._innerFourthLevelLoaderManager.load(d,B.create(null,E._onTextureCubeImagesLoaded,[a,d,e]),e,"nativeimage")}},E._onTextureCubeImagesLoaded=function(a,b,c){var d=[];d.length=6;for(var e=0;e<6;e++){var f=b[e];d[e]=r.getRes(f),r.clearRes(f)}a.endLoad(d),c.recover()},E._onProcessChange=function(a,b,c,d){(d=b+d*c)<1&&a.event("progress",d)},E.init=function(a,b,c,d,e,f){if(void 0===c&&(c=!1),void 0===d&&(d=!1),void 0===e&&(e=!0),void 0===f&&(f=!0),s.update3DLoop=function(){},s.cancelLoadByUrl=function(a){E._cancelLoadByUrl(a)},i.isAntialias=c,i.isAlpha=d,i.premultipliedAlpha=e,i.isStencil=f,!D.enable())throw new Error("Laya3D启动失败，模拟器请尝试《雷电模拟器》最新版本！");s.changeWebGLSize=E._changeWebGLSize,p.is3DMode=!0,v.init(a,b),G.__init__(),lb.__init__(),Vb.__init__(),O.__init__(),E.__init__(),g.maxTextureCount=2,(E.debugMode||X.debugMode)&&(E._debugPhasorSprite=new T)},E.HIERARCHY="SPRITE3DHIERARCHY",E.MESH="MESH",E.MATERIAL="MATERIAL",E.PBRMATERIAL="PBRMTL",E.TEXTURECUBE="TEXTURECUBE",E.TERRAIN="TERRAIN",E._readData=null,E._debugPhasorSprite=null,E.debugMode=!1,l(E,["_DATA",function(){return this._DATA={offset:0,size:0}},"_strings",function(){return this._strings=["BLOCK","DATA","STRINGS"]},"_innerFirstLevelLoaderManager",function(){return this._innerFirstLevelLoaderManager=new b},"_innerSecondLevelLoaderManager",function(){return this._innerSecondLevelLoaderManager=new b},"_innerThirdLevelLoaderManager",function(){return this._innerThirdLevelLoaderManager=new b},"_innerFourthLevelLoaderManager",function(){return this._innerFourthLevelLoaderManager=new b}]),E}(),sb=function(a){function e(a){e.__super.call(this),this._owner=a,this._childs=[],this._localMatrix=new Float32Array(16),this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0}n(e,"laya.d3.animation.AnimationTransform3D",f);var b=e.prototype;return b._getlocalMatrix=function(){return this._localUpdate&&(qb._createAffineTransformationArray(this._localPosition,this._localRotation,this._localScale,this._localMatrix),this._localUpdate=!1),this._localMatrix},b._onWorldTransform=function(){if(!this._worldUpdate){this._worldUpdate=!0;for(var a=0,b=this._childs.length;a<b;a++)this._childs[a]._onWorldTransform()}},b._setWorldMatrixAndUpdate=function(a){if(this._worldMatrix=a,null==this._parent)throw new Error("don't need to set worldMatrix to root Node.");if(null==this._parent._parent)for(var b=this._getlocalMatrix(),c=0;c<16;++c)this._worldMatrix[c]=b[c];else qb.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);this._worldUpdate=!1},b._setWorldMatrixNoUpdate=function(a){this._worldMatrix=a},b._setWorldMatrixIgnoreUpdate=function(a){this._worldMatrix=a,this._worldUpdate=!1},b.getLocalPosition=function(){return this._localPosition},b.setLocalPosition=function(a){if(this._parent)this._localPosition=a,this._localUpdate=!0,this._onWorldTransform();else{var b=this._entity.owner._transform,c=this._entity.localPosition,d=c.elements;d[0]=a[0],d[1]=a[1],d[2]=a[2],b.localPosition=c}},b.getLocalRotation=function(){if(this._localQuaternionUpdate){var a=this._localRotationEuler;qb._quaternionCreateFromYawPitchRollArray(a[1]/e._angleToRandin,a[0]/e._angleToRandin,a[2]/e._angleToRandin,this._localRotation),this._localQuaternionUpdate=!1}return this._localRotation},b.setLocalRotation=function(a){if(this._parent)this._localRotation=a,qb.quaterionNormalize(this._localRotation,this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var b=this._entity.owner._transform,c=this._entity.localRotation,d=c.elements;d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3],b.localRotation=c}},b.getLocalScale=function(){return this._localScale},b.setLocalScale=function(a){if(this._parent)this._localScale=a,this._localUpdate=!0,this._onWorldTransform();else{var b=this._entity.owner._transform,c=this._entity.localScale,d=c.elements;d[0]=a[0],d[1]=a[1],d[2]=a[2],b.localScale=c}},b.getLocalRotationEuler=function(){if(this._locaEulerlUpdate){qb.getYawPitchRoll(this._localRotation,e._tempVector3);var a=e._tempVector3,b=this._localRotationEuler;b[0]=a[1]*e._angleToRandin,b[1]=a[0]*e._angleToRandin,b[2]=a[2]*e._angleToRandin,this._locaEulerlUpdate=!1}return this._localRotationEuler},b.setLocalRotationEuler=function(a){if(this._parent)qb._quaternionCreateFromYawPitchRollArray(a[1]/e._angleToRandin,a[0]/e._angleToRandin,a[2]/e._angleToRandin,this._localRotation),this._localRotationEuler=a,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var b=this._entity.owner._transform,c=this._entity.localRotationEuler,d=c.elements;d[0]=a[0],d[1]=a[1],d[2]=a[2],b.localRotationEuler=c}},b.getWorldMatrix=function(){if(this._worldUpdate){if(null!=this._parent._parent)qb.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);else for(var a=this._getlocalMatrix(),b=0;b<16;++b)this._worldMatrix[b]=a[b];this._worldUpdate=!1}return this._worldMatrix},b.setParent=function(a){if(this._parent!==a){if(this._parent){var b=this._parent._childs,c=b.indexOf(this);b.splice(c,1)}a&&(a._childs.push(this),a&&this._onWorldTransform()),this._parent=a}},l(e,["_tempVector3",function(){return this._tempVector3=new Float32Array(3)},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),e}(),tb=function(a){function b(){this._destroyed=!1,this._id=0,this._enable=!1,this._owner=null,this.started=!1,b.__super.call(this),this._destroyed=!1,this._id=b._uniqueIDCounter,b._uniqueIDCounter++}n(b,"laya.d3.component.Component3D",f);var c=b.prototype;return v.imps(c,{"laya.d3.core.render.IUpdate":!0,"laya.resource.IDestroy":!0}),c._initialize=function(a){this._owner=a,this._enable=!0,this.started=!1,this._load(a)},c._destroy=function(){this._unload(this._owner),this._owner=null,this._destroyed=!0},c._load=function(a){},c._start=function(a){},c._update=function(a){},c._lateUpdate=function(a){},c._preRenderUpdate=function(a){},c._postRenderUpdate=function(a){},c._unload=function(a){this.offAll()},c._cloneTo=function(a){},o(0,c,"id",function(){return this._id}),o(0,c,"destroyed",function(){return this._destroyed}),o(0,c,"owner",function(){return this._owner}),o(0,c,"enable",function(){return this._enable},function(a){this._enable!==a&&(this._enable=a,this.event("enablechanged",this._enable))}),o(0,c,"isSingleton",function(){return b._isSingleton}),b._isSingleton=!0,b._uniqueIDCounter=1,b}(),ub=function(a){function b(){this._destroyed=!1,b.__super.call(this),this._destroyed=!1}n(b,"laya.d3.core.GeometryFilter",f);var c=b.prototype;return v.imps(c,{"laya.resource.IDestroy":!0}),c._destroy=function(){this.offAll(),this._destroyed=!0},o(0,c,"_isAsyncLoaded",function(){return!0}),o(0,c,"_originalBoundingBoxCorners",function(){throw new Error("BaseRender: must override it.")}),o(0,c,"_originalBoundingSphere",function(){throw new Error("BaseRender: must override it.")}),o(0,c,"_originalBoundingBox",function(){throw new Error("BaseRender: must override it.")}),o(0,c,"destroyed",function(){return this._destroyed}),b}(),vb=function(a){function d(a){d.__super.call(this),this._id=++d._uniqueIDCounter,this._indexInSceneFrustumCullingObjects=-1,this._boundingBox=new Xa(new gb,new gb),this._boundingBoxCenter=new gb,this._boundingSphere=new Za(new gb,0),this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0,this._materials=[],this._renderElements=[],this._isPartOfStaticBatch=!1,this._destroyed=!1,this._owner=a,this._enable=!0,this._materialsInstance=[],this.lightmapIndex=-1,this.castShadow=!1,this.receiveShadow=!1,this.sortingFudge=0,this._owner.transform.on("worldmatrixneedchanged",this,this._onWorldMatNeedChange)}n(d,"laya.d3.core.render.BaseRender",f);var b=d.prototype;return v.imps(b,{"laya.resource.IDestroy":!0}),b._changeMaterialReference=function(a,b){a&&a._removeReference(),b._addReference()},b._getInstanceMaterial=function(a,b){var c=new a.constructor;return a.cloneTo(c),c.name=c.name+"(Instance)",this._materialsInstance[b]=!0,this._changeMaterialReference(this._materials[b],c),this._materials[b]=c},b._setShaderValuelightMap=function(a){this._setShaderValueTexture(3,a)},b._onWorldMatNeedChange=function(){this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0},b._renderRenderableBoundBox=function(){var a=rb._debugPhasorSprite,b=this.boundingBox,c=d._tempBoundBoxCorners;b.getCorners(c),a.line(c[0],d._greenColor,c[1],d._greenColor),a.line(c[2],d._greenColor,c[3],d._greenColor),a.line(c[4],d._greenColor,c[5],d._greenColor),a.line(c[6],d._greenColor,c[7],d._greenColor),a.line(c[0],d._greenColor,c[3],d._greenColor),a.line(c[1],d._greenColor,c[2],d._greenColor),a.line(c[2],d._greenColor,c[6],d._greenColor),a.line(c[3],d._greenColor,c[7],d._greenColor),a.line(c[0],d._greenColor,c[4],d._greenColor),a.line(c[1],d._greenColor,c[5],d._greenColor),a.line(c[4],d._greenColor,c[7],d._greenColor),a.line(c[5],d._greenColor,c[6],d._greenColor)},b._calculateBoundingSphere=function(){throw"BaseRender: must override it."},b._calculateBoundingBox=function(){throw"BaseRender: must override it."},b._setShaderValueTexture=function(a,b){this._owner._shaderValues.setValue(a,b)},b._setShaderValueMatrix4x4=function(a,b){this._owner._shaderValues.setValue(a,b?b.elements:null)},b._setShaderValueColor=function(a,b){this._owner._shaderValues.setValue(a,b?b.elements:null)},b._setShaderValueBuffer=function(a,b){this._owner._shaderValues.setValue(a,b)},b._setShaderValueInt=function(a,b){this._owner._shaderValues.setValue(a,b)},b._setShaderValueBool=function(a,b){this._owner._shaderValues.setValue(a,b)},b._setShaderValueNumber=function(a,b){this._owner._shaderValues.setValue(a,b)},b._setShaderValueVector2=function(a,b){this._owner._shaderValues.setValue(a,b?b.elements:null)},b._addShaderDefine=function(a){this._owner._shaderDefineValue|=a},b._removeShaderDefine=function(a){this._owner._shaderDefineValue&=~a},b._renderUpdate=function(a){return!0},b._applyLightMapParams=function(){if(0<=this._lightmapIndex){var a=this._owner.scene;if(a){var b=a.getlightmaps()[this._lightmapIndex];b?(this._addShaderDefine(Tb.SAHDERDEFINE_LIGHTMAP),b.loaded?this._setShaderValuelightMap(b):b.once("loaded",this,this._setShaderValuelightMap)):this._removeShaderDefine(Tb.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine(Tb.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine(Tb.SAHDERDEFINE_LIGHTMAP)},b._updateOctreeNode=function(){var a=this._treeNode;a&&this._octreeNodeNeedChange&&(a.updateObject(this),this._octreeNodeNeedChange=!1)},b._destroy=function(){this.offAll();var a=0,b=0;for(a=0,b=this._renderElements.length;a<b;a++)this._renderElements[a]._destroy();for(a=0,b=this._materials.length;a<b;a++)this._materials[a]._removeReference();this._renderElements=null,this._owner=null,this._materials=null,this._boundingBox=null,this._boundingBoxCenter=null,this._boundingSphere=null,this._lightmapScaleOffset=null,this._destroyed=!0},o(0,b,"boundingSphere",function(){return this._boundingSphereNeedChange&&(this._calculateBoundingSphere(),this._boundingSphereNeedChange=!1),this._boundingSphere}),o(0,b,"id",function(){return this._id}),o(0,b,"material",function(){var a=this._materials[0];if(a&&!this._materialsInstance[0]){var b=this._getInstanceMaterial(a,0);this.event("materialchanged",[this,0,b])}return this._materials[0]},function(a){this.sharedMaterial=a}),o(0,b,"sharedMaterial",function(){return this._materials[0]},function(a){var b=this._materials[0];b!==a&&(this._materials[0]=a,this._materialsInstance[0]=!1,this._changeMaterialReference(b,a),this.event("materialchanged",[this,0,a]))}),o(0,b,"lightmapIndex",function(){return this._lightmapIndex},function(a){this._lightmapIndex=a,this._applyLightMapParams()}),o(0,b,"lightmapScaleOffset",function(){return this._lightmapScaleOffset},function(a){this._lightmapScaleOffset=a,this._setShaderValueColor(2,a),this._addShaderDefine(Tb.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV)}),o(0,b,"enable",function(){return this._enable},function(a){this._enable=a,this.event("enablechanged",[this,a])}),o(0,b,"materials",function(){for(var a=0,b=this._materials.length;a<b;a++)if(!this._materialsInstance[a]){var c=this._getInstanceMaterial(this._materials[a],a);this.event("materialchanged",[this,a,c])}return this._materials.slice()},function(a){this.sharedMaterials=a}),o(0,b,"sharedMaterials",function(){return this._materials.slice()},function(a){if(!a)throw new Error("MeshRender: shadredMaterials value can't be null.");var b=a.length;this._materialsInstance.length=b;for(var c=0;c<b;c++){var d=this._materials[c];d!==a[c]&&(this._materialsInstance[c]=!1,this._changeMaterialReference(d,a[c]),this.event("materialchanged",[this,c,a[c]]))}this._materials=a}),o(0,b,"boundingBox",function(){return this._boundingBoxNeedChange&&(this._calculateBoundingBox(),this._boundingBoxNeedChange=!1),this._boundingBox}),o(0,b,"boundingBoxCenter",function(){if(this._boundingBoxCenterNeedChange){var a=this.boundingBox;gb.add(a.min,a.max,this._boundingBoxCenter),gb.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter),this._boundingBoxCenterNeedChange=!1}return this._boundingBoxCenter}),o(0,b,"receiveShadow",function(){return this._receiveShadow},function(a){this._receiveShadow!==a&&((this._receiveShadow=a)?this._addShaderDefine(nb.SHADERDEFINE_RECEIVE_SHADOW):this._removeShaderDefine(nb.SHADERDEFINE_RECEIVE_SHADOW))}),o(0,b,"destroyed",function(){return this._destroyed}),d._uniqueIDCounter=0,l(d,["_tempBoundBoxCorners",function(){return this._tempBoundBoxCorners=[new gb,new gb,new gb,new gb,new gb,new gb,new gb,new gb]},"_greenColor",function(){return this._greenColor=new hb(0,1,0,1)}]),d}(),wb=function(a){function h(a){this._owner=null,this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0,this._positionUpdate=!0,this._rotationUpdate=!0,this._scaleUpdate=!0,this._parent=null,this._childs=null,this._dummy=null,this.pivot=null,h.__super.call(this),this._localPosition=new gb,this._localRotation=new cb(0,0,0,1),this._localScale=new gb(1,1,1),this._localRotationEuler=new gb,this._localMatrix=new ab,this._position=new gb,this._rotation=new cb(0,0,0,1),this._scale=new gb(1,1,1),this._worldMatrix=new ab,this._forward=new gb,this._up=new gb,this._right=new gb,this._owner=a,this._childs=[]}n(h,"laya.d3.core.Transform3D",f);var b=h.prototype;return b._updateLocalMatrix=function(){if(!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z)ab.createAffineTransformation(this._localPosition,this.localRotation,this._localScale,this._localMatrix);else{var a=h._tempVector30;gb.multiply(this.pivot,this._localScale,a);var b=h._tempVector31;gb.subtract(a,this.pivot,b);var c=h._tempVector32,d=this.localRotation;gb.transformQuat(a,d,c),gb.subtract(c,a,c);var e=h._tempVector33;gb.subtract(this._localPosition,b,e),gb.subtract(e,c,e),ab.createAffineTransformation(e,d,this._localScale,this._localMatrix)}},b._onWorldPositionRotationTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._rotationUpdate){this._worldUpdate=this._positionUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var a=0,b=this._childs.length;a<b;a++)this._childs[a]._onWorldPositionRotationTransform()}},b._onWorldPositionScaleTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._scaleUpdate){this._worldUpdate=this._positionUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var a=0,b=this._childs.length;a<b;a++)this._childs[a]._onWorldPositionScaleTransform()}},b._onWorldPositionTransform=function(){if(!this._worldUpdate||!this._positionUpdate){this._worldUpdate=this._positionUpdate=!0,this.event("worldmatrixneedchanged");for(var a=0,b=this._childs.length;a<b;a++)this._childs[a]._onWorldPositionTransform()}},b._onWorldRotationTransform=function(){if(!this._worldUpdate||!this._rotationUpdate){this._worldUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var a=0,b=this._childs.length;a<b;a++)this._childs[a]._onWorldPositionRotationTransform()}},b._onWorldScaleTransform=function(){if(!this._worldUpdate||!this._scaleUpdate){this._worldUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var a=0,b=this._childs.length;a<b;a++)this._childs[a]._onWorldPositionScaleTransform()}},b._onWorldTransform=function(){if(!(this._worldUpdate&&this._positionUpdate&&this._rotationUpdate&&this._scaleUpdate)){this._worldUpdate=this._positionUpdate=this._rotationUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var a=0,b=this._childs.length;a<b;a++)this._childs[a]._onWorldTransform()}},b.translate=function(a,b){void 0===b&&(b=!0),b?(ab.createFromQuaternion(this.localRotation,h._tempMatrix0),gb.transformCoordinate(a,h._tempMatrix0,h._tempVector30),gb.add(this.localPosition,h._tempVector30,this._localPosition),this.localPosition=this._localPosition):(gb.add(this.position,a,this._position),this.position=this._position)},b.rotate=function(a,b,c){var d;void 0===b&&(b=!0),void 0===c&&(c=!0),d=c?a:(gb.scale(a,Math.PI/180,h._tempVector30),h._tempVector30),cb.createFromYawPitchRoll(d.y,d.x,d.z,h._tempQuaternion0),b?(cb.multiply(this._localRotation,h._tempQuaternion0,this._localRotation),this.localRotation=this._localRotation):(cb.multiply(h._tempQuaternion0,this.rotation,this._rotation),this.rotation=this._rotation)},b.lookAt=function(a,b,c){void 0===c&&(c=!1);var d,e=a.elements;if(c){if(d=this._localPosition.elements,Math.abs(d[0]-e[0])<$a.zeroTolerance&&Math.abs(d[1]-e[1])<$a.zeroTolerance&&Math.abs(d[2]-e[2])<$a.zeroTolerance)return;cb.lookAt(this._localPosition,a,b,this._localRotation),this._localRotation.invert(this._localRotation),this.localRotation=this._localRotation}else{var f=this.position;if(d=f.elements,Math.abs(d[0]-e[0])<$a.zeroTolerance&&Math.abs(d[1]-e[1])<$a.zeroTolerance&&Math.abs(d[2]-e[2])<$a.zeroTolerance)return;cb.lookAt(f,a,b,this._rotation),this._rotation.invert(this._rotation),this.rotation=this._rotation}},o(0,b,"_isFrontFaceInvert",function(){var a=this.scale,b=a.x<0;return a.y<0&&(b=!b),a.z<0&&(b=!b),b}),o(0,b,"owner",function(){return this._owner}),o(0,b,"localRotation",function(){if(this._localQuaternionUpdate){var a=this._localRotationEuler.elements;cb.createFromYawPitchRoll(a[1]/h._angleToRandin,a[0]/h._angleToRandin,a[2]/h._angleToRandin,this._localRotation)}return this._localRotation},function(a){this._localRotation=a,this._localRotation.normalize(this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),o(0,b,"worldMatrix",function(){return this._worldUpdate&&(null!=this._parent?ab.multiply(this._parent.worldMatrix,this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),this._worldUpdate=!1),this._worldMatrix},function(a){null===this._parent?a.cloneTo(this._localMatrix):(this._parent.worldMatrix.invert(this._localMatrix),ab.multiply(this._localMatrix,a,this._localMatrix)),this.localMatrix=this._localMatrix,this._worldMatrix=a,this._worldUpdate=!1}),o(0,b,"worldNeedUpdate",function(){return this._worldUpdate}),o(0,b,"localMatrix",function(){return this._localUpdate&&(this._updateLocalMatrix(),this._localUpdate=!1),this._localMatrix},function(a){this._localMatrix=a,this._localMatrix.decomposeTransRotScale(this._localPosition,this._localRotation,this._localScale),this._localUpdate=!1,this._onWorldTransform()}),o(0,b,"dummy",function(){return this._dummy},function(a){this._dummy!==a&&(this._dummy&&(this._dummy._entity=null),a&&(a._entity=this),this._dummy=a)}),o(0,b,"localPosition",function(){return this._localPosition},function(a){this._localPosition=a,this._localUpdate=!0,this._onWorldPositionTransform()}),o(0,b,"position",function(){if(this._positionUpdate){if(null!=this._parent){var a=this._parent.position;gb.multiply(this._localPosition,this._parent.scale,h._tempVector30),gb.transformQuat(h._tempVector30,this._parent.rotation,h._tempVector30),gb.add(a,h._tempVector30,this._position)}else this._localPosition.cloneTo(this._position);this._positionUpdate=!1}return this._position},function(a){if(null!=this._parent){gb.subtract(a,this._parent.position,this._localPosition);var b=this._parent.scale.elements,c=b[0],d=b[1],e=b[2];if(1!==c||1!==d||1!==e){var f=h._tempVector30,g=f.elements;g[0]=1/c,g[1]=1/d,g[2]=1/e,gb.multiply(this._localPosition,f,this._localPosition)}this._parent.rotation.invert(h._tempQuaternion0),gb.transformQuat(this._localPosition,h._tempQuaternion0,this._localPosition)}else a.cloneTo(this._localPosition);this.localPosition=this._localPosition,this._position=a,this._positionUpdate=!1}),o(0,b,"localScale",function(){return this._localScale},function(a){this._localScale=a,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldScaleTransform():this._onWorldPositionScaleTransform()}),o(0,b,"localRotationEuler",function(){if(this._locaEulerlUpdate){this._localRotation.getYawPitchRoll(h._tempVector30);var a=h._tempVector30.elements,b=this._localRotationEuler.elements;b[0]=a[1]*h._angleToRandin,b[1]=a[0]*h._angleToRandin,b[2]=a[2]*h._angleToRandin}return this._localRotationEuler},function(a){this._localRotationEuler=a,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!0,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),o(0,b,"rotation",function(){return this._rotationUpdate&&(null!=this._parent?cb.multiply(this._parent.rotation,this.localRotation,this._rotation):this.localRotation.cloneTo(this._rotation),this._rotationUpdate=!1),this._rotation},function(a){null!=this._parent?(this._parent.rotation.invert(h._tempQuaternion0),cb.multiply(a,h._tempQuaternion0,this._localRotation)):a.cloneTo(this._localRotation),this.localRotation=this._localRotation,this._rotation=a,this._rotationUpdate=!1}),o(0,b,"scale",function(){return this._scaleUpdate&&(null!==this._parent?gb.multiply(this._parent.scale,this._localScale,this._scale):this._localScale.cloneTo(this._scale),this._scaleUpdate=!1),this._scale},function(a){if(null!==this._parent){var b=this._parent.scale.elements,c=h._tempVector30.elements;c[0]=1/b[0],c[1]=1/b[1],c[2]=1/b[2],gb.multiply(a,h._tempVector30,this._localScale)}else a.cloneTo(this._localScale);this.localScale=this._localScale,this._scale=a,this._scaleUpdate=!1}),o(0,b,"rotationEuler",null,function(a){cb.createFromYawPitchRoll(a.y,a.x,a.z,this._rotation),this.rotation=this._rotation}),o(0,b,"forward",function(){var a=this.worldMatrix.elements;return this._forward.elements[0]=-a[8],this._forward.elements[1]=-a[9],this._forward.elements[2]=-a[10],this._forward}),o(0,b,"up",function(){var a=this.worldMatrix.elements;return this._up.elements[0]=a[4],this._up.elements[1]=a[5],this._up.elements[2]=a[6],this._up}),o(0,b,"right",function(){var a=this.worldMatrix.elements;return this._right.elements[0]=a[0],this._right.elements[1]=a[1],this._right.elements[2]=a[2],this._right}),o(0,b,"parent",function(){return this._parent},function(a){if(this._parent!==a){if(this._parent){var b=this._parent._childs,c=b.indexOf(this);b.splice(c,1)}a&&(a._childs.push(this),a&&this._onWorldTransform()),this._parent=a}}),l(h,["_tempVector30",function(){return this._tempVector30=new gb},"_tempVector31",function(){return this._tempVector31=new gb},"_tempVector32",function(){return this._tempVector32=new gb},"_tempVector33",function(){return this._tempVector33=new gb},"_tempQuaternion0",function(){return this._tempQuaternion0=new cb},"_tempMatrix0",function(){return this._tempMatrix0=new ab},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),h}(),xb=(function(a){function b(){this._rotation=0,this._matNeedUpdte=!1,b.__super.call(this),this._matrix=new ab,this._offset=new fb,this._tiling=new fb(1,1)}n(b,"laya.d3.core.TransformUV",f);var c=b.prototype;v.imps(c,{"laya.d3.core.IClone":!0}),c._updateMatrix=function(){b._tempOffsetV3.elements[0]=this._offset.x,b._tempOffsetV3.elements[1]=this._offset.y,cb.createFromYawPitchRoll(0,0,this._rotation,b._tempRotationQua),b._tempTitlingV3.elements[0]=this._tiling.x,b._tempTitlingV3.elements[1]=this._tiling.y,ab.createAffineTransformation(b._tempOffsetV3,b._tempRotationQua,b._tempTitlingV3,this._matrix)},c.cloneTo=function(a){a._matrix=this._matrix.clone(),a._offset=this._offset.clone(),a._rotation=this._rotation,a._tiling=this._tiling.clone()},c.clone=function(){var a=new this.constructor;return this.cloneTo(a),a},o(0,c,"matrix",function(){return this._matNeedUpdte&&(this._updateMatrix(),this._matNeedUpdte=!1),this._matrix}),o(0,c,"tiling",function(){return this._tiling},function(a){this._tiling=a,this._matNeedUpdte=!0}),o(0,c,"offset",function(){return this._offset},function(a){this._offset=a,this._matNeedUpdte=!0}),o(0,c,"rotation",function(){return this._rotation},function(a){this._rotation=a,this._matNeedUpdte=!0}),l(b,["_tempOffsetV3",function(){return this._tempOffsetV3=new gb(0,0,0)},"_tempRotationQua",function(){return this._tempRotationQua=new cb},"_tempTitlingV3",function(){return this._tempTitlingV3=new gb(1,1,1)}])}(),function(c){function a(){this.x=NaN,this.y=NaN,this.z=NaN,a.__super.call(this),this.x=1,this.y=1,this.z=1,this.randomDirection=!1}n(a,"laya.d3.core.particleShuriKen.module.shape.BoxShape",c);var b=a.prototype;b._getShapeBoundBox=function(a){var b=a.min.elements;b[0]=.5*-this.x,b[1]=.5*-this.y,b[2]=.5*-this.z;var c=a.max.elements;c[0]=.5*this.x,c[1]=.5*this.y,c[2]=.5*this.z},b._getSpeedBoundBox=function(a){var b=a.min.elements;b[0]=0,b[1]=0,b[2]=0;var c=a.max.elements;c[0]=0,c[1]=1,c[2]=0},b.generatePositionAndDirection=function(a,b,c,d){var e=a.elements,f=b.elements;c?(c.seed=d[16],R._randomPointInsideHalfUnitBox(a,c),d[16]=c.seed):R._randomPointInsideHalfUnitBox(a),e[0]=this.x*e[0],e[1]=this.y*e[1],e[2]=this.z*e[2],this.randomDirection?c?(c.seed=d[17],R._randomPointUnitSphere(b,c),d[17]=c.seed):R._randomPointUnitSphere(b):(f[0]=0,f[1]=0,f[2]=1)},b.cloneTo=function(a){c.prototype.cloneTo.call(this,a);var b=a;b.x=this.x,b.y=this.y,b.z=this.z,b.randomDirection=this.randomDirection}}(M),function(c){function g(){this.radius=NaN,this.arc=NaN,this.emitFromEdge=!1,g.__super.call(this),this.radius=1,this.arc=2*Math.PI,this.emitFromEdge=!1,this.randomDirection=!1}n(g,"laya.d3.core.particleShuriKen.module.shape.CircleShape",c);var a=g.prototype;a._getShapeBoundBox=function(a){var b=a.min.elements;b[0]=b[2]=-this.radius,b[1]=0;var c=a.max.elements;c[0]=c[2]=this.radius,c[1]=0},a._getSpeedBoundBox=function(a){var b=a.min.elements;b[0]=b[1]=-1,b[2]=0;var c=a.max.elements;c[0]=c[1]=1,c[2]=0},a.generatePositionAndDirection=function(a,b,c,d){var e=a.elements,f=g._tempPositionPoint.elements;c?(c.seed=d[16],this.emitFromEdge?R._randomPointUnitArcCircle(this.arc,g._tempPositionPoint,c):R._randomPointInsideUnitArcCircle(this.arc,g._tempPositionPoint,c),d[16]=c.seed):this.emitFromEdge?R._randomPointUnitArcCircle(this.arc,g._tempPositionPoint):R._randomPointInsideUnitArcCircle(this.arc,g._tempPositionPoint),e[0]=-f[0],e[1]=f[1],e[2]=0,gb.scale(a,this.radius,a),this.randomDirection?c?(c.seed=d[17],R._randomPointUnitSphere(b,c),d[17]=c.seed):R._randomPointUnitSphere(b):a.cloneTo(b)},a.cloneTo=function(a){c.prototype.cloneTo.call(this,a);var b=a;b.radius=this.radius,b.arc=this.arc,b.emitFromEdge=this.emitFromEdge,b.randomDirection=this.randomDirection},l(g,["_tempPositionPoint",function(){return this._tempPositionPoint=new fb}])}(M),function(c){function m(){this.angle=NaN,this.radius=NaN,this.length=NaN,this.emitType=0,m.__super.call(this),this.angle=25/180*Math.PI,this.radius=1,this.length=5,this.emitType=0,this.randomDirection=!1}n(m,"laya.d3.core.particleShuriKen.module.shape.ConeShape",c);var a=m.prototype;a._getShapeBoundBox=function(a){var b=this.radius+this.length*Math.sin(this.angle),c=this.length*Math.cos(this.angle),d=a.min.elements;d[0]=d[1]=-b,d[2]=0;var e=a.max.elements;e[0]=e[1]=b,e[2]=c},a._getSpeedBoundBox=function(a){var b=Math.sin(this.angle),c=a.min.elements;c[0]=c[1]=-b,c[2]=0;var d=a.max.elements;d[0]=c[1]=b,d[2]=1},a.generatePositionAndDirection=function(a,b,c,d){var e,f=a.elements,g=b.elements,h=m._tempPositionPoint.elements,i=NaN,j=NaN,k=Math.cos(this.angle),l=Math.sin(this.angle);switch(this.emitType){case 0:c?(c.seed=d[16],R._randomPointInsideUnitCircle(m._tempPositionPoint,c),d[16]=c.seed):R._randomPointInsideUnitCircle(m._tempPositionPoint),i=h[0],j=h[1],f[0]=i*this.radius,f[1]=j*this.radius,f[2]=0,this.randomDirection?(c?(c.seed=d[17],R._randomPointInsideUnitCircle(m._tempDirectionPoint,c),d[17]=c.seed):R._randomPointInsideUnitCircle(m._tempDirectionPoint),e=m._tempDirectionPoint.elements,g[0]=e[0]*l,g[1]=e[1]*l):(g[0]=i*l,g[1]=j*l),g[2]=k;break;case 1:c?(c.seed=d[16],R._randomPointUnitCircle(m._tempPositionPoint,c),d[16]=c.seed):R._randomPointUnitCircle(m._tempPositionPoint),i=h[0],j=h[1],f[0]=i*this.radius,f[1]=j*this.radius,f[2]=0,this.randomDirection?(c?(c.seed=d[17],R._randomPointInsideUnitCircle(m._tempDirectionPoint,c),d[17]=c.seed):R._randomPointInsideUnitCircle(m._tempDirectionPoint),e=m._tempDirectionPoint.elements,g[0]=e[0]*l,g[1]=e[1]*l):(g[0]=i*l,g[1]=j*l),g[2]=k;break;case 2:c?(c.seed=d[16],R._randomPointInsideUnitCircle(m._tempPositionPoint,c)):R._randomPointInsideUnitCircle(m._tempPositionPoint),i=h[0],j=h[1],f[0]=i*this.radius,f[1]=j*this.radius,g[f[2]=0]=i*l,g[1]=j*l,g[2]=k,gb.normalize(b,b),c?(gb.scale(b,this.length*c.getFloat(),b),d[16]=c.seed):gb.scale(b,this.length*Math.random(),b),gb.add(a,b,a),this.randomDirection&&(c?(c.seed=d[17],R._randomPointUnitSphere(b,c),d[17]=c.seed):R._randomPointUnitSphere(b));break;case 3:c?(c.seed=d[16],R._randomPointUnitCircle(m._tempPositionPoint,c)):R._randomPointUnitCircle(m._tempPositionPoint),i=h[0],j=h[1],f[0]=i*this.radius,f[1]=j*this.radius,g[f[2]=0]=i*l,g[1]=j*l,g[2]=k,gb.normalize(b,b),c?(gb.scale(b,this.length*c.getFloat(),b),d[16]=c.seed):gb.scale(b,this.length*Math.random(),b),gb.add(a,b,a),this.randomDirection&&(c?(c.seed=d[17],R._randomPointUnitSphere(b,c),d[17]=c.seed):R._randomPointUnitSphere(b));break;default:throw new Error("ConeShape:emitType is invalid.")}},a.cloneTo=function(a){c.prototype.cloneTo.call(this,a);var b=a;b.angle=this.angle,b.radius=this.radius,b.length=this.length,b.emitType=this.emitType,b.randomDirection=this.randomDirection},l(m,["_tempPositionPoint",function(){return this._tempPositionPoint=new fb},"_tempDirectionPoint",function(){return this._tempDirectionPoint=new fb}])}(M),function(c){function a(){this.radius=NaN,this.emitFromShell=!1,a.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}n(a,"laya.d3.core.particleShuriKen.module.shape.HemisphereShape",c);var b=a.prototype;b._getShapeBoundBox=function(a){var b=a.min.elements;b[0]=b[1]=b[2]=-this.radius;var c=a.max.elements;c[0]=c[1]=this.radius,c[2]=0},b._getSpeedBoundBox=function(a){var b=a.min.elements;b[0]=b[1]=-1,b[2]=0;var c=a.max.elements;c[0]=c[1]=c[2]=1},b.generatePositionAndDirection=function(a,b,c,d){var e=a.elements;c?(c.seed=d[16],this.emitFromShell?R._randomPointUnitSphere(a,c):R._randomPointInsideUnitSphere(a,c),d[16]=c.seed):this.emitFromShell?R._randomPointUnitSphere(a):R._randomPointInsideUnitSphere(a),gb.scale(a,this.radius,a);var f=e[2];f<0&&(e[2]=-1*f),this.randomDirection?c?(c.seed=d[17],R._randomPointUnitSphere(b,c),d[17]=c.seed):R._randomPointUnitSphere(b):a.cloneTo(b)},b.cloneTo=function(a){c.prototype.cloneTo.call(this,a);var b=a;b.radius=this.radius,b.emitFromShell=this.emitFromShell,b.randomDirection=this.randomDirection}}(M),function(c){function a(){this.radius=NaN,this.emitFromShell=!1,a.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}n(a,"laya.d3.core.particleShuriKen.module.shape.SphereShape",c);var b=a.prototype;b._getShapeBoundBox=function(a){var b=a.min.elements;b[0]=b[1]=b[2]=-this.radius;var c=a.max.elements;c[0]=c[1]=c[2]=this.radius},b._getSpeedBoundBox=function(a){var b=a.min.elements;b[0]=b[1]=b[2]=-1;var c=a.max.elements;c[0]=c[1]=c[2]=1},b.generatePositionAndDirection=function(a,b,c,d){c?(c.seed=d[16],this.emitFromShell?R._randomPointUnitSphere(a,c):R._randomPointInsideUnitSphere(a,c),d[16]=c.seed):this.emitFromShell?R._randomPointUnitSphere(a):R._randomPointInsideUnitSphere(a),gb.scale(a,this.radius,a),this.randomDirection?c?(c.seed=d[17],R._randomPointUnitSphere(b,c),d[17]=c.seed):R._randomPointUnitSphere(b):a.cloneTo(b)},b.cloneTo=function(a){c.prototype.cloneTo.call(this,a);var b=a;b.radius=this.radius,b.emitFromShell=this.emitFromShell,b.randomDirection=this.randomDirection}}(M),function(a){function b(){this._batchIndexStart=0,this._batchIndexEnd=0,this._skinAnimationDatas=null,b.__super.call(this)}return n(b,"laya.d3.core.render.SubMeshRenderElement",U),b}()),yb=function(a){function q(a,b,c,d,e,f){this._name=NaN,this._attributeMap=null,this._renderElementUniformMap=null,this._materialUniformMap=null,this._spriteUniformMap=null,this._cameraUniformMap=null,this._sceneUniformMap=null,this.sharders=null,this._spriteDefineCounter=3,this._spriteInt2name=[],this._spriteName2Int={},this._materialDefineCounter=1,this._materialInt2name=[],this._materialName2Int={},this._conchShader=null,this._name=a,this._renderElementUniformMap={},this._materialUniformMap={},this._spriteUniformMap={},this._cameraUniformMap={},this._sceneUniformMap={},this.sharders=[],this._spriteInt2name[nb.SHADERDEFINE_RECEIVE_SHADOW]="RECEIVESHADOW",this._spriteInt2name[Tb.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV]="SCALEOFFSETLIGHTINGMAPUV",this._spriteInt2name[Tb.SAHDERDEFINE_LIGHTMAP]="LIGHTMAP",this._spriteInt2name[0]="BONE",this._materialInt2name[Cb.SHADERDEFINE_ALPHATEST]="ALPHATEST";q.__super.call(this,a,b,c,null,{}),this._attributeMap=d;var g;for(g in e){var h=e[g];switch(h[1]){case 0:this._renderElementUniformMap[g]=h[0];break;case 1:this._materialUniformMap[g]=h[0];break;case 2:this._spriteUniformMap[g]=h[0];break;case 3:this._cameraUniformMap[g]=h[0];break;case 4:this._sceneUniformMap[g]=h[0];break;default:throw new Error("ShaderCompile3D: period is unkonw.")}}}n(q,"laya.d3.shader.ShaderCompile3D",t);var b=q.prototype;return b._definesToNameDic=function(a,b){for(var c={},d=1,e=0;e<32&&!(a<(d=1<<e));e++)if(a&d){var f=b[d];f&&(c[f]="")}return c},b.withCompile=function(a,b,c,d){var e,f,g;if(f=this.sharders[a])if(g=f[b]){if(e=g[c])return e}else g=f[b]=[];else g=(f=this.sharders[a]=[])[b]=[];var h,i=this._definesToNameDic(a,q._globalInt2name),j=this._definesToNameDic(b,this._spriteInt2name),k=this._definesToNameDic(c,this._materialInt2name),l={},m="";if(i)for(h in i)m+="#define "+h+"\n",l[h]=!0;if(j)for(h in j)m+="#define "+h+"\n",l[h]=!0;if(k)for(h in k)m+="#define "+h+"\n",l[h]=!0;var n=Jb.nameKey.getName(this._name)+" compile ("+a+","+b+","+c+")",o=this._VS.toscript(l,[]),p=this._PS.toscript(l,[]);F.now();if(e=Jb.create(m+o.join("\n"),m+p.join("\n"),this._attributeMap,this._sceneUniformMap,this._cameraUniformMap,this._spriteUniformMap,this._materialUniformMap,this._renderElementUniformMap,d,n),g[c]=e,laya.d3.shader.ShaderCompile3D.debugMode)F.now();return e},b.precompileShaderWithShaderDefine=function(a,b,c){this.withCompile(a,b,c,!0)},b.addMaterialDefines=function(a){var b=a.defines;for(var c in b){var d=b[c],e=parseInt(c);this._materialInt2name[e]=d,this._materialName2Int[d]=e}},b.addSpriteDefines=function(a){var b=a.defines;for(var c in b){var d=b[c],e=parseInt(c);this._spriteInt2name[e]=d,this._spriteName2Int[d]=e}},b.getMaterialDefineByName=function(a){return this._materialName2Int[a]},b.registerMaterialDefine=function(a){var b=Math.pow(2,this._materialDefineCounter++);return this._materialInt2name[b]=a,this._materialName2Int[a]=b},b.registerSpriteDefine=function(a){var b=Math.pow(2,this._spriteDefineCounter++);return this._spriteInt2name[b]=a,this._spriteName2Int[a]=b},q._globalRegDefine=function(a,b){q._globalInt2name[b]=a},q.add=function(a,b,c,d,e){return laya.d3.shader.ShaderCompile3D._preCompileShader[a]=new q(a,b,c,d,e,t.includes)},q.get=function(a){return laya.d3.shader.ShaderCompile3D._preCompileShader[Jb.nameKey.getID(a)]},q._preCompileShader={},q._globalInt2name=[],q.debugMode=!1,q.SHADERDEFINE_HIGHPRECISION=1,q.SHADERDEFINE_FOG=4,q.SHADERDEFINE_DIRECTIONLIGHT=8,q.SHADERDEFINE_POINTLIGHT=16,q.SHADERDEFINE_SPOTLIGHT=32,q.SHADERDEFINE_UV0=64,q.SHADERDEFINE_COLOR=128,q.SHADERDEFINE_UV1=256,q.SAHDERDEFINE_DEPTHFOG=131072,q}(),zb=function(a){function o(){o.__super.call(this)}n(o,"laya.d3.graphics.MeshSprite3DStaticBatchManager",da);var b=o.prototype;return b._getStaticBatch=function(a,b,c,d){var e,f;return f=a?a.id.toString()+c.id.toString()+b.id.toString()+d.toString():c.id.toString()+b.id.toString()+d.toString(),this._staticBatches[f]?e=this._staticBatches[f]:this._staticBatches[f]=e=new Ab(f,this,a,b,c),e},b._initStaticBatchs=function(a){var b,c;this._initBatchRenderElements.sort(o._sortPrepareStaticBatch);for(var d,e=!1,f=0,g=0,h=this._initBatchRenderElements.length;g<h;g++){var i,j=this._initBatchRenderElements[g],k=j.renderObj._getVertexBuffer(0);j._sprite3D;if(c===k.vertexDeclaration&&b===j._material)if(e)d._addCombineBatchRenderObjTest(j)?(i=j._staticBatch)!==d&&(i&&i._deleteCombineBatchRenderObj(j),d._addCombineBatchRenderObj(j)):(e=!1,f++);else{var l=this._initBatchRenderElements[g-1],m=l.renderObj,n=j.renderObj;e=!(65535<m._getVertexBuffer().vertexCount+n._getVertexBuffer().vertexCount)&&(d=this._getStaticBatch(a,c,b,f),(i=l._staticBatch)!==d&&(i&&i._deleteCombineBatchRenderObj(l),d._addCombineBatchRenderObj(l)),(i=j._staticBatch)!==d&&(i&&i._deleteCombineBatchRenderObj(j),d._addCombineBatchRenderObj(j)),!0)}else e=!1,f=0;b=j._material,c=k.vertexDeclaration}},o._sortPrepareStaticBatch=function(a,b){var c=a._render,d=b._render,e=c.lightmapIndex-d.lightmapIndex;if(0!=e)return e;var f=c.receiveShadow-d.receiveShadow;if(0!=f)return f;var g=a._mainSortID-b._mainSortID;return 0==g?a.renderObj.triangleCount-b.renderObj.triangleCount:g},o}(),Ab=function(a){function f(a,b,c,d,e){this._batchOwnerIndices=null,this._batchOwners=null,this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=null,this._vertexBuffer=null,this._indexBuffer=null,f.__super.call(this,a,b,c),this._batchOwnerIndices=[],this._batchOwners=[],this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=d,this._material=e}n(f,"laya.d3.graphics.SubMeshStaticBatch",ea);var b=f.prototype;return b._compareBatchRenderElement=function(a,b){return a._batchIndexStart>b._batchIndexStart},b._addCombineBatchRenderObjTest=function(a){var b=a.renderObj._vertexCount;return!(65535<(0<b?this._currentCombineVertexCount+b:this._currentCombineVertexCount+a.renderObj._getVertexBuffer().vertexCount))},b._addCombineBatchRenderObj=function(a){var b=a.renderObj,c=b._vertexCount;this._initBatchRenderElements.push(a),a._staticBatch=this,0<c?(this._currentCombineIndexCount+=b._indexCount,this._currentCombineVertexCount+=c):(this._currentCombineIndexCount=this._currentCombineIndexCount+b._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+b._getVertexBuffer().vertexCount),this._needFinishCombine=!0},b._deleteCombineBatchRenderObj=function(a){var b=a.renderObj,c=this._initBatchRenderElements.indexOf(a);if(-1!==c){this._initBatchRenderElements.splice(c,1),a._staticBatch=null;var d=b._vertexCount;0<d?(this._currentCombineIndexCount=this._currentCombineIndexCount-b._indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-d):(this._currentCombineIndexCount=this._currentCombineIndexCount-b._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-b._getVertexBuffer().vertexCount),this._needFinishCombine=!0}},b._finishInit=function(){if(this._needFinishCombine){var a=0,b=0;0<=this._initBatchRenderElements[0]._sprite3D._render.lightmapIndex?this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration):this._material instanceof laya.d3.core.material.StandardMaterial&&this._material.ambientTexture&&(this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration));var c=new Float32Array(this._vertexDeclaration.vertexStride/4*this._currentCombineVertexCount),d=new Uint16Array(this._currentCombineIndexCount);this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy()),this._vertexBuffer=Mb.create(this._vertexDeclaration,this._currentCombineVertexCount,35044),this._indexBuffer=Lb.create("ushort",this._currentCombineIndexCount,35044);for(var e=0,f=this._initBatchRenderElements.length;e<f;e++){var g=this._initBatchRenderElements[e],h=g.renderObj,i=h._getStaticBatchBakedVertexs(this._rootOwner?this._rootOwner._transform:null,g._sprite3D),j=h.getIndices(),k=g._sprite3D.transform._isFrontFaceInvert,l=a/(this._vertexDeclaration.vertexStride/4)-h._vertexStart,m=b,n=m+j.length;g._batchIndexStart=m,g._batchIndexEnd=n,d.set(j,b);var o=0;if(k)for(o=m;o<n;o+=3){d[o]=l+d[o];var p=d[o+1],q=d[o+2];d[o+1]=l+q,d[o+2]=l+p}else for(o=m;o<n;o+=3)d[o]=l+d[o],d[o+1]=l+d[o+1],d[o+2]=l+d[o+2];b+=j.length,c.set(i,a),a+=i.length}this._vertexBuffer.setData(c),this._indexBuffer.setData(d),this._needFinishCombine=!1}},b._getCombineRenderElementFromPool=function(){return this._combineRenderElementPool[this._combineRenderElementPoolIndex++]||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=new xb)},b._getRenderElement=function(a,b,c){for(var d,e,f=this._batchRenderElements.length,g=!0,h=0;h<f;h++){var i,j,k=(e=this._batchRenderElements[h])._sprite3D._render;if(0!==h&&(g=(i=(d=this._batchRenderElements[h-1])._sprite3D._render).lightmapIndex!==k.lightmapIndex||i.receiveShadow!==k.receiveShadow||d._batchIndexEnd!==e._batchIndexStart),g){(j=this._getCombineRenderElementFromPool()).renderObj=this,j._material=this._material,j._batchIndexStart=e._batchIndexStart,j._batchIndexEnd=e._batchIndexEnd;var l=k.lightmapIndex,m=l+1,n=this._batchOwnerIndices[m];n||(n=this._batchOwnerIndices[m]=[]);var o,p=n[e._render.receiveShadow?1:0];void 0===p?(n[k.receiveShadow?1:0]=this._batchOwners.length,(o=new Vb(null,"StaticBatchMeshSprite3D"))._scene=b,o._transform=this._rootOwner?this._rootOwner._transform:null,o._render.lightmapIndex=l,o._render.receiveShadow=e._render.receiveShadow,this._batchOwners.push(o)):o=this._batchOwners[p],o._render._renderUpdate(c),j._sprite3D=o,a.push(j)}else j._batchIndexEnd=e._batchIndexEnd}},b._beforeRender=function(a){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},b._render=function(a){var b=a.renderElement,c=b._batchIndexStart,d=b._batchIndexEnd-c;D.mainContext.drawElements(4,d,5123,2*c),y.drawCall++,y.trianglesFaces+=d/3},b.dispose=function(){this._batchOwnerIndices=null,this._batchOwners=null,this._vertexDeclaration=null,this._vertexBuffer.destroy(),this._indexBuffer.destroy()},b._getVertexBuffer=function(a){return void 0===a&&(a=0),this._vertexBuffer},f}(),Bb=function(a){function b(){this._componentsMap=null,this._typeComponentsIndices=null,this._components=null,this._scripts=null,b.__super.call(this),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[],this._scripts=[]}n(b,"laya.d3.core.ComponentNode",j);var c=b.prototype;return c.addComponent=function(a){var b,c=this._componentsMap.indexOf(a);if(-1===c)b=[],this._componentsMap.push(a),this._typeComponentsIndices.push(b);else if(b=this._typeComponentsIndices[c],this._components[b[0]].isSingleton)throw new Error("无法单实例创建"+a+"组件，"+a+"组件已存在！");var d=e.getInstance(a);return b.push(this._components.length),this._components.push(d),d instanceof laya.d3.component.Script&&this._scripts.push(d),d._initialize(this),d},c._removeComponent=function(a,b){var c=this._typeComponentsIndices[a],d=c[b],e=this._components[d];this._components.splice(d,1),e instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf(e),1),c.splice(b,1),0===c.length&&(this._typeComponentsIndices.splice(a,1),this._componentsMap.splice(a,1));for(var f=0,g=this._componentsMap.length;f<g;f++)for(var h=(c=this._typeComponentsIndices[f]).length-1;0<=h;h--){var i=c[h];if(!(d<i))break;c[h]=--i}e._destroy()},c.getComponentByType=function(a,b){void 0===b&&(b=0);var c=this._componentsMap.indexOf(a);return-1===c?null:this._components[this._typeComponentsIndices[c][b]]},c.getComponentsByType=function(a,b){var c=this._componentsMap.indexOf(a);if(-1!==c){var d=this._typeComponentsIndices[c],e=d.length;b.length=e;for(var f=0;f<e;f++)b[f]=this._components[d[f]]}else b.length=0},c.getComponentByIndex=function(a){return this._components[a]},c.removeComponentByType=function(a,b){void 0===b&&(b=0);var c=this._componentsMap.indexOf(a);-1!==c&&this._removeComponent(c,b)},c.removeComponentsByType=function(a){var b=this._componentsMap.indexOf(a);if(-1!==b)for(var c=this._typeComponentsIndices[b],d=0,e=c.length;d<e;c.length<e?e--:d++)this._removeComponent(b,d)},c.removeAllComponent=function(){for(var a=0,b=this._componentsMap.length;a<b;this._componentsMap.length<b?b--:a++)this.removeComponentsByType(this._componentsMap[a])},c._updateComponents=function(a){for(var b=0,c=this._components.length;b<c;b++){var d=this._components[b];!d.started&&(d._start(a),d.started=!0),d.enable&&d._update(a)}},c._lateUpdateComponents=function(a){for(var b=0;b<this._components.length;b++){var c=this._components[b];!c.started&&(c._start(a),c.started=!0),c.enable&&c._lateUpdate(a)}},c._preRenderUpdateComponents=function(a){for(var b=0;b<this._components.length;b++){var c=this._components[b];!c.started&&(c._start(a),c.started=!0),c.enable&&c._preRenderUpdate(a)}},c._postRenderUpdateComponents=function(a){for(var b=0;b<this._components.length;b++){var c=this._components[b];!c.started&&(c._start(a),c.started=!0),c.enable&&c._postRenderUpdate(a)}},b}(),Cb=function(d){function a(){a.__super.call(this),this._shaderDefineValue=0,this._disablePublicShaderDefine=0,this._shaderValues=new mb,this._values=[],this.renderQueue=2e3,this._alphaTest=!1,this.cull=2,this.blend=0,this.srcBlend=1,this.dstBlend=0,this.srcBlendRGB=1,this.dstBlendRGB=0,this.srcBlendAlpha=1,this.dstBlendAlpha=0,this.blendConstColor=new hb(1,1,1,1),this.blendEquation=0,this.blendEquationRGB=0,this.blendEquationAlpha=0,this.depthTest=513,this.depthWrite=!0}n(a,"laya.d3.core.material.BaseMaterial",d);var b=a.prototype;return v.imps(b,{"laya.d3.core.IClone":!0}),b._addShaderDefine=function(a){this._shaderDefineValue|=a},b._removeShaderDefine=function(a){this._shaderDefineValue&=~a},b._addDisablePublicShaderDefine=function(a){this._disablePublicShaderDefine|=a},b._removeDisablePublicShaderDefine=function(a){this._disablePublicShaderDefine&=~a},b._setBuffer=function(a,b){this._shaderValues.setValue(a,b),this._values[a]=b},b._getBuffer=function(a){return this._values[a]},b._setMatrix4x4=function(a,b){this._shaderValues.setValue(a,b?b.elements:null),this._values[a]=b},b._getMatrix4x4=function(a){return this._values[a]},b._setInt=function(a,b){this._shaderValues.setValue(a,b),this._values[a]=b},b._getInt=function(a){return this._values[a]},b._setNumber=function(a,b){this._shaderValues.setValue(a,b),this._values[a]=b},b._getNumber=function(a){return this._values[a]},b._setBool=function(a,b){this._shaderValues.setValue(a,b),this._values[a]=b},b._getBool=function(a){return this._values[a]},b._setVector2=function(a,b){this._shaderValues.setValue(a,b?b.elements:null),this._values[a]=b},b._getVector2=function(a){return this._values[a]},b._setColor=function(a,b){this._shaderValues.setValue(a,b?b.elements:null),this._values[a]=b},b._getColor=function(a){return this._values[a]},b._setTexture=function(a,b){var c=this._values[a];this._values[a]=b,this._shaderValues.setValue(a,b),0<this.referenceCount&&(c&&c._removeReference(),b&&b._addReference())},b._getTexture=function(a){return this._values[a]},b._upload=function(){this._shader.uploadMaterialUniforms(this._shaderValues.data)},b._getShader=function(a,b,c){var d=(a|b)&~this._disablePublicShaderDefine;return this._shader=this._shaderCompile.withCompile(d,c,this._shaderDefineValue),this._shader},b._setRenderStateBlendDepth=function(){var a=D.mainContext;switch(E.setDepthMask(a,this.depthWrite),0===this.depthTest?E.setDepthTest(a,!1):(E.setDepthTest(a,!0),E.setDepthFunc(a,this.depthTest)),this.blend){case 0:E.setBlend(a,!1);break;case 1:E.setBlend(a,!0),E.setBlendFunc(a,this.srcBlend,this.dstBlend);break;case 2:E.setBlend(a,!0)}},b._setRenderStateFrontFace=function(a,b){var c=D.mainContext,d=0;switch(this.cull){case 0:E.setCullFace(c,!1);break;case 1:E.setCullFace(c,!0),d=a?b&&b._isFrontFaceInvert?2305:2304:b&&b._isFrontFaceInvert?2304:2305,E.setFrontFace(c,d);break;case 2:E.setCullFace(c,!0),d=a?b&&b._isFrontFaceInvert?2304:2305:b&&b._isFrontFaceInvert?2305:2304,E.setFrontFace(c,d)}},b.onAsynLoaded=function(a,b,c){var d=b[0],e=b[1];switch(d.version){case"LAYAMATERIAL:01":var f=0,g=0,h=d.props;for(var i in h)switch(i){case"vectors":var j=h[i];for(f=0,g=j.length;f<g;f++){var k=j[f],l=k.value;switch(l.length){case 2:this[k.name]=new fb(l[0],l[1]);break;case 3:this[k.name]=new gb(l[0],l[1],l[2]);break;case 4:this[k.name]=new hb(l[0],l[1],l[2],l[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}}break;case"textures":var m=h[i];for(f=0,g=m.length;f<g;f++){var n=m[f],o=n.path;o&&(this[n.name]=r.getRes(e[o]))}break;case"defines":var p=h[i];for(f=0,g=p.length;f<g;f++){var q=this._shaderCompile.getMaterialDefineByName(p[f]);this._addShaderDefine(q)}break;case"cull":case"blend":case"srcBlend":case"dstBlend":case"depthWrite":this[i]=h[i];break;case"renderQueue":switch(h[i]){case 1:this.renderQueue=2e3;break;case 2:this.renderQueue=3e3}break;default:this[i]=h[i]}break;case"LAYAMATERIAL:02":for(i in h=d.props)switch(i){case"vectors":for(f=0,g=(j=h[i]).length;f<g;f++)switch((l=(k=j[f]).value).length){case 2:this[k.name]=new fb(l[0],l[1]);break;case 3:this[k.name]=new gb(l[0],l[1],l[2]);break;case 4:this[k.name]=new hb(l[0],l[1],l[2],l[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}break;case"textures":for(f=0,g=(m=h[i]).length;f<g;f++)(o=(n=m[f]).path)&&(this[n.name]=r.getRes(e[o]));break;case"defines":for(f=0,g=(p=h[i]).length;f<g;f++)q=this._shaderCompile.getMaterialDefineByName(p[f]),this._addShaderDefine(q);break;default:this[i]=h[i]}break;default:throw new Error("BaseMaterial:unkonwn version.")}this._endLoaded()},b._addReference=function(){d.prototype._addReference.call(this);for(var a=0,b=this._values.length;a<b;a++){var c=this._values[a];c&&c instanceof laya.d3.resource.BaseTexture&&c._addReference()}},b._removeReference=function(){d.prototype._removeReference.call(this);for(var a=0,b=this._values.length;a<b;a++){var c=this._values[a];c&&c instanceof laya.d3.resource.BaseTexture&&c._removeReference()}},b.disposeResource=function(){this.blendConstColor=null,this._shader=null,this._shaderValues=null,this._values=null},b.setShaderName=function(a){var b=Jb.nameKey.getID(a);if(-1===b)throw new Error("BaseMaterial: unknown shader name.");this._shaderCompile=yb._preCompileShader[b]},b.cloneTo=function(a){var b=a;b.name=this.name,b.cull=this.cull,b.blend=this.blend,b.srcBlend=this.srcBlend,b.dstBlend=this.dstBlend,b.srcBlendRGB=this.srcBlendRGB,b.dstBlendRGB=this.dstBlendRGB,b.srcBlendAlpha=this.srcBlendAlpha,b.dstBlendAlpha=this.dstBlendAlpha,this.blendConstColor.cloneTo(b.blendConstColor),b.blendEquation=this.blendEquation,b.blendEquationRGB=this.blendEquationRGB,b.blendEquationAlpha=this.blendEquationAlpha,b.depthTest=this.depthTest,b.depthWrite=this.depthWrite,b.renderQueue=this.renderQueue,b._shader=this._shader,b._disablePublicShaderDefine=this._disablePublicShaderDefine,b._shaderDefineValue=this._shaderDefineValue;var c,d=0,e=b._shaderValues;b._shaderValues.data.length=this._shaderValues.data.length;var f=this._values.length,g=b._values;for(d=0,c=g.length=f;d<c;d++){var h=this._values[d];if(h)if("number"==typeof h)g[d]=h,e.data[d]=h;else if("number"==typeof h&&Math.floor(h)==h)g[d]=h,e.data[d]=h;else if("boolean"==typeof h)g[d]=h,e.data[d]=h;else if(h instanceof laya.d3.math.Vector2){var i=g[d]||(g[d]=new fb);h.cloneTo(i),e.data[d]=i.elements}else if(h instanceof laya.d3.math.Vector3){var j=g[d]||(g[d]=new gb);h.cloneTo(j),e.data[d]=j.elements}else if(h instanceof laya.d3.math.Vector4){var k=g[d]||(g[d]=new hb);h.cloneTo(k),e.data[d]=k.elements}else if(h instanceof laya.d3.math.Matrix4x4){var l=g[d]||(g[d]=new ab);h.cloneTo(l),e.data[d]=l.elements}else h instanceof laya.d3.resource.BaseTexture&&(g[d]=h,e.data[d]=h)}},b.clone=function(){var a=new this.constructor;return this.cloneTo(a),a},o(0,b,"alphaTestValue",function(){return this._getNumber(0)},function(a){this._setNumber(0,a)}),o(0,b,"alphaTest",function(){return this._alphaTest},function(a){(this._alphaTest=a)?this._addShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST):this._removeShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST)}),a.__init__=function(){a.SHADERDEFINE_ALPHATEST=a.shaderDefines.registerDefine("ALPHATEST")},a.RENDERQUEUE_OPAQUE=2e3,a.RENDERQUEUE_ALPHATEST=2450,a.RENDERQUEUE_TRANSPARENT=3e3,a.CULL_NONE=0,a.CULL_FRONT=1,a.CULL_BACK=2,a.BLEND_DISABLE=0,a.BLEND_ENABLE_ALL=1,a.BLEND_ENABLE_SEPERATE=2,a.BLENDPARAM_ZERO=0,a.BLENDPARAM_ONE=1,a.BLENDPARAM_SRC_COLOR=768,a.BLENDPARAM_ONE_MINUS_SRC_COLOR=769,a.BLENDPARAM_DST_COLOR=774,a.BLENDPARAM_ONE_MINUS_DST_COLOR=775,a.BLENDPARAM_SRC_ALPHA=770,a.BLENDPARAM_ONE_MINUS_SRC_ALPHA=771,a.BLENDPARAM_DST_ALPHA=772,a.BLENDPARAM_ONE_MINUS_DST_ALPHA=773,a.BLENDPARAM_SRC_ALPHA_SATURATE=776,a.BLENDEQUATION_ADD=0,a.BLENDEQUATION_SUBTRACT=1,a.BLENDEQUATION_REVERSE_SUBTRACT=2,a.DEPTHTEST_OFF=0,a.DEPTHTEST_NEVER=512,a.DEPTHTEST_LESS=513,a.DEPTHTEST_EQUAL=514,a.DEPTHTEST_LEQUAL=515,a.DEPTHTEST_GREATER=516,a.DEPTHTEST_NOTEQUAL=517,a.DEPTHTEST_GEQUAL=518,a.DEPTHTEST_ALWAYS=519,a.SHADERDEFINE_ALPHATEST=1,a.ALPHATESTVALUE=0,l(a,["shaderDefines",function(){return this.shaderDefines=new kb}]),a}(q),Db=function(a){function b(){this._type=0,this._width=0,this._height=0,this._size=null,this._repeat=!1,this._mipmap=!1,this._minFifter=0,this._magFifter=0,this._format=0,this._source=null,this._conchTexture=null,this._wrapModeU=0,this._wrapModeV=0,b.__super.call(this),this._repeat=!0,this.mipmap=!0,this.minFifter=-1,this.magFifter=-1}n(b,"laya.d3.resource.BaseTexture",q);var c=b.prototype;return o(0,c,"width",function(){return this._width}),o(0,c,"repeat",function(){return this._repeat},function(a){if(this._repeat!==a&&(this._repeat=a,this._source)){var b=D.mainContext;E.bindTexture(b,this._type,this._source),u.isPOT(this._width,this._height)&&this._repeat?(b.texParameteri(this._type,10242,10497),b.texParameteri(this._type,10243,10497)):(b.texParameteri(this._type,10242,33071),b.texParameteri(this._type,10243,33071))}}),o(0,c,"height",function(){return this._height}),o(0,c,"magFifter",function(){return this._magFifter},function(a){(this._magFifter=a)!=this._magFifter&&this._conchTexture&&this._conchTexture.setMaxFifter(a)}),o(0,c,"wrapModeV",function(){return this._wrapModeV}),o(0,c,"size",function(){return this._size}),o(0,c,"wrapModeU",function(){return this._wrapModeU}),o(0,c,"mipmap",function(){return this._mipmap},function(a){this._mipmap=a,this._mipmap!=a&&this._conchTexture&&this._conchTexture.setMipMap(a)}),o(0,c,"minFifter",function(){return this._minFifter},function(a){this._minFifter=a,this._minFifter!=a&&this._conchTexture&&this._conchTexture.setMinFifter(a)}),o(0,c,"format",function(){return this._format}),o(0,c,"source",function(){return this.activeResource(),this._source}),o(0,c,"defaulteTexture",function(){return Qb.grayTexture}),b.WARPMODE_REPEAT=0,b.WARPMODE_CLAMP=1,b}(),Eb=function(a){function b(){this._subMeshCount=0,this._boundingBox=null,this._boundingSphere=null,this._boundingBoxCorners=null,this._positions=null,b.__super.call(this),this._boundingBoxCorners=d(8,null)}n(b,"laya.d3.resource.models.BaseMesh",q);var c=b.prototype;return c._getPositions=function(){throw new Error("未Override,请重载该属性！")},c._generateBoundingObject=function(){this._boundingSphere=new Za(new gb,0),Za.createfromPoints(this._positions,this._boundingSphere),this._boundingBox=new Xa(new gb,new gb),Xa.createfromPoints(this._positions,this._boundingBox),this._boundingBox.getCorners(this._boundingBoxCorners)},c.getRenderElementsCount=function(){throw new Error("未Override,请重载该属性！")},c.getRenderElement=function(a){throw new Error("未Override,请重载该属性！")},o(0,c,"subMeshCount",function(){return this._subMeshCount}),o(0,c,"boundingBox",function(){return this._boundingBox}),o(0,c,"boundingBoxCorners",function(){return this._boundingBoxCorners}),o(0,c,"boundingSphere",function(){return this._boundingSphere}),b}(),Fb=(function(a){function b(){b.__super.call(this)}n(b,"laya.d3.component.Script",tb);var c=b.prototype;c.onTriggerEnter=function(a){},c.onTriggerExit=function(a){},c.onTriggerStay=function(a){},o(0,c,"isSingleton",function(){return b._isSingleton}),b._isSingleton=!1}(),function(a){function b(a){this._owner=null,this._sharedMesh=null,b.__super.call(this),this._owner=a}n(b,"laya.d3.core.MeshFilter",a);var c=b.prototype;return c._sharedMeshLoaded=function(){this.event("loaded")},c._destroy=function(){a.prototype._destroy.call(this),this._owner=null,this._sharedMesh&&(this._sharedMesh._removeReference(),this._sharedMesh=null)},o(0,c,"sharedMesh",function(){return this._sharedMesh},function(a){var b=this._sharedMesh;b&&b._removeReference(),(this._sharedMesh=a)._addReference(),this.event("meshchanged",[this,b,a]),a.loaded||this._sharedMesh.once("loaded",this,this._sharedMeshLoaded)}),o(0,c,"_isAsyncLoaded",function(){return this._sharedMesh.loaded}),o(0,c,"_originalBoundingBoxCorners",function(){return this._sharedMesh.boundingBoxCorners}),o(0,c,"_originalBoundingSphere",function(){return this._sharedMesh.boundingSphere}),o(0,c,"_originalBoundingBox",function(){return this._sharedMesh.boundingBox}),b}(ub)),Gb=function(a){function b(a){b.__super.call(this,a),a.meshFilter.on("meshchanged",this,this._onMeshChanged)}n(b,"laya.d3.core.MeshRender",vb);var c=b.prototype;return c._onMeshChanged=function(a,b,c){c.loaded?this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0:c.once("loaded",this,this._onMeshLoaed)},c._onMeshLoaed=function(a,b){this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0},c._calculateBoundingSphereByInitSphere=function(a){var b=NaN,c=this._owner.transform,d=c.scale.elements,e=Math.abs(d[0]),f=Math.abs(d[1]),g=Math.abs(d[2]);b=f<=e&&g<=e?e:g<=f?f:g,gb.transformCoordinate(a.center,c.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=a.radius*b},c._calculateBoundBoxByInitCorners=function(a){for(var b=this._owner.transform.worldMatrix,c=0;c<8;c++)gb.transformCoordinate(a[c],b,vb._tempBoundBoxCorners[c]);Xa.createfromPoints(vb._tempBoundBoxCorners,this._boundingBox)},c._calculateBoundingSphere=function(){var a=this._owner.meshFilter.sharedMesh;null==a||null==a.boundingSphere?this._boundingSphere.toDefault():this._calculateBoundingSphereByInitSphere(a.boundingSphere)},c._calculateBoundingBox=function(){var a=this._owner.meshFilter.sharedMesh;null==a||null==a.boundingBox?this._boundingBox.toDefault():this._calculateBoundBoxByInitCorners(a.boundingBoxCorners)},c._renderUpdate=function(a){var b=this._owner.transform;if(b){this._setShaderValueMatrix4x4(0,b.worldMatrix);var c=this._owner.getProjectionViewWorldMatrix(a);this._setShaderValueMatrix4x4(1,c)}else this._setShaderValueMatrix4x4(0,ab.DEFAULT),this._setShaderValueMatrix4x4(1,a);return rb.debugMode&&this._renderRenderableBoundBox(),!0},b}(),Hb=function(b){function d(){this._time=0,this._enableLightCount=3,this._customRenderQueneIndex=11,this.enableLight=!0,d.__super.call(this),this._renderState=new W,this._lights=[],this._quenes=[],this._cameraPool=[],this._renderableSprite3Ds=[],this.__loaded=!0,this._lightmaps=[],this._shaderValues=new mb,this.parallelSplitShadowMaps=[],this._dynamicBatchManager=new ba,this._cullingRenders=[],this._cullingRendersLength=0,this.enableFog=!1,this.fogStart=300,this.fogRange=1e3,this.fogColor=new gb(.7,.7,.7),this.ambientColor=new gb(.212,.227,.259),D.shaderHighPrecision&&this.addShaderDefine(yb.SHADERDEFINE_HIGHPRECISION),this.on("display",this,this._display),this.on("undisplay",this,this._unDisplay),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[]}n(d,"laya.d3.core.scene.Scene",b);var a=d.prototype;return v.imps(a,{"laya.webgl.submit.ISubmit":!0,"laya.resource.ICreateResource":!0}),a._setUrl=function(a){this._url=a},a._getGroup=function(){return this._group},a._setGroup=function(a){this._group=a},a._display=function(){v.stage._scenes.push(this),v.stage._scenes.sort(d._sortScenes);for(var a=0,b=this._childs.length;a<b;a++){var c=this._childs[a];c.active&&c._activeHierarchy()}},a._unDisplay=function(){var a=v.stage._scenes;a.splice(a.indexOf(this),1);for(var b=0,c=this._childs.length;b<c;b++){var d=this._childs[b];d.active&&d._inActiveHierarchy()}},a._addChild3D=function(a){a.transform._onWorldTransform(),a._setBelongScene(this),this.displayedInStage&&a.active&&a._activeHierarchy()},a._removeChild3D=function(a){a.transform.parent=null,this.displayedInStage&&a.active&&a._inActiveHierarchy(),a._setUnBelongScene()},a.initOctree=function(a,b,c,d,e){void 0===e&&(e=6),this.treeSize=new gb(a,b,c),this.treeLevel=e,this.treeRoot=new X(this,0),this.treeRoot.init(d,this.treeSize)},a._prepareUpdateToRenderState=function(a,b){b.elapsedTime=this._lastCurrentTime?this.timer.currTimer-this._lastCurrentTime:0,this._lastCurrentTime=this.timer.currTimer,b.scene=this},a._prepareSceneToRender=function(a){var b=this._lights.length;if(0<b)for(var c=0,d=0;d<b&&!(this._lights[d]._prepareToScene(a)&&++c>=this._enableLightCount);d++);},a._updateChilds=function(a){for(var b=0,c=this._childs.length;b<c;++b)this._childs[b]._update(a)},a._preRenderScene=function(a,b,c){var d,e=b._viewMatrix,f=b._projectionMatrix,g=b._projectionViewMatrix,h=0,i=b.camera;for(i.useOcclusionCulling?this.treeRoot?ca.renderObjectCullingOctree(c,this,i,e,f,g):ca.renderObjectCulling(c,this,i,e,f,g):ca.renderObjectCullingNoBoundFrustum(this,i,e,f,g),h=0,d=this._quenes.length;h<d;h++)this._quenes[h]&&this._quenes[h]._preRender(b)},a._clear=function(a,b){var c=b._viewport,d=b.camera,e=c.x,f=d.renderTargetSize.height-c.y-c.height,g=c.width,h=c.height;a.viewport(e,f,g,h);var i=256,j=d.renderTarget;switch(d.clearFlag){case 0:var k=d.clearColor;if(k){a.enable(3089),a.scissor(e,f,g,h);var l=k.elements;a.clearColor(l[0],l[1],l[2],l[3]),i|=16384}if(j)switch(k||(i=16384),j.depthStencilFormat){case 33189:i|=256;break;case 36168:i|=1024;break;case 34041:i|=256,i|=1024}a.clear(i),k&&a.disable(3089);break;case 1:case 2:if(j)switch(i=16384,j.depthStencilFormat){case 33189:i|=256;break;case 36168:i|=1024;break;case 34041:i|=256,i|=1024}a.clear(i);break;case 3:break;default:throw new Error("BaseScene:camera clearFlag invalid.")}},a._renderScene=function(a,b){var c,d,e=b.camera,f=0;for(f=0;f<2;f++)(d=this._quenes[f])&&(e.renderTarget?d._render(b,!0):d._render(b,!1));if(1===e.clearFlag){var g=e.sky;g&&(E.setCullFace(a,!1),E.setDepthFunc(a,515),E.setDepthMask(a,!1),g._render(b),E.setDepthFunc(a,513),E.setDepthMask(a,!0))}for(f=2,c=this._quenes.length;f<c;f++)(d=this._quenes[f])&&(d._sortAlpha(b.camera.transform.position),e.renderTarget?d._render(b,!0):d._render(b,!1))},a._set3DRenderConfig=function(a){a.disable(3042),E._blend=!1,a.blendFunc(770,771),E._sFactor=770,E._dFactor=771,a.disable(2929),E._depthTest=!1,a.enable(2884),E._cullFace=!0,a.depthMask(1),E._depthMask=!0,a.frontFace(2304),E._frontFace=2304},a._set2DRenderConfig=function(a){E.setBlend(a,!0),E.setBlendFunc(a,1,771),E.setDepthTest(a,!1),E.setCullFace(a,!1),E.setDepthMask(a,!0),E.setFrontFace(a,2305),a.viewport(0,0,k.width,k.height)},a._parseCustomProps=function(a,b,c,d){var e=d.customProps.lightmaps,f=e.length,g=this._lightmaps;g.length=f;for(var h=0;h<f;h++)g[h]=r.getRes(b[e[h].replace(".exr",".png")]);this.setlightmaps(g);var i=d.customProps.ambientColor;i&&(this.ambientColor=new gb(i[0],i[1],i[2]));var j=d.customProps.fogColor;j&&(this.fogColor=new gb(j[0],j[1],j[2]))},a._addLight=function(a){this._lights.indexOf(a)<0&&this._lights.push(a)},a._removeLight=function(a){var b=this._lights.indexOf(a);0<=b&&this._lights.splice(b,1)},a._updateScene=function(){var a=this._renderState;this._prepareUpdateToRenderState(D.mainContext,a),this._updateComponents(a),this._updateChilds(a),this._lateUpdateComponents(a),this._time+=a.elapsedTime/1e3,this._shaderValues.setValue(22,this._time)},a._updateSceneConch=function(){var a=this._renderState;this._prepareUpdateToRenderState(D.mainContext,a),this._updateComponents(a),this._lateUpdateComponents(a),this._prepareSceneToRender(a);for(var b=0,c=this._cameraPool.length;b<c;b++){var d=this._cameraPool[b];(a.camera=d)._prepareCameraToRender()}},a._preRenderShadow=function(a,b,c,d,e){this.treeRoot?ca.renderShadowObjectCullingOctree(this,b,c,d,e):ca.renderShadowObjectCulling(this,b,c,d,e);for(var f=0,g=c.length;f<g;f++)c[f]&&c[f]._preRender(a)},a._renderShadowMap=function(a,b,c){var d=this.parallelSplitShadowMaps[0];d._calcAllLightCameraInfo(c);var e,f,g,h=d.PSSMNum;if(this._preRenderShadow(b,d._lightCulling,d._shadowQuenes,d._lightVPMatrix[0],h),this.addShaderDefine(nb.SHADERDEFINE_CAST_SHADOW),1<h)for(var i=0;i<h;i++)e=d.getRenderTarget(i+1),d.beginRenderTarget(i+1),a.clearColor(1,1,1,1),a.clear(16640),a.viewport(0,0,e.width,e.height),b.camera=g=d.getLightCamera(i),g._prepareCameraToRender(),g._prepareCameraViewProject(g.viewMatrix,g.projectionMatrix),b._projectionViewMatrix=d._lightVPMatrix[i+1],(f=d._shadowQuenes[i])._preRender(b),f._renderShadow(b,!1),d.endRenderTarget(i+1);else e=d.getRenderTarget(1),d.beginRenderTarget(1),a.clearColor(1,1,1,1),a.clear(16640),a.viewport(0,0,e.width,e.height),b.camera=g=d.getLightCamera(0),g._prepareCameraToRender(),g._prepareCameraViewProject(g.viewMatrix,g.projectionMatrix),b._projectionViewMatrix=d._lightVPMatrix[0],(f=d._shadowQuenes[0])._preRender(b),f._renderShadow(b,!0),d.endRenderTarget(1);this.removeShaderDefine(nb.SHADERDEFINE_CAST_SHADOW)},a.addTreeNode=function(a){this.treeRoot.addTreeNode(a)},a.removeTreeNode=function(a){this.treeSize&&a._treeNode&&a._treeNode.removeObject(a)},a.setlightmaps=function(a){this._lightmaps=a;for(var b=0,c=this._renderableSprite3Ds.length;b<c;b++)this._renderableSprite3Ds[b]._render._applyLightMapParams()},a.getlightmaps=function(){return this._lightmaps},a.addChildAt=function(a,b){if(!(a instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.  className="+(a&&a.__className));if(!a||this.destroyed||a===this)return a;if(a.zOrder&&this._set$P("hasZorder",!0),0<=b&&b<=this._childs.length){if(a._parent===this){var c=this.getChildIndex(a);this._childs.splice(c,1),this._childs.splice(b,0,a),this.conchModel&&(this.conchModel.removeChild(a.conchModel),this.conchModel.addChildAt(a.conchModel,b)),this._childChanged()}else a.parent&&a.parent.removeChild(a),this._childs===j.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(b,0,a),this.conchModel&&this.conchModel.addChildAt(a.conchModel,b),(a.parent=this)._addChild3D(a);return a}throw new Error("appendChildAt:The index is out of bounds")},a.addChild=function(a){if(!(a instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!a||this.destroyed||a===this)return a;if(a.zOrder&&this._set$P("hasZorder",!0),a._parent===this){var b=this.getChildIndex(a);b!==this._childs.length-1&&(this._childs.splice(b,1),this._childs.push(a),this.conchModel&&(this.conchModel.removeChild(a.conchModel),this.conchModel.addChildAt(a.conchModel,this._childs.length-1)),this._childChanged())}else a.parent&&a.parent.removeChild(a),this._childs===j.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(a),this.conchModel&&this.conchModel.addChildAt(a.conchModel,this._childs.length-1),(a.parent=this)._childChanged(),this._addChild3D(a);return a},a.removeChildAt=function(a){var b=this.getChildAt(a);return b&&(this._removeChild3D(b),this._childs.splice(a,1),this.conchModel&&this.conchModel.removeChild(b.conchModel),b.parent=null),b},a.removeChildren=function(a,b){if(void 0===a&&(a=0),void 0===b&&(b=2147483647),this._childs&&0<this._childs.length){var c=this._childs;if(0===a&&f<=b){var d=c;this._childs=j.ARRAY_EMPTY}else d=c.splice(a,b-a);for(var e=0,f=d.length;e<f;e++)this._removeChild3D(d[e]),d[e].parent=null,this.conchModel&&this.conchModel.removeChild(d[e].conchModel)}return this},a.addFrustumCullingObject=function(a){this.treeRoot?this.addTreeNode(a):(this._cullingRendersLength===this._cullingRenders.length?this._cullingRenders.push(a):this._cullingRenders[this._cullingRendersLength]=a,a._indexInSceneFrustumCullingObjects=this._cullingRendersLength++)},a.removeFrustumCullingObject=function(a){if(this.treeRoot)this.removeTreeNode(a);else{this._cullingRendersLength--;var b=a._indexInSceneFrustumCullingObjects;if(b!==this._cullingRendersLength){var c=this._cullingRenders[this._cullingRendersLength];(this._cullingRenders[b]=c)._indexInSceneFrustumCullingObjects=b,a._indexInSceneFrustumCullingObjects=-1}}},a.getRenderQueue=function(a){return a<3e3?this._quenes[1]||(this._quenes[1]=new V(this)):this._quenes[2]||(this._quenes[2]=new V(this))},a.addRenderQuene=function(){this._quenes[this._customRenderQueneIndex++]=new V(this)},a.addShaderDefine=function(a){this._shaderDefineValue|=a},a.removeShaderDefine=function(a){this._shaderDefineValue&=~a},a.addScript=function(a){return this._addComponent(a)},a.getScriptByType=function(a,b){return void 0===b&&(b=0),this._getComponentByType(a,b)},a.getScriptsByType=function(a,b){this._getComponentsByType(a,b)},a.getScriptByIndex=function(a){return this._getComponentByIndex(a)},a.removeScriptByType=function(a,b){void 0===b&&(b=0),this._removeComponentByType(a,b)},a.removeScriptsByType=function(a){this._removeComponentByType(a)},a.removeAllScript=function(){this._removeAllComponent()},a.render=function(a,b,c){(p._context.ctx._renderKey=0)<this._childs.length&&a.addRenderObject(this)},a.renderSubmit=function(){var a=D.mainContext,b=this._renderState;this._set3DRenderConfig(a),this._prepareSceneToRender(this._renderState);var c,d=0,e=0;if(rb.debugMode||X.debugMode)for(d=0,e=this._cameraPool.length;d<e;d++)c=this._cameraPool[d],rb._debugPhasorSprite.begin(1,c),c.activeInHierarchy&&c._renderCamera(a,b,this),rb._debugPhasorSprite.end();else for(d=0,e=this._cameraPool.length;d<e;d++)(c=this._cameraPool[d]).activeInHierarchy&&c._renderCamera(a,b,this);return this._set2DRenderConfig(a),1},a.onAsynLoaded=function(a,b,c){var d=b[0];if("Scene"!==d.type)throw new Error("Scene: the .lh file root type must be Scene,please use other function to  load  this file.");var e=b[1];qb._createNodeByJson(this,d,this,e),this.event("hierarchyloaded",[this]),this.__loaded=!0},a.destroy=function(a){void 0===a&&(a=!0),this.destroyed||(b.prototype.destroy.call(this,a),this._renderState=null,this._lights=null,this._lightmaps=null,this._renderTargetTexture=null,this._shaderValues=null,this._cullingRenders=null,this._dynamicBatchManager=null,this._quenes=null,this._cameraPool=null,this._renderableSprite3Ds=null,this.treeRoot=null,this.treeSize=null,this.parallelSplitShadowMaps=null,this._typeComponentsIndices=null,this._components=null,r.clearRes(this.url),this.loaded||rb._cancelLoadByUrl(this.url))},a.getRenderType=function(){return 0},a.releaseRender=function(){},a._addComponent=function(a){var b,c=this._componentsMap.indexOf(a);if(-1===c)b=[],this._componentsMap.push(a),this._typeComponentsIndices.push(b);else if(b=this._typeComponentsIndices[c],this._components[b[0]].isSingleton)throw new Error("无法单实例创建"+a+"组件，"+a+"组件已存在！");var d=e.getInstance(a);b.push(this._components.length),this._components.push(d);return d._initialize(this),d},a._removeComponent=function(a,b){var c=this._typeComponentsIndices[a],d=c[b],e=this._components[d];this._components.splice(d,1),c.splice(b,1),0===c.length&&(this._typeComponentsIndices.splice(a,1),this._componentsMap.splice(a,1));for(var f=0,g=this._componentsMap.length;f<g;f++)for(var h=(c=this._typeComponentsIndices[f]).length-1;0<=h;h--){var i=c[h];if(!(d<i))break;c[h]=--i}e._destroy()},a._getComponentByType=function(a,b){void 0===b&&(b=0);var c=this._componentsMap.indexOf(a);return-1===c?null:this._components[this._typeComponentsIndices[c][b]]},a._getComponentsByType=function(a,b){var c=this._componentsMap.indexOf(a);if(-1!==c){var d=this._typeComponentsIndices[c],e=d.length;b.length=e;for(var f=0;f<e;f++)b[f]=this._components[d[f]]}else b.length=0},a._getComponentByIndex=function(a){return this._components[a]},a._removeComponentByType=function(a,b){void 0===b&&(b=0);var c=this._componentsMap.indexOf(a);-1!==c&&this._removeComponent(c,b)},a._removeComponentsByType=function(a){var b=this._componentsMap.indexOf(a);if(-1!==b)for(var c=this._typeComponentsIndices[b],d=0,e=c.length;d<e;c.length<e?e--:d++)this._removeComponent(b,d)},a._removeAllComponent=function(){for(var a=0,b=this._componentsMap.length;a<b;this._componentsMap.length<b?b--:a++)this._removeComponentsByType(this._componentsMap[a])},a._updateComponents=function(a){for(var b=0,c=this._components.length;b<c;b++){var d=this._components[b];!d.started&&(d._start(a),d.started=!0),d.enable&&d._update(a)}},a._lateUpdateComponents=function(a){for(var b=0;b<this._components.length;b++){var c=this._components[b];!c.started&&(c._start(a),c.started=!0),c.enable&&c._lateUpdate(a)}},a._preRenderUpdateComponents=function(a){for(var b=0;b<this._components.length;b++){var c=this._components[b];!c.started&&(c._start(a),c.started=!0),c.enable&&c._preRenderUpdate(a)}},a._postRenderUpdateComponents=function(a){for(var b=0;b<this._components.length;b++){var c=this._components[b];!c.started&&(c._start(a),c.started=!0),c.enable&&c._postRenderUpdate(a)}},o(0,a,"_loaded",null,function(a){this.__loaded=a}),o(0,a,"fogColor",function(){return this._fogColor},function(a){this._fogColor=a,this._shaderValues.setValue(0,a.elements)}),o(0,a,"enableFog",function(){return this._enableFog},function(a){this._enableFog!==a&&((this._enableFog=a)?(this.addShaderDefine(yb.SHADERDEFINE_FOG),this.removeShaderDefine(yb.SAHDERDEFINE_DEPTHFOG)):this.removeShaderDefine(yb.SHADERDEFINE_FOG))}),o(0,a,"url",function(){return this._url}),o(0,a,"loaded",function(){return this.__loaded}),o(0,a,"enableDepthFog",function(){return this._enableDepthFog},function(a){this._enableDepthFog!=a&&((this._enableDepthFog=a)?(this.addShaderDefine(yb.SAHDERDEFINE_DEPTHFOG),this.removeShaderDefine(yb.SHADERDEFINE_FOG)):this.removeShaderDefine(yb.SAHDERDEFINE_DEPTHFOG))}),o(0,a,"fogStart",function(){return this._fogStart},function(a){this._fogStart=a,this._shaderValues.setValue(1,a)}),o(0,a,"fogRange",function(){return this._fogRange},function(a){this._fogRange=a,this._shaderValues.setValue(2,a)}),o(0,a,"ambientColor",function(){return this._ambientColor},function(a){this._ambientColor=a,this._shaderValues.setValue(21,a.elements)}),o(0,a,"scene",function(){return this}),o(0,a,"renderableSprite3Ds",function(){return this._renderableSprite3Ds.slice()}),d._sortScenes=function(a,b){if(a.parent!==v.stage||b.parent!==v.stage)return a.parent!==v.stage&&b.parent!==v.stage?d._sortScenes(a.parent,b.parent):a.parent===v.stage?-1:1;var c=v.stage._childs;return c.indexOf(a)-c.indexOf(b)},d.load=function(a){return v.loader.create(a,null,null,d)},d.FOGCOLOR=0,d.FOGSTART=1,d.FOGRANGE=2,d.LIGHTDIRECTION=3,d.LIGHTDIRCOLOR=4,d.POINTLIGHTPOS=5,d.POINTLIGHTRANGE=6,d.POINTLIGHTATTENUATION=7,d.POINTLIGHTCOLOR=8,d.SPOTLIGHTPOS=9,d.SPOTLIGHTDIRECTION=10,d.SPOTLIGHTSPOT=11,d.SPOTLIGHTRANGE=12,d.SPOTLIGHTATTENUATION=13,d.SPOTLIGHTCOLOR=14,d.SHADOWDISTANCE=15,d.SHADOWLIGHTVIEWPROJECT=16,d.SHADOWMAPPCFOFFSET=17,d.SHADOWMAPTEXTURE1=18,d.SHADOWMAPTEXTURE2=19,d.SHADOWMAPTEXTURE3=20,d.AMBIENTCOLOR=21,d.TIME=22,d}(x),Ib=function(a){function b(a){b.__super.call(this),this.__loaded=!0,this._projectionViewWorldUpdateLoopCount=-1,this._activeInHierarchy=!1,this._projectionViewWorldMatrix=new ab,this._shaderValues=new mb,this._colliders=[],this._id=++b._uniqueIDCounter,this._transform=new wb(this),this.name=a||"Sprite3D-"+b._nameNumberCounter++,this.layer=G.currentCreationLayer,this.active=!0}n(b,"laya.d3.core.Sprite3D",Bb);var c=b.prototype;return v.imps(c,{"laya.d3.core.render.IUpdate":!0,"laya.resource.ICreateResource":!0,"laya.d3.core.IClone":!0}),c._setUrl=function(a){this._url=a},c._getGroup=function(){return this._group},c._setGroup=function(a){this._group=a},c._addChild3D=function(a){a.transform.parent=this.transform,this._hierarchyAnimator&&(!a._hierarchyAnimator&&a._setHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D(a,!0,[a.name])),this._scene&&(a._setBelongScene(this._scene),this._activeInHierarchy&&a._active&&a._activeHierarchy())},c._removeChild3D=function(a){a.transform.parent=null,this._scene&&(this._activeInHierarchy&&a._active&&a._inActiveHierarchy(),a._setUnBelongScene()),this._hierarchyAnimator&&(a._hierarchyAnimator==this._hierarchyAnimator&&a._clearHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D(a,!1,[a.name]))},c._parseBaseCustomProps=function(a){var b=this.transform.localPosition;a.translate?(b.fromArray(a.translate),b.x*=100,b.y*=100,b.z*=100):b.elements.fill(0),this.transform.localPosition=b;var c=this.transform.localRotation;a.rotation?c.fromArray(a.rotation):c.fromArray([0,0,0,-1]),this.transform.localRotation=c;var d=this.transform.localScale;a.scale?d.fromArray(a.scale):d.elements.fill(1),this.transform.localScale=d;var e=a.layer;null!=e&&(this.layer=G.getLayerByNumber(e))},c._parseCustomComponent=function(a,b,c){for(var d in c){var e=c[d];switch(d){case"Animator":var f=this.addComponent(Animator);if(e.avatarPath)f.avatar=r.getRes(b[e.avatarPath]);else{var g=e.avatar;if(g){f.avatar=r.getRes(b[g.path]);var h=g.linkSprites;h&&a.once("hierarchyloaded",this,this._onRootNodeHierarchyLoaded,[f,h])}}for(var i=e.clipPaths,j=i.length,k=0;k<j;k++)f.addClip(r.getRes(b[i[k]]));f.clip=r.getRes(b[i[0]]);var l=e.playOnWake;void 0!==l&&(f.playOnWake=l);break;case"Rigidbody":this.addComponent(Rigidbody);break;case"SphereCollider":var m=this.addComponent(SphereCollider);m.isTrigger=e.isTrigger;var n=m.center;n.fromArray(e.center),m.center=n,m.radius=e.radius;break;case"BoxCollider":var o=this.addComponent(BoxCollider);o.isTrigger=e.isTrigger,o.center.fromArray(e.center);var p=o.size;p.fromArray(e.size),o.size=p;break;case"MeshCollider":this.addComponent(MeshCollider)}}},c._onRootNodeHierarchyLoaded=function(a,b){for(var c in b){for(var d=this,e=b[c],f=0,g=e.length;f<g;f++){var h=e[f];if(""===h)break;if(!(d=d.getChildByName(h)))break}d&&a.linkSprite3DToAvatarNode(c,d)}},c._setHierarchyAnimator=function(a,b){this._changeHierarchyAnimator(a);for(var c=0,d=this._childs.length;c<d;c++){var e=this._childs[c];e._hierarchyAnimator==b&&e._setHierarchyAnimator(a,b)}},c._clearHierarchyAnimator=function(a,b){this._changeHierarchyAnimator(b);for(var c=0,d=this._childs.length;c<d;c++){var e=this._childs[c];e._hierarchyAnimator==a&&e._clearHierarchyAnimator(a,b)}},c._getAnimatorToLinkSprite3D=function(a,b,c){var d=this.getComponentByType(Animator);if(d&&(d.avatar?d.avatar._version||a._setAnimatorToLinkAvatar(d,b):a._setAnimatorToLinkSprite3DNoAvatar(d,b,c)),this._parent&&this._parent instanceof laya.d3.core.Sprite3D){c.unshift(this._parent.name);var e=this._parent;e._hierarchyAnimator&&e._getAnimatorToLinkSprite3D(a,b,c)}},c._setAnimatorToLinkSprite3DNoAvatar=function(a,b,c){var d=0,e=0;for(d=0,e=a.getClipCount();d<e;d++)a._handleSpriteOwnersBySprite(d,b,c,this);for(d=0,e=this._childs.length;d<e;d++){var f=this._childs[d],g=c.length;c.push(f.name),f._setAnimatorToLinkSprite3DNoAvatar(a,b,c),c.splice(g,1)}},c._changeHierarchyAnimator=function(a){this._hierarchyAnimator=a},c._isLinkSpriteToAnimationNode=function(a,b,c){var d=a._avatarNodes.indexOf(b),e=a._cacheSpriteToNodesMap;if(c)this._transform.dummy=b.transform,a._cacheNodesToSpriteMap[d]=e.length,e.push(d);else{this._transform.dummy=null;var f=a._cacheNodesToSpriteMap[d];a._cacheNodesToSpriteMap[d]=null,e.splice(f,1)}},c._setBelongScene=function(a){this._scene=a;for(var b=0,c=this._childs.length;b<c;b++)this._childs[b]._setBelongScene(a)},c._setUnBelongScene=function(){this._scene=null;for(var a=0,b=this._childs.length;a<b;a++)this._childs[a]._setUnBelongScene()},c._activeHierarchy=function(){var a=0,b=0;for(this._activeInHierarchy=!0,this._addSelfRenderObjects(),a=0,b=this._colliders.length;a<b;a++)this._layer._addCollider(this._colliders[a]);for(this.event("activeinhierarchychanged",!0),a=0,b=this._childs.length;a<b;a++){var c=this._childs[a];c._active&&c._activeHierarchy()}},c._inActiveHierarchy=function(){var a=0,b=0;for(this._activeInHierarchy=!1,this._clearSelfRenderObjects(),a=0,b=this._colliders.length;a<b;a++){var c=this._colliders[a];c._clearCollsionMap(),this._layer._removeCollider(c)}for(this.event("activeinhierarchychanged",!1),a=0,b=this._childs.length;a<b;a++){var d=this._childs[a];d._active&&d._inActiveHierarchy()}},c.addComponent=function(a){var b,c=this._componentsMap.indexOf(a);if(-1===c)b=[],this._componentsMap.push(a),this._typeComponentsIndices.push(b);else if(b=this._typeComponentsIndices[c],this._components[b[0]].isSingleton)throw new Error("无法单实例创建"+a+"组件，"+a+"组件已存在！");var d=e.getInstance(a);return b.push(this._components.length),this._components.push(d),d instanceof laya.d3.component.Script&&this._scripts.push(d),d._initialize(this),d},c._removeComponent=function(a,b){var c,d=0,e=this._typeComponentsIndices[a],f=e[b],g=this._components[f];for(g instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf(g),1),e.splice(b,1),0===e.length&&(this._typeComponentsIndices.splice(a,1),this._componentsMap.splice(a,1)),d=0,c=this._componentsMap.length;d<c;d++)for(var h=(e=this._typeComponentsIndices[d]).length-1;0<=h;h--){var i=e[h];if(!(f<i))break;e[h]=--i}g._destroy()},c._clearSelfRenderObjects=function(){},c._addSelfRenderObjects=function(){},c._parseCustomProps=function(a,b,c,d){},c._updateChilds=function(a){var b=this._childs.length;if(0!==b)for(var c=0;c<b;++c)this._childs[c]._update(a)},c._getSortID=function(a,b){return 1e3*b.id+a._getVertexBuffer().vertexDeclaration.id},c._update=function(a){(a.owner=this)._activeInHierarchy&&(this._updateComponents(a),this._lateUpdateComponents(a),y.spriteCount++,this._childs.length&&this._updateChilds(a))},c.getProjectionViewWorldMatrix=function(a){return ab.multiply(a,this.transform.worldMatrix,this._projectionViewWorldMatrix),this._projectionViewWorldMatrix},c.loadHierarchy=function(a){this.addChild(laya.d3.core.Sprite3D.load(a))},c.addChildAt=function(a,b){if(!(a instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!a||this.destroyed||a===this)return a;if(a.zOrder&&this._set$P("hasZorder",!0),0<=b&&b<=this._childs.length){if(a._parent===this){var c=this.getChildIndex(a);this._childs.splice(c,1),this._childs.splice(b,0,a),this.conchModel&&(this.conchModel.removeChild(a.conchModel),this.conchModel.addChildAt(a.conchModel,b)),this._childChanged()}else a.parent&&a.parent.removeChild(a),this._childs===j.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(b,0,a),this.conchModel&&this.conchModel.addChildAt(a.conchModel,b),(a.parent=this)._addChild3D(a);return a}throw new Error("appendChildAt:The index is out of bounds")},c.addChild=function(a){if(!(a instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!a||this.destroyed||a===this)return a;if(a.zOrder&&this._set$P("hasZorder",!0),a._parent===this){var b=this.getChildIndex(a);b!==this._childs.length-1&&(this._childs.splice(b,1),this._childs.push(a),this.conchModel&&(this.conchModel.removeChild(a.conchModel),this.conchModel.addChildAt(a.conchModel,this._childs.length-1)),this._childChanged())}else a.parent&&a.parent.removeChild(a),this._childs===j.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(a),this.conchModel&&this.conchModel.addChildAt(a.conchModel,this._childs.length-1),(a.parent=this)._childChanged(),this._addChild3D(a);return a},c.removeChildAt=function(a){var b=this.getChildAt(a);return b&&(this._removeChild3D(b),this._childs.splice(a,1),this.conchModel&&this.conchModel.removeChild(b.conchModel),b.parent=null),b},c.removeChildren=function(a,b){if(void 0===a&&(a=0),void 0===b&&(b=2147483647),this._childs&&0<this._childs.length){var c=this._childs;if(0===a&&f<=b){var d=c;this._childs=j.ARRAY_EMPTY}else d=c.splice(a,b-a);for(var e=0,f=d.length;e<f;e++)this._removeChild3D(d[e]),d[e].parent=null,this.conchModel&&this.conchModel.removeChild(d[e].conchModel)}return this},c.onAsynLoaded=function(a,b,c){var d=b[0];if("Sprite3D"!==d.type)throw new Error("Sprite3D: The .lh file root type must be Sprite3D,please use other function to  load  this file.");var e=b[1];qb._createNodeByJson(this,d,this,e),this.event("hierarchyloaded",[this]),this.__loaded=!0},c.cloneTo=function(a){if(this.destroyed)throw new Error("Sprite3D: Can't be cloned if the Sprite3D has destroyed.");var b=a;b.name=this.name,b._destroyed=this._destroyed,b.timer=this.timer,b._$P=this._$P,b.active=this._active;var c=b.transform.localPosition;this.transform.localPosition.cloneTo(c),b.transform.localPosition=c;var d=b.transform.localRotation;this.transform.localRotation.cloneTo(d),b.transform.localRotation=d;var e=b.transform.localScale;this.transform.localScale.cloneTo(e),b.transform.localScale=e,b.isStatic=this.isStatic;var f=0,g=0;for(f=0,g=this._componentsMap.length;f<g;f++){var h=b.addComponent(this._componentsMap[f]);this._components[f]._cloneTo(h)}for(f=0,g=this._childs.length;f<g;f++)b.addChild(this._childs[f].clone());var i=b.getComponentByType(Animator);if(i){var j=i._linkSpritesData;if(j)for(var k in j){for(var l=j[k],m=b,n=0,o=l.length;n<o&&(m=m.getChildByName(l[n]));n++);if(m){var p=i._avatarNodeMap[k];m._isLinkSpriteToAnimationNode(i,p,!0)}}}},c.clone=function(){var a=new this.constructor;return this.cloneTo(a),a},c.destroy=function(a){if(void 0===a&&(a=!0),!this.destroyed){laya.display.Node.prototype.destroy.call(this,a);var b,c=0;for(c=0,b=this._components.length;c<b;c++)this._components[c]._destroy();this._components=null,this._componentsMap=null,this._typeComponentsIndices=null,this._transform=null,this._colliders=null,r.clearRes(this.url),this.loaded||rb._cancelLoadByUrl(this.url)}},c._handleSpriteToAvatar=function(a,b){a._avatarNodes;var c=a._avatarNodeMap[this.name];c&&c.name===this.name&&!this._transform.dummy&&this._isLinkSpriteToAnimationNode(a,c,b)},c._setAnimatorToLinkAvatar=function(a,b){this._handleSpriteToAvatar(a,b);for(var c=0,d=this._childs.length;c<d;c++){this._childs[c]._setAnimatorToLinkAvatar(a,b)}},o(0,c,"activeInHierarchy",function(){return this._activeInHierarchy}),o(0,c,"_loaded",null,function(a){this.__loaded=a}),o(0,c,"active",function(){return this._active},function(a){this._active!==a&&(this._active=a,this._parent&&(this._parent===this._scene&&this._parent.displayedInStage||this._parent._activeInHierarchy)&&(a?this._activeHierarchy():this._inActiveHierarchy()))}),o(0,c,"componentsCount",function(){return this._components.length}),o(0,c,"loaded",function(){return this.__loaded}),o(0,c,"id",function(){return this._id}),o(0,c,"url",function(){return this._url}),o(0,c,"layer",function(){return this._layer},function(a){if(this._layer!==a){if(!a)throw new Error("Layer value can be null.");if(this._activeInHierarchy){var b=0,c=this._colliders.length;if(this._layer)for(b=0;b<c;b++)this._layer._removeCollider(this._colliders[b]);for(b=0;b<c;b++)a._addCollider(this._colliders[b])}this._layer=a,this.event("layerchanged",a)}}),o(0,c,"scene",function(){return this._scene}),o(0,c,"transform",function(){return this._transform}),b.instantiate=function(a,b,c,d,e){void 0===c&&(c=!0);var f=a.clone();b&&b.addChild(f);var g=f.transform;if(c){var h=g.worldMatrix;a.transform.worldMatrix.cloneTo(h),g.worldMatrix=h}else d&&(g.position=d),e&&(g.rotation=e);return f},b.load=function(a){return v.loader.create(a,null,null,b)},b.WORLDMATRIX=0,b.MVPMATRIX=1,b._uniqueIDCounter=0,b._nameNumberCounter=0,b}(),Jb=function(a){function k(a,b,c,d,e,f,g,h,i,j){if(this._curActTexIndex=0,this._program=null,this._attributeParams=null,this._uniformParams=null,this._attributeParamsMap=[],this._sceneUniformParamsMap=[],this._cameraUniformParamsMap=[],this._spriteUniformParamsMap=[],this._materialUniformParamsMap=[],this._renderElementUniformParamsMap=[],k.__super.call(this),!a||!b)throw"Shader Error";this._id=++k._count,this._vs=a,this._ps=b,this._attributeMap=c,this._sceneUniformMap=d,this._cameraUniformMap=e,this._spriteUniformMap=f,this._materialUniformMap=g,this._renderElementUniformMap=h,this._precompile=i,this._define=j,this._precompile&&k.extCompileObj&&k.extCompileFunc?k.extCompileFunc.call(k.extCompileObj,a,b,j):this.recreateResource()}n(k,"laya.d3.shader.Shader3D",c);var b=k.prototype;return b.recreateResource=function(){F.now();this._compile(),this.completeCreate(),this.memorySize=0},b.disposeResource=function(){D.mainContext.deleteShader(this._vshader),D.mainContext.deleteShader(this._pshader),D.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._attributeParams=null,this._uniformParams=null,this.memorySize=0,this._curActTexIndex=0},b._compile=function(){if(this._vs&&this._ps&&!this._attributeParams&&!this._uniformParams){this._reCompile=!0,this._attributeParams=[],this._uniformParams=[];var a=[this._vs,this._ps],b=D.mainContext;if(this._program=b.createProgram(),this._vshader=k._createShader(b,a[0],35633),this._pshader=k._createShader(b,a[1],35632),b.attachShader(this._program,this._vshader),b.attachShader(this._program,this._pshader),b.linkProgram(this._program),!p.isConchApp&&yb.debugMode&&!b.getProgramParameter(this._program,35714))throw b.getProgramInfoLog(this._program);var c,d=0,e=0,f=0;for(f=p.isConchApp?b.getProgramParameterEx(this._vs,this._ps,"",35721):b.getProgramParameter(this._program,35721),d=0;d<f;d++){var g=null;c={vartype:"attribute",ivartype:0,attrib:g=p.isConchApp?b.getActiveAttribEx(this._vs,this._ps,"",d):b.getActiveAttrib(this._program,d),location:b.getAttribLocation(this._program,g.name),name:g.name,type:g.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._attributeParams.push(c)}var h=0;for(h=p.isConchApp?b.getProgramParameterEx(this._vs,this._ps,"",35718):b.getProgramParameter(this._program,35718),d=0;d<h;d++){var i=null;i=p.isConchApp?b.getActiveUniformEx(this._vs,this._ps,"",d):b.getActiveUniform(this._program,d),0<(c={vartype:"uniform",ivartype:1,attrib:g,location:b.getUniformLocation(this._program,i.name),name:i.name,type:i.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(c.name=c.name.substr(0,c.name.length-3),c.isArray=!0,c.location=b.getUniformLocation(this._program,c.name)),this._uniformParams.push(c)}for(d=0,e=this._attributeParams.length;d<e;d++)(c=this._attributeParams[d]).indexOfParams=d,c.index=1,c.value=[c.location,null],c.codename=c.name,c.name=null!=this._attributeMap[c.codename]?this._attributeMap[c.codename]:c.codename,this._attributeParamsMap.push(c.name),this._attributeParamsMap.push(c),c._this=this,c.uploadedValue=[],c.fun=this._attribute;for(d=0,e=this._uniformParams.length;d<e;d++)switch((c=this._uniformParams[d]).indexOfParams=d,c.index=1,c.value=[c.location,null],c.codename=c.name,null!=this._sceneUniformMap[c.codename]?(c.name=this._sceneUniformMap[c.codename],this._sceneUniformParamsMap.push(c.name),this._sceneUniformParamsMap.push(c)):null!=this._cameraUniformMap[c.codename]?(c.name=this._cameraUniformMap[c.codename],this._cameraUniformParamsMap.push(c.name),this._cameraUniformParamsMap.push(c)):null!=this._spriteUniformMap[c.codename]?(c.name=this._spriteUniformMap[c.codename],this._spriteUniformParamsMap.push(c.name),this._spriteUniformParamsMap.push(c)):null!=this._materialUniformMap[c.codename]?(c.name=this._materialUniformMap[c.codename],this._materialUniformParamsMap.push(c.name),this._materialUniformParamsMap.push(c)):null!=this._renderElementUniformMap[c.codename]?(c.name=this._renderElementUniformMap[c.codename],this._renderElementUniformParamsMap.push(c.name),this._renderElementUniformParamsMap.push(c)):console.log("Shader:can't find uinform name:"+c.codename+" in shader file."),c._this=this,c.uploadedValue=[],c.type){case 5124:c.fun=c.isArray?this._uniform1iv:this._uniform1i;break;case 5126:c.fun=c.isArray?this._uniform1fv:this._uniform1f;break;case 35664:c.fun=c.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:c.fun=c.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:c.fun=c.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:c.fun=this._uniform_sampler2D;break;case 35680:c.fun=this._uniform_samplerCube;break;case 35676:c.fun=this._uniformMatrix4fv;break;case 35670:c.fun=this._uniform1i;break;case 35674:c.fun=this._uinformMatrix2fv;break;case 35675:c.fun=this._uinformMatrix3fv;break;default:throw new Error("compile shader err!")}}},b._attribute=function(a,b){var c=D.mainContext,d=h._enableAtributes,e=a.location;return d[e]||c.enableVertexAttribArray(e),c.vertexAttribPointer(e,b[0],b[1],b[2],b[3],b[4]),d[e]=h._bindVertexBuffer,1},b._uniform1f=function(a,b){var c=a.uploadedValue;return c[0]!==b?(D.mainContext.uniform1f(a.location,c[0]=b),1):0},b._uniform1fv=function(a,b){if(b.length<4){var c=a.uploadedValue;return c[0]!==b[0]||c[1]!==b[1]||c[2]!==b[2]||c[3]!==b[3]?(D.mainContext.uniform1fv(a.location,b),c[0]=b[0],c[1]=b[1],c[2]=b[2],c[3]=b[3],1):0}return D.mainContext.uniform1fv(a.location,b),1},b._uniform_vec2=function(a,b){var c=a.uploadedValue;return c[0]!==b[0]||c[1]!==b[1]?(D.mainContext.uniform2f(a.location,c[0]=b[0],c[1]=b[1]),1):0},b._uniform_vec2v=function(a,b){if(b.length<2){var c=a.uploadedValue;return c[0]!==b[0]||c[1]!==b[1]||c[2]!==b[2]||c[3]!==b[3]?(D.mainContext.uniform2fv(a.location,b),c[0]=b[0],c[1]=b[1],c[2]=b[2],c[3]=b[3],1):0}return D.mainContext.uniform2fv(a.location,b),1},b._uniform_vec3=function(a,b){var c=a.uploadedValue;return c[0]!==b[0]||c[1]!==b[1]||c[2]!==b[2]?(D.mainContext.uniform3f(a.location,c[0]=b[0],c[1]=b[1],c[2]=b[2]),1):0},b._uniform_vec3v=function(a,b){return D.mainContext.uniform3fv(a.location,b),1},b._uniform_vec4=function(a,b){var c=a.uploadedValue;return c[0]!==b[0]||c[1]!==b[1]||c[2]!==b[2]||c[3]!==b[3]?(D.mainContext.uniform4f(a.location,c[0]=b[0],c[1]=b[1],c[2]=b[2],c[3]=b[3]),1):0},b._uniform_vec4v=function(a,b){return D.mainContext.uniform4fv(a.location,b),1},b._uniformMatrix2fv=function(a,b){return D.mainContext.uniformMatrix2fv(a.location,!1,b),1},b._uniformMatrix3fv=function(a,b){return D.mainContext.uniformMatrix3fv(a.location,!1,b),1},b._uniformMatrix4fv=function(a,b){return D.mainContext.uniformMatrix4fv(a.location,!1,b),1},b._uinformMatrix2fv=function(a,b){return D.mainContext.uniformMatrix2fv(a.location,!1,b),1},b._uinformMatrix3fv=function(a,b){return D.mainContext.uniformMatrix3fv(a.location,!1,b),1},b._uniform1i=function(a,b){var c=a.uploadedValue;return c[0]!==b?(D.mainContext.uniform1i(a.location,c[0]=b),1):0},b._uniform1iv=function(a,b){return D.mainContext.uniform1iv(a.location,b),1},b._uniform_ivec2=function(a,b){var c=a.uploadedValue;return c[0]!==b[0]||c[1]!==b[1]?(D.mainContext.uniform2i(a.location,c[0]=b[0],c[1]=b[1]),1):0},b._uniform_ivec2v=function(a,b){return D.mainContext.uniform2iv(a.location,b),1},b._uniform_vec3i=function(a,b){var c=a.uploadedValue;return c[0]!==b[0]||c[1]!==b[1]||c[2]!==b[2]?(D.mainContext.uniform3i(a.location,c[0]=b[0],c[1]=b[1],c[2]=b[2]),1):0},b._uniform_vec3vi=function(a,b){return D.mainContext.uniform3iv(a.location,b),1},b._uniform_vec4i=function(a,b){var c=a.uploadedValue;return c[0]!==b[0]||c[1]!==b[1]||c[2]!==b[2]||c[3]!==b[3]?(D.mainContext.uniform4i(a.location,c[0]=b[0],c[1]=b[1],c[2]=b[2],c[3]=b[3]),1):0},b._uniform_vec4vi=function(a,b){return D.mainContext.uniform4iv(a.location,b),1},b._uniform_sampler2D=function(a,b){var c=b.source||b.defaulteTexture.source,d=D.mainContext,e=a.uploadedValue;if(null!=e[0])return d.activeTexture(k._TEXTURES[e[0]]),c&&E.bindTexture(d,3553,c),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return e[0]=this._curActTexIndex,d.uniform1i(a.location,this._curActTexIndex),d.activeTexture(k._TEXTURES[this._curActTexIndex]),c&&E.bindTexture(d,3553,c),this._curActTexIndex++,1},b._uniform_samplerCube=function(a,b){var c=b.source||b.defaulteTexture.source,d=D.mainContext,e=a.uploadedValue;if(null!=e[0])return d.activeTexture(k._TEXTURES[e[0]]),c?E.bindTexture(d,34067,c):E.bindTexture(d,34067,SolidColorTextureCube.grayTexture.source),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return e[0]=this._curActTexIndex,d.uniform1i(a.location,this._curActTexIndex),d.activeTexture(k._TEXTURES[this._curActTexIndex]),c?E.bindTexture(d,34067,c):E.bindTexture(d,34067,SolidColorTextureCube.grayTexture.source),this._curActTexIndex++,1},b._noSetValue=function(a){console.log("no....:"+a.name)},b.bind=function(){return c.activeShader=this,(c.bindShader=this).activeResource(),E.UseProgram(this._program)},b.uploadAttributes=function(a,b){for(var c,d,e=0,f=0,g=this._attributeParamsMap.length;f<g;f+=2)d=this._attributeParamsMap[f+1],null!=(c=a[this._attributeParamsMap[f]])&&(b&&b[d.name]&&b[d.name].bind(),e+=d.fun.call(this,d,c));y.shaderCall+=e},b.uploadAttributesX=function(a,b){for(var c,d,e=0,f=0,g=this._attributeParamsMap.length;f<g;f+=2)d=this._attributeParamsMap[f+1],null!=(c=a[this._attributeParamsMap[f]])&&(b._bind(),e+=d.fun.call(this,d,c));y.shaderCall+=e},b.uploadSceneUniforms=function(a){for(var b,c,d=0,e=0,f=this._sceneUniformParamsMap.length;e<f;e+=2)c=this._sceneUniformParamsMap[e+1],null!=(b=a[this._sceneUniformParamsMap[e]])&&(d+=c.fun.call(this,c,b));y.shaderCall+=d},b.uploadCameraUniforms=function(a){for(var b,c,d=0,e=0,f=this._cameraUniformParamsMap.length;e<f;e+=2)c=this._cameraUniformParamsMap[e+1],null!=(b=a[this._cameraUniformParamsMap[e]])&&(d+=c.fun.call(this,c,b));y.shaderCall+=d},b.uploadSpriteUniforms=function(a){for(var b,c,d=0,e=0,f=this._spriteUniformParamsMap.length;e<f;e+=2)c=this._spriteUniformParamsMap[e+1],null!=(b=a[this._spriteUniformParamsMap[e]])&&(d+=c.fun.call(this,c,b));y.shaderCall+=d},b.uploadMaterialUniforms=function(a){for(var b,c,d=0,e=0,f=this._materialUniformParamsMap.length;e<f;e+=2)c=this._materialUniformParamsMap[e+1],null!=(b=a[this._materialUniformParamsMap[e]])&&(d+=c.fun.call(this,c,b));y.shaderCall+=d},b.uploadRenderElementUniforms=function(a){for(var b,c,d=0,e=0,f=this._renderElementUniformParamsMap.length;e<f;e+=2)c=this._renderElementUniformParamsMap[e+1],null!=(b=a[this._renderElementUniformParamsMap[e]])&&(d+=c.fun.call(this,c,b));y.shaderCall+=d},k.create=function(a,b,c,d,e,f,g,h,i,j){return new k(a,b,c,d,e,f,g,h,i,j)},k.addInclude=function(a,b){t.addInclude(a,b)},k._createShader=function(a,b,c){var d=a.createShader(c);if(a.shaderSource(d,b),a.compileShader(d),yb.debugMode&&!a.getShaderParameter(d,35713))throw a.getShaderInfoLog(d);return d},k.PERIOD_RENDERELEMENT=0,k.PERIOD_MATERIAL=1,k.PERIOD_SPRITE=2,k.PERIOD_CAMERA=3,k.PERIOD_SCENE=4,k._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,33991],k._count=0,k._preCompile=!1,k.extCompileFunc=null,k.extCompileObj=null,l(k,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"nameKey",function(){return this.nameKey=new z}]),k}(),Kb=function(h){function i(){this._transformUV=null,i.__super.call(this),this.setShaderName("SIMPLE"),this._setColor(9,new gb(.6,.6,.6)),this._setColor(10,new gb(1,1,1)),this._setColor(11,new hb(1,1,1,8)),this._setColor(12,new gb(1,1,1)),this._setColor(7,new hb(1,1,1,1)),this._setNumber(0,.5),this._setColor(15,new hb(1,1,0,0)),this.renderMode=1}n(i,"laya.d3.core.material.StandardMaterial",h);var a=i.prototype;return a.disableLight=function(){this._addDisablePublicShaderDefine(yb.SHADERDEFINE_POINTLIGHT|yb.SHADERDEFINE_SPOTLIGHT|yb.SHADERDEFINE_DIRECTIONLIGHT)},a.disableFog=function(){this._addDisablePublicShaderDefine(yb.SHADERDEFINE_FOG)},a.onAsynLoaded=function(a,b,c){var d=b[0];if(d.version)h.prototype.onAsynLoaded.call(this,a,b,c);else{var e=b[1],f=d.props;for(var g in f)this[g]=f[g];i._parseStandardMaterial(e,this,d),this._endLoaded()}},a.cloneTo=function(a){h.prototype.cloneTo.call(this,a);var b=a;this._transformUV&&(b._transformUV=this._transformUV.clone())},o(0,a,"ambientColor",function(){return this._getColor(9)},function(a){this._setColor(9,a)}),o(0,a,"ambientTexture",function(){return this._getTexture(5)},function(a){a?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP),this._setTexture(5,a)}),o(0,a,"renderMode",null,function(a){switch(a){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(i.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(i.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3,this.alphaTest=!0,this._removeShaderDefine(i.SHADERDEFINE_ADDTIVEFOG);break;case 4:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!0,this._removeShaderDefine(i.SHADERDEFINE_ADDTIVEFOG);break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(i.SHADERDEFINE_ADDTIVEFOG);break;case 14:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(i.SHADERDEFINE_ADDTIVEFOG);break;case 15:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(i.SHADERDEFINE_ADDTIVEFOG);break;case 16:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(i.SHADERDEFINE_ADDTIVEFOG);break;case 5:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(i.SHADERDEFINE_ADDTIVEFOG);break;case 6:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(i.SHADERDEFINE_ADDTIVEFOG);break;case 7:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(i.SHADERDEFINE_ADDTIVEFOG);break;case 8:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(i.SHADERDEFINE_ADDTIVEFOG);break;case 9:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(i.SHADERDEFINE_ADDTIVEFOG);break;case 10:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(i.SHADERDEFINE_ADDTIVEFOG);break;case 11:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(i.SHADERDEFINE_ADDTIVEFOG);break;case 12:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(i.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(a)}),o(0,a,"reflectColor",function(){return this._getColor(12)},function(a){this._setColor(12,a)}),o(0,a,"tilingOffset",function(){return this._getColor(15)},function(a){if(a){var b=a.elements;1!=b[0]||1!=b[1]||0!=b[2]||0!=b[3]?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(15,a)}),o(0,a,"albedo",function(){return this._getColor(7)},function(a){this._setColor(7,a)}),o(0,a,"diffuseColor",function(){return this._getColor(10)},function(a){this._setColor(10,a)}),o(0,a,"albedoColor",function(){return this._getColor(7)},function(a){this._setColor(7,a)}),o(0,a,"specularColor",function(){return this._getColor(11)},function(a){this._setColor(11,a)}),o(0,a,"diffuseTexture",function(){return this._getTexture(1)},function(a){a?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,a)}),o(0,a,"normalTexture",function(){return this._getTexture(2)},function(a){a?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP),this._setTexture(2,a)}),o(0,a,"specularTexture",function(){return this._getTexture(3)},function(a){a?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP),this._setTexture(3,a)}),o(0,a,"emissiveTexture",function(){return this._getTexture(4)},function(a){a?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP),this._setTexture(4,a)}),o(0,a,"reflectTexture",function(){return this._getTexture(6)},function(a){a?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP),this._setTexture(6,a)}),o(0,a,"transformUV",function(){return this._transformUV},function(a){this._transformUV=a,this._setMatrix4x4(13,a.matrix),a?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM),this._conchMaterial&&this._conchMaterial.setShaderValue(13,a.matrix.elements,0)}),i.__init__=function(){i.SHADERDEFINE_DIFFUSEMAP=i.shaderDefines.registerDefine("DIFFUSEMAP"),i.SHADERDEFINE_NORMALMAP=i.shaderDefines.registerDefine("NORMALMAP"),i.SHADERDEFINE_SPECULARMAP=i.shaderDefines.registerDefine("SPECULARMAP"),i.SHADERDEFINE_EMISSIVEMAP=i.shaderDefines.registerDefine("EMISSIVEMAP"),i.SHADERDEFINE_AMBIENTMAP=i.shaderDefines.registerDefine("AMBIENTMAP"),i.SHADERDEFINE_REFLECTMAP=i.shaderDefines.registerDefine("REFLECTMAP"),i.SHADERDEFINE_UVTRANSFORM=i.shaderDefines.registerDefine("UVTRANSFORM"),i.SHADERDEFINE_TILINGOFFSET=i.shaderDefines.registerDefine("TILINGOFFSET"),i.SHADERDEFINE_ADDTIVEFOG=i.shaderDefines.registerDefine("ADDTIVEFOG")},i.load=function(a){return v.loader.create(a,null,null,i)},i._parseStandardMaterial=function(a,b,c){var d=c.customProps,e=d.ambientColor;b.ambientColor=new gb(e[0],e[1],e[2]);var f=d.diffuseColor;b.diffuseColor=new gb(f[0],f[1],f[2]);var g=d.specularColor;b.specularColor=new hb(g[0],g[1],g[2],g[3]);var h=d.reflectColor;b.reflectColor=new gb(h[0],h[1],h[2]);var i=d.albedoColor;i&&(b.albedo=new hb(i[0],i[1],i[2],i[3]));var j=d.diffuseTexture.texture2D;j&&(b.diffuseTexture=r.getRes(a[j]));var k=d.normalTexture.texture2D;k&&(b.normalTexture=r.getRes(a[k]));var l=d.specularTexture.texture2D;l&&(b.specularTexture=r.getRes(a[l]));var m=d.emissiveTexture.texture2D;m&&(b.emissiveTexture=r.getRes(a[m]));var n=d.ambientTexture.texture2D;n&&(b.ambientTexture=r.getRes(a[n]));var o=d.reflectTexture.texture2D;o&&(b.reflectTexture=r.getRes(a[o]))},i.RENDERMODE_OPAQUE=1,i.RENDERMODE_OPAQUEDOUBLEFACE=2,i.RENDERMODE_CUTOUT=3,i.RENDERMODE_CUTOUTDOUBLEFACE=4,i.RENDERMODE_TRANSPARENT=13,i.RENDERMODE_TRANSPARENTDOUBLEFACE=14,i.RENDERMODE_ADDTIVE=15,i.RENDERMODE_ADDTIVEDOUBLEFACE=16,i.RENDERMODE_DEPTHREAD_TRANSPARENT=5,i.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,i.RENDERMODE_DEPTHREAD_ADDTIVE=7,i.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,i.RENDERMODE_NONDEPTH_TRANSPARENT=9,i.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,i.RENDERMODE_NONDEPTH_ADDTIVE=11,i.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,i.SHADERDEFINE_DIFFUSEMAP=0,i.SHADERDEFINE_NORMALMAP=0,i.SHADERDEFINE_SPECULARMAP=0,i.SHADERDEFINE_EMISSIVEMAP=0,i.SHADERDEFINE_AMBIENTMAP=0,i.SHADERDEFINE_REFLECTMAP=0,i.SHADERDEFINE_UVTRANSFORM=0,i.SHADERDEFINE_TILINGOFFSET=0,i.SHADERDEFINE_ADDTIVEFOG=0,i.DIFFUSETEXTURE=1,i.NORMALTEXTURE=2,i.SPECULARTEXTURE=3,i.EMISSIVETEXTURE=4,i.AMBIENTTEXTURE=5,i.REFLECTTEXTURE=6,i.ALBEDO=7,i.UVANIAGE=8,i.MATERIALAMBIENT=9,i.MATERIALDIFFUSE=10,i.MATERIALSPECULAR=11,i.MATERIALREFLECT=12,i.UVMATRIX=13,i.UVAGE=14,i.TILINGOFFSET=15,l(i,["defaultMaterial",function(){var a=new i;return a.lock=!0,this.defaultMaterial=a},"shaderDefines",function(){return this.shaderDefines=new kb(Cb.shaderDefines)}]),i}(Cb),Lb=function(a){function g(a,b,c,d,e){this._indexType=null,this._indexTypeByteCount=0,this._indexCount=0,this._canRead=!1,void 0===c&&(c=35044),void 0===d&&(d=!1),g.__super.call(this),this._indexType=a,this._indexCount=b,this._bufferUsage=c,this._bufferType=34963,this._canRead=d;var f;if("ushort"==a)this._indexTypeByteCount=2;else{if("ubyte"!=a)throw new Error("unidentification index type.");this._indexTypeByteCount=1}f=this._indexTypeByteCount*b,this._byteLength=f,this._bind(),h._gl.bufferData(this._bufferType,f,this._bufferUsage),this.uri=e,d?("ushort"==a?this._buffer=new Uint16Array(b):"ubyte"==a&&(this._buffer=new Uint8Array(b)),this.memorySize=2*f):this.memorySize=f}n(g,"laya.d3.graphics.IndexBuffer3D",a);var b=g.prototype;return b.setData=function(a,b,c,d){void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=4294967295);var e=0;if("ushort"==this._indexType?(e=2,0===c&&4294967295===d||(a=new Uint16Array(a.buffer,c*e,d))):"ubyte"==this._indexType&&(e=1,0===c&&4294967295===d||(a=new Uint8Array(a.buffer,c*e,d))),this._bind(),h._gl.bufferSubData(this._bufferType,b*e,a),this._canRead)if(0!==b||0!==c||4294967295!==d){var f=this._buffer.length-b;f<d&&(d=f);for(var g=0;g<d;g++)this._buffer[b+g]=a[g]}else this._buffer=a},b.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},b.disposeResource=function(){a.prototype.disposeResource.call(this),this._buffer=null,this.memorySize=0},o(0,b,"indexType",function(){return this._indexType}),o(0,b,"indexTypeByteCount",function(){return this._indexTypeByteCount}),o(0,b,"indexCount",function(){return this._indexCount}),o(0,b,"canRead",function(){return this._canRead}),g.INDEXTYPE_UBYTE="ubyte",g.INDEXTYPE_USHORT="ushort",g.create=function(a,b,c,d,e){return void 0===c&&(c=35044),void 0===d&&(d=!1),new g(a,b,c,d,e)},g}(h),Mb=function(f){function g(a,b,c,d,e){this._vertexDeclaration=null,this._vertexCount=0,this._canRead=!1,void 0===d&&(d=!1),g.__super.call(this),this._vertexDeclaration=a,this._vertexCount=b,this._bufferUsage=c,this._bufferType=34962,this._canRead=d,this.uri=e,this.memorySize=this._byteLength=this._vertexDeclaration.vertexStride*b,this._bind(),h._gl.bufferData(this._bufferType,this._byteLength,this._bufferUsage),d&&(this._buffer=new Float32Array(this._byteLength/4))}n(g,"laya.d3.graphics.VertexBuffer3D",f);var a=g.prototype;return a.bindWithIndexBuffer=function(a){a&&a._bind(),this._bind()},a.setData=function(a,b,c,d){if(void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=4294967295),0===c&&4294967295===d||(a=new Float32Array(a.buffer,4*c,d)),this._bind(),h._gl.bufferSubData(this._bufferType,4*b,a),this._canRead)if(0!==b||0!==c||4294967295!==d){var e=this._buffer.length-b;e<d&&(d=e);for(var f=0;f<d;f++)this._buffer[b+f]=a[f]}else this._buffer=a},a.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},a.disposeResource=function(){for(var a=D.mainContext,b=this._vertexDeclaration.getVertexElements(),c=h._enableAtributes,d=0,e=b.length;d<e;d++)c[d]===this._glBuffer&&(a.disableVertexAttribArray(d),c[d]=null);f.prototype.disposeResource.call(this),this._buffer=null,this._vertexDeclaration=null,this.memorySize=0},o(0,a,"vertexDeclaration",function(){return this._vertexDeclaration}),o(0,a,"vertexCount",function(){return this._vertexCount}),o(0,a,"canRead",function(){return this._canRead}),g.create=function(a,b,c,d,e){return void 0===c&&(c=35044),void 0===d&&(d=!1),new g(a,b,c,d,e)},g}(h),Nb=function(a){function t(){this.simLodInfo=null,this._src=null,this._buffer=null,this._image=null,this._mipmaps=null,this._recreateLock=!1,this._needReleaseAgain=!1,t.__super.call(this),this._type=3553}n(t,"laya.d3.resource.DataTexture2D",Db);var b=t.prototype;return b.genDebugMipmaps=function(){var a=[];return a.push(new Uint8Array(new Uint32Array(131072).fill(4278190335).buffer)),a.push(new Uint8Array(new Uint32Array(32768).fill(4278223103).buffer)),a.push(new Uint8Array(new Uint32Array(8192).fill(4278255615).buffer)),a.push(new Uint8Array(new Uint32Array(2048).fill(4278255360).buffer)),a.push(new Uint8Array(new Uint32Array(512).fill(4286595072).buffer)),a.push(new Uint8Array(new Uint32Array(128).fill(4294901760).buffer)),a.push(new Uint8Array(new Uint32Array(32).fill(4294901888).buffer)),a.push(new Uint8Array(new Uint32Array(8).fill(0).buffer)),a.push(new Uint8Array(new Uint32Array(2).fill(4286611584).buffer)),a.push(new Uint8Array(new Uint32Array(1).fill(4294967295).buffer)),a},b._onTextureLoaded=function(a){},b._createWebGlTexture=function(){if(!this._buffer&&!this._image&&!this._mipmaps)throw"create GLTextur err:no data";var a=D.mainContext;a.getExtension("EXT_shader_texture_lod");var b=this._source=a.createTexture(),c=this._width,d=this._height,e=E.curBindTexTarget,f=E.curBindTexValue,g=!1;if(E.bindTexture(a,this._type,b),this._mipmaps){if(laya.d3.resource.DataTexture2D.lodasatlas){var h=0;a.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null);for(var i=0;i<this._mipmaps.length;i++){if(this._mipmaps[i].byteLength!=j*k*4)throw"mipmap size error  level:"+i;a.texSubImage2D(this._type,0,t.simLodRect[h++],t.simLodRect[h++],t.simLodRect[h++],t.simLodRect[h++],6408,5121,new Uint8Array(this._mipmaps[i]))}this.minFifter=9729,this.magFifter=9729}else{var j=this._width,k=this._height;for(h=0,a.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null),i=0;i<this._mipmaps.length;i++){if(this._mipmaps[i].byteLength!=j*k*4)throw"mipmap size error  level:"+i;a.texImage2D(this._type,i,6408,j,k,0,6408,5121,new Uint8Array(this._mipmaps[i])),(j/=2)<1&&(j=1),(k/=2)<1&&(k=1),this.minFifter=9987,this.magFifter=9729}}this.mipmap=!1}else if(this._image)6407==this._format&&a.pixelStorei(a.UNPACK_ALIGNMENT,1),a.texImage2D(this._type,0,this._format,this._format,5121,this._image);else if(this._buffer){var l=0,m=!1,n=!1;this._buffer.byteLength==4*c*d?(l=6408,m=!0):this._buffer.byteLength==3*c*d?(l=6407,n=!0):l=this._format,m||n?(this._buffer instanceof Uint8Array||(this._buffer=new Uint8Array(this._buffer)),n&&a.pixelStorei(a.UNPACK_ALIGNMENT,1),a.texImage2D(this._type,0,l,c,d,0,l,5121,this._buffer)):a&&l==a.ALPHA?(a.texImage2D(3553,0,l,c,d,0,l,a.UNSIGNED_BYTE,this._buffer),g=!0):0!=l&&(a.compressedTexImage2D(3553,0,l,c,d,0,this._buffer),g=!0)}var o=this._minFifter,p=this._magFifter,q=0==this._wrapModeU?10497:33071,r=0==this._wrapModeV?10497:33071,s=u.isPOT(c,d);s?(this._mipmap||this._mipmaps?-1!==o||(o=9987):-1!==o||(o=9729),-1!==p||(p=9729),a.texParameteri(this._type,10241,o),a.texParameteri(this._type,10240,p),a.texParameteri(this._type,10242,q),a.texParameteri(this._type,10243,r),this._mipmap&&a.generateMipmap(this._type)):(-1!==o||(o=9729),-1!==p||(p=9729),a.texParameteri(this._type,10241,o),a.texParameteri(this._type,10240,p),a.texParameteri(this._type,10242,33071),a.texParameteri(this._type,10243,33071)),e&&f&&E.bindTexture(a,e,f),this.memorySize=g?this._buffer.length:s?c*d*4*(1+1/3):c*d*4,this.src&&0<this.src.length&&(this._buffer=null,this._image=null),this._recreateLock=!1},b.recreateResource=function(){if(this._buffer||this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._buffer||this._image||this._mipmaps){if(this._recreateLock)return;this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0}},b.onAsynLoaded=function(a,b,c){var d;c&&(d=c[0].call(this,b)),d&&(this._width=d.width,this._height=d.height,this._buffer=d.data),this._src=a,this._size=new pb(this._width,this._height),this._conchTexture?alert("怎么给runtime传递datatexture数据"):this.activeResource(),this._endLoaded()},b.getPixels=function(){return new Uint8Array(this._buffer)},b.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(D.mainContext.deleteTexture(this._source),this._source=null,this._buffer=null,this._image=null,this.memorySize=0)},o(0,b,"src",function(){return this._src}),t.create=function(a,b,c,d,e,f,g){if(void 0===d&&(d=9729),void 0===e&&(e=9729),void 0===f&&(f=!0),!a||a.byteLength<b*c*4)throw"DataTexture2D create error";var h=new t;return h.uri=g,h._buffer=a,h._width=b,h._height=c,h._mipmap=f,h._magFifter=d,h._minFifter=e,h._size=new pb(h._width,h._height),h._conchTexture?alert("怎么给runtime传递datatexture数据"):h.activeResource(),h},t.load=function(a,b,c,d,e){if(void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=9729),void 0===e&&(e=9729),"mipmaps"===A.getFileExtension(a)){var f=v.loader.create(a,null,null,t,[function(a){this._mipmaps=[];var b=new Uint32Array(a);this._width=b[0];var c=512;if(laya.d3.resource.DataTexture2D.lodasatlas&&(this._width*=2,c=1024),this._width!=c)throw"现在只支持512x256的环境贴图。当前的是"+b[0];this._height=b[1];for(var d=laya.d3.resource.DataTexture2D.lodasatlas?this._width/2:this._width,e=this._height,f=8;;){var g=d*e*4;if(f+g>a.byteLength)throw"load mipmaps data size error ";var h=new Uint8Array(a,f,g);if(this._mipmaps.push(h),f+=g,1==d&&1==e)break;(d/=2)<1&&(d=1),(e/=2)<1&&(e=1)}return null}]);if(laya.d3.resource.DataTexture2D.lodasatlas){f.simLodInfo=new Float32Array(40);for(var g=0;g<f.simLodInfo.length;)f.simLodInfo[g]=(t.simLodRect[g]+.5)/1024,g++,f.simLodInfo[g]=(t.simLodRect[g]+.5)/256,g++,f.simLodInfo[g]=Math.max(t.simLodRect[g]-1,.1)/1024,g++,f.simLodInfo[g]=Math.max(t.simLodRect[g]-1.5,.1)/256,g++}return f}if("number"==typeof b)return v.loader.create(a,null,null,t,[function(a){return this._width=b,this._height=c,this._buffer=a,null}]);if("function"==typeof b)return v.loader.create(a,null,null,t,[b]);throw new Error("unknown params.")},t.lodasatlas=!1,l(t,["simLodRect",function(){return this.simLodRect=new Uint32Array([0,0,512,256,512,0,256,128,768,0,128,64,896,0,64,32,960,0,32,16,992,0,16,8,1008,0,8,4,1016,0,4,2,1020,0,2,1,1022,0,1,1])}]),t}(),Ob=function(a){function b(){this._numberVertices=0,this._numberIndices=0,this._vertexBuffer=null,this._indexBuffer=null,b.__super.call(this)}n(b,"laya.d3.resource.models.PrimitiveMesh",Eb);var c=b.prototype;return v.imps(c,{"laya.d3.core.render.IRenderable":!0}),c._getVertexBuffer=function(a){return void 0===a&&(a=0),0===a?this._vertexBuffer:null},c._getVertexBuffers=function(){return null},c._getIndexBuffer=function(){return this._indexBuffer},c._getPositions=function(){var a,b=[],c=this._vertexBuffer.vertexDeclaration.getVertexElements(),d=0;for(d=0;d<c.length;d++){var e=c[d];if("vector3"===e.elementFormat&&0===e.elementUsage){a=e;break}}var f=this._vertexBuffer.getData();for(d=0;d<f.length;d+=this._vertexBuffer.vertexDeclaration.vertexStride/4){var g=d+a.offset/4,h=new gb(f[g+0],f[g+1],f[g+2]);b.push(h)}return b},c.getRenderElement=function(a){return this},c.getRenderElementsCount=function(){return 1},c.disposeResource=function(){this._vertexBuffer&&(this._vertexBuffer._removeReference(),this._vertexBuffer=null),this._indexBuffer&&(this._indexBuffer._removeReference(),this._indexBuffer=null),this.memorySize=0},c._beforeRender=function(a){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},c._render=function(a){D.mainContext.drawElements(4,this._numberIndices,5123,0),y.drawCall++,y.trianglesFaces+=this._numberIndices/3},o(0,c,"_vertexBufferCount",function(){return 1}),o(0,c,"triangleCount",function(){return this._indexBuffer.indexCount/3}),b}(),Pb=function(a){function b(){this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null,this._skinnedDatas=null,b.__super.call(this),this._subMeshes=[],this._materials=[],this._vertexBuffers=[]}n(b,"laya.d3.resource.models.Mesh",Eb);var c=b.prototype;return c._getPositions=function(){var a,b,c,d,e,f=[],g=0,h=0,i=0;if(0!==this._vertexBuffers.length){var j=this._vertexBuffers.length;for(g=0;g<j;g++){for(c=(a=this._vertexBuffers[g]).vertexDeclaration.getVertexElements(),h=0;h<c.length;h++)if("vector3"===(d=c[h]).elementFormat&&0===d.elementUsage){b=d;break}for(e=a.getData(),h=0;h<e.length;h+=a.vertexDeclaration.vertexStride/4)i=h+b.offset/4,f.push(new gb(e[i+0],e[i+1],e[i+2]))}}else{var k=this._subMeshes.length;for(g=0;g<k;g++){for(c=(a=this._subMeshes[g]._getVertexBuffer()).vertexDeclaration.getVertexElements(),h=0;h<c.length;h++)if("vector3"===(d=c[h]).elementFormat&&0===d.elementUsage){b=d;break}for(e=a.getData(),h=0;h<e.length;h+=a.vertexDeclaration.vertexStride/4)i=h+b.offset/4,f.push(new gb(e[i+0],e[i+1],e[i+2]))}}return f},c._setSubMeshes=function(a){this._subMeshes=a,this._subMeshCount=a.length;for(var b=0;b<this._subMeshCount;b++)a[b]._indexInMesh=b;this._positions=this._getPositions(),this._generateBoundingObject()},c.onAsynLoaded=function(a,b,c){var d=b[0],e=b[1];Wa.read(d,this,this._materials,this._subMeshes,e),this.completeCreate(),this._endLoaded()},c.getSubMesh=function(a){return this._subMeshes[a]},c.getSubMeshCount=function(){return this._subMeshes.length},c.getRenderElementsCount=function(){return this._subMeshes.length},c.getRenderElement=function(a){return this._subMeshes[a]},c.disposeResource=function(){for(var a=0;a<this._subMeshes.length;a++)this._subMeshes[a].dispose();this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null},o(0,c,"materials",function(){return this._materials.slice()}),o(0,c,"InverseAbsoluteBindPoses",function(){return this._inverseBindPoses}),b.load=function(a){return v.loader.create(a,null,null,b)},b}(),Qb=(function(a){function j(a,b,c,d,e,f,g,h,i){this._alreadyResolved=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._frameBuffer=null,this._depthStencilBuffer=null,void 0===c&&(c=6408),void 0===d&&(d=5121),void 0===e&&(e=33189),void 0===f&&(f=!1),void 0===g&&(g=!1),void 0===h&&(h=-1),void 0===i&&(i=-1),j.__super.call(this),this._type=3553,this._width=a,this._height=b,this._size=new pb(a,b),this._surfaceFormat=c,this._surfaceType=d,this._depthStencilFormat=e,p.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipmap=f,this._repeat=g,this._minFifter=h,this._magFifter=i,this.activeResource(),this._alreadyResolved=!0}n(j,"laya.d3.resource.RenderTexture",Db);var b=j.prototype;b.recreateResource=function(){var a=D.mainContext;this._frameBuffer=a.createFramebuffer(),this._source=a.createTexture();var b=E.curBindTexTarget,c=E.curBindTexValue;E.bindTexture(a,this._type,this._source),a.texImage2D(this._type,0,6408,this._width,this._height,0,this._surfaceFormat,this._surfaceType,null);var d=this._minFifter,e=this._magFifter,f=this._repeat?10497:33071;if(u.isPOT(this._width,this._height)?(this._mipmap?-1!==d||(d=9987):-1!==d||(d=9729),-1!==e||(e=9729),a.texParameteri(this._type,10241,d),a.texParameteri(this._type,10240,e),a.texParameteri(this._type,10242,f),a.texParameteri(this._type,10243,f),this._mipmap&&a.generateMipmap(this._type)):(-1!==d||(d=9729),-1!==e||(e=9729),a.texParameteri(this._type,10241,d),a.texParameteri(this._type,10240,e),a.texParameteri(this._type,10242,33071),a.texParameteri(this._type,10243,33071)),b&&c&&E.bindTexture(a,b,c),a.bindFramebuffer(36160,this._frameBuffer),this._depthStencilFormat)switch(this._depthStencilBuffer=a.createRenderbuffer(),a.bindRenderbuffer(36161,this._depthStencilBuffer),a.renderbufferStorage(36161,this._depthStencilFormat,this._width,this._height),a.bindRenderbuffer(36161,null),this._depthStencilFormat){case 33189:a.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:a.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:a.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}a.framebufferTexture2D(36160,36064,3553,this._source,0),a.bindFramebuffer(36160,null),this.memorySize=this._width*this._height*4,this.completeCreate()},b.start=function(){D.mainContext.bindFramebuffer(36160,this.frameBuffer),(j._currentRenderTarget=this)._alreadyResolved=!1},b.end=function(){D.mainContext.bindFramebuffer(36160,null),j._currentRenderTarget=null,this._alreadyResolved=!0},b.getData=function(a,b,c,d){var e=D.mainContext;if(e.bindFramebuffer(36160,this._frameBuffer),!(36053===e.checkFramebufferStatus(36160)))return e.bindFramebuffer(36160,null),null;var f=new Uint8Array(this._width*this._height*4);return e.readPixels(a,b,c,d,this._surfaceFormat,this._surfaceType,f),e.bindFramebuffer(36160,null),f},b.disposeResource=function(){if(this._frameBuffer){var a=D.mainContext;a.deleteTexture(this._source),a.deleteFramebuffer(this._frameBuffer),a.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0}},o(0,b,"surfaceFormat",function(){return this._surfaceFormat}),o(0,b,"surfaceType",function(){return this._surfaceType}),o(0,b,"depthStencilFormat",function(){return this._depthStencilFormat}),o(0,b,"source",function(){return this._alreadyResolved?v.superGet(Db,this,"source"):null}),o(0,b,"depthStencilBuffer",function(){return this._depthStencilBuffer}),o(0,b,"frameBuffer",function(){return this._frameBuffer}),j._currentRenderTarget=null}(),function(a){function b(a){this._color=null,this._pixels=null,b.__super.call(this),this._type=3553,this._width=1,this._height=1,this._size=new pb(this.width,this.height),this._color=a,this._pixels=new Uint8Array([255*a.x,255*a.y,255*a.z,255*a.w]),this.uri="SolidColorTexture2D_"+this.id}n(b,"laya.d3.resource.SolidColorTexture2D",Db);var c=b.prototype;return c._createWebGlTexture=function(){var a=D.mainContext,b=this._source=a.createTexture(),c=this._width,d=this._height,e=E.curBindTexTarget,f=E.curBindTexValue;E.bindTexture(a,this._type,b),a.texImage2D(this._type,0,6408,c,d,0,6408,5121,this._pixels);var g=this._minFifter,h=this._magFifter,i=this._repeat?10497:33071,j=u.isPOT(c,d);j?(this._mipmap?-1!==g||(g=9987):-1!==g||(g=9729),-1!==h||(h=9729),a.texParameteri(this._type,10241,g),a.texParameteri(this._type,10240,h),a.texParameteri(this._type,10242,i),a.texParameteri(this._type,10243,i),this._mipmap&&a.generateMipmap(this._type)):(-1!==g||(g=9729),-1!==h||(h=9729),a.texParameteri(this._type,10241,g),a.texParameteri(this._type,10240,h),a.texParameteri(this._type,10242,33071),a.texParameteri(this._type,10243,33071)),e&&f&&E.bindTexture(a,e,f),this.memorySize=j?c*d*4*(1+1/3):c*d*4},c.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},c.disposeResource=function(){this._source&&(D.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},l(b,["magentaTexture",function(){var a=new b(new hb(1,0,1,1));return a.lock=!0,this.magentaTexture=a},"grayTexture",function(){var a=new b(new hb(.5,.5,.5,1));return a.lock=!0,this.grayTexture=a}]),b}()),Rb=function(a){function e(a,b,c,d){this._canRead=!1,this._image=null,this._pixels=null,void 0===a&&(a=!1),void 0===b&&(b=!0),void 0===c&&(c=6408),void 0===d&&(d=!0),e.__super.call(this),this._type=3553,this._repeat=b,this._canRead=a,this._format=c,this._mipmap=d}n(e,"laya.d3.resource.Texture2D",Db);var b=e.prototype;return b._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var a=D.mainContext,b=this._source=a.createTexture(),c=this._width,d=this._height,e=E.curBindTexTarget,f=E.curBindTexValue;switch(E.bindTexture(a,this._type,b),this._format){case 6407:case 6408:this._canRead?a.texImage2D(this._type,0,this._format,c,d,0,this._format,5121,this._pixels):this._image instanceof laya.webgl.resource.WebGLImage?a.texImage2D(this._type,0,this._image._format,c,d,0,this._image._format,5121,this._image.atlasSource):a.texImage2D(this._type,0,this._format,this._format,5121,this._image);break;case D.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:a.compressedTexImage2D(this._type,0,this._format,this._width,this._height,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}var g=this._minFifter,h=this._magFifter,i=this._repeat?10497:33071,j=0==this._wrapModeU?10497:33071,k=0==this._wrapModeV?10497:33071,l=u.isPOT(c,d);l?(this._mipmap?-1!==g||(g=9987):-1!==g||(g=9729),-1!==h||(h=9729),a.texParameteri(this._type,10241,g),a.texParameteri(this._type,10240,h),a.texParameteri(this._type,10242,i),a.texParameteri(this._type,10243,i),a.texParameteri(this._type,10242,j),a.texParameteri(this._type,10243,k),this._mipmap&&a.generateMipmap(this._type)):(-1!==g||(g=9729),-1!==h||(h=9729),a.texParameteri(this._type,10241,g),a.texParameteri(this._type,10240,h),a.texParameteri(this._type,10242,33071),a.texParameteri(this._type,10243,33071)),e&&f&&E.bindTexture(a,e,f),this._image.onload=null,this._image=null,this.memorySize=l?c*d*4*(1+1/3):c*d*4},b.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},b.onAsynLoaded=function(a,b,c){if(c){var d=c[0];void 0!==d&&(this._canRead=d);var e=c[1];void 0!==e&&(this._repeat=e);var f=c[2];void 0!==f&&(this._format=f);var g=c[3];void 0!==g&&(this._mipmap=g);var h=c.wrapModeU;void 0!==h&&(this._wrapModeU=h);var i=c.wrapModeV;void 0!==i&&(this._wrapModeV=i)}switch(this._format){case 6407:case 6408:var j=(this._image=b).width,k=b.height;this._width=j,this._height=k,this._size=new pb(j,k),this._canRead&&(p.isConchApp?b instanceof m.HTMLElement&&(this._pixels=new Uint8Array(b.getImageData(0,0,j,k))):(F.canvas.size(j,k),F.canvas.clear(),F.context.drawImage(b,0,0,j,k),this._pixels=new Uint8Array(F.context.getImageData(0,0,j,k).data.buffer)));break;case D.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:var l=new w(b);l.readUTFBytes(4),l.readUTFBytes(2),l.getInt16();l.endian="bigEndian",this._width=l.getInt16(),this._height=l.getInt16(),this._size=new pb(this._width,this._height);l.getInt16(),l.getInt16();this._image=new Uint8Array(b,l.pos)}this.recreateResource(),this._endLoaded()},b.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},b.disposeResource=function(){this._source&&(D.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0)},o(0,b,"_src",function(){return this.url}),o(0,b,"src",function(){return this.url}),e.load=function(a){return v.loader.create(a,null,null,e)},e}(),Sb=function(b){function c(a,b){c.__super.call(this),void 0===a&&(a=.3),void 0===b&&(b=1e3),this._tempVector3=new gb,this._position=new gb,this._up=new gb,this._forward=new gb,this._right=new gb,this._fieldOfView=60,this._useUserProjectionMatrix=!1,this._orthographic=!1,this._viewportExpressedInClipSpace=!0,this._renderTargetSize=pb.fullScreen,this._orthographicVerticalSize=10,this.renderingOrder=0,this._nearPlane=a,this._farPlane=b,this.cullingMask=2147483647,this.clearFlag=0,this.useOcclusionCulling=!0,this._calculateProjectionMatrix(),v.stage.on("resize",this,this._onScreenSizeChanged)}n(c,"laya.d3.core.BaseCamera",b);var a=c.prototype;return a._sortCamerasByRenderingOrder=function(){if(this._displayedInStage)for(var a=this.scene._cameraPool,b=a.length-1,c=0;c<b;c++)if(a[c].renderingOrder>a[b].renderingOrder){var d=a[c];a[c]=a[b],a[b]=d}},a._calculateProjectionMatrix=function(){},a._onScreenSizeChanged=function(){this._calculateProjectionMatrix()},a._prepareCameraToRender=function(){G._currentCameraCullingMask=this.cullingMask;var a=this._shaderValues;a.setValue(0,this.transform.position.elements),a.setValue(5,this.forward.elements),a.setValue(6,this.up.elements)},a._prepareCameraViewProject=function(a,b){var c=this._shaderValues;c.setValue(1,a.elements),c.setValue(2,b.elements)},a._renderCamera=function(a,b,c){},a.addLayer=function(a){29!==a.number&&30!=a.number&&(this.cullingMask=this.cullingMask|a.mask)},a.removeLayer=function(a){29!==a.number&&30!=a.number&&(this.cullingMask=this.cullingMask&~a.mask)},a.addAllLayers=function(){this.cullingMask=2147483647},a.removeAllLayers=function(){this.cullingMask=0|G.getLayerByNumber(29).mask|G.getLayerByNumber(30).mask},a.ResetProjectionMatrix=function(){this._useUserProjectionMatrix=!1,this._calculateProjectionMatrix()},a.moveForward=function(a){this._tempVector3.elements[0]=this._tempVector3.elements[1]=0,this._tempVector3.elements[2]=a,this.transform.translate(this._tempVector3)},a.moveRight=function(a){this._tempVector3.elements[1]=this._tempVector3.elements[2]=0,this._tempVector3.elements[0]=a,this.transform.translate(this._tempVector3)},a.moveVertical=function(a){this._tempVector3.elements[0]=this._tempVector3.elements[2]=0,this._tempVector3.elements[1]=a,this.transform.translate(this._tempVector3,!1)},a._addSelfRenderObjects=function(){var a=this.scene._cameraPool,b=a.length;if(0<b){for(var c=b-1;0<=c;c--)if(this.renderingOrder<=a[c].renderingOrder){a.splice(c+1,0,this);break}}else a.push(this),this.scene.conchModel&&this.scene.conchModel.setCurrentCamera(this.conchModel)},a._clearSelfRenderObjects=function(){var a=this.scene._cameraPool;a.splice(a.indexOf(this),1)},a.destroy=function(a){void 0===a&&(a=!0),this._sky&&this._sky.destroy(),this.renderTarget=null,v.stage.off("resize",this,this._onScreenSizeChanged),b.prototype.destroy.call(this,a)},o(0,a,"sky",function(){return this._sky},function(a){(this._sky=a)._ownerCamera=this}),o(0,a,"forward",function(){var a=this.transform.worldMatrix.elements,b=this._forward.elements;return b[0]=-a[8],b[1]=-a[9],b[2]=-a[10],this._forward}),o(0,a,"position",function(){var a=this.transform.worldMatrix.elements,b=this._position.elements;return b[0]=a[12],b[1]=a[13],b[2]=a[14],this._position}),o(0,a,"renderTarget",function(){return this._renderTarget},function(a){null!=(this._renderTarget=a)&&(this._renderTargetSize=a.size)}),o(0,a,"up",function(){var a=this.transform.worldMatrix.elements,b=this._up.elements;return b[0]=a[4],b[1]=a[5],b[2]=a[6],this._up}),o(0,a,"right",function(){var a=this.transform.worldMatrix.elements,b=this._right.elements;return b[0]=a[0],b[1]=a[1],b[2]=a[2],this._right}),o(0,a,"renderTargetSize",function(){return this._renderTargetSize},function(a){null!=this.renderTarget&&this._renderTargetSize,this._renderTargetSize=a,this._calculateProjectionMatrix()}),o(0,a,"fieldOfView",function(){return this._fieldOfView},function(a){this._fieldOfView=a,this._calculateProjectionMatrix()}),o(0,a,"nearPlane",function(){return this._nearPlane},function(a){this._nearPlane=a,this._calculateProjectionMatrix()}),o(0,a,"farPlane",function(){return this._farPlane},function(a){this._farPlane=a,this._calculateProjectionMatrix()}),o(0,a,"orthographic",function(){return this._orthographic},function(a){this._orthographic=a,this._calculateProjectionMatrix()}),o(0,a,"orthographicVerticalSize",function(){return this._orthographicVerticalSize},function(a){this._orthographicVerticalSize=a,this._calculateProjectionMatrix()}),o(0,a,"renderingOrder",function(){return this._renderingOrder},function(a){this._renderingOrder=a,this._sortCamerasByRenderingOrder()}),c.CAMERAPOS=0,c.VIEWMATRIX=1,c.PROJECTMATRIX=2,c.VPMATRIX=3,c.VPMATRIX_NO_TRANSLATE=4,c.CAMERADIRECTION=5,c.CAMERAUP=6,c.ENVIRONMENTDIFFUSE=7,c.ENVIRONMENTSPECULAR=8,c.SIMLODINFO=9,c.DIFFUSEIRRADMATR=10,c.DIFFUSEIRRADMATG=11,c.DIFFUSEIRRADMATB=12,c.HDREXPOSURE=13,c.RENDERINGTYPE_DEFERREDLIGHTING="DEFERREDLIGHTING",c.RENDERINGTYPE_FORWARDRENDERING="FORWARDRENDERING",c.CLEARFLAG_SOLIDCOLOR=0,c.CLEARFLAG_SKY=1,c.CLEARFLAG_DEPTHONLY=2,c.CLEARFLAG_NONE=3,l(c,["_invertYScaleMatrix",function(){return this._invertYScaleMatrix=new ab(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1)},"_invertYProjectionMatrix",function(){return this._invertYProjectionMatrix=new ab},"_invertYProjectionViewMatrix",function(){return this._invertYProjectionViewMatrix=new ab}]),c}(Ib),Tb=function(c){function b(a){this._render=null,this._geometryFilter=null,b.__super.call(this,a)}n(b,"laya.d3.core.RenderableSprite3D",c);var a=b.prototype;return a._addToInitStaticBatchManager=function(){},a._setBelongScene=function(a){c.prototype._setBelongScene.call(this,a),a._renderableSprite3Ds.push(this),this._render._applyLightMapParams()},a._setUnBelongScene=function(){var a=this._scene._renderableSprite3Ds,b=a.indexOf(this);a.splice(b,1),this._render._removeShaderDefine(laya.d3.core.RenderableSprite3D.SAHDERDEFINE_LIGHTMAP),c.prototype._setUnBelongScene.call(this)},a._update=function(a){(a.owner=this)._activeInHierarchy&&(this._updateComponents(a),this._render._updateOctreeNode(),this._lateUpdateComponents(a),y.spriteCount++,this._childs.length&&this._updateChilds(a))},a.destroy=function(a){void 0===a&&(a=!0),c.prototype.destroy.call(this,a),this._render._destroy(),this._render=null},b.__init__=function(){b.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=b.shaderDefines.registerDefine("SCALEOFFSETLIGHTINGMAPUV"),b.SAHDERDEFINE_LIGHTMAP=b.shaderDefines.registerDefine("LIGHTMAP")},b.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=2,b.SAHDERDEFINE_LIGHTMAP=4,b.LIGHTMAPSCALEOFFSET=2,b.LIGHTMAP=3,l(b,["shaderDefines",function(){return this.shaderDefines=new kb}]),b}(Ib),Ub=(function(a){function d(a,b,c){this._long=NaN,this._width=NaN,this._height=NaN,void 0===a&&(a=1),void 0===b&&(b=1),void 0===c&&(c=1),d.__super.call(this),this._long=a,this._width=b,this._height=c,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}n(d,"laya.d3.resource.models.BoxMesh",Ob);var b=d.prototype;b.recreateResource=function(){this.disposeResource(),this._numberVertices=24,this._numberIndices=36;var a=Da.vertexDeclaration,b=(a.vertexStride,this._long/2),c=this._height/2,d=this._width/2,e=new Float32Array([-b,c,-d,0,1,0,0,0,b,c,-d,0,1,0,1,0,b,c,d,0,1,0,1,1,-b,c,d,0,1,0,0,1,-b,-c,-d,0,-1,0,0,1,b,-c,-d,0,-1,0,1,1,b,-c,d,0,-1,0,1,0,-b,-c,d,0,-1,0,0,0,-b,c,-d,-1,0,0,0,0,-b,c,d,-1,0,0,1,0,-b,-c,d,-1,0,0,1,1,-b,-c,-d,-1,0,0,0,1,b,c,-d,1,0,0,1,0,b,c,d,1,0,0,0,0,b,-c,d,1,0,0,0,1,b,-c,-d,1,0,0,1,1,-b,c,d,0,0,1,0,0,b,c,d,0,0,1,1,0,b,-c,d,0,0,1,1,1,-b,-c,d,0,0,1,0,1,-b,c,-d,0,0,-1,1,0,b,c,-d,0,0,-1,0,0,b,-c,-d,0,0,-1,0,1,-b,-c,-d,0,0,-1,1,1]),f=new Uint16Array([0,1,2,2,3,0,4,7,6,6,5,4,8,9,10,10,11,8,12,15,14,14,13,12,16,17,18,18,19,16,20,23,22,22,21,20]);this._vertexBuffer=new Mb(a,this._numberVertices,35044,!0),this._indexBuffer=new Lb("ushort",this._numberIndices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer._addReference(),this._vertexBuffer.setData(e),this._indexBuffer.setData(f),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},o(0,b,"long",function(){return this._long},function(a){this._long!==a&&(this._long=a,this.releaseResource(),this.activeResource())}),o(0,b,"width",function(){return this._width},function(a){this._width!==a&&(this._width=a,this.releaseResource(),this.activeResource())}),o(0,b,"height",function(){return this._height},function(a){this._height!==a&&(this._height=a,this.releaseResource(),this.activeResource())})}(),function(a){function g(a,b,c){void 0===a&&(a=0),void 0===b&&(b=.3),void 0===c&&(c=1e3),this._viewMatrix=new ab,this._projectionMatrix=new ab,this._projectionViewMatrix=new ab,this._viewport=new ib(0,0,0,0),this._normalizedViewport=new ib(0,0,1,1),this._aspectRatio=a,this._boundFrustumUpdate=!0,this._boundFrustum=new Ya(ab.DEFAULT),g.__super.call(this,b,c),this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged)}n(g,"laya.d3.core.Camera",Sb);var b=g.prototype;return b._onWorldMatrixChanged=function(){this._boundFrustumUpdate=!0},b._parseCustomProps=function(a,b,c,d){var e=c.clearColor;this.clearColor=new hb(e[0],e[1],e[2],e[3]);var f=c.viewport;this.normalizedViewport=new ib(f[0],f[1],f[2],f[3])},b._calculateProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var a=this.orthographicVerticalSize*this.aspectRatio*.5,b=.5*this.orthographicVerticalSize;ab.createOrthoOffCenterRH(-a,a,-b,b,this.nearPlane,this.farPlane,this._projectionMatrix)}else ab.createPerspective(3.1416*this.fieldOfView/180,this.aspectRatio,this.nearPlane,this.farPlane,this._projectionMatrix);this._boundFrustumUpdate=!0},b._update=function(a){this.conchModel&&(this.conchModel.setViewMatrix(this.viewMatrix.elements),this.conchModel.setProjectMatrix(this.projectionMatrix.elements)),laya.d3.core.Sprite3D.prototype._update.call(this,a)},b._renderCamera=function(a,b,c){var d,e;c.parallelSplitShadowMaps[0]&&c._renderShadowMap(a,b,this),(b.camera=this)._prepareCameraToRender(),c._preRenderUpdateComponents(b),d=b._viewMatrix=this.viewMatrix;var f=this._renderTarget;f?(f.start(),ab.multiply(Sb._invertYScaleMatrix,this._projectionMatrix,Sb._invertYProjectionMatrix),ab.multiply(Sb._invertYScaleMatrix,this.projectionViewMatrix,Sb._invertYProjectionViewMatrix),e=b._projectionMatrix=Sb._invertYProjectionMatrix,b._projectionViewMatrix=Sb._invertYProjectionViewMatrix):(e=b._projectionMatrix=this._projectionMatrix,b._projectionViewMatrix=this.projectionViewMatrix),this._prepareCameraViewProject(d,e),b._viewport=this.viewport,c._preRenderScene(a,b,this.boundFrustum),c._clear(a,b),c._renderScene(a,b),c._postRenderUpdateComponents(b),f&&f.end()},b.viewportPointToRay=function(a,b){ob.calculateCursorRay(a,this.viewport,this._projectionMatrix,this.viewMatrix,null,b)},b.normalizedViewportPointToRay=function(a,b){var c=g._tempVector20,d=this.viewport,e=a.elements,f=c.elements;f[0]=e[0]*d.width,f[1]=e[1]*d.height,ob.calculateCursorRay(c,this.viewport,this._projectionMatrix,this.viewMatrix,null,b)},b.worldToViewportPoint=function(a,b){ab.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.viewport.project(a,this._projectionViewMatrix,b);var c=b.elements;c[0]=c[0]/v.stage.clientScaleX,c[1]=c[1]/v.stage.clientScaleY},b.worldToNormalizedViewportPoint=function(a,b){ab.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.normalizedViewport.project(a,this._projectionViewMatrix,b);var c=b.elements;c[0]=c[0]/v.stage.clientScaleX,c[1]=c[1]/v.stage.clientScaleY},b.convertScreenCoordToOrthographicCoord=function(a,b){if(this._orthographic){var c=W.clientWidth,d=W.clientHeight,e=this.orthographicVerticalSize*this.aspectRatio/c,f=this.orthographicVerticalSize/d,g=a.elements,h=b.elements;return h[0]=(-c/2+g[0])*e,h[1]=(d/2-g[1])*f,h[2]=(this.nearPlane-this.farPlane)*(g[2]+1)/2-this.nearPlane,gb.transformCoordinate(b,this.transform.worldMatrix,b),!0}return!1},o(0,b,"projectionViewMatrix",function(){return ab.multiply(this.projectionMatrix,this.viewMatrix,this._projectionViewMatrix),this._projectionViewMatrix}),o(0,b,"aspectRatio",function(){if(0!==this._aspectRatio)return this._aspectRatio;var a=this.viewport;return a.width/a.height},function(a){if(a<0)throw new Error("Camera: the aspect ratio has to be a positive real number.");this._aspectRatio=a,this._calculateProjectionMatrix()}),o(0,b,"boundFrustum",function(){return this._boundFrustumUpdate&&(this._boundFrustum.matrix=this.projectionViewMatrix),this._boundFrustum}),o(0,b,"needViewport",function(){var a=this.normalizedViewport;return 0===a.x&&0===a.y&&1===a.width&&1===a.height}),o(0,b,"viewport",function(){if(this._viewportExpressedInClipSpace){var a=this._normalizedViewport,b=this.renderTargetSize,c=b.width,d=b.height;this._viewport.x=a.x*c,this._viewport.y=a.y*d,this._viewport.width=a.width*c,this._viewport.height=a.height*d}return this._viewport},function(a){if(null!=this.renderTarget&&(a.x<0||a.y<0||0==a.width||0==a.height))throw new Error("Camera: viewport size invalid.","value");this._viewportExpressedInClipSpace=!1,this._viewport=a,this._calculateProjectionMatrix()}),o(0,b,"normalizedViewport",function(){if(!this._viewportExpressedInClipSpace){var a=this._viewport,b=this.renderTargetSize,c=b.width,d=b.height;this._normalizedViewport.x=a.x/c,this._normalizedViewport.y=a.y/d,this._normalizedViewport.width=a.width/c,this._normalizedViewport.height=a.height/d}return this._normalizedViewport},function(a){a.x<0&&(a.x=0,console.warn("Camera: viewport.x must large than 0.0.")),a.y<0&&(a.y=0,console.warn("Camera: viewport.y must large than 0.0.")),1<a.x+a.width&&(a.width=1-a.x,console.warn("Camera: viewport.width + viewport.x must less than 1.0.")),1<a.y+a.height&&(a.height=1-a.y,console.warn("Camera: viewport.height + viewport.y must less than 1.0.")),this._viewportExpressedInClipSpace=!0,this._normalizedViewport=a,this._calculateProjectionMatrix()}),o(0,b,"projectionMatrix",function(){return this._projectionMatrix},function(a){this._projectionMatrix=a,this._useUserProjectionMatrix=!0}),o(0,b,"viewMatrix",function(){return this.transform.worldMatrix.invert(this._viewMatrix),this._viewMatrix}),l(g,["_tempVector20",function(){return this._tempVector20=new fb}]),g}()),Vb=function(c){function d(a,b){d.__super.call(this,b),this._geometryFilter=new Fb(this),this._render=new Gb(this),this._geometryFilter.on("meshchanged",this,this._onMeshChanged),this._render.on("materialchanged",this,this._onMaterialChanged),a&&(this._geometryFilter.sharedMesh=a)instanceof laya.d3.resource.models.Mesh&&(a.loaded?this._render.sharedMaterials=a.materials:a.once("loaded",this,this._applyMeshMaterials))}n(d,"laya.d3.core.MeshSprite3D",c);var a=d.prototype;return a._changeRenderObjectByMesh=function(a){var b=this._render._renderElements,c=b[a];c||(c=b[a]=new xb),c._render=this._render;var d=this._render.sharedMaterials[a];d||(d=Kb.defaultMaterial);var e=this._geometryFilter.sharedMesh.getRenderElement(a);return c._mainSortID=this._getSortID(e,d),c._sprite3D=this,c.renderObj=e,c._material=d,c},a._changeRenderObjectByMaterial=function(a,b){var c=this._render._renderElements[a];b||(b=Kb.defaultMaterial);var d=this._geometryFilter.sharedMesh.getRenderElement(a);return c._mainSortID=this._getSortID(d,b),c._sprite3D=this,c.renderObj=d,c._material=b,c},a._changeRenderObjectsByMesh=function(){var a=this._geometryFilter.sharedMesh.getRenderElementsCount();this._render._renderElements.length=a;for(var b=0;b<a;b++)this._changeRenderObjectByMesh(b)},a._onMeshChanged=function(a){var b=a.sharedMesh;b.loaded?this._changeRenderObjectsByMesh():b.once("loaded",this,this._onMeshLoaded)},a._onMeshLoaded=function(a){a===this.meshFilter.sharedMesh&&this._changeRenderObjectsByMesh()},a._onMaterialChanged=function(a,b,c){b<this._render._renderElements.length&&this._changeRenderObjectByMaterial(b,c)},a._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},a._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},a._parseCustomProps=function(a,b,c,d){var e=this.meshRender,f=c.lightmapIndex;null!=f&&(e.lightmapIndex=f);var g,h,i=c.lightmapScaleOffset;if(i&&(e.lightmapScaleOffset=new hb(i[0],i[1],i[2],i[3])),d.instanceParams)(g=d.instanceParams.loadPath)&&(h=r.getRes(b[g]),(this.meshFilter.sharedMesh=h).loaded?e.sharedMaterials=h.materials:h.once("loaded",this,this._applyMeshMaterials));else{(g=c.meshPath)&&(h=r.getRes(b[g]),this.meshFilter.sharedMesh=h);var j=c.materials;if(j){var k=e.sharedMaterials,l=j.length;k.length=l;for(var m=0;m<l;m++)k[m]=r.getRes(b[j[m].path]);e.sharedMaterials=k}}},a._applyMeshMaterials=function(a){for(var b=this._render.sharedMaterials,c=a.materials,d=0,e=c.length;d<e;d++)b[d]||(b[d]=c[d]);this._render.sharedMaterials=b},a._addToInitStaticBatchManager=function(){d._staticBatchManager._addInitBatchSprite(this)},a.cloneTo=function(a){var b=a;b._geometryFilter.sharedMesh=this._geometryFilter.sharedMesh;var c=this._render,d=b._render;d.enable=c.enable,d.sharedMaterials=c.sharedMaterials,d.castShadow=c.castShadow;var e=c.lightmapScaleOffset;e&&(d.lightmapScaleOffset=e.clone()),d.lightmapIndex=c.lightmapIndex,d.receiveShadow=c.receiveShadow,d.sortingFudge=c.sortingFudge,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,a)},a.destroy=function(a){if(void 0===a&&(a=!0),!this.destroyed){var b=this.meshFilter.sharedMesh;null!=b&&(b.loaded||b.off("loaded",this,this._applyMeshMaterials)),c.prototype.destroy.call(this,a),this._geometryFilter._destroy()}},o(0,a,"meshFilter",function(){return this._geometryFilter}),o(0,a,"meshRender",function(){return this._render}),d.__init__=function(){da._staticBatchManagers.push(d._staticBatchManager)},d.load=function(a){return v.loader.create(a,null,null,d)},l(d,["_staticBatchManager",function(){return this._staticBatchManager=new zb}]),d}(Tb)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(a,b){"use strict";for(var c in Object.defineProperty(b,"__esModule",{value:!0}),Laya){var d=Laya[c];d&&d.__isclass&&(b[c]=d)}}),function(a,b,ea){ea.un,ea.uns;var c=ea.static,d=ea.class,f=ea.getset,p=ea.__newvec,h=laya.maths.Bezier,l=laya.utils.Browser,Da=laya.utils.Byte,e=(laya.events.Event,laya.events.EventDispatcher),g=laya.display.Graphics,i=(laya.resource.HTMLCanvas,laya.utils.Handler),j=laya.net.Loader,m=laya.maths.MathUtil,Ea=laya.maths.Matrix,q=(laya.display.Node,laya.maths.Point,laya.maths.Rectangle,laya.renders.Render),k=(laya.renders.RenderContext,laya.resource.Resource),n=laya.utils.RunDriver,fa=laya.display.Sprite,o=laya.utils.Stat,Fa=laya.resource.Texture,r=(laya.net.URL,laya.utils.Utils),E=function(){function a(){this.nodes=null,this.name=null,this.playTime=NaN,this.bone3DMap=null,this.totalKeyframeDatasLength=0}return d(a,"laya.ani.AnimationContent"),a}(),F=function(){function a(){this.name=null,this.parentIndex=0,this.parent=null,this.keyframeWidth=0,this.lerpType=0,this.interpolationMethod=null,this.childs=null,this.keyFrame=null,this.playTime=NaN,this.extenData=null,this.dataOffset=0}return d(a,"laya.ani.AnimationNodeContent"),a}(),t=function(){function a(){}return d(a,"laya.ani.AnimationParser01"),a.parse=function(a,b){var c=b.__getBuffer(),d=0,e=0,f=0,g=0,h=0,i=0,j=0,k=b.readUTFString();a._aniClassName=k;var l,m=b.readUTFString().split("\n"),n=b.getUint8(),o=b.getUint32(),p=b.getUint32();0<o&&(l=c.slice(o,p));var q=new Da(l);for(0<p&&(a._publicExtData=c.slice(p,c.byteLength)),a._useParent=!!b.getUint8(),a._anis.length=n,d=0;d<n;d++){var r=a._anis[d]=new E;r.nodes=new Array;var s=r.name=m[b.getUint16()];a._aniMap[s]=d,r.bone3DMap={},r.playTime=b.getFloat32(),r.playTime<=0&&console.error("播放时间不能为0  url="+a.url+" name="+r.name);var t=r.nodes.length=b.getUint8();for(e=r.totalKeyframeDatasLength=0;e<t;e++){var u=r.nodes[e]=new F;u.childs=[];var v=b.getInt16();0<=v&&(u.name=m[v],r.bone3DMap[u.name]=e),u.keyFrame=new Array,u.parentIndex=b.getInt16(),-1==u.parentIndex?u.parent=null:u.parent=r.nodes[u.parentIndex],u.lerpType=b.getUint8();var w=b.getUint32();q.pos=w;var x=u.keyframeWidth=q.getUint16();if(r.totalKeyframeDatasLength+=x,0===u.lerpType||1===u.lerpType)for(u.interpolationMethod=[],u.interpolationMethod.length=x,f=0;f<x;f++)u.interpolationMethod[f]=I.interpolation[q.getUint8()];null!=u.parent&&u.parent.childs.push(u);var y=b.getUint16();0<y&&(u.extenData=c.slice(b.pos,b.pos+y),b.pos+=y);var z,A=b.getUint16(),B=0;for(f=0,g=u.keyFrame.length=A;f<g;f++){if((z=u.keyFrame[f]=new G).duration=b.getFloat32(),z.startTime=B,2===u.lerpType){z.interpolationData=[];var C,D=b.getUint8();switch(C=b.getFloat32()){case 254:for(z.interpolationData.length=x,j=0;j<x;j++)z.interpolationData[j]=0;break;case 255:for(z.interpolationData.length=x,j=0;j<x;j++)z.interpolationData[j]=5;break;default:for(z.interpolationData.push(C),i=1;i<D;i++)z.interpolationData.push(b.getFloat32())}}for(z.data=new Float32Array(x),h=0;h<x;h++)z.data[h]=b.getFloat32(),-1e-8<z.data[h]&&z.data[h]<1e-8&&(z.data[h]=0);B+=z.duration}z.startTime=r.playTime,u.playTime=r.playTime,a._calculateKeyFrame(u,A,x)}}},a}(),u=function(){function v(){}return d(v,"laya.ani.AnimationParser02"),v.READ_DATA=function(){v._DATA.offset=v._reader.getUint32(),v._DATA.size=v._reader.getUint32()},v.READ_BLOCK=function(){for(var a=v._BLOCK.count=v._reader.getUint16(),b=v._BLOCK.blockStarts=[],c=v._BLOCK.blockLengths=[],d=0;d<a;d++)b.push(v._reader.getUint32()),c.push(v._reader.getUint32())},v.READ_STRINGS=function(){var a=v._reader.getUint32(),b=v._reader.getUint16(),c=v._reader.pos;v._reader.pos=a+v._DATA.offset;for(var d=0;d<b;d++)v._strings[d]=v._reader.readUTFString();v._reader.pos=c},v.parse=function(a,b){v._templet=a;(v._reader=b).__getBuffer();v.READ_DATA(),v.READ_BLOCK(),v.READ_STRINGS();for(var c=0,d=v._BLOCK.count;c<d;c++){var e=b.getUint16(),f=v._strings[e],g=v["READ_"+f];if(null==g)throw new Error("model file err,no this function:"+e+" "+f);g.call()}},v.READ_ANIMATIONS=function(){var a=v._reader,b=a.__getBuffer(),c=0,d=0,e=0,f=0,g=a.getUint16(),h=[];for(h.length=g,c=0;c<g;c++)h[c]=I.interpolation[a.getByte()];var i=a.getUint8();for(v._templet._anis.length=i,c=0;c<i;c++){var j=v._templet._anis[c]={};j.nodes=new Array;var k=j.name=v._strings[a.getUint16()];v._templet._aniMap[k]=c,j.bone3DMap={},j.playTime=a.getFloat32();var l=j.nodes.length=a.getInt16();for(d=j.totalKeyframeDatasLength=0;d<l;d++){var m=j.nodes[d]={};m.keyframeWidth=g,m.childs=[];var n=a.getUint16();0<=n&&(m.name=v._strings[n],j.bone3DMap[m.name]=d),m.keyFrame=new Array,m.parentIndex=a.getInt16(),-1==m.parentIndex?m.parent=null:m.parent=j.nodes[m.parentIndex],j.totalKeyframeDatasLength+=g,m.interpolationMethod=h,null!=m.parent&&m.parent.childs.push(m);var o=a.getUint16(),p=null,q=null;for(e=0,f=m.keyFrame.length=o;e<f;e++){(p=m.keyFrame[e]={}).startTime=a.getFloat32(),q&&(q.duration=p.startTime-q.startTime);var r=v._DATA.offset,s=a.getUint32(),t=4*g,u=b.slice(r+s,r+s+t);p.data=new Float32Array(u),q=p}p.duration=0,m.playTime=j.playTime,v._templet._calculateKeyFrame(m,o,g)}}},v._templet=null,v._reader=null,v._strings=[],c(v,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),v}(),Ga=(function(){function a(){}d(a,"laya.ani.AnimationState"),a.stopped=0,a.paused=1,a.playing=2}(),function(){function e(){this.name=null,this.root=null,this.parentBone=null,this.length=10,this.transform=null,this.inheritScale=!0,this.inheritRotation=!0,this.rotation=NaN,this.resultRotation=NaN,this.d=-1,this._tempMatrix=null,this._sprite=null,this.resultTransform=new Ta,this.resultMatrix=new Ea,this._children=[]}d(e,"laya.ani.bone.Bone");var a=e.prototype;return a.setTempMatrix=function(a){this._tempMatrix=a;var b,c=0;for(c=0,b=this._children.length;c<b;c++)this._children[c].setTempMatrix(this._tempMatrix)},a.update=function(a){var b;if(this.rotation=this.transform.skX,a)b=this.resultTransform.getMatrix(),Ea.mul(b,a,this.resultMatrix),this.resultRotation=this.rotation;else if(this.resultRotation=this.rotation+this.parentBone.resultRotation,this.parentBone)if(this.inheritRotation&&this.inheritScale)b=this.resultTransform.getMatrix(),Ea.mul(b,this.parentBone.resultMatrix,this.resultMatrix);else{var c=this.parentBone,d=NaN,e=NaN,f=NaN,g=this.parentBone.resultMatrix;b=this.resultTransform.getMatrix();var h=g.a*b.tx+g.c*b.ty+g.tx,i=g.b*b.tx+g.d*b.ty+g.ty,j=new Ea;this.inheritRotation?(d=Math.atan2(c.resultMatrix.b,c.resultMatrix.a),e=Math.cos(d),f=Math.sin(d),j.setTo(e,f,-f,e,0,0),Ea.mul(this._tempMatrix,j,Ea.TEMP),Ea.TEMP.copyTo(j),b=this.resultTransform.getMatrix(),Ea.mul(b,j,this.resultMatrix),this.resultTransform.scX*this.resultTransform.scY<0&&this.resultMatrix.rotate(.5*Math.PI)):(this.inheritScale,b=this.resultTransform.getMatrix(),Ea.TEMP.identity(),Ea.TEMP.d=this.d,Ea.mul(b,Ea.TEMP,this.resultMatrix)),this.resultMatrix.tx=h,this.resultMatrix.ty=i}else(b=this.resultTransform.getMatrix()).copyTo(this.resultMatrix);var k,l=0;for(l=0,k=this._children.length;l<k;l++)this._children[l].update()},a.updateChild=function(){var a,b=0;for(b=0,a=this._children.length;b<a;b++)this._children[b].update()},a.setRotation=function(a){this._sprite&&(this._sprite.rotation=180*a/Math.PI)},a.updateDraw=function(a,b){e.ShowBones&&!e.ShowBones[this.name]||(this._sprite||(this._sprite=new fa,this._sprite.graphics.drawCircle(0,0,5,"#ff0000"),this._sprite.graphics.drawLine(0,0,this.length,0,"#00ff00"),this._sprite.graphics.fillText(this.name,0,0,"20px Arial","#00ff00","center"),ea.stage.addChild(this._sprite)),this._sprite.x=a+this.resultMatrix.tx,this._sprite.y=b+this.resultMatrix.ty);var c,d=0;for(d=0,c=this._children.length;d<c;d++)this._children[d].updateDraw(a,b)},a.addChild=function(a){this._children.push(a),a.parentBone=this},a.findBone=function(a){if(this.name==a)return this;var b,c,d=0;for(d=0,b=this._children.length;d<b;d++)if(c=this._children[d].findBone(a))return c;return null},a.localToWorld=function(a){var b=a[0],c=a[1];a[0]=b*this.resultMatrix.a+c*this.resultMatrix.c+this.resultMatrix.tx,a[1]=b*this.resultMatrix.b+c*this.resultMatrix.d+this.resultMatrix.ty},e.ShowBones={},e}()),Ha=function(){function p(){this.name=null,this.parent=null,this.attachmentName=null,this.srcDisplayIndex=-1,this.type="src",this.templet=null,this.currSlotData=null,this.currTexture=null,this.currDisplayData=null,this.displayIndex=-1,this._diyTexture=null,this._parentMatrix=null,this._resultMatrix=null,this._replaceDic={},this._curDiyUV=null,this._curDiyVS=null,this._skinSprite=null,this.deformData=null,this._mVerticleArr=null}d(p,"laya.ani.bone.BoneSlot");var a=p.prototype;return a.showSlotData=function(a,b){void 0===b&&(b=!0),this.currSlotData=a,b&&(this.displayIndex=this.srcDisplayIndex),this.currDisplayData=null,this.currTexture=null},a.showDisplayByName=function(a){this.currSlotData&&this.showDisplayByIndex(this.currSlotData.getDisplayByName(a))},a.replaceDisplayByName=function(a,b){if(this.currSlotData){var c;c=this.currSlotData.getDisplayByName(a);var d;d=this.currSlotData.getDisplayByName(b),this.replaceDisplayByIndex(c,d)}},a.replaceDisplayByIndex=function(a,b){this.currSlotData&&(this._replaceDic[a]=b,this.displayIndex==a&&this.showDisplayByIndex(a))},a.showDisplayByIndex=function(a){if(null!=this._replaceDic[a]&&(a=this._replaceDic[a]),this.currSlotData&&-1<a&&a<this.currSlotData.displayArr.length){if(this.displayIndex=a,this.currDisplayData=this.currSlotData.displayArr[a],this.currDisplayData){var b=this.currDisplayData.name;this.currTexture=this.templet.getTexture(b),this.currTexture&&0==this.currDisplayData.type&&this.currDisplayData.uvs&&(!q.isConchApp||q.isConchApp&&"0.9.15"<fa.RUNTIMEVERION)&&(this.currTexture=this.currDisplayData.createTexture(this.currTexture))}}else this.displayIndex=-1,this.currDisplayData=null,this.currTexture=null},a.replaceSkin=function(a){this._diyTexture=a,this._curDiyUV&&(this._curDiyUV.length=0),this.currDisplayData&&this._diyTexture==this.currDisplayData.texture&&(this._diyTexture=null)},a.setParentMatrix=function(a){this._parentMatrix=a},a.draw=function(a,b,c,d){if(void 0===c&&(c=!1),void 0===d&&(d=1),(null!=this._diyTexture||null!=this.currTexture)&&null!=this.currDisplayData||this.currDisplayData&&3==this.currDisplayData.type){var e,f=this.currTexture;switch(this._diyTexture&&(f=this._diyTexture),this.currDisplayData.type){case 0:if(a){var g=this.getDisplayMatrix();if(this._parentMatrix){var h=!1;if(g){var i;if(Ea.mul(g,this._parentMatrix,Ea.TEMP),i=c?(null==this._resultMatrix&&(this._resultMatrix=new Ea),this._resultMatrix):new Ea,!q.isWebGL&&this.currDisplayData.uvs||q.isWebGL&&this._diyTexture&&this.currDisplayData.uvs){var j=p._tempMatrix;j.identity(),this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(j.d=-1),this.currDisplayData.uvs[0]>this.currDisplayData.uvs[4]&&this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(h=!0,j.rotate(-Math.PI/2)),Ea.mul(j,Ea.TEMP,i)}else Ea.TEMP.copyTo(i);h?a.drawTexture(f,-this.currDisplayData.height/2,-this.currDisplayData.width/2,this.currDisplayData.height,this.currDisplayData.width,i):a.drawTexture(f,-this.currDisplayData.width/2,-this.currDisplayData.height/2,this.currDisplayData.width,this.currDisplayData.height,i)}}}break;case 1:if(null==(e=c?(null==this._skinSprite&&(this._skinSprite=p.createSkinMesh()),this._skinSprite):p.createSkinMesh()))return;var k;if(null==this.currDisplayData.bones){var l,m=this.currDisplayData.weights;this.deformData&&(m=this.deformData),l=this._diyTexture?(this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=x.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=x.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs,this._mVerticleArr=m;this.currDisplayData.triangles.length;k=this.currDisplayData.triangles,e.init2(f,null,k,this._mVerticleArr,l);var n,o=this.getDisplayMatrix();if(this._parentMatrix)if(o)Ea.mul(o,this._parentMatrix,Ea.TEMP),n=c?(null==this._resultMatrix&&(this._resultMatrix=new Ea),this._resultMatrix):new Ea,Ea.TEMP.copyTo(n),e.transform=n}else this.skinMesh(b,e,d);a.drawSkin(e);break;case 2:if(null==(e=c?(null==this._skinSprite&&(this._skinSprite=p.createSkinMesh()),this._skinSprite):p.createSkinMesh()))return;this.skinMesh(b,e,d),a.drawSkin(e)}}},a.skinMesh=function(a,b,c){var d,e=this.currTexture,f=this.currDisplayData.bones;d=this._diyTexture?(e=this._diyTexture,this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=x.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=x.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs;var g,h,i=this.currDisplayData.weights,j=this.currDisplayData.triangles,k=0,l=0,m=0,n=NaN,o=NaN,p=0,q=0,r=[],s=0,t=0;if(this.deformData&&0<this.deformData.length){var u=0;for(s=0,t=f.length;s<t;){for(m=f[s++]+s,l=k=0;s<m;s++)h=a[f[s]],n=i[p]+this.deformData[u++],o=i[p+1]+this.deformData[u++],q=i[p+2],k+=(n*h.a+o*h.c+h.tx)*q,l+=(n*h.b+o*h.d+h.ty)*q,p+=3;r.push(k,l)}}else for(s=0,t=f.length;s<t;){for(m=f[s++]+s,l=k=0;s<m;s++)h=a[f[s]],n=i[p],o=i[p+1],q=i[p+2],k+=(n*h.a+o*h.c+h.tx)*q,l+=(n*h.b+o*h.d+h.ty)*q,p+=3;r.push(k,l)}this._mVerticleArr=r,g=j,b.init2(e,null,g,this._mVerticleArr,d)},a.drawBonePoint=function(a){a&&this._parentMatrix&&a.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000")},a.getDisplayMatrix=function(){return this.currDisplayData?this.currDisplayData.transform.getMatrix():null},a.getMatrix=function(){return this._resultMatrix},a.copy=function(){var a=new p;return a.type="copy",a.name=this.name,a.attachmentName=this.attachmentName,a.srcDisplayIndex=this.srcDisplayIndex,a.parent=this.parent,a.displayIndex=this.displayIndex,a.templet=this.templet,a.currSlotData=this.currSlotData,a.currTexture=this.currTexture,a.currDisplayData=this.currDisplayData,a},p.createSkinMesh=function(){return q.isWebGL||q.isConchApp?n.skinAniSprite():(q.isWebGL,null)},c(p,["_tempMatrix",function(){return this._tempMatrix=new Ea}]),p}(),Ia=function(){function a(){this.skinName=null,this.deformSlotDataList=[]}return d(a,"laya.ani.bone.DeformAniData"),a}(),Ja=function(){function a(){this.deformSlotDisplayList=[]}return d(a,"laya.ani.bone.DeformSlotData"),a}(),Ka=function(){function a(){this.boneSlot=null,this.slotIndex=-1,this.attachment=null,this.deformData=null,this.frameIndex=0,this.timeList=[],this.vectices=[],this.tweenKeyList=[]}d(a,"laya.ani.bone.DeformSlotDisplayData");var b=a.prototype;return b.binarySearch1=function(a,b){var c=0,d=a.length-2;if(0==d)return 1;for(var e=d>>>1;;){if(a[Math.floor(e+1)]<=b?c=e+1:d=e,c==d)return c+1;e=c+d>>>1}return 0},b.apply=function(a,b,c){if(void 0===c&&(c=1),a+=.05,!(this.timeList.length<=0)){var d=0;if(!(a<this.timeList[0])){var e=this.vectices[0].length,f=[],g=this.binarySearch1(this.timeList,a);if(this.frameIndex=g,a>=this.timeList[this.timeList.length-1]){var h=this.vectices[this.vectices.length-1];if(c<1)for(d=0;d<e;d++)f[d]+=(h[d]-f[d])*c;else for(d=0;d<e;d++)f[d]=h[d];this.deformData=f}else{this.tweenKeyList[this.frameIndex];var i=this.vectices[this.frameIndex-1],j=this.vectices[this.frameIndex],k=this.timeList[this.frameIndex-1],l=this.timeList[this.frameIndex];c=this.tweenKeyList[g-1]?(a-k)/(l-k):0;var m=NaN;for(d=0;d<e;d++)m=i[d],f[d]=m+(j[d]-m)*c;this.deformData=f}}}},a}(),La=function(){function a(){this.time=NaN,this.drawOrder=[]}return d(a,"laya.ani.bone.DrawOrderData"),a}(),Ma=function(){function a(){this.name=null,this.intValue=0,this.floatValue=NaN,this.stringValue=null,this.time=NaN}return d(a,"laya.ani.bone.EventData"),a}(),s=function(){function da(a,b){this._targetBone=null,this._bones=null,this._data=null,this.name=null,this.mix=NaN,this.bendDirection=NaN,this.isSpine=!0,this._sp=null,this.isDebug=!1,this._data=a,this._targetBone=b[a.targetBoneIndex],this.isSpine=a.isSpine,null==this._bones&&(this._bones=[]);for(var c=this._bones.length=0,d=a.boneIndexs.length;c<d;c++)this._bones.push(b[a.boneIndexs[c]]);this.name=a.name,this.mix=a.mix,this.bendDirection=a.bendDirection}d(da,"laya.ani.bone.IkConstraint");var a=da.prototype;return a.apply=function(){switch(this._bones.length){case 1:this._applyIk1(this._bones[0],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.mix);break;case 2:this.isSpine?this._applyIk2(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix):this._applyIk3(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix)}},a._applyIk1=function(a,b,c,d){var e=a.parentBone,f=1/(e.resultMatrix.a*e.resultMatrix.d-e.resultMatrix.b*e.resultMatrix.c),g=b-e.resultMatrix.tx,h=c-e.resultMatrix.ty,i=(g*e.resultMatrix.d-h*e.resultMatrix.c)*f-a.transform.x,j=(h*e.resultMatrix.a-g*e.resultMatrix.b)*f-a.transform.y,k=Math.atan2(j,i)*da.radDeg-0-a.transform.skX;a.transform.scX<0&&(k+=180),180<k?k-=360:k<-180&&(k+=360),a.transform.skX=a.transform.skY=a.transform.skX+k*d,a.update()},a.updatePos=function(a,b){this._sp&&this._sp.pos(a,b)},a._applyIk2=function(a,b,c,d,e,f){if(0!=f){var g=a.resultTransform.x,h=a.resultTransform.y,i=a.transform.scX,j=a.transform.scY,k=b.transform.scX,l=0,m=0,n=0;n=i<0?(i=-i,l=180,-1):(l=0,1),j<0&&(j=-j,n=-n),m=k<0?(k=-k,180):0;var o=b.resultTransform.x,p=NaN,q=NaN,r=NaN,s=a.resultMatrix.a,t=a.resultMatrix.c,u=a.resultMatrix.b,v=a.resultMatrix.d,w=Math.abs(i-j)<=1e-4;r=w?(q=s*o+t*(p=b.resultTransform.y)+a.resultMatrix.tx,u*o+v*p+a.resultMatrix.ty):(p=0,q=s*o+a.resultMatrix.tx,u*o+a.resultMatrix.ty),this.isDebug&&(this._sp||(this._sp=new fa,ea.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(c,d,15,"#ffff00"),this._sp.graphics.drawCircle(q,r,15,"#ff00ff")),a.setRotation(Math.atan2(r-a.resultMatrix.ty,q-a.resultMatrix.tx));var x=a.parentBone;s=x.resultMatrix.a,t=x.resultMatrix.c,u=x.resultMatrix.b;var y=1/(s*(v=x.resultMatrix.d)-t*u),z=c-x.resultMatrix.tx,A=d-x.resultMatrix.ty,B=(z*v-A*t)*y-g,C=(A*s-z*u)*y-h,D=((z=q-x.resultMatrix.tx)*v-(A=r-x.resultMatrix.ty)*t)*y-g,E=(A*s-z*u)*y-h,F=Math.sqrt(D*D+E*E),G=b.length*k,H=NaN,I=NaN;if(w){var J=(B*B+C*C-F*F-(G*=i)*G)/(2*F*G);J<-1?J=-1:1<J&&(J=1),I=Math.acos(J)*e,s=F+G*J,t=G*Math.sin(I),H=Math.atan2(C*s-B*t,B*s+C*t)}else{var K=(s=i*G)*s,L=(t=j*G)*t,M=B*B+C*C,N=Math.atan2(C,B),O=-2*L*F,P=L-K;if(0<(v=O*O-4*P*(u=L*F*F+K*M-K*L))){var Q=Math.sqrt(v);O<0&&(Q=-Q);var R=(Q=-(O+Q)/2)/P,S=u/Q,T=Math.abs(R)<Math.abs(S)?R:S;T*T<=M&&(A=Math.sqrt(M-T*T)*e,H=N-Math.atan2(A,T),I=Math.atan2(A/j,(T-F)/i))}var U=0,V=Number.MAX_VALUE,W=0,X=0,Y=0,Z=0,$=0,_=0;Z<(v=(z=F+s)*z)&&(Y=0,Z=v,$=z),(v=(z=F-s)*z)<V&&(U=Math.PI,V=v,W=z);var aa=Math.acos(-s*F/(K-L));(v=(z=s*Math.cos(aa)+F)*z+(A=t*Math.sin(aa))*A)<V&&(U=aa,V=v,W=z,X=A),Z<v&&(Y=aa,Z=v,$=z,_=A),I=M<=(V+Z)/2?(H=N-Math.atan2(X*e,W),U*e):(H=N-Math.atan2(_*e,$),Y*e)}var ba=Math.atan2(p,o)*n,ca=a.resultTransform.skX;180<(H=(H-ba)*da.radDeg+l-ca)?H-=360:H<-180&&(H+=360),a.resultTransform.x=g,a.resultTransform.y=h,a.resultTransform.skX=a.resultTransform.skY=ca+H*f,ca=b.resultTransform.skX,180<(I=((I+ba)*da.radDeg-0)*n+m-(ca%=360))?I-=360:I<-180&&(I+=360),b.resultTransform.x=o,b.resultTransform.y=p,b.resultTransform.skX=b.resultTransform.skY=b.resultTransform.skY+I*f,a.update()}},a._applyIk3=function(a,b,c,d,e,f){if(0!=f){var g,h,i=b.resultMatrix.a*b.length,j=b.resultMatrix.b*b.length,k=i*i+j*j,l=Math.sqrt(k),m=a.resultMatrix.tx,n=a.resultMatrix.ty,o=b.resultMatrix.tx,p=b.resultMatrix.ty,q=o-m,r=p-n,s=q*q+r*r,t=Math.sqrt(s),u=(q=c-a.resultMatrix.tx)*q+(r=d-a.resultMatrix.ty)*r,v=Math.sqrt(u);if(l+t<=v||v+l<=t||v+t<=l){var w=NaN;o=m+(w=l+t<=v?1:-1)*(c-m)*t/v,p=n+w*(d-n)*t/v}else{var x=(s-k+u)/(2*u),y=Math.sqrt(s-x*x*u)/v,z=m+q*x,A=n+r*x,B=-r*y,C=q*y;p=0<e?(o=z-B,A-C):(o=z+B,A+C)}g=o,h=p,this.isDebug&&(this._sp||(this._sp=new fa,ea.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(m,n,15,"#ff00ff"),this._sp.graphics.drawCircle(c,d,15,"#ffff00"),this._sp.graphics.drawCircle(g,h,15,"#ff00ff"));var D,E;D=Math.atan2(h-a.resultMatrix.ty,g-a.resultMatrix.tx),a.setRotation(D),(E=da._tempMatrix).identity(),E.rotate(D),E.scale(a.resultMatrix.getScaleX(),a.resultMatrix.getScaleY()),E.translate(a.resultMatrix.tx,a.resultMatrix.ty),E.copyTo(a.resultMatrix),a.updateChild();var F,G;F=Math.atan2(d-h,c-g),b.setRotation(F),(G=da._tempMatrix).identity(),G.rotate(F),G.scale(b.resultMatrix.getScaleX(),b.resultMatrix.getScaleY()),G.translate(g,h),E.copyTo(b.resultMatrix),b.updateChild()}},c(da,["radDeg",function(){return this.radDeg=180/Math.PI},"degRad",function(){return this.degRad=Math.PI/180},"_tempMatrix",function(){return this._tempMatrix=new Ea}]),da}(),Na=function(){function a(){this.name=null,this.targetBoneName=null,this.bendDirection=1,this.mix=1,this.isSpine=!0,this.targetBoneIndex=-1,this.boneNames=[],this.boneIndexs=[]}return d(a,"laya.ani.bone.IkConstraintData"),a}(),v=function(){function G(a,b){this.target=null,this.data=null,this.bones=null,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this._debugKey=!1,this._spaces=null,this._segments=[],this._curves=[],this.data=a,this.position=a.position,this.spacing=a.spacing,this.rotateMix=a.rotateMix,this.translateMix=a.translateMix,this.bones=[];for(var c=this.data.bones,d=0,e=c.length;d<e;d++)this.bones.push(b[c[d]])}d(G,"laya.ani.bone.PathConstraint");var a=G.prototype;return a.apply=function(a,b){if(this.target){var c=this.translateMix,d=this.translateMix,e=0<d,f=this.data.spacingMode,g="length"==f,h=this.data.rotateMode,i="tangent"==h,j="chainScale"==h,k=[],l=this.bones.length,m=i?l:l+1,n=[];(this._spaces=n)[0]=this.position;var o=this.spacing;if(j||g)for(var p=0,q=m-1;p<q;){var r=this.bones[p],s=r.length,t=s*r.resultMatrix.a,u=s*r.resultMatrix.b;s=Math.sqrt(t*t+u*u),j&&(k[p]=s),n[++p]=g?Math.max(0,s+o):o}else for(p=1;p<m;p++)n[p]=o;var v=this.computeWorldPositions(this.target,a,b,m,i,"percent"==this.data.positionMode,"percent"==f);if(this._debugKey){for(p=0;p<v.length;p++)b.drawCircle(v[p++],v[p++],5,"#00ff00");var w=[];for(p=0;p<v.length;p++)w.push(v[p++],v[p++]);b.drawLines(0,0,w,"#ff0000")}var x=v[0],y=v[1],z=this.data.offsetRotation,A="chain"==h&&0==z,B=NaN;for(p=0,B=3;p<l;p++,B+=3){(r=this.bones[p]).resultMatrix.tx+=(x-r.resultMatrix.tx)*c,r.resultMatrix.ty+=(y-r.resultMatrix.ty)*c;var C=(t=v[B])-x,D=(u=v[B+1])-y;if(j&&0!=(s=k[p])){var E=(Math.sqrt(C*C+D*D)/s-1)*d+1;r.resultMatrix.a*=E,r.resultMatrix.c*=E}if(x=t,y=u,e){var F=r.resultMatrix.a,G=r.resultMatrix.c,H=r.resultMatrix.b,I=r.resultMatrix.d,J=NaN,K=NaN,L=NaN;J=i?v[B-1]:0==n[p+1]?v[B+2]:Math.atan2(D,C),J-=Math.atan2(H,F)-z/180*Math.PI,A&&(K=Math.cos(J),L=Math.sin(J),x+=((s=r.length)*(K*F-L*H)-C)*d,y+=(s*(L*F+K*H)-D)*d),J>Math.PI?J-=2*Math.PI:J<-Math.PI&&(J+=2*Math.PI),J*=d,K=Math.cos(J),L=Math.sin(J),r.resultMatrix.a=K*F-L*H,r.resultMatrix.c=K*G-L*I,r.resultMatrix.b=L*F+K*H,r.resultMatrix.d=L*G+K*I}}}},a.computeWorldVertices2=function(a,b,c,d,e,f){var g,h,i=a.currDisplayData.bones,j=a.currDisplayData.weights,k=a.currDisplayData.triangles,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0;if(null!=i){for(l=0;l<c;l+=2)m+=(o=i[m])+1,n+=o;var w=b;for(p=f,q=3*n;p<d;p+=2){for(s=r=0,o=i[m++],o+=m;m<o;m++,q+=3){g=w[i[m]].resultMatrix,t=j[q],u=j[q+1];var x=j[q+2];r+=(t*g.a+u*g.c+g.tx)*x,s+=(t*g.b+u*g.d+g.ty)*x}e[p]=r,e[p+1]=s}}else{var y,z;if(k||(k=j),a.deformData&&(k=a.deformData),y=a.parent,b)for(v=b.length,l=0;l<v;l++)if(b[l].name==y){h=b[l];break}h&&(z=h.resultMatrix),z||(z=G._tempMt);var A=z.tx,B=z.ty,C=z.a,D=z.b,E=z.c,F=z.d;for(h&&(F*=h.d),m=c,p=f;p<d;m+=2,p+=2)t=k[m],u=k[m+1],e[p]=t*C+u*D+A,e[p+1]=-(t*E+u*F+B)}},a.computeWorldPositions=function(a,b,c,d,e,f,g){a.currDisplayData.bones,a.currDisplayData.weights,a.currDisplayData.triangles;var h=[],i=0,j=a.currDisplayData.verLen,k=this.position,l=this._spaces,m=[],n=[],o=j/6,p=-1,q=NaN,r=0,s=0,t=NaN,u=NaN,v=NaN,w=NaN;if(o--,j-=4,this.computeWorldVertices2(a,b,2,j,h,0),this._debugKey)for(i=0;i<h.length;)c.drawCircle(h[i++],h[i++],10,"#ff0000");m=h,this._curves.length=o;var x=this._curves,y=m[q=0],z=m[1],A=0,B=0,C=0,D=0,E=0,F=0,G=NaN,H=NaN,I=NaN,J=NaN,K=NaN,L=NaN,M=NaN,N=NaN,O=0;for(i=0,O=2;i<o;i++,O+=6)A=m[O],B=m[O+1],C=m[O+2],D=m[O+3],K=2*(G=.1875*(y-2*A+C))+(I=.09375*(3*(A-C)-y+(E=m[O+4]))),L=2*(H=.1875*(z-2*B+D))+(J=.09375*(3*(B-D)-z+(F=m[O+5]))),M=.75*(A-y)+G+.16666667*I,N=.75*(B-z)+H+.16666667*J,q+=Math.sqrt(M*M+N*N),M+=K,N+=L,K+=I,L+=J,q+=Math.sqrt(M*M+N*N),M+=K,N+=L,q+=Math.sqrt(M*M+N*N),M+=K+I,N+=L+J,q+=Math.sqrt(M*M+N*N),x[i]=q,y=E,z=F;if(f&&(k*=q),g)for(i=0;i<d;i++)l[i]*=q;var P=this._segments,Q=0,R=0;for(R=s=r=i=0;i<d;i++,r+=3)if((t=k+=u=l[i])<0)this.addBeforePosition(t,m,0,n,r);else if(q<t)this.addAfterPosition(t-q,m,j-4,n,r);else{for(;;s++)if(!((w=x[s])<t)){0==s?t/=w:t=(t-(v=x[s-1]))/(w-v);break}if(s!=p){var S=6*(p=s);for(y=m[S],z=m[S+1],A=m[S+2],B=m[S+3],C=m[S+4],D=m[S+5],K=2*(G=.03*(y-2*A+C))+(I=.006*(3*(A-C)-y+(E=m[S+6]))),L=2*(H=.03*(z-2*B+D))+(J=.006*(3*(B-D)-z+(F=m[S+7]))),M=.3*(A-y)+G+.16666667*I,N=.3*(B-z)+H+.16666667*J,Q=Math.sqrt(M*M+N*N),P[0]=Q,S=1;S<8;S++)M+=K,N+=L,K+=I,L+=J,Q+=Math.sqrt(M*M+N*N),P[S]=Q;M+=K,N+=L,Q+=Math.sqrt(M*M+N*N),P[8]=Q,M+=K+I,N+=L+J,Q+=Math.sqrt(M*M+N*N),P[9]=Q,R=0}for(t*=Q;;R++)if(!((w=P[R])<t)){0==R?t/=w:t=R+(t-(v=P[R-1]))/(w-v);break}this.addCurvePosition(.1*t,y,z,A,B,C,D,E,F,n,r,e||0<i&&0==u)}return n},a.addBeforePosition=function(a,b,c,d,e){var f=b[c],g=b[c+1],h=b[c+2]-f,i=b[c+3]-g,j=Math.atan2(i,h);d[e]=f+a*Math.cos(j),d[e+1]=g+a*Math.sin(j),d[e+2]=j},a.addAfterPosition=function(a,b,c,d,e){var f=b[c+2],g=b[c+3],h=f-b[c],i=g-b[c+1],j=Math.atan2(i,h);d[e]=f+a*Math.cos(j),d[e+1]=g+a*Math.sin(j),d[e+2]=j},a.addCurvePosition=function(a,b,c,d,e,f,g,h,i,j,k,l){0==a&&(a=1e-4);var m=a*a,n=m*a,o=1-a,p=o*o,q=p*o,r=o*a,s=3*r,t=o*s,u=s*a,v=b*q+d*t+f*u+h*n,w=c*q+e*t+g*u+i*n;j[k]=v,j[k+1]=w,j[k+2]=l?Math.atan2(w-(c*p+e*r*2+g*m),v-(b*p+d*r*2+f*m)):0},G.NONE=-1,G.BEFORE=-2,G.AFTER=-3,c(G,["_tempMt",function(){return this._tempMt=new Ea}]),G}(),Oa=function(){function a(){this.name=null,this.target=null,this.positionMode=null,this.spacingMode=null,this.rotateMode=null,this.offsetRotation=NaN,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this.bones=[]}return d(a,"laya.ani.bone.PathConstraintData"),a}(),Pa=function(){function a(){this.name=null,this.slotArr=[]}return d(a,"laya.ani.bone.SkinData"),a}(),Qa=function(){function a(){this.name=null,this.attachmentName=null,this.type=0,this.transform=null,this.width=NaN,this.height=NaN,this.texture=null,this.bones=null,this.uvs=null,this.weights=null,this.triangles=null,this.vertices=null,this.lengths=null,this.verLen=0}d(a,"laya.ani.bone.SkinSlotDisplayData");var b=a.prototype;return b.createTexture=function(a){return this.texture||(this.texture=new Fa(a.bitmap,this.uvs),a.bitmap.alphaTexture&&(this.texture.alphaTexture=new Fa(a.bitmap.alphaTexture,this.uvs)),this.uvs[0]>this.uvs[4]&&this.uvs[1]>this.uvs[5]?(this.texture.width=a.height,this.texture.height=a.width,this.texture.offsetX=-a.offsetX,this.texture.offsetY=-a.offsetY,this.texture.sourceWidth=a.sourceHeight,this.texture.sourceHeight=a.sourceWidth):(this.texture.width=a.width,this.texture.height=a.height,this.texture.offsetX=-a.offsetX,this.texture.offsetY=-a.offsetY,this.texture.sourceWidth=a.sourceWidth,this.texture.sourceHeight=a.sourceHeight),q.isWebGL||this.uvs[1]>this.uvs[5]&&(this.texture.offsetY=this.texture.sourceHeight-this.texture.height-this.texture.offsetY)),this.texture},b.destory=function(){this.texture&&this.texture.destroy()},a}(),Ra=function(){function a(){this.name=null,this.displayArr=[]}return d(a,"laya.ani.bone.SlotData"),a.prototype.getDisplayByName=function(a){for(var b=0,c=this.displayArr.length;b<c;b++)if(this.displayArr[b].attachmentName==a)return b;return-1},a}(),w=function(){function a(a,b){this._data=null,this._bones=null,this.target=null,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this._temp=p(2,0),this._data=a,null==this._bones&&(this._bones=[]),this.target=b[a.targetIndex];var c,d=0;for(d=0,c=a.boneIndexs.length;d<c;d++)this._bones.push(b[a.boneIndexs[d]]);this.rotateMix=a.rotateMix,this.translateMix=a.translateMix,this.scaleMix=a.scaleMix,this.shearMix=a.shearMix}return d(a,"laya.ani.bone.TfConstraint"),a.prototype.apply=function(){for(var a,b=this.target.resultMatrix.a,c=this.target.resultMatrix.b,d=this.target.resultMatrix.c,e=this.target.resultMatrix.d,f=0,g=this._bones.length;f<g;f++){if(a=this._bones[f],0<this.rotateMix){var h=a.resultMatrix.a,i=a.resultMatrix.b,j=a.resultMatrix.c,k=a.resultMatrix.d,l=Math.atan2(d,b)-Math.atan2(j,h)+this._data.offsetRotation*Math.PI/180;l>Math.PI?l-=2*Math.PI:l<-Math.PI&&(l+=2*Math.PI),l*=this.rotateMix;var m=Math.cos(l),n=Math.sin(l);a.resultMatrix.a=m*h-n*j,a.resultMatrix.b=m*i-n*k,a.resultMatrix.c=n*h+m*j,a.resultMatrix.d=n*i+m*k}if(this.translateMix&&(this._temp[0]=this._data.offsetX,this._temp[1]=this._data.offsetY,this.target.localToWorld(this._temp),a.resultMatrix.tx+=(this._temp[0]-a.resultMatrix.tx)*this.translateMix,a.resultMatrix.ty+=(this._temp[1]-a.resultMatrix.ty)*this.translateMix,a.updateChild()),0<this.scaleMix){var o=Math.sqrt(a.resultMatrix.a*a.resultMatrix.a+a.resultMatrix.c*a.resultMatrix.c),p=Math.sqrt(b*b+d*d),q=1e-5<o?(o+(p-o+this._data.offsetScaleX)*this.scaleMix)/o:0;a.resultMatrix.a*=q,a.resultMatrix.c*=q,o=Math.sqrt(a.resultMatrix.b*a.resultMatrix.b+a.resultMatrix.d*a.resultMatrix.d),p=Math.sqrt(c*c+e*e),q=1e-5<o?(o+(p-o+this._data.offsetScaleY)*this.scaleMix)/o:0,a.resultMatrix.b*=q,a.resultMatrix.d*=q}if(0<this.shearMix){i=a.resultMatrix.b,k=a.resultMatrix.d;var r=Math.atan2(k,i);(l=Math.atan2(e,c)-Math.atan2(d,b)-(r-Math.atan2(a.resultMatrix.c,a.resultMatrix.a)))>Math.PI?l-=2*Math.PI:l<-Math.PI&&(l+=2*Math.PI),l=r+(l+this._data.offsetShearY*Math.PI/180)*this.shearMix,q=Math.sqrt(i*i+k*k),a.resultMatrix.b=Math.cos(l)*q,a.resultMatrix.d=Math.sin(l)*q}}},a}(),Sa=function(){function a(){this.name=null,this.targetIndex=0,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this.offsetRotation=NaN,this.offsetX=NaN,this.offsetY=NaN,this.offsetScaleX=NaN,this.offsetScaleY=NaN,this.offsetShearY=NaN,this.boneIndexs=[]}return d(a,"laya.ani.bone.TfConstraintData"),a}(),Ta=function(){function a(){this.skX=0,this.skY=0,this.scX=1,this.scY=1,this.x=0,this.y=0,this.skewX=0,this.skewY=0,this.mMatrix=null}d(a,"laya.ani.bone.Transform");var b=a.prototype;return b.initData=function(a){null!=a.x&&(this.x=a.x),null!=a.y&&(this.y=a.y),null!=a.skX&&(this.skX=a.skX),null!=a.skY&&(this.skY=a.skY),null!=a.scX&&(this.scX=a.scX),null!=a.scY&&(this.scY=a.scY)},b.getMatrix=function(){var a;return(a=this.mMatrix?this.mMatrix:this.mMatrix=new Ea).identity(),a.scale(this.scX,this.scY),(this.skewX||this.skewY)&&this.skew(a,this.skewX*Math.PI/180,this.skewY*Math.PI/180),a.rotate(this.skX*Math.PI/180),a.translate(this.x,this.y),a},b.skew=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=Math.sin(b),g=Math.cos(b);return a.setTo(a.a*g-a.b*d,a.a*f+a.b*e,a.c*g-a.d*d,a.c*f+a.d*e,a.tx*g-a.ty*d,a.tx*f+a.ty*e),a},a}(),x=function(){function a(){}return d(a,"laya.ani.bone.UVTools"),a.getRelativeUV=function(a,b,c){var d=a[0],e=a[2]-a[0],f=a[1],g=a[5]-a[1];c||(c=[]),c.length=b.length;var h,i=0;h=c.length;var j=1/e,k=1/g;for(i=0;i<h;i+=2)c[i]=(b[i]-d)*j,c[i+1]=(b[i+1]-f)*k;return c},a.getAbsoluteUV=function(a,b,c){if(0==a[0]&&0==a[1]&&1==a[4]&&1==a[5])return c?(r.copyArray(c,b),c):b;var d=a[0],e=a[2]-a[0],f=a[1],g=a[5]-a[1];c||(c=[]),c.length=b.length;var h,i=0;for(h=c.length,i=0;i<h;i+=2)c[i]=b[i]*e+d,c[i+1]=b[i+1]*g+f;return c},a}(),G=function(){function a(){this.startTime=NaN,this.duration=NaN,this.interpolationData=null,this.data=null,this.nextData=null}return d(a,"laya.ani.KeyFramesContent"),a}(),y=function(){function k(){}return d(k,"laya.ani.math.BezierLerp"),k.getBezierRate=function(a,b,c,d,e){var f=k._getBezierParamKey(b,c,d,e),g=100*f+a;if(k._bezierResultCache[g])return k._bezierResultCache[g];var h,i=k._getBezierPoints(b,c,d,e,f),j=0;for(h=i.length,j=0;j<h;j+=2)if(a<=i[j])return k._bezierResultCache[g]=i[j+1],i[j+1];return k._bezierResultCache[g]=1},k._getBezierParamKey=function(a,b,c,d){return 100*(100*(100*(100*a+b)+c)+d)},k._getBezierPoints=function(a,b,c,d,e){return k._bezierPointsCache[e]?k._bezierPointsCache[e]:(f=[0,0,a,b,c,d,1,1],g=(new h).getBezierPoints(f,100,3),k._bezierPointsCache[e]=g);var f,g},k._bezierResultCache={},k._bezierPointsCache={},k}(),z=function(a){function b(){this._destroyed=!1,this._templet=null,this._currentTime=NaN,this._currentFrameTime=NaN,this._playStart=NaN,this._playEnd=NaN,this._playDuration=NaN,this._overallDuration=NaN,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=NaN,this._startUpdateLoopCount=NaN,this._currentAnimationClipIndex=0,this._currentKeyframeIndex=0,this._paused=!1,this._cacheFrameRate=0,this._cacheFrameRateInterval=NaN,this._cachePlayRate=NaN,this._fullFrames=null,this.isCache=!0,this.playbackRate=1,this.returnToZeroStopped=!1,b.__super.call(this),this._destroyed=!1,this._currentAnimationClipIndex=-1,this._currentKeyframeIndex=-1,this._currentTime=0,this._overallDuration=Number.MAX_VALUE,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0,this._startUpdateLoopCount=-1,this._cachePlayRate=1,this.cacheFrameRate=60,this.returnToZeroStopped=!1}d(b,"laya.ani.AnimationPlayer",e);var c=b.prototype;return ea.imps(c,{"laya.resource.IDestroy":!0}),c._onTempletLoadedComputeFullKeyframeIndices=function(a,b,c){this._templet===c&&this._cachePlayRate===a&&this._cacheFrameRate===b&&this._computeFullKeyframeIndices()},c._computeFullKeyframeIndices=function(){for(var a=this._fullFrames=[],b=this._templet,c=this._cacheFrameRateInterval*this._cachePlayRate,d=0,e=b.getAnimationCount();d<e;d++){for(var f=[],g=0,h=b.getAnimation(d).nodes.length;g<h;g++){for(var i=b.getAnimation(d).nodes[g],j=Math.floor(i.playTime/c+.01),k=new Uint16Array(j+1),l=-1,m=0,n=i.keyFrame.length;m<n;m++){var o=i.keyFrame[m],p=o.startTime,q=p+o.duration+c;do{for(var r=Math.floor(p/c+.5),s=l+1;s<r;s++)k[s]=m;k[l=r]=m,p+=c}while(p<=q)}f.push(k)}a.push(f)}},c._onAnimationTempletLoaded=function(){this.destroyed||this._calculatePlayDuration()},c._calculatePlayDuration=function(){if(0!==this.state){var a=this._templet.getAniDuration(this._currentAnimationClipIndex);0===this._playEnd&&(this._playEnd=a),this._playEnd>a&&(this._playEnd=a),this._playDuration=this._playEnd-this._playStart}},c._setPlayParams=function(a,b){this._currentTime=a,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/b+.01),0),this._currentFrameTime=this._currentKeyframeIndex*b},c._setPlayParamsWhenStop=function(a,b){this._currentTime=a,this._currentKeyframeIndex=Math.max(Math.floor(a/b+.01),0),this._currentFrameTime=this._currentKeyframeIndex*b,this._currentAnimationClipIndex=-1},c._update=function(a){if(-1!==this._currentAnimationClipIndex&&!this._paused&&this._templet&&this._templet.loaded){var b=this._cacheFrameRateInterval*this._cachePlayRate,c=0;this._startUpdateLoopCount!==o.loopCount&&(c=a*this.playbackRate,this._elapsedPlaybackTime+=c);var d=this.playDuration;if(0!==this._overallDuration&&this._elapsedPlaybackTime>=this._overallDuration||0===this._overallDuration&&this._elapsedPlaybackTime>=d)return this._setPlayParamsWhenStop(d,b),void this.event("stopped");if(c+=this._currentTime,0<d)if(d<=c)do{if(c-=d,this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(d,b),this._stopWhenCircleFinish=!1,void this.event("stopped");c<d&&(this._setPlayParams(c,b),this.event("complete"))}while(d<=c);else this._setPlayParams(c,b);else{if(this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(d,b),this._stopWhenCircleFinish=!1,void this.event("stopped");this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this.event("complete")}}},c._destroy=function(){this.offAll(),this._templet=null,this._fullFrames=null,this._destroyed=!0},c.play=function(a,b,c,d,e){if(void 0===a&&(a=0),void 0===b&&(b=1),void 0===c&&(c=2147483647),void 0===d&&(d=0),void 0===e&&(e=0),!this._templet)throw new Error("AnimationPlayer:templet must not be null,maybe you need to set url.");if(c<0||d<0||e<0)throw new Error("AnimationPlayer:overallDuration,playStart and playEnd must large than zero.");if(0!==e&&e<d)throw new Error("AnimationPlayer:start must less than end.");this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this.playbackRate=b,this._overallDuration=c,this._playStart=d,this._playEnd=e,this._paused=!1,this._currentAnimationClipIndex=a,this._currentKeyframeIndex=0,this._startUpdateLoopCount=o.loopCount,this.event("played"),this._templet.loaded?this._calculatePlayDuration():this._templet.once("loaded",this,this._onAnimationTempletLoaded),this._update(0)},c.playByFrame=function(a,b,c,d,e,f){void 0===a&&(a=0),void 0===b&&(b=1),void 0===c&&(c=2147483647),void 0===d&&(d=0),void 0===e&&(e=0),void 0===f&&(f=30);var g=1e3/f;this.play(a,b,c,d*g,e*g)},c.stop=function(a){void 0===a&&(a=!0),a?(this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this._currentAnimationClipIndex=-1,this.event("stopped")):this._stopWhenCircleFinish=!0},f(0,c,"playEnd",function(){return this._playEnd}),f(0,c,"templet",function(){return this._templet},function(a){0===!this.state&&this.stop(!0),this._templet!==a&&((this._templet=a).loaded?this._computeFullKeyframeIndices():a.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,this._cacheFrameRate]))}),f(0,c,"playStart",function(){return this._playStart}),f(0,c,"playDuration",function(){return this._playDuration}),f(0,c,"state",function(){return-1===this._currentAnimationClipIndex?0:this._paused?1:2}),f(0,c,"currentKeyframeIndex",function(){return this._currentKeyframeIndex}),f(0,c,"overallDuration",function(){return this._overallDuration}),f(0,c,"currentFrameTime",function(){return this._currentFrameTime}),f(0,c,"currentAnimationClipIndex",function(){return this._currentAnimationClipIndex}),f(0,c,"currentPlayTime",function(){return this._currentTime+this._playStart}),f(0,c,"cachePlayRate",function(){return this._cachePlayRate},function(a){this._cachePlayRate!==a&&(this._cachePlayRate=a,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[a,this._cacheFrameRate])))}),f(0,c,"cacheFrameRate",function(){return this._cacheFrameRate},function(a){this._cacheFrameRate!==a&&(this._cacheFrameRate=a,this._cacheFrameRateInterval=1e3/this._cacheFrameRate,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,a])))}),f(0,c,"currentTime",null,function(a){if(-1!==this._currentAnimationClipIndex&&this._templet&&this._templet.loaded){if(a<this._playStart||a>this._playEnd)throw new Error("AnimationPlayer:value must large than playStartTime,small than playEndTime.");this._startUpdateLoopCount=o.loopCount;var b=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=a,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/b),0),this._currentFrameTime=this._currentKeyframeIndex*b}}),f(0,c,"paused",function(){return this._paused},function(a){(this._paused=a)&&this.event("paused")}),f(0,c,"cacheFrameRateInterval",function(){return this._cacheFrameRateInterval}),f(0,c,"destroyed",function(){return this._destroyed}),b}(),H=function(a){function b(){b.__super.call(this),q.isConchNode&&(this.drawSkin=function(a){a.transform||(a.transform=Ea.EMPTY),this._addCmd([a]),this.setSkinMesh&&this.setSkinMesh(a._ps,a.mVBData,a.mEleNum,0,a.mTexture,a.transform)})}return d(b,"laya.ani.GraphicsAni",g),b.prototype.drawSkin=function(a){var b=[a];this._saveToCmd(q._context._drawSkin,b)},b.create=function(){return b._caches.pop()||new b},b.recycle=function(a){a.clear(),b._caches.push(a)},b._caches=[],b}(),I=function(a){function s(){this._aniMap={},this.unfixedLastAniIndex=-1,s.__super.call(this),this._anis=new Array}d(s,"laya.ani.AnimationTemplet",k);var b=s.prototype;return b.parse=function(a){var b=new Da(a);this._aniVersion=b.readUTFString(),t.parse(this,b)},b._calculateKeyFrame=function(a,b,c){var d=a.keyFrame;d[b]=d[0];for(var e=0;e<b;e++){var f=d[e];f.nextData=0===f.duration?f.data:d[e+1].data}d.length--},b.onAsynLoaded=function(a,b,c){var d=new Da(b);switch(this._aniVersion=d.readUTFString(),this._aniVersion){case"LAYAANIMATION:02":u.parse(this,d);break;default:t.parse(this,d)}this._endLoaded()},b.disposeResource=function(){this._aniVersion=null,this._anis=null,this._aniMap=null,this._publicExtData=null,this.unfixedCurrentFrameIndexes=null,this.unfixedCurrentTimes=null,this.unfixedKeyframes=null,this._aniClassName=null,this._animationDatasCache=null},b.getAnimationCount=function(){return this._anis.length},b.getAnimation=function(a){return this._anis[a]},b.getAniDuration=function(a){return this._anis[a].playTime},b.getNodes=function(a){return this._anis[a].nodes},b.getNodeIndexWithName=function(a,b){return this._anis[a].bone3DMap[b]},b.getNodeCount=function(a){return this._anis[a].nodes.length},b.getTotalkeyframesLength=function(a){return this._anis[a].totalKeyframeDatasLength},b.getPublicExtData=function(){return this._publicExtData},b.getAnimationDataWithCache=function(a,b,c,d){var e=b[c];if(e){var f=e[a];return f?f[d]:null}return null},b.setAnimationDataWithCache=function(a,b,c,d,e){var f=b[c]||(b[c]={});(f[a]||(f[a]=[]))[d]=e},b.getOriginalData=function(a,b,c,d,e){for(var f=this._anis[a].nodes,g=0,h=0,i=f.length,j=0;h<i;h++){var k,l=f[h];k=l.keyFrame[c[h][d]],l.dataOffset=j;var m=e-k.startTime,n=l.lerpType;if(n)switch(n){case 0:case 1:for(g=0;g<l.keyframeWidth;)g+=l.interpolationMethod[g](l,g,b,j+g,k.data,m,null,k.duration,k.nextData);break;case 2:var o=k.interpolationData,p=o.length,q=0;for(g=0;g<p;){var r=o[g];switch(r){case 6:case 7:g+=s.interpolation[r](l,q,b,j+q,k.data,m,null,k.duration,k.nextData,o,g+1);break;default:g+=s.interpolation[r](l,q,b,j+q,k.data,m,null,k.duration,k.nextData)}q++}}else for(g=0;g<l.keyframeWidth;)g+=l.interpolationMethod[g](l,g,b,j+g,k.data,m,null,k.duration,k.nextData);j+=l.keyframeWidth}},b.getNodesCurrentFrameIndex=function(a,b){var c=this._anis[a].nodes;a!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(c.length),this.unfixedCurrentTimes=new Float32Array(c.length),this.unfixedLastAniIndex=a);for(var d=0,e=c.length;d<e;d++){var f=c[d];for(b<this.unfixedCurrentTimes[d]&&(this.unfixedCurrentFrameIndexes[d]=0),this.unfixedCurrentTimes[d]=b;this.unfixedCurrentFrameIndexes[d]<f.keyFrame.length&&!(f.keyFrame[this.unfixedCurrentFrameIndexes[d]].startTime>this.unfixedCurrentTimes[d]);)this.unfixedCurrentFrameIndexes[d]++;this.unfixedCurrentFrameIndexes[d]--}return this.unfixedCurrentFrameIndexes},b.getOriginalDataUnfixedRate=function(a,b,c){var d=this._anis[a].nodes;a!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(d.length),this.unfixedCurrentTimes=new Float32Array(d.length),this.unfixedKeyframes=p(d.length),this.unfixedLastAniIndex=a);for(var e=0,f=0,g=d.length,h=0;f<g;f++){var i=d[f];for(c<this.unfixedCurrentTimes[f]&&(this.unfixedCurrentFrameIndexes[f]=0),this.unfixedCurrentTimes[f]=c;this.unfixedCurrentFrameIndexes[f]<i.keyFrame.length&&!(i.keyFrame[this.unfixedCurrentFrameIndexes[f]].startTime>this.unfixedCurrentTimes[f]);)this.unfixedKeyframes[f]=i.keyFrame[this.unfixedCurrentFrameIndexes[f]],this.unfixedCurrentFrameIndexes[f]++;var j=this.unfixedKeyframes[f];i.dataOffset=h;var k=c-j.startTime;if(i.lerpType)switch(i.lerpType){case 0:case 1:for(e=0;e<i.keyframeWidth;)e+=i.interpolationMethod[e](i,e,b,h+e,j.data,k,null,j.duration,j.nextData);break;case 2:var l=j.interpolationData,m=l.length,n=0;for(e=0;e<m;){var o=l[e];switch(o){case 6:case 7:e+=s.interpolation[o](i,n,b,h+n,j.data,k,null,j.duration,j.nextData,l,e+1);break;default:e+=s.interpolation[o](i,n,b,h+n,j.data,k,null,j.duration,j.nextData)}n++}}else for(e=0;e<i.keyframeWidth;)e+=i.interpolationMethod[e](i,e,b,h+e,j.data,k,null,j.duration,j.nextData);h+=i.keyframeWidth}},s._LinearInterpolation_0=function(a,b,c,d,e,f,g,h,i,j){var k=0===h?0:f/h;return c[d]=(1-k)*e[b]+k*i[b],1},s._QuaternionInterpolation_1=function(a,b,c,d,e,f,g,h,i,j){var k=0===h?0:f/h;return m.slerpQuaternionArray(e,b,i,b,k,c,d),4},s._AngleInterpolation_2=function(a,b,c,d,e,f,g,h,i,j){return 0},s._RadiansInterpolation_3=function(a,b,c,d,e,f,g,h,i,j){return 0},s._Matrix4x4Interpolation_4=function(a,b,c,d,e,f,g,h,i,j){for(var k=0;k<16;k++,b++)c[d+k]=e[b]+f*g[b];return 16},s._NoInterpolation_5=function(a,b,c,d,e,f,g,h,i,j){return c[d]=e[b],1},s._BezierInterpolation_6=function(a,b,c,d,e,f,g,h,i,j,k){return void 0===k&&(k=0),c[d]=e[b]+(i[b]-e[b])*y.getBezierRate(f/h,j[k],j[k+1],j[k+2],j[k+3]),5},s._BezierInterpolation_7=function(a,b,c,d,e,f,g,h,i,j,k){return void 0===k&&(k=0),c[d]=j[k+4]+j[k+5]*y.getBezierRate((.001*f+j[k+6])/j[k+7],j[k],j[k+1],j[k+2],j[k+3]),9},s.load=function(a){return ea.loader.create(a,null,null,s)},s.interpolation=[s._LinearInterpolation_0,s._QuaternionInterpolation_1,s._AngleInterpolation_2,s._RadiansInterpolation_3,s._Matrix4x4Interpolation_4,s._NoInterpolation_5,s._BezierInterpolation_6,s._BezierInterpolation_7],s}(),A=function(b){function c(a,b){this._templet=null,this._player=null,this._curOriginalData=null,this._boneMatrixArray=[],this._lastTime=0,this._currAniName=null,this._currAniIndex=-1,this._pause=!0,this._aniClipIndex=-1,this._clipIndex=-1,this._skinIndex=0,this._skinName="default",this._aniMode=0,this._graphicsCache=null,this._boneSlotDic=null,this._bindBoneBoneSlotDic=null,this._boneSlotArray=null,this._index=-1,this._total=-1,this._indexControl=!1,this._aniPath=null,this._texturePath=null,this._complete=null,this._loadAniMode=0,this._yReverseMatrix=null,this._ikArr=null,this._tfArr=null,this._pathDic=null,this._rootBone=null,this._boneList=null,this._aniSectionDic=null,this._eventIndex=0,this._drawOrderIndex=0,this._drawOrder=null,this._lastAniClipIndex=-1,this._lastUpdateAniClipIndex=-1,c.__super.call(this),void 0===b&&(b=0),a&&this.init(a,b)}d(c,"laya.ani.bone.Skeleton",b);var a=c.prototype;return a.init=function(a,b){void 0===b&&(b=0);var c,d,e,f=0,g=0;if(1==b)for(this._graphicsCache=[],f=0,g=a.getAnimationCount();f<g;f++)this._graphicsCache.push([]);if(this._yReverseMatrix=a.yReverseMatrix,this._aniMode=b,this._templet=a,this._player=new z,this._player.cacheFrameRate=a.rate,this._player.templet=a,this._player.play(),this._parseSrcBoneMatrix(),this._boneList=a.mBoneArr,this._rootBone=a.mRootBone,this._aniSectionDic=a.aniSectionDic,0<a.ikArr.length)for(this._ikArr=[],f=0,g=a.ikArr.length;f<g;f++)this._ikArr.push(new s(a.ikArr[f],this._boneList));if(0<a.pathArr.length)for(null==this._pathDic&&(this._pathDic={}),f=0,g=a.pathArr.length;f<g;f++)c=a.pathArr[f],d=new v(c,this._boneList),(e=this._boneSlotDic[c.name])&&((d=new v(c,this._boneList)).target=e),this._pathDic[c.name]=d;if(0<a.tfArr.length)for(this._tfArr=[],f=0,g=a.tfArr.length;f<g;f++)this._tfArr.push(new w(a.tfArr[f],this._boneList));if(0<a.skinDataArray.length){var h=this._templet.skinDataArray[this._skinIndex];this._skinName=h.name}this._player.on("played",this,this._onPlay),this._player.on("stopped",this,this._onStop),this._player.on("paused",this,this._onPause)},a.load=function(a,b,c){},a._onLoaded=function(){},a._parseComplete=function(){var a=B.TEMPLET_DICTIONARY[this._aniPath];a&&(this.init(a,this._loadAniMode),this.play(0,!0)),this._complete&&this._complete.runWith(this)},a._parseFail=function(){console.error("[Error]:"+this._aniPath+"解析失败")},a._onPlay=function(){this.event("played")},a._onStop=function(){var a,b=this._templet.eventAniArr[this._aniClipIndex];if(b&&this._eventIndex<b.length)for(;this._eventIndex<b.length;this._eventIndex++)(a=b[this._eventIndex]).time>=this._player.playStart&&a.time<=this._player.playEnd&&this.event("label",a);this._eventIndex=0,this._drawOrder=null,this.event("stopped")},a._onPause=function(){this.event("paused")},a._parseSrcBoneMatrix=function(){var a=0,b=0;for(b=this._templet.srcBoneMatrixArr.length,a=0;a<b;a++)this._boneMatrixArray.push(new Ea);if(0==this._aniMode)this._boneSlotDic=this._templet.boneSlotDic,this._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic,this._boneSlotArray=this._templet.boneSlotArray;else{null==this._boneSlotDic&&(this._boneSlotDic={}),null==this._bindBoneBoneSlotDic&&(this._bindBoneBoneSlotDic={}),null==this._boneSlotArray&&(this._boneSlotArray=[]);var c,d,e=this._templet.boneSlotArray;for(a=0,b=e.length;a<b;a++)c=e[a],null==(d=this._bindBoneBoneSlotDic[c.parent])&&(this._bindBoneBoneSlotDic[c.parent]=d=[]),this._boneSlotDic[c.name]=c=c.copy(),d.push(c),this._boneSlotArray.push(c)}},a._emitMissedEvents=function(a,b,c){void 0===c&&(c=0);var d=this._templet.eventAniArr[this._player.currentAnimationClipIndex];if(d){var e,f,g=0;for(e=d.length,g=c;g<e;g++)(f=d[g]).time>=this._player.playStart&&f.time<=this._player.playEnd&&this.event("label",f)}},a._update=function(a){if(void 0===a&&(a=!0),!(this._pause||a&&this._indexControl)){var b=this.timer.currTimer,c=this._player.currentKeyframeIndex,d=b-this._lastTime;if(a?this._player._update(d):c=-1,this._lastTime=b,this._player&&(this._index=this._clipIndex=this._player.currentKeyframeIndex,!(this._index<0||0<d&&this._clipIndex==c&&this._lastUpdateAniClipIndex==this._aniClipIndex))){var e;this._lastUpdateAniClipIndex=this._aniClipIndex,c>this._clipIndex&&0!=this._eventIndex&&(this._emitMissedEvents(this._player.playStart,this._player.playEnd,this._eventIndex),this._eventIndex=0);var f,g=this._templet.eventAniArr[this._aniClipIndex];if(g&&this._eventIndex<g.length&&((e=g[this._eventIndex]).time>=this._player.playStart&&e.time<=this._player.playEnd?this._player.currentPlayTime>=e.time&&(this.event("label",e),this._eventIndex++):this._eventIndex++),0==this._aniMode){if(f=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=f&&(this.graphics=f));var h=0,i=0;for(i=this._clipIndex;!this._templet.getGrahicsDataWithCache(this._aniClipIndex,i-1)&&0<i;)i--;if(i<this._clipIndex)for(h=i;h<this._clipIndex;h++)this._createGraphics(h)}else if(1==this._aniMode){if(f=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=f&&(this.graphics=f));for(i=this._clipIndex;!this._getGrahicsDataWithCache(this._aniClipIndex,i-1)&&0<i;)i--;if(i<this._clipIndex)for(h=i;h<this._clipIndex;h++)this._createGraphics(h)}this._createGraphics()}}},a._createGraphics=function(a){void 0===a&&(a=-1),-1==a&&(a=this._clipIndex);var b,c,d=a*this._player.cacheFrameRateInterval,e=this._templet.drawOrderAniArr[this._aniClipIndex];if(e&&0<e.length)for(this._drawOrderIndex=0,b=e[this._drawOrderIndex];d>=b.time&&(this._drawOrder=b.drawOrder,this._drawOrderIndex++,!(this._drawOrderIndex>=e.length));)b=e[this._drawOrderIndex];0==this._aniMode||1==this._aniMode?this.graphics=H.create():this.graphics instanceof laya.ani.GraphicsAni?this.graphics.clear():this.graphics=H.create(),c=this.graphics;var f=this._templet.getNodes(this._aniClipIndex);this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._player._fullFrames[this._aniClipIndex],a,d);var g,h,i,j,k=this._aniSectionDic[this._aniClipIndex],l=0,m=0,n=0,o=0,p=0,q=this._templet.srcBoneMatrixArr.length;for(p=k[m=0];m<q;m++)j=this._boneList[m],i=this._templet.srcBoneMatrixArr[m],j.resultTransform.scX=i.scX*this._curOriginalData[l++],j.resultTransform.skX=i.skX+this._curOriginalData[l++],j.resultTransform.skY=i.skY+this._curOriginalData[l++],j.resultTransform.scY=i.scY*this._curOriginalData[l++],j.resultTransform.x=i.x+this._curOriginalData[l++],j.resultTransform.y=i.y+this._curOriginalData[l++],8===this._templet.tMatrixDataLen&&(j.resultTransform.skewX=i.skewX+this._curOriginalData[l++],j.resultTransform.skewY=i.skewY+this._curOriginalData[l++]);var r,s={},t={};for(p+=k[1];m<p;m++)s[(r=f[m]).name]=this._curOriginalData[l++],t[r.name]=this._curOriginalData[l++],this._curOriginalData[l++],this._curOriginalData[l++],this._curOriginalData[l++],this._curOriginalData[l++];var u,v,w={},x={};for(p+=k[2];m<p;m++)w[(r=f[m]).name]=this._curOriginalData[l++],x[r.name]=this._curOriginalData[l++],this._curOriginalData[l++],this._curOriginalData[l++],this._curOriginalData[l++],this._curOriginalData[l++];if(this._pathDic)for(p+=k[3];m<p;m++){if(r=f[m],u=this._pathDic[r.name])switch(new Da(r.extenData).getByte()){case 1:u.position=this._curOriginalData[l++];break;case 2:u.spacing=this._curOriginalData[l++];break;case 3:u.rotateMix=this._curOriginalData[l++],u.translateMix=this._curOriginalData[l++]}}if(this._yReverseMatrix?this._rootBone.update(this._yReverseMatrix):this._rootBone.update(Ea.TEMP.identity()),this._ikArr)for(m=0,p=this._ikArr.length;m<p;m++)v=this._ikArr[m],w.hasOwnProperty(v.name)&&(v.bendDirection=w[v.name]),x.hasOwnProperty(v.name)&&(v.mix=x[v.name]),v.apply();if(this._pathDic)for(var y in this._pathDic)(u=this._pathDic[y]).apply(this._boneList,c);if(this._tfArr)for(m=0,o=this._tfArr.length;m<o;m++)this._tfArr[m].apply();for(m=0,o=this._boneList.length;m<o;m++)if(j=this._boneList[m],h=this._bindBoneBoneSlotDic[j.name],j.resultMatrix.copyTo(this._boneMatrixArray[m]),h)for(n=0,p=h.length;n<p;n++)(g=h[n])&&g.setParentMatrix(j.resultMatrix);var z,A,B,C,D={},E=this._templet.deformAniArr;if(E&&0<E.length){if(this._lastAniClipIndex!=this._aniClipIndex)for(this._lastAniClipIndex=this._aniClipIndex,m=0,p=this._boneSlotArray.length;m<p;m++)(g=this._boneSlotArray[m]).deformData=null;var F,G=E[this._aniClipIndex];for(F in z=G.default,this._setDeform(z,D,this._boneSlotArray,d),G)"default"!=F&&F!=this._skinName&&(z=G[F],this._setDeform(z,D,this._boneSlotArray,d));z=G[this._skinName],this._setDeform(z,D,this._boneSlotArray,d)}if(this._drawOrder)for(m=0,p=this._drawOrder.length;m<p;m++)A=s[(g=this._boneSlotArray[this._drawOrder[m]]).name],B=t[g.name],isNaN(B)||(c.save(),c.alpha(B)),isNaN(A)||-2==A||(this._templet.attachmentNames?g.showDisplayByName(this._templet.attachmentNames[A]):g.showDisplayByIndex(A)),D[this._drawOrder[m]]?(C=D[this._drawOrder[m]],g.currDisplayData&&C[g.currDisplayData.attachmentName]?g.deformData=C[g.currDisplayData.attachmentName]:g.deformData=null):g.deformData=null,isNaN(B)?g.draw(c,this._boneMatrixArray,2==this._aniMode):g.draw(c,this._boneMatrixArray,2==this._aniMode,B),isNaN(B)||c.restore();else for(m=0,p=this._boneSlotArray.length;m<p;m++)A=s[(g=this._boneSlotArray[m]).name],B=t[g.name],isNaN(B)||(c.save(),c.alpha(B)),isNaN(A)||-2==A||(this._templet.attachmentNames?g.showDisplayByName(this._templet.attachmentNames[A]):g.showDisplayByIndex(A)),D[m]?(C=D[m],g.currDisplayData&&C[g.currDisplayData.attachmentName]?g.deformData=C[g.currDisplayData.attachmentName]:g.deformData=null):g.deformData=null,isNaN(B)?g.draw(c,this._boneMatrixArray,2==this._aniMode):g.draw(c,this._boneMatrixArray,2==this._aniMode,B),isNaN(B)||c.restore();0==this._aniMode?this._templet.setGrahicsDataWithCache(this._aniClipIndex,a,c):1==this._aniMode&&this._setGrahicsDataWithCache(this._aniClipIndex,a,c)},a._setDeform=function(a,b,c,d){if(a){var e,f,g,h=0,i=0,j=0;if(a)for(h=0,i=a.deformSlotDataList.length;h<i;h++)for(e=a.deformSlotDataList[h],j=0;j<e.deformSlotDisplayList.length;j++)g=c[(f=e.deformSlotDisplayList[j]).slotIndex],f.apply(d,g),b[f.slotIndex]||(b[f.slotIndex]={}),b[f.slotIndex][f.attachment]=f.deformData}},a.getAnimNum=function(){return this._templet.getAnimationCount()},a.getAniNameByIndex=function(a){return this._templet.getAniNameByIndex(a)},a.getSlotByName=function(a){return this._boneSlotDic[a]},a.showSkinByName=function(a,b){void 0===b&&(b=!0),this.showSkinByIndex(this._templet.getSkinIndexByName(a),b)},a.showSkinByIndex=function(a,b){void 0===b&&(b=!0);for(var c=0;c<this._boneSlotArray.length;c++)this._boneSlotArray[c].showSlotData(null,b);if(this._templet.showSkinByIndex(this._boneSlotDic,a,b)){var d=this._templet.skinDataArray[a];this._skinIndex=a,this._skinName=d.name}this._clearCache()},a.showSlotSkinByIndex=function(a,b){if(0!=this._aniMode){var c=this.getSlotByName(a);c&&c.showDisplayByIndex(b),this._clearCache()}},a.showSlotSkinByName=function(a,b){if(0!=this._aniMode){var c=this.getSlotByName(a);c&&c.showDisplayByName(b),this._clearCache()}},a.replaceSlotSkinName=function(a,b,c){if(0!=this._aniMode){var d=this.getSlotByName(a);d&&d.replaceDisplayByName(b,c),this._clearCache()}},a.replaceSlotSkinByIndex=function(a,b,c){if(0!=this._aniMode){var d=this.getSlotByName(a);d&&d.replaceDisplayByIndex(b,c),this._clearCache()}},a.setSlotSkin=function(a,b){if(0!=this._aniMode){var c=this.getSlotByName(a);c&&c.replaceSkin(b),this._clearCache()}},a._clearCache=function(){if(1==this._aniMode)for(var a=0,b=this._graphicsCache.length;a<b;a++){for(var c=0,d=this._graphicsCache[a].length;c<d;c++){var e=this._graphicsCache[a][c];e!=this.graphics&&H.recycle(e)}this._graphicsCache[a].length=0}},a.play=function(a,b,c,d,e,f){void 0===c&&(c=!0),void 0===d&&(d=0),void 0===e&&(e=0),void 0===f&&(f=!0),this._indexControl=!1;var g=-1,h=NaN;if(h=b?2147483647:0,"string"==typeof a)for(var i=0,j=this._templet.getAnimationCount();i<j;i++){var k=this._templet.getAnimation(i);if(k&&a==k.name){g=i;break}}else g=a;-1<g&&g<this.getAnimNum()&&(this._aniClipIndex=g,(c||this._pause||this._currAniIndex!=g)&&(this._currAniIndex=g,this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(g)),this._drawOrder=null,this._eventIndex=0,this._player.play(g,this._player.playbackRate,h,d,e),f&&this._templet.showSkinByIndex(this._boneSlotDic,this._skinIndex),this._pause&&(this._pause=!1,this._lastTime=l.now(),this.timer.frameLoop(1,this,this._update,null,!0)),this._update()))},a.stop=function(){this._pause||(this._pause=!0,this._player&&this._player.stop(!0),this.timer.clear(this,this._update))},a.playbackRate=function(a){this._player&&(this._player.playbackRate=a)},a.paused=function(){this._pause||(this._pause=!0,this._player&&(this._player.paused=!0),this.timer.clear(this,this._update))},a.resume=function(){this._indexControl=!1,this._pause&&(this._pause=!1,this._player&&(this._player.paused=!1),this._lastTime=l.now(),this.timer.frameLoop(1,this,this._update,null,!0))},a._getGrahicsDataWithCache=function(a,b){return this._graphicsCache[a][b]},a._setGrahicsDataWithCache=function(a,b,c){this._graphicsCache[a][b]=c},a.destroy=function(a){void 0===a&&(a=!0),b.prototype.destroy.call(this,a),this._templet=null,this._player&&this._player.offAll(),this._player=null,this._curOriginalData=null,this._boneMatrixArray.length=0,this._lastTime=0,this.timer.clear(this,this._update)},f(0,a,"url",function(){return this._aniPath},function(a){this.load(a)}),f(0,a,"index",function(){return this._index},function(a){this.player&&(this._index=a,this._player.currentTime=1e3*this._index/this._player.cacheFrameRate,this._indexControl=!0,this._update(!1))}),f(0,a,"total",function(){return this._templet&&this._player?this._total=Math.floor(this._templet.getAniDuration(this._player.currentAnimationClipIndex)/1e3*this._player.cacheFrameRate):this._total=-1,this._total}),f(0,a,"templet",function(){return this._templet}),f(0,a,"player",function(){return this._player}),c.useSimpleMeshInCanvas=!1,c}(fa),B=function(b){function e(){this._mainTexture=null,this._textureJson=null,this._graphicsCache=[],this.srcBoneMatrixArr=[],this.ikArr=[],this.tfArr=[],this.pathArr=[],this.boneSlotDic={},this.bindBoneBoneSlotDic={},this.boneSlotArray=[],this.skinDataArray=[],this.skinDic={},this.subTextureDic={},this.isParseFail=!1,this.yReverseMatrix=null,this.drawOrderAniArr=[],this.eventAniArr=[],this.attachmentNames=null,this.deformAniArr=[],this._isDestroyed=!1,this._rate=30,this.isParserComplete=!1,this.aniSectionDic={},this._skBufferUrl=null,this._textureDic={},this._loadList=null,this._path=null,this.tMatrixDataLen=0,this.mRootBone=null,e.__super.call(this),this.skinSlotDisplayDataArr=[],this.mBoneArr=[]}d(e,"laya.ani.bone.Templet",b);var a=e.prototype;return a.getLoadList=function(){return this._loadList},a.loadAni=function(a){this._skBufferUrl=a,ea.loader.load(a,i.create(this,this.onComplete),null,"arraybuffer")},a.onComplete=function(a){if(this._isDestroyed)this.destroy();else{var b=j.getRes(this._skBufferUrl);b?(this._path=this._skBufferUrl.slice(0,this._skBufferUrl.lastIndexOf("/"))+"/",this.parseData(null,b)):this.event("error","load failed:"+this._skBufferUrl)}},a.parseData=function(a,b,c){void 0===c&&(c=30),!this._path&&this.url&&(this._path=this.url.slice(0,this.url.lastIndexOf("/"))+"/"),this._mainTexture=a,this._mainTexture&&q.isWebGL&&a.bitmap&&(a.bitmap.enableMerageInAtlas=!1),this._rate=c,this.parse(b)},a.buildArmature=function(a){return void 0===a&&(a=0),new A(this,a)},a.parse=function(a){b.prototype.parse.call(this,a),this._endLoaded(),this._aniVersion!=e.LAYA_ANIMATION_VISION&&(console.error("[Error] 版本不一致，请使用IDE版本配套的重新导出"+this._aniVersion+"->"+e.LAYA_ANIMATION_VISION),this._loaded=!1),this.loaded?this._mainTexture?this._parsePublicExtData():this._parseTexturePath():(this.event("error",this),this.isParseFail=!0)},a._parseTexturePath=function(){if(this._isDestroyed)this.destroy();else{var a=0;this._loadList=[];var b,c=new Da(this.getPublicExtData()),d=0,e=0,f=0,g=c.getInt32(),h=c.readUTFString(),i=h.split("\n");for(a=0;a<g;a++)b=this._path+i[2*a],h=i[2*a+1],c.getFloat32(),c.getFloat32(),d=c.getFloat32(),e=c.getFloat32(),f=c.getFloat32(),isNaN(f)?0:f,f=c.getFloat32(),isNaN(f)?0:f,f=c.getFloat32(),isNaN(f)?d:f,f=c.getFloat32(),isNaN(f)?e:f,-1==this._loadList.indexOf(b)&&this._loadList.push(b);this.event("inited",this)}},a._textureComplete=function(){for(var a,b,c=0,d=this._loadList.length;c<d;c++)b=this._loadList[c],a=this._textureDic[b]=j.getRes(b),q.isWebGL&&a&&a.bitmap&&(a.bitmap.enableMerageInAtlas=!1);this._parsePublicExtData()},a._parsePublicExtData=function(){var a=0,b=0,c=0,d=0,e=0;for(a=0,e=this.getAnimationCount();a<e;a++)this._graphicsCache.push([]);var f;f="Dragon"!=this._aniClassName;var g,h,i=new Da(this.getPublicExtData()),j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=i.getInt32(),t=i.readUTFString(),u=t.split("\n");for(a=0;a<s;a++){if(g=this._mainTexture,h=this._path+u[2*a],t=u[2*a+1],null==this._mainTexture&&(g=this._textureDic[h]),!g)return this.event("error",this),void(this.isParseFail=!0);j=i.getFloat32(),k=i.getFloat32(),l=i.getFloat32(),m=i.getFloat32(),r=i.getFloat32(),n=isNaN(r)?0:r,r=i.getFloat32(),o=isNaN(r)?0:r,r=i.getFloat32(),p=isNaN(r)?l:r,r=i.getFloat32(),q=isNaN(r)?m:r,this.subTextureDic[t]=Fa.create(g,j,k,l,m,-n,-o,p,q),g.alphaTexture&&(this.subTextureDic[t].alphaTexture=Fa.create(g.alphaTexture,j,k,l,m,-n,-o,p,q))}this._mainTexture=g;var v,w,x,y,z,A=i.getUint16();for(a=0;a<A;a++)(v=[]).push(i.getUint16()),v.push(i.getUint16()),v.push(i.getUint16()),v.push(i.getUint16()),this.aniSectionDic[a]=v;var B,C=i.getInt16(),D={};for(a=0;a<C;a++)w=new Ga,0==a?B=w:w.root=B,w.d=f?-1:1,y=i.readUTFString(),z=i.readUTFString(),w.length=i.getFloat32(),1==i.getByte()&&(w.inheritRotation=!1),1==i.getByte()&&(w.inheritScale=!1),w.name=y,z&&((x=D[z])?x.addChild(w):this.mRootBone=w),D[y]=w,this.mBoneArr.push(w);this.tMatrixDataLen=i.getUint16();var E,F,G=i.getUint16(),H=Math.floor(G/this.tMatrixDataLen),I=this.srcBoneMatrixArr;for(a=0;a<H;a++)(E=new Ta).scX=i.getFloat32(),E.skX=i.getFloat32(),E.skY=i.getFloat32(),E.scY=i.getFloat32(),E.x=i.getFloat32(),E.y=i.getFloat32(),8===this.tMatrixDataLen&&(E.skewX=i.getFloat32(),E.skewY=i.getFloat32()),I.push(E),(w=this.mBoneArr[a]).transform=E;var J,K=i.getUint16(),L=0;for(a=0;a<K;a++){for(F=new Na,L=i.getUint16(),b=0;b<L;b++)F.boneNames.push(i.readUTFString()),F.boneIndexs.push(i.getInt16());F.name=i.readUTFString(),F.targetBoneName=i.readUTFString(),F.targetBoneIndex=i.getInt16(),F.bendDirection=i.getFloat32(),F.mix=i.getFloat32(),F.isSpine=f,this.ikArr.push(F)}var M,N=i.getUint16(),O=0;for(a=0;a<N;a++){for(J=new Sa,O=i.getUint16(),b=0;b<O;b++)J.boneIndexs.push(i.getInt16());J.name=i.getUTFString(),J.targetIndex=i.getInt16(),J.rotateMix=i.getFloat32(),J.translateMix=i.getFloat32(),J.scaleMix=i.getFloat32(),J.shearMix=i.getFloat32(),J.offsetRotation=i.getFloat32(),J.offsetX=i.getFloat32(),J.offsetY=i.getFloat32(),J.offsetScaleX=i.getFloat32(),J.offsetScaleY=i.getFloat32(),J.offsetShearY=i.getFloat32(),this.tfArr.push(J)}var P=i.getUint16(),Q=0;for(a=0;a<P;a++){for((M=new Oa).name=i.readUTFString(),Q=i.getUint16(),b=0;b<Q;b++)M.bones.push(i.getInt16());M.target=i.readUTFString(),M.positionMode=i.readUTFString(),M.spacingMode=i.readUTFString(),M.rotateMode=i.readUTFString(),M.offsetRotation=i.getFloat32(),M.position=i.getFloat32(),M.spacing=i.getFloat32(),M.rotateMix=i.getFloat32(),M.translateMix=i.getFloat32(),this.pathArr.push(M)}var R,S,T,U,V,W=0,X=0,Y=0,Z=NaN,$=0,_=i.getInt16();for(a=0;a<_;a++){var aa=i.getUint8(),ba={};this.deformAniArr.push(ba);for(var ca=0;ca<aa;ca++)for((R=new Ia).skinName=i.getUTFString(),ba[R.skinName]=R,W=i.getInt16(),b=0;b<W;b++)for(S=new Ja,R.deformSlotDataList.push(S),X=i.getInt16(),c=0;c<X;c++)for(T=new Ka,S.deformSlotDisplayList.push(T),T.slotIndex=i.getInt16(),T.attachment=i.getUTFString(),Y=i.getInt16(),d=0;d<Y;d++)for(1==i.getByte()?T.tweenKeyList.push(!0):T.tweenKeyList.push(!1),Z=i.getFloat32(),T.timeList.push(Z),U=[],T.vectices.push(U),$=i.getInt16(),e=0;e<$;e++)U.push(i.getFloat32())}var da,ea,fa=i.getInt16(),ga=0,ha=0;for(a=0;a<fa;a++){for(ga=i.getInt16(),V=[],b=0;b<ga;b++){for((da=new La).time=i.getFloat32(),ha=i.getInt16(),c=0;c<ha;c++)da.drawOrder.push(i.getInt16());V.push(da)}this.drawOrderAniArr.push(V)}var ia,ja=i.getInt16(),ka=0;for(a=0;a<ja;a++){for(ka=i.getInt16(),ea=[],b=0;b<ka;b++)(ia=new Ma).name=i.getUTFString(),ia.intValue=i.getInt32(),ia.floatValue=i.getFloat32(),ia.stringValue=i.getUTFString(),ia.time=i.getFloat32(),ea.push(ia);this.eventAniArr.push(ea)}var la=i.getInt16();if(0<la)for(this.attachmentNames=[],a=0;a<la;a++)this.attachmentNames.push(i.getUTFString());var ma,na,oa=i.getInt16();for(a=0;a<oa;a++)(ma=new Ha).name=i.readUTFString(),ma.parent=i.readUTFString(),ma.attachmentName=i.readUTFString(),ma.srcDisplayIndex=ma.displayIndex=i.getInt16(),(ma.templet=this).boneSlotDic[ma.name]=ma,null==(na=this.bindBoneBoneSlotDic[ma.parent])&&(this.bindBoneBoneSlotDic[ma.parent]=na=[]),na.push(ma),this.boneSlotArray.push(ma);var pa,qa,ra,sa=i.readUTFString().split("\n"),ta=0,ua=i.getUint8(),va=0,wa=0,xa=0,ya=0,za=0,Aa=0,Ba=0;for(a=0;a<ua;a++){for((pa=new Pa).name=sa[ta++],va=i.getUint8(),b=0;b<va;b++){for((qa=new Ra).name=sa[ta++],ma=this.boneSlotDic[qa.name],wa=i.getUint8(),c=0;c<wa;c++){if(ra=new Qa,this.skinSlotDisplayDataArr.push(ra),ra.name=sa[ta++],ra.attachmentName=sa[ta++],ra.transform=new Ta,ra.transform.scX=i.getFloat32(),ra.transform.skX=i.getFloat32(),ra.transform.skY=i.getFloat32(),ra.transform.scY=i.getFloat32(),ra.transform.x=i.getFloat32(),ra.transform.y=i.getFloat32(),qa.displayArr.push(ra),ra.width=i.getFloat32(),ra.height=i.getFloat32(),ra.type=i.getUint8(),ra.verLen=i.getUint16(),0<(C=i.getUint16()))for(ra.bones=[],d=0;d<C;d++){var Ca=i.getUint16();ra.bones.push(Ca)}if(0<(xa=i.getUint16()))for(ra.uvs=[],d=0;d<xa;d++)ra.uvs.push(i.getFloat32());if(0<(ya=i.getUint16()))for(ra.weights=[],d=0;d<ya;d++)ra.weights.push(i.getFloat32());if(0<(za=i.getUint16()))for(ra.triangles=[],d=0;d<za;d++)ra.triangles.push(i.getUint16());if(0<(Aa=i.getUint16()))for(ra.vertices=[],d=0;d<Aa;d++)ra.vertices.push(i.getFloat32());if(0<(Ba=i.getUint16()))for(ra.lengths=[],d=0;d<Ba;d++)ra.lengths.push(i.getFloat32())}pa.slotArr.push(qa)}this.skinDic[pa.name]=pa,this.skinDataArray.push(pa)}1==i.getUint8()?(this.yReverseMatrix=new Ea(1,0,0,-1,0,0),B&&B.setTempMatrix(this.yReverseMatrix)):B&&B.setTempMatrix(new Ea),this.showSkinByIndex(this.boneSlotDic,0),this.isParserComplete=!0,this.event("complete",this)},a.getTexture=function(a){var b=this.subTextureDic[a];return b||(b=this.subTextureDic[a.substr(0,a.length-1)]),null==b?this._mainTexture:b},a.showSkinByIndex=function(a,b,c){if(void 0===c&&(c=!0),b<0&&b>=this.skinDataArray.length)return!1;var d,e,f=0,g=0,h=this.skinDataArray[b];if(h){for(f=0,g=h.slotArr.length;f<g;f++)(e=h.slotArr[f])&&(d=a[e.name])&&(d.showSlotData(e,c),c&&"undefined"!=d.attachmentName&&"null"!=d.attachmentName?d.showDisplayByName(d.attachmentName):d.showDisplayByIndex(d.displayIndex));return!0}return!1},a.getSkinIndexByName=function(a){for(var b=0,c=this.skinDataArray.length;b<c;b++)if(this.skinDataArray[b].name==a)return b;return-1},a.getGrahicsDataWithCache=function(a,b){return this._graphicsCache[a][b]},a.setGrahicsDataWithCache=function(a,b,c){this._graphicsCache[a][b]=c},a.destroy=function(){var a;for(var b in this._isDestroyed=!0,this.subTextureDic)(a=this.subTextureDic[b])&&a.destroy();for(b in this._textureDic)(a=this._textureDic[b])&&a.destroy();for(var c=0,d=this.skinSlotDisplayDataArr.length;c<d;c++)this.skinSlotDisplayDataArr[c].destory();this.skinSlotDisplayDataArr.length=0,this.url&&delete e.TEMPLET_DICTIONARY[this.url],laya.resource.Resource.prototype.destroy.call(this)},a.getAniNameByIndex=function(a){var b=this.getAnimation(a);return b?b.name:null},f(0,a,"rate",function(){return this._rate},function(a){this._rate=a}),e.LAYA_ANIMATION_VISION="LAYAANIMATION:1.6.0",e.TEMPLET_DICTIONARY=null,e}(I)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(a,b){"use strict";for(var c in Object.defineProperty(b,"__esModule",{value:!0}),Laya){var d=Laya[c];d&&d.__isclass&&(b[c]=d)}});